"use strict";(self.webpackChunkawesome_notes=self.webpackChunkawesome_notes||[]).push([[2087],{3905:function(e,n,t){t.d(n,{Zo:function(){return c},kt:function(){return u}});var a=t(7294);function l(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){l(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,a,l=function(e,n){if(null==e)return{};var t,a,l={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(l[t]=e[t]);return l}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(l[t]=e[t])}return l}var s=a.createContext({}),p=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},c=function(e){var n=p(e.components);return a.createElement(s.Provider,{value:n},e.children)},m={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},d=a.forwardRef((function(e,n){var t=e.components,l=e.mdxType,r=e.originalType,s=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),d=p(t),u=l,k=d["".concat(s,".").concat(u)]||d[u]||m[u]||r;return t?a.createElement(k,i(i({ref:n},c),{},{components:t})):a.createElement(k,i({ref:n},c))}));function u(e,n){var t=arguments,l=n&&n.mdxType;if("string"==typeof e||l){var r=t.length,i=new Array(r);i[0]=d;var o={};for(var s in n)hasOwnProperty.call(n,s)&&(o[s]=n[s]);o.originalType=e,o.mdxType="string"==typeof e?e:l,i[1]=o;for(var p=2;p<r;p++)i[p]=t[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}d.displayName="MDXCreateElement"},4222:function(e,n,t){t.r(n),t.d(n,{assets:function(){return c},contentTitle:function(){return s},default:function(){return u},frontMatter:function(){return o},metadata:function(){return p},toc:function(){return m}});var a=t(7462),l=t(3366),r=(t(7294),t(3905)),i=["components"],o={author:"Sabertazimi",authorTitle:"Web Developer",authorURL:"https://github.com/sabertazimi",authorImageURL:"https://github.com/sabertazimi.png",tags:["Web","JavaScript","ECMAScript"]},s="JavaScript Advanced Notes",p={unversionedId:"web/javascript/javascriptAdvancedNotes",id:"web/javascript/javascriptAdvancedNotes",title:"JavaScript Advanced Notes",description:"BOM",source:"@site/notes/web/javascript/javascriptAdvancedNotes.md",sourceDirName:"web/javascript",slug:"/web/javascript/javascriptAdvancedNotes",permalink:"/awesome-notes/web/javascript/javascriptAdvancedNotes",editUrl:"https://github.com/sabertazimi/awesome-notes/edit/main/notes/web/javascript/javascriptAdvancedNotes.md",tags:[{label:"Web",permalink:"/awesome-notes/tags/web"},{label:"JavaScript",permalink:"/awesome-notes/tags/java-script"},{label:"ECMAScript",permalink:"/awesome-notes/tags/ecma-script"}],version:"current",lastUpdatedBy:"sabertazimi",lastUpdatedAt:1651181444,formattedLastUpdatedAt:"4/28/2022",frontMatter:{author:"Sabertazimi",authorTitle:"Web Developer",authorURL:"https://github.com/sabertazimi",authorImageURL:"https://github.com/sabertazimi.png",tags:["Web","JavaScript","ECMAScript"]},sidebar:"sidebar",previous:{title:"HTML Basic Notes",permalink:"/awesome-notes/web/html/htmlBasicNotes"},next:{title:"JavaScript Basic Notes",permalink:"/awesome-notes/web/javascript/javascriptBasicNotes"}},c={},m=[{value:"BOM",id:"bom",level:2},{value:"Window",id:"window",level:3},{value:"Location",id:"location",level:3},{value:"Navigator",id:"navigator",level:3},{value:"Web Online API",id:"web-online-api",level:4},{value:"Web Connection API",id:"web-connection-api",level:4},{value:"Web Protocol Handler API",id:"web-protocol-handler-api",level:4},{value:"Web Battery Status API",id:"web-battery-status-api",level:4},{value:"Web Storage Estimate API",id:"web-storage-estimate-api",level:4},{value:"Web Geolocation API",id:"web-geolocation-api",level:4},{value:"Navigator User Agent",id:"navigator-user-agent",level:4},{value:"Screen",id:"screen",level:3},{value:"History",id:"history",level:3},{value:"History Navigation",id:"history-navigation",level:4},{value:"History State Management",id:"history-state-management",level:4},{value:"Browser Compatibility",id:"browser-compatibility",level:3},{value:"User Agent Detection",id:"user-agent-detection",level:4},{value:"Browser Feature Detection",id:"browser-feature-detection",level:4},{value:"DOM",id:"dom",level:2},{value:"DOM Core",id:"dom-core",level:3},{value:"DOM Node Type",id:"dom-node-type",level:4},{value:"DOM Attribute Node",id:"dom-attribute-node",level:4},{value:"DOM Text Node",id:"dom-text-node",level:4},{value:"DOM Document Node",id:"dom-document-node",level:4},{value:"DOM Document Type Node",id:"dom-document-type-node",level:4},{value:"DOM Document Fragment Node",id:"dom-document-fragment-node",level:4},{value:"DOM Programming",id:"dom-programming",level:3},{value:"Append DOM Node",id:"append-dom-node",level:4},{value:"Insert DOM Node",id:"insert-dom-node",level:4},{value:"Replace DOM Node",id:"replace-dom-node",level:4},{value:"Remove DOM Node",id:"remove-dom-node",level:4},{value:"Traverse DOM Node",id:"traverse-dom-node",level:4},{value:"Attributes DOM Node",id:"attributes-dom-node",level:4},{value:"Select DOM Node",id:"select-dom-node",level:4},{value:"Dynamic Scripts Loading",id:"dynamic-scripts-loading",level:4},{value:"Dynamic Styles Loading",id:"dynamic-styles-loading",level:4},{value:"Table Manipulation",id:"table-manipulation",level:4},{value:"CSSOM",id:"cssom",level:3},{value:"Inline Styles",id:"inline-styles",level:4},{value:"Styles Getter and Setter",id:"styles-getter-and-setter",level:4},{value:"Computed Styles",id:"computed-styles",level:4},{value:"CSS Class List",id:"css-class-list",level:4},{value:"DOM StyleSheets API",id:"dom-stylesheets-api",level:4},{value:"CSS Rules Definition",id:"css-rules-definition",level:5},{value:"Media Rules",id:"media-rules",level:5},{value:"Keyframe Rules",id:"keyframe-rules",level:5},{value:"Manipulate CSS Rules",id:"manipulate-css-rules",level:5},{value:"DOM Events",id:"dom-events",level:3},{value:"Events Object",id:"events-object",level:4},{value:"Events Checking",id:"events-checking",level:4},{value:"Global UI Events",id:"global-ui-events",level:4},{value:"Form Events",id:"form-events",level:4},{value:"Input Events",id:"input-events",level:4},{value:"Input Focus Event",id:"input-focus-event",level:5},{value:"Input Change Event",id:"input-change-event",level:5},{value:"Input Select Event",id:"input-select-event",level:5},{value:"Clipboard Events",id:"clipboard-events",level:4},{value:"Mouse Events",id:"mouse-events",level:4},{value:"Keyboard Events",id:"keyboard-events",level:4},{value:"Device Events",id:"device-events",level:4},{value:"Dispatch Events",id:"dispatch-events",level:4},{value:"Events Util",id:"events-util",level:4},{value:"DOM Rect",id:"dom-rect",level:3},{value:"DOM Width and Height",id:"dom-width-and-height",level:4},{value:"DOM Left and Top",id:"dom-left-and-top",level:4},{value:"DOM Scroll Size",id:"dom-scroll-size",level:4},{value:"DOM Observer",id:"dom-observer",level:3},{value:"Intersection Observer",id:"intersection-observer",level:4},{value:"Mutation Observer",id:"mutation-observer",level:4},{value:"XML Namespace",id:"xml-namespace",level:3},{value:"JavaScript Engine",id:"javascript-engine",level:2},{value:"Variables Lifecycle",id:"variables-lifecycle",level:3},{value:"Execution Context",id:"execution-context",level:3},{value:"Global Execution Context",id:"global-execution-context",level:4},{value:"Function Execution Context",id:"function-execution-context",level:4},{value:"Event Loop",id:"event-loop",level:3},{value:"Browser Event Loop",id:"browser-event-loop",level:4},{value:"Node Event Loop",id:"node-event-loop",level:4},{value:"V8 Good Parts",id:"v8-good-parts",level:2},{value:"V8 Object Shape",id:"v8-object-shape",level:3},{value:"V8 Inline Cache",id:"v8-inline-cache",level:3},{value:"V8 Garbage Collection",id:"v8-garbage-collection",level:3},{value:"V8 Scavenge GC Algorithm",id:"v8-scavenge-gc-algorithm",level:4},{value:"V8 Mark-Sweep-Compact GC Algorithm",id:"v8-mark-sweep-compact-gc-algorithm",level:4},{value:"V8 GC Stop-The-World",id:"v8-gc-stop-the-world",level:4},{value:"V8 Performance Tools",id:"v8-performance-tools",level:3},{value:"V8 Performance Reference",id:"v8-performance-reference",level:3},{value:"Browser Engine",id:"browser-engine",level:2},{value:"Browser Process",id:"browser-process",level:3},{value:"Render Engine",id:"render-engine",level:3},{value:"HTML Parser",id:"html-parser",level:4},{value:"CSS Parser",id:"css-parser",level:4},{value:"Render Blocking Resources Type",id:"render-blocking-resources-type",level:4},{value:"Render Blocking Resources Performance",id:"render-blocking-resources-performance",level:4},{value:"Layout",id:"layout",level:4},{value:"Paint",id:"paint",level:4},{value:"Browser Engine Reference",id:"browser-engine-reference",level:3},{value:"Effective JavaScript",id:"effective-javascript",level:2},{value:"Memory Leak",id:"memory-leak",level:3},{value:"Danger Features",id:"danger-features",level:3},{value:"Function Performance",id:"function-performance",level:3},{value:"Local Variables Performance",id:"local-variables-performance",level:4},{value:"Scope Chain Performance",id:"scope-chain-performance",level:4},{value:"Loop Performance",id:"loop-performance",level:3},{value:"Event Delegation",id:"event-delegation",level:3},{value:"Cache Pattern",id:"cache-pattern",level:3},{value:"Script Loading Performance",id:"script-loading-performance",level:3},{value:"Script Lazy Loading",id:"script-lazy-loading",level:4},{value:"Script Dynamic Loading",id:"script-dynamic-loading",level:4},{value:"DOM Performance",id:"dom-performance",level:3},{value:"Layout and Paint Performance",id:"layout-and-paint-performance",level:4},{value:"DOM Manipulation Performance",id:"dom-manipulation-performance",level:4},{value:"Animation Frame Performance",id:"animation-frame-performance",level:4},{value:"CSS Performance",id:"css-performance",level:3},{value:"Timer Performance",id:"timer-performance",level:3},{value:"Time Slicing Pattern",id:"time-slicing-pattern",level:4},{value:"Task Batching Pattern",id:"task-batching-pattern",level:4},{value:"Reduce Repeat Manipulation",id:"reduce-repeat-manipulation",level:3},{value:"Debounce and Throttle",id:"debounce-and-throttle",level:4},{value:"Animation Frame Throttling",id:"animation-frame-throttling",level:4},{value:"Math Performance",id:"math-performance",level:3},{value:"Bit Operators",id:"bit-operators",level:4},{value:"Browser Performance",id:"browser-performance",level:2},{value:"Browser Caches",id:"browser-caches",level:3},{value:"HTTP Cache",id:"http-cache",level:4},{value:"Code Cache",id:"code-cache",level:4},{value:"Performance Monitoring",id:"performance-monitoring",level:3},{value:"Synthetic Monitoring",id:"synthetic-monitoring",level:4},{value:"Real User Monitoring",id:"real-user-monitoring",level:4},{value:"SYN and RUM",id:"syn-and-rum",level:4},{value:"Monitoring Methods",id:"monitoring-methods",level:4},{value:"Monitoring Standard API",id:"monitoring-standard-api",level:4},{value:"Monitoring Statistics Data",id:"monitoring-statistics-data",level:4},{value:"Monitoring Report Dimension",id:"monitoring-report-dimension",level:4},{value:"Monitoring Report Performance",id:"monitoring-report-performance",level:4},{value:"Images Performance",id:"images-performance",level:3},{value:"Responsive Images",id:"responsive-images",level:4},{value:"Pre-fetch Loading Images",id:"pre-fetch-loading-images",level:4},{value:"Lazy Loading Images",id:"lazy-loading-images",level:4},{value:"Placeholder Images",id:"placeholder-images",level:4},{value:"Images Format",id:"images-format",level:4},{value:"Images Compression and Minification",id:"images-compression-and-minification",level:4},{value:"Images Performance Reference",id:"images-performance-reference",level:4},{value:"Data Loading",id:"data-loading",level:3},{value:"Data Preloading",id:"data-preloading",level:4},{value:"Images Lazy Loading",id:"images-lazy-loading",level:4},{value:"JavaScript Lazy Loading",id:"javascript-lazy-loading",level:4},{value:"PreFetch and PreLoad",id:"prefetch-and-preload",level:4},{value:"Babel Configuration for JavaScript",id:"babel-configuration-for-javascript",level:4},{value:"Data Loading Best Practice",id:"data-loading-best-practice",level:4},{value:"Performance API",id:"performance-api",level:3},{value:"First Paint Time",id:"first-paint-time",level:4},{value:"FCP",id:"fcp",level:4},{value:"LCP",id:"lcp",level:4},{value:"CLS",id:"cls",level:4},{value:"PRPL Pattern",id:"prpl-pattern",level:3},{value:"Performance Best Practice",id:"performance-best-practice",level:3},{value:"Performance and Analysis Tools",id:"performance-and-analysis-tools",level:3},{value:"Inspect Android Device",id:"inspect-android-device",level:4},{value:"Performance Reference",id:"performance-reference",level:3},{value:"Testing and Debugging",id:"testing-and-debugging",level:2},{value:"Log",id:"log",level:3},{value:"Log Clock",id:"log-clock",level:4},{value:"Headless Testing",id:"headless-testing",level:3},{value:"Browser Context",id:"browser-context",level:4},{value:"DOM Testing",id:"dom-testing",level:4},{value:"Event Testing",id:"event-testing",level:4},{value:"Operation Simulation Testing",id:"operation-simulation-testing",level:4},{value:"Tracing Testing",id:"tracing-testing",level:4},{value:"Puppeteer Testing API",id:"puppeteer-testing-api",level:4},{value:"Testing Frameworks",id:"testing-frameworks",level:3},{value:"Unit Testing Frameworks",id:"unit-testing-frameworks",level:4},{value:"UI Testing Frameworks",id:"ui-testing-frameworks",level:4},{value:"Testable Code",id:"testable-code",level:3},{value:"\u5708\u590d\u6742\u5ea6",id:"\u5708\u590d\u6742\u5ea6",level:3},{value:"\u51fd\u6570\u590d\u6742\u5ea6",id:"\u51fd\u6570\u590d\u6742\u5ea6",level:3},{value:"\u6247\u51fa",id:"\u6247\u51fa",level:4},{value:"\u6247\u5165",id:"\u6247\u5165",level:4},{value:"\u8026\u5408\u5ea6",id:"\u8026\u5408\u5ea6",level:3},{value:"\u5185\u5bb9\u8026\u5408",id:"\u5185\u5bb9\u8026\u5408",level:4},{value:"\u516c\u5171\u8026\u5408",id:"\u516c\u5171\u8026\u5408",level:4},{value:"\u63a7\u5236\u8026\u5408",id:"\u63a7\u5236\u8026\u5408",level:4},{value:"\u5370\u8bb0\u8026\u5408",id:"\u5370\u8bb0\u8026\u5408",level:4},{value:"\u6570\u636e\u8026\u5408",id:"\u6570\u636e\u8026\u5408",level:4},{value:"\u65e0\u8026\u5408",id:"\u65e0\u8026\u5408",level:4},{value:"Unit Testing",id:"unit-testing",level:3},{value:"Unit Testing Principles",id:"unit-testing-principles",level:4},{value:"Testing Code Isolation",id:"testing-code-isolation",level:4},{value:"Mock Testing",id:"mock-testing",level:4},{value:"Monkey Patch",id:"monkey-patch",level:3},{value:"Window State Injection",id:"window-state-injection",level:4},{value:"Event Propagation Injection",id:"event-propagation-injection",level:4},{value:"Window Scroll Injection",id:"window-scroll-injection",level:4},{value:"Console API",id:"console-api",level:3},{value:"JavaScript Testing and Tracing API",id:"javascript-testing-and-tracing-api",level:3},{value:"Trace Property",id:"trace-property",level:4},{value:"Node Testing API",id:"node-testing-api",level:3},{value:"Jest Testing",id:"jest-testing",level:2},{value:"Jest Installation",id:"jest-installation",level:3},{value:"Jest Configuration",id:"jest-configuration",level:3},{value:"Jest Basic Testing",id:"jest-basic-testing",level:3},{value:"Jest Snapshot Testing",id:"jest-snapshot-testing",level:3},{value:"Jest Async Testing",id:"jest-async-testing",level:3},{value:"Jest Mocks",id:"jest-mocks",level:3},{value:"Jest Internals",id:"jest-internals",level:3},{value:"E2E Testing",id:"e2e-testing",level:2},{value:"Cypress Installation",id:"cypress-installation",level:3},{value:"Cypress Configuration",id:"cypress-configuration",level:3},{value:"Basic Cypress Testing",id:"basic-cypress-testing",level:3},{value:"Cypress Reference",id:"cypress-reference",level:3},{value:"Chrome DevTools",id:"chrome-devtools",level:2},{value:"DevTools Detection",id:"devtools-detection",level:3},{value:"Console DevTools Detection",id:"console-devtools-detection",level:4},{value:"Debugger Detection",id:"debugger-detection",level:4},{value:"Chrome DevTools Shortcuts",id:"chrome-devtools-shortcuts",level:3},{value:"Elements Panel",id:"elements-panel",level:3},{value:"Style Tab",id:"style-tab",level:4},{value:"Console Panel",id:"console-panel",level:3},{value:"Console Settings",id:"console-settings",level:4},{value:"Capture Default Event Listener",id:"capture-default-event-listener",level:4},{value:"Source Panel",id:"source-panel",level:3},{value:"Network Panel",id:"network-panel",level:3},{value:"Performance Panel",id:"performance-panel",level:3},{value:"Simulation DevTools",id:"simulation-devtools",level:3},{value:"Audit DevTool",id:"audit-devtool",level:3},{value:"Coverage Tool",id:"coverage-tool",level:3},{value:"Memory Panel",id:"memory-panel",level:3},{value:"JS Profiler Panel",id:"js-profiler-panel",level:3},{value:"Layer Panel",id:"layer-panel",level:3},{value:"Rendering Panel",id:"rendering-panel",level:3},{value:"Animation Panel",id:"animation-panel",level:3},{value:"JavaScript Style Guide",id:"javascript-style-guide",level:2},{value:"ESLint",id:"eslint",level:3},{value:"Naming Style",id:"naming-style",level:3},{value:"Variable Style",id:"variable-style",level:3},{value:"Object Style",id:"object-style",level:3},{value:"Array Style",id:"array-style",level:3},{value:"Destruct Style",id:"destruct-style",level:3},{value:"String Style",id:"string-style",level:3},{value:"Function Style",id:"function-style",level:3},{value:"Arrow Function Style",id:"arrow-function-style",level:3},{value:"Module Style",id:"module-style",level:3},{value:"Iterator and Generator Style",id:"iterator-and-generator-style",level:3},{value:"Expression Style",id:"expression-style",level:3},{value:"Space Style",id:"space-style",level:3},{value:"Comments Style",id:"comments-style",level:3},{value:"Web Animations",id:"web-animations",level:2},{value:"Web Canvas",id:"web-canvas",level:2},{value:"Canvas Basic Usage",id:"canvas-basic-usage",level:3},{value:"Canvas Game Loop",id:"canvas-game-loop",level:3},{value:"Canvas Performance",id:"canvas-performance",level:3},{value:"Canvas Reference",id:"canvas-reference",level:3},{value:"Web Audio",id:"web-audio",level:2},{value:"Oscillator",id:"oscillator",level:3},{value:"Music Data",id:"music-data",level:3},{value:"Audio Bar Chart",id:"audio-bar-chart",level:3},{value:"Media Session",id:"media-session",level:2},{value:"Web Storage",id:"web-storage",level:2},{value:"Cookie",id:"cookie",level:3},{value:"Local Storage",id:"local-storage",level:3},{value:"IndexDB",id:"indexdb",level:3},{value:"File API",id:"file-api",level:3},{value:"Web RTC",id:"web-rtc",level:2},{value:"Web Gamepad",id:"web-gamepad",level:2},{value:"PWA",id:"pwa",level:2},{value:"Service Worker",id:"service-worker",level:3},{value:"Service Worker Pros",id:"service-worker-pros",level:4},{value:"Service Worker Costs",id:"service-worker-costs",level:4},{value:"Service Worker Caching Strategy",id:"service-worker-caching-strategy",level:4},{value:"Service Worker Usage",id:"service-worker-usage",level:4},{value:"PWA Library",id:"pwa-library",level:3},{value:"PWA Reference",id:"pwa-reference",level:3},{value:"JamStack",id:"jamstack",level:2},{value:"Rendering Patterns",id:"rendering-patterns",level:3},{value:"CSR",id:"csr",level:3},{value:"SSR",id:"ssr",level:3},{value:"SSG",id:"ssg",level:3},{value:"ISR",id:"isr",level:3},{value:"SEO",id:"seo",level:2},{value:"SEO Metadata",id:"seo-metadata",level:3},{value:"SEO Best Practice",id:"seo-best-practice",level:3},{value:"SEO Reference",id:"seo-reference",level:3},{value:"Network",id:"network",level:2},{value:"JSON",id:"json",level:3},{value:"AJAX",id:"ajax",level:3},{value:"AJAX Data Format",id:"ajax-data-format",level:4},{value:"Ajax Usage",id:"ajax-usage",level:4},{value:"Ajax Cross Origin Request",id:"ajax-cross-origin-request",level:4},{value:"AJAX Alternatives",id:"ajax-alternatives",level:4},{value:"Fetch",id:"fetch",level:3},{value:"Fetch Basis Usage",id:"fetch-basis-usage",level:4},{value:"Fetch Form Data",id:"fetch-form-data",level:4},{value:"Fetch Aborting",id:"fetch-aborting",level:4},{value:"Fetch Objects API",id:"fetch-objects-api",level:4},{value:"Fetch Streaming",id:"fetch-streaming",level:4},{value:"WebSocket",id:"websocket",level:3},{value:"WebSocket Message Header",id:"websocket-message-header",level:4},{value:"WebSocket Basic Usage",id:"websocket-basic-usage",level:4},{value:"WebSocket HeartBeat Mechanism",id:"websocket-heartbeat-mechanism",level:4},{value:"RESTful",id:"restful",level:3},{value:"HTTPS",id:"https",level:3},{value:"HTTPS \u901a\u4fe1\u8fc7\u7a0b",id:"https-\u901a\u4fe1\u8fc7\u7a0b",level:4},{value:"HTTPS \u5b89\u5168\u6027",id:"https-\u5b89\u5168\u6027",level:4},{value:"HTTP 2",id:"http-2",level:3},{value:"HTTP 3",id:"http-3",level:3},{value:"HTTP Response Status Codes",id:"http-response-status-codes",level:3},{value:"CORS",id:"cors",level:3},{value:"Web Authentication",id:"web-authentication",level:2},{value:"HTTP Basic Authentication",id:"http-basic-authentication",level:3},{value:"Session Cookie",id:"session-cookie",level:3},{value:"Session Cookie Basis",id:"session-cookie-basis",level:4},{value:"Session Cookie Cons",id:"session-cookie-cons",level:4},{value:"Token Authentication",id:"token-authentication",level:3},{value:"Token Authentication Basis",id:"token-authentication-basis",level:4},{value:"Token Authentication Pros",id:"token-authentication-pros",level:4},{value:"Token Authentication Cons",id:"token-authentication-cons",level:4},{value:"JSON Web Token",id:"json-web-token",level:3},{value:"JSON Web Token Basis",id:"json-web-token-basis",level:4},{value:"JSON Web TOken Pros",id:"json-web-token-pros",level:4},{value:"JSON Web Token Cons",id:"json-web-token-cons",level:4},{value:"JWT Client",id:"jwt-client",level:4},{value:"OAuth Authentication",id:"oauth-authentication",level:3},{value:"OAuth Authentication Basis",id:"oauth-authentication-basis",level:4},{value:"OAuth 2.0",id:"oauth-20",level:4},{value:"OAuth Usage",id:"oauth-usage",level:4},{value:"Single Sign On",id:"single-sign-on",level:3},{value:"Security",id:"security",level:2},{value:"Content Security Policy Level 3",id:"content-security-policy-level-3",level:3},{value:"Trusted Types",id:"trusted-types",level:3},{value:"CSRF",id:"csrf",level:3},{value:"Sandbox",id:"sandbox",level:3},{value:"User Privacy",id:"user-privacy",level:3},{value:"User Fingerprint",id:"user-fingerprint",level:4},{value:"Crypto",id:"crypto",level:3},{value:"DevOps",id:"devops",level:2},{value:"Static Assets",id:"static-assets",level:3},{value:"CI System",id:"ci-system",level:3},{value:"Release System",id:"release-system",level:3},{value:"Blue Green Deployment",id:"blue-green-deployment",level:3},{value:"Rolling Update",id:"rolling-update",level:3},{value:"Gray Release",id:"gray-release",level:3},{value:"Gray Release Introduction",id:"gray-release-introduction",level:4},{value:"Gray Release Solution",id:"gray-release-solution",level:4},{value:"Gray Release Performance",id:"gray-release-performance",level:4},{value:"Zero Trust Access Control",id:"zero-trust-access-control",level:3},{value:"Chain of Trust",id:"chain-of-trust",level:4},{value:"Identity 2.0",id:"identity-20",level:4},{value:"Continuous Access Control",id:"continuous-access-control",level:4},{value:"Zero Trust Basement",id:"zero-trust-basement",level:4},{value:"Babel",id:"babel",level:2},{value:"Babel Node",id:"babel-node",level:3},{value:"Babel Core",id:"babel-core",level:3},{value:"CodeMod Tool",id:"codemod-tool",level:3},{value:"Babel Transform Plugin",id:"babel-transform-plugin",level:3},{value:"Babel Preset Plugin",id:"babel-preset-plugin",level:3},{value:"Webpack",id:"webpack",level:2},{value:"Webpack Internals",id:"webpack-internals",level:3},{value:"Webpack Configuration Intellisense",id:"webpack-configuration-intellisense",level:3},{value:"Webpack Hot Module Replacement",id:"webpack-hot-module-replacement",level:3},{value:"Webpack Watch Options",id:"webpack-watch-options",level:3},{value:"Webpack Resolve Path Options",id:"webpack-resolve-path-options",level:3},{value:"Webpack Flag Options",id:"webpack-flag-options",level:3},{value:"Webpack Devtool Source Map Configuration",id:"webpack-devtool-source-map-configuration",level:3},{value:"Webpack Cache Configuration",id:"webpack-cache-configuration",level:3},{value:"Webpack Build Cache",id:"webpack-build-cache",level:4},{value:"Webpack Browser Cache",id:"webpack-browser-cache",level:4},{value:"Webpack Library Configuration",id:"webpack-library-configuration",level:3},{value:"Webpack Loader Configuration",id:"webpack-loader-configuration",level:3},{value:"Webpack Babel Loader",id:"webpack-babel-loader",level:4},{value:"Webpack CSS Loader",id:"webpack-css-loader",level:4},{value:"Webpack Static Assets Loader",id:"webpack-static-assets-loader",level:4},{value:"Webpack Resource Assets",id:"webpack-resource-assets",level:5},{value:"Webpack Inline Assets",id:"webpack-inline-assets",level:5},{value:"Webpack Source Assets",id:"webpack-source-assets",level:5},{value:"Webpack Thread Loader",id:"webpack-thread-loader",level:4},{value:"Webpack Web Worker Loader",id:"webpack-web-worker-loader",level:4},{value:"Webpack Optimization",id:"webpack-optimization",level:3},{value:"Common Libraries",id:"common-libraries",level:4},{value:"Common Chunks",id:"common-chunks",level:4},{value:"Code Minimization",id:"code-minimization",level:4},{value:"Code Splitting",id:"code-splitting",level:4},{value:"Tree Shaking",id:"tree-shaking",level:4},{value:"Building Caches",id:"building-caches",level:4},{value:"Webpack Perf Profiling",id:"webpack-perf-profiling",level:4},{value:"Commit Linter",id:"commit-linter",level:4},{value:"Webpack Plugins",id:"webpack-plugins",level:3},{value:"Webpack HTML Plugins",id:"webpack-html-plugins",level:4},{value:"Webpack JavaScript Plugins",id:"webpack-javascript-plugins",level:4},{value:"Webpack CSS Plugins",id:"webpack-css-plugins",level:4},{value:"Webpack Images Plugins",id:"webpack-images-plugins",level:4},{value:"Webpack Building Work Plugins",id:"webpack-building-work-plugins",level:4},{value:"Webpack Bundles UI Plugins",id:"webpack-bundles-ui-plugins",level:4},{value:"Webpack DLL Plugins",id:"webpack-dll-plugins",level:4},{value:"Webpack Other Plugins",id:"webpack-other-plugins",level:4},{value:"Webpack Custom Plugin",id:"webpack-custom-plugin",level:4},{value:"Webpack Migrate to 5",id:"webpack-migrate-to-5",level:3},{value:"Webpack Reference",id:"webpack-reference",level:3},{value:"Vite",id:"vite",level:2}],d={toc:m};function u(e){var n=e.components,o=(0,l.Z)(e,i);return(0,r.kt)("wrapper",(0,a.Z)({},d,o,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"javascript-advanced-notes"},"JavaScript Advanced Notes"),(0,r.kt)("h2",{id:"bom"},"BOM"),(0,r.kt)("h3",{id:"window"},"Window"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const selfWindow = window.self;\nconst topWindow = window.top;\nconst parentWindow = window.parent;\nconst grandParentWindow = window.parent.parent;\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// eslint-disable-next-line no-restricted-globals\nif (confirm('Are you sure?')) {\n  alert(\"I'm so glad you're sure!\");\n} else {\n  alert(\"I'm sorry to hear you're not sure.\");\n}\n\nconst result = prompt('What is your name? ', 'James');\nif (result !== null) {\n  alert(`Welcome, ${result}`);\n}\n\n// \u663e\u793a\u6253\u5370\u5bf9\u8bdd\u6846\nwindow.print();\n\n// \u663e\u793a\u67e5\u627e\u5bf9\u8bdd\u6846\nwindow.find();\n\n// \u663e\u5f0f\u6253\u5370\u673a\nwindow.print();\n")),(0,r.kt)("p",null,"\u5f39\u7a97\u6709\u975e\u5e38\u591a\u7684\u5b89\u5168\u9650\u5236:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u7981\u6b62\u9690\u85cf\u72b6\u6001\u680f\u4e0e\u5730\u5740\u680f."),(0,r.kt)("li",{parentName:"ul"},"\u5f39\u7a97\u9ed8\u8ba4\u4e0d\u80fd\u79fb\u52a8\u6216\u7f29\u653e."),(0,r.kt)("li",{parentName:"ul"},"\u53ea\u5141\u8bb8\u7528\u6237\u64cd\u4f5c\u4e0b (\u9f20\u6807/\u952e\u76d8) \u521b\u5efa\u5f39\u7a97."),(0,r.kt)("li",{parentName:"ul"},"\u5c4f\u853d\u5f39\u7a97.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const newWin = window.open(\n  'https://www.new.com/',\n  'newWindow',\n  'height=400,width=400,top=10,left=10,resizable=yes'\n);\nnewWin.resizeTo(500, 500);\nnewWin.moveTo(100, 100);\nalert(newWin.opener === window); // true\nnewWin.close();\nalert(newWin.closed); // true\n\nlet blocked = false;\ntry {\n  const newWin = window.open('https://www.new.com/', '_blank');\n  if (newWin === null) {\n    blocked = true;\n  }\n} catch (ex) {\n  blocked = true;\n}\nif (blocked) {\n  alert('The popup was blocked!');\n}\n")),(0,r.kt)("h3",{id:"location"},"Location"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"\u5c5e\u6027"),(0,r.kt)("th",{parentName:"tr",align:"left"},"\u63cf\u8ff0"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"hash"),(0,r.kt)("td",{parentName:"tr",align:"left"},"\u8bbe\u7f6e\u6216\u8fd4\u56de\u4ece\u4e95\u53f7 (#) \u5f00\u59cb\u7684 URL (\u951a)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"host"),(0,r.kt)("td",{parentName:"tr",align:"left"},"\u8bbe\u7f6e\u6216\u8fd4\u56de\u4e3b\u673a\u540d\u548c\u5f53\u524d URL \u7684\u7aef\u53e3\u53f7")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"hostname"),(0,r.kt)("td",{parentName:"tr",align:"left"},"\u8bbe\u7f6e\u6216\u8fd4\u56de\u5f53\u524d URL \u7684\u4e3b\u673a\u540d")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"href"),(0,r.kt)("td",{parentName:"tr",align:"left"},"\u8bbe\u7f6e\u6216\u8fd4\u56de\u5b8c\u6574\u7684 URL")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"pathname"),(0,r.kt)("td",{parentName:"tr",align:"left"},"\u8bbe\u7f6e\u6216\u8fd4\u56de\u5f53\u524d URL \u7684\u8def\u5f84\u90e8\u5206")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"port"),(0,r.kt)("td",{parentName:"tr",align:"left"},"\u8bbe\u7f6e\u6216\u8fd4\u56de\u5f53\u524d URL \u7684\u7aef\u53e3\u53f7")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"protocol"),(0,r.kt)("td",{parentName:"tr",align:"left"},"\u8bbe\u7f6e\u6216\u8fd4\u56de\u5f53\u524d URL \u7684\u534f\u8bae")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"search"),(0,r.kt)("td",{parentName:"tr",align:"left"},"\u8bbe\u7f6e\u6216\u8fd4\u56de\u4ece\u95ee\u53f7 (?) \u5f00\u59cb\u7684 URL (\u67e5\u8be2\u90e8\u5206)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"username"),(0,r.kt)("td",{parentName:"tr",align:"left"},"\u8bbe\u7f6e\u6216\u8fd4\u56de\u57df\u540d\u524d\u6307\u5b9a\u7684\u7528\u6237\u540d")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"password"),(0,r.kt)("td",{parentName:"tr",align:"left"},"\u8bbe\u7f6e\u6216\u8fd4\u56de\u57df\u540d\u524d\u6307\u5b9a\u7684\u5bc6\u7801")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"origin"),(0,r.kt)("td",{parentName:"tr",align:"left"},"\u8fd4\u56de URL \u7684\u6e90\u5730\u5740")))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"function getQueryStringArgs(location) {\n  // \u53d6\u5f97\u6ca1\u6709\u5f00\u5934\u95ee\u53f7\u7684\u67e5\u8be2\u5b57\u7b26\u4e32\n  const qs = location.search.length > 0 ? location.search.substring(1) : '';\n  // \u4fdd\u5b58\u6570\u636e\u7684\u5bf9\u8c61\n  const args = {};\n\n  // \u628a\u6bcf\u4e2a\u53c2\u6570\u6dfb\u52a0\u5230 args \u5bf9\u8c61\n  for (const item of qs.split('&').map(kv => kv.split('='))) {\n    const name = decodeURIComponent(item[0]);\n    const value = decodeURIComponent(item[1]);\n\n    if (name.length) {\n      args[name] = value;\n    }\n  }\n\n  return args;\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"window.location.assign('https://www.new.com');\nwindow.location = 'https://www.new.com';\nwindow.location.href = 'https://www.new.com';\nwindow.location.replace('https://www.new.com'); // No new history\nwindow.location.reload(); // \u91cd\u65b0\u52a0\u8f7d, \u53ef\u80fd\u662f\u4ece\u7f13\u5b58\u52a0\u8f7d\nwindow.location.reload(true); // \u91cd\u65b0\u52a0\u8f7d, \u4ece\u670d\u52a1\u5668\u52a0\u8f7d\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"window.addEventListener(\n  'hashchange',\n  event => {\n    // event.oldURL\n    // event.nweURL\n    if (window.location.hash === '#someCoolFeature') {\n      someCoolFeature();\n    }\n  },\n  false\n);\n")),(0,r.kt)("h3",{id:"navigator"},"Navigator"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"navigator")," \u5bf9\u8c61\u5305\u542b\u4ee5\u4e0b\u63a5\u53e3\u5b9a\u4e49\u7684\u5c5e\u6027\u548c\u65b9\u6cd5:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"NavigatorID."),(0,r.kt)("li",{parentName:"ul"},"NavigatorLanguage."),(0,r.kt)("li",{parentName:"ul"},"NavigatorOnLine."),(0,r.kt)("li",{parentName:"ul"},"NavigatorContentUtils."),(0,r.kt)("li",{parentName:"ul"},"NavigatorStorage."),(0,r.kt)("li",{parentName:"ul"},"NavigatorStorageUtils."),(0,r.kt)("li",{parentName:"ul"},"NavigatorConcurrentHardware."),(0,r.kt)("li",{parentName:"ul"},"NavigatorPlugins."),(0,r.kt)("li",{parentName:"ul"},"NavigatorUserMedia.")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Property/Method"),(0,r.kt)("th",{parentName:"tr",align:null}))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"battery"),(0,r.kt)("td",{parentName:"tr",align:null},"BatteryManager (Battery Status API)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"clipboard"),(0,r.kt)("td",{parentName:"tr",align:null},"Clipboard API")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"connection"),(0,r.kt)("td",{parentName:"tr",align:null},"NetworkInformation (Network Information API)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"cookieEnabled"),(0,r.kt)("td",{parentName:"tr",align:null},"Boolean, \u662f\u5426\u542f\u7528\u4e86 cookie")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"credentials"),(0,r.kt)("td",{parentName:"tr",align:null},"CredentialsContainer (Credentials Management API)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"deviceMemory"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5355\u4f4d\u4e3a GB \u7684\u8bbe\u5907\u5185\u5b58\u5bb9\u91cf")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"doNotTrack"),(0,r.kt)("td",{parentName:"tr",align:null},"\u7528\u6237\u7684",(0,r.kt)("inlineCode",{parentName:"td"},"\u4e0d\u8ddf\u8e2a")," (",(0,r.kt)("inlineCode",{parentName:"td"},"do-not-track"),") \u8bbe\u7f6e")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"geolocation"),(0,r.kt)("td",{parentName:"tr",align:null},"Geolocation (Geolocation API)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"hardwareConcurrency"),(0,r.kt)("td",{parentName:"tr",align:null},"\u8bbe\u5907\u7684\u5904\u7406\u5668\u6838\u5fc3\u6570\u91cf")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"language"),(0,r.kt)("td",{parentName:"tr",align:null},"\u6d4f\u89c8\u5668\u7684\u4e3b\u8bed\u8a00")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"languages"),(0,r.kt)("td",{parentName:"tr",align:null},"\u6d4f\u89c8\u5668\u504f\u597d\u7684\u8bed\u8a00\u6570\u7ec4")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"locks"),(0,r.kt)("td",{parentName:"tr",align:null},"LockManager (Web Locks API)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"mediaCapabilities"),(0,r.kt)("td",{parentName:"tr",align:null},"MediaCapabilities (Media Capabilities API)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"mediaDevices"),(0,r.kt)("td",{parentName:"tr",align:null},"\u53ef\u7528\u7684\u5a92\u4f53\u8bbe\u5907")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"maxTouchPoints"),(0,r.kt)("td",{parentName:"tr",align:null},"\u8bbe\u5907\u89e6\u6478\u5c4f\u652f\u6301\u7684\u6700\u5927\u89e6\u70b9\u6570")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"onLine"),(0,r.kt)("td",{parentName:"tr",align:null},"Boolean, \u8868\u793a\u6d4f\u89c8\u5668\u662f\u5426\u8054\u7f51")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"pdfViewerEnabled"),(0,r.kt)("td",{parentName:"tr",align:null},"Boolean, \u662f\u5426\u542f\u7528\u4e86 PDF \u529f\u80fd")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"permissions"),(0,r.kt)("td",{parentName:"tr",align:null},"Permissions (Permissions API)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"serviceWorker"),(0,r.kt)("td",{parentName:"tr",align:null},"ServiceWorkerContainer")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"storage"),(0,r.kt)("td",{parentName:"tr",align:null},"StorageManager (Storage API)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"userAgent"),(0,r.kt)("td",{parentName:"tr",align:null},"\u6d4f\u89c8\u5668\u7684\u7528\u6237\u4ee3\u7406\u5b57\u7b26\u4e32 (",(0,r.kt)("strong",{parentName:"td"},"\u9ed8\u8ba4\u53ea\u8bfb"),")")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"vendor"),(0,r.kt)("td",{parentName:"tr",align:null},"\u6d4f\u89c8\u5668\u7684\u5382\u5546\u540d\u79f0")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"webdriver"),(0,r.kt)("td",{parentName:"tr",align:null},"\u6d4f\u89c8\u5668\u5f53\u524d\u662f\u5426\u88ab\u81ea\u52a8\u5316\u7a0b\u5e8f\u63a7\u5236")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"xr"),(0,r.kt)("td",{parentName:"tr",align:null},"XRSystem (WebXR Device API)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"registerProtocolHandler()"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5c06\u4e00\u4e2a\u7f51\u7ad9\u6ce8\u518c\u4e3a\u7279\u5b9a\u534f\u8bae\u7684\u5904\u7406\u7a0b\u5e8f")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"sendBeacon()"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5f02\u6b65\u4f20\u8f93\u4e00\u4e9b\u5c0f\u6570\u636e")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"share()"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5f53\u524d\u5e73\u53f0\u7684\u539f\u751f\u5171\u4eab\u673a\u5236")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"vibrate()"),(0,r.kt)("td",{parentName:"tr",align:null},"\u89e6\u53d1\u8bbe\u5907\u632f\u52a8")))),(0,r.kt)("h4",{id:"web-online-api"},"Web Online API"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const connectionStateChange = () => console.log(navigator.onLine);\nwindow.addEventListener('online', connectionStateChange);\nwindow.addEventListener('offline', connectionStateChange);\n// \u8bbe\u5907\u8054\u7f51\u65f6:\n// true\n// \u8bbe\u5907\u65ad\u7f51\u65f6:\n// false\n")),(0,r.kt)("h4",{id:"web-connection-api"},"Web Connection API"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const downlink = navigator.connection.downlink;\nconst downlinkMax = navigator.connection.downlinkMax;\nconst rtt = navigator.connection.rtt;\nconst type = navigator.connection.type; // wifi/bluetooth/cellular/ethernet/mixed/unknown/none.\nconst networkType = navigator.connection.effectiveType; // 2G - 5G.\nconst saveData = navigator.connection.saveData; // Boolean: Reduced data mode.\n\nnavigator.connection.addEventListener('change', changeHandler);\n")),(0,r.kt)("h4",{id:"web-protocol-handler-api"},"Web Protocol Handler API"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"navigator.registerProtocolHandler(\n  'mailto',\n  'http://www.somemailclient.com?cmd=%s',\n  'Some Mail Client'\n);\n")),(0,r.kt)("h4",{id:"web-battery-status-api"},"Web Battery Status API"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"navigator.getBattery().then(battery => {\n  // \u6dfb\u52a0\u5145\u7535\u72b6\u6001\u53d8\u5316\u65f6\u7684\u5904\u7406\u7a0b\u5e8f\n  const chargingChangeHandler = () => console.log(battery.charging);\n  battery.addEventListener('chargingchange', chargingChangeHandler);\n  // \u6dfb\u52a0\u5145\u7535\u65f6\u95f4\u53d8\u5316\u65f6\u7684\u5904\u7406\u7a0b\u5e8f\n  const chargingTimeChangeHandler = () => console.log(battery.chargingTime);\n  battery.addEventListener('chargingtimechange', chargingTimeChangeHandler);\n  // \u6dfb\u52a0\u653e\u7535\u65f6\u95f4\u53d8\u5316\u65f6\u7684\u5904\u7406\u7a0b\u5e8f\n  const dischargingTimeChangeHandler = () =>\n    console.log(battery.dischargingTime);\n  battery.addEventListener(\n    'dischargingtimechange',\n    dischargingTimeChangeHandler\n  );\n  // \u6dfb\u52a0\u7535\u91cf\u767e\u5206\u6bd4\u53d8\u5316\u65f6\u7684\u5904\u7406\u7a0b\u5e8f\n  const levelChangeHandler = () => console.log(battery.level * 100);\n  battery.addEventListener('levelchange', levelChangeHandler);\n});\n")),(0,r.kt)("h4",{id:"web-storage-estimate-api"},"Web Storage Estimate API"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"navigator.storage.estimate().then(estimate => {\n  console.log(((estimate.usage / estimate.quota) * 100).toFixed(2));\n});\n")),(0,r.kt)("h4",{id:"web-geolocation-api"},"Web Geolocation API"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"if (window.navigator.geolocation) {\n  // getCurrentPosition\u7b2c\u4e09\u4e2a\u53c2\u6570\u4e3a\u53ef\u9009\u53c2\u6570\n  navigator.geolocation.getCurrentPosition(locationSuccess, locationError, {\n    // \u6307\u793a\u6d4f\u89c8\u5668\u83b7\u53d6\u9ad8\u7cbe\u5ea6\u7684\u4f4d\u7f6e, \u9ed8\u8ba4\u4e3afalse\n    enableHighAccuracy: true,\n    // \u6307\u5b9a\u83b7\u53d6\u5730\u7406\u4f4d\u7f6e\u7684\u8d85\u65f6\u65f6\u95f4, \u9ed8\u8ba4\u4e0d\u9650\u65f6, \u5355\u4f4d\u4e3a\u6beb\u79d2\n    timeout: 5000,\n    // \u6700\u957f\u6709\u6548\u671f, \u5728\u91cd\u590d\u83b7\u53d6\u5730\u7406\u4f4d\u7f6e\u65f6, \u6b64\u53c2\u6570\u6307\u5b9a\u591a\u4e45\u518d\u6b21\u83b7\u53d6\u4f4d\u7f6e.\n    maximumAge: 3000,\n  });\n} else {\n  alert('Your browser does not support Geolocation!');\n}\n")),(0,r.kt)("p",null,"locationError \u4e3a\u83b7\u53d6\u4f4d\u7f6e\u4fe1\u606f\u5931\u8d25\u7684\u56de\u8c03\u51fd\u6570, \u53ef\u4ee5\u6839\u636e\u9519\u8bef\u7c7b\u578b\u63d0\u793a\u4fe1\u606f:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"function locationError(error) {\n  switch (error.code) {\n    case error.TIMEOUT:\n      showError('A timeout occurred! Please try again!');\n      break;\n    case error.POSITION_UNAVAILABLE:\n      showError(\"We can't detect your location. Sorry!\");\n      break;\n    case error.PERMISSION_DENIED:\n      showError('Please allow geolocation access for this to work.');\n      break;\n    case error.UNKNOWN_ERROR:\n      showError('An unknown error occurred!');\n      break;\n    default:\n      throw new Error('Unsupported error!');\n  }\n}\n")),(0,r.kt)("p",null,"locationSuccess \u4e3a\u83b7\u53d6\u4f4d\u7f6e\u4fe1\u606f\u6210\u529f\u7684\u56de\u8c03\u51fd\u6570,\n\u8fd4\u56de\u7684\u6570\u636e\u4e2d\u5305\u542b\u7ecf\u7eac\u5ea6\u7b49\u4fe1\u606f:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"position.timestamp"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"position.coords"),":",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"latitude"),": \u7ef4\u5ea6."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"longitude"),": \u7ecf\u5ea6."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"accuracy"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"altitude"),": \u6d77\u62d4\u9ad8\u5ea6."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"altitudeAccuracy"),".")))),(0,r.kt)("p",null,"\u7ed3\u5408 Google Map API \u5373\u53ef\u5728\u5730\u56fe\u4e2d\u663e\u793a\u5f53\u524d\u7528\u6237\u7684\u4f4d\u7f6e\u4fe1\u606f:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"function locationSuccess(position) {\n  const coords = position.coords;\n  const latlng = new google.maps.LatLng(\n    // \u7ef4\u5ea6\n    coords.latitude,\n    // \u7cbe\u5ea6\n    coords.longitude\n  );\n  const myOptions = {\n    // \u5730\u56fe\u653e\u5927\u500d\u6570\n    zoom: 12,\n    // \u5730\u56fe\u4e2d\u5fc3\u8bbe\u4e3a\u6307\u5b9a\u5750\u6807\u70b9\n    center: latlng,\n    // \u5730\u56fe\u7c7b\u578b\n    mapTypeId: google.maps.MapTypeId.ROADMAP,\n  };\n\n  // \u521b\u5efa\u5730\u56fe\u5e76\u8f93\u51fa\u5230\u9875\u9762\n  const myMap = new google.maps.Map(document.getElementById('map'), myOptions);\n\n  // \u521b\u5efa\u6807\u8bb0\n  const marker = new google.maps.Marker({\n    // \u6807\u6ce8\u6307\u5b9a\u7684\u7ecf\u7eac\u5ea6\u5750\u6807\u70b9\n    position: latlng,\n    // \u6307\u5b9a\u7528\u4e8e\u6807\u6ce8\u7684\u5730\u56fe\n    map: myMap,\n  });\n\n  // \u521b\u5efa\u6807\u6ce8\u7a97\u53e3\n  const infoWindow = new google.maps.InfoWindow({\n    content: `\u60a8\u5728\u8fd9\u91cc<br/>\u7eac\u5ea6: ${coords.latitude}<br/>\u7ecf\u5ea6: ${coords.longitude}`,\n  });\n\n  // \u6253\u5f00\u6807\u6ce8\u7a97\u53e3\n  infoWindow.open(myMap, marker);\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"navigator.geolocation.watchPosition(\n  locationSuccess,\n  locationError,\n  positionOption\n);\n")),(0,r.kt)("h4",{id:"navigator-user-agent"},"Navigator User Agent"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"navigator.userAgent")," \u7279\u522b\u590d\u6742:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5386\u53f2\u517c\u5bb9\u95ee\u9898: Netscape -> IE -> Firefox -> Safari -> Chrome -> Edge."),(0,r.kt)("li",{parentName:"ul"},"\u6bcf\u4e00\u4e2a\u65b0\u7684\u6d4f\u89c8\u5668\u5382\u5546\u5fc5\u987b\u4fdd\u8bc1\u65e7\u7f51\u7ad9\u7684\u68c0\u6d4b\u811a\u672c\u80fd\u6b63\u5e38\u8bc6\u522b\u81ea\u5bb6\u6d4f\u89c8\u5668,\n\u4ece\u800c\u6b63\u5e38\u6253\u5f00\u7f51\u9875, \u5bfc\u81f4 ",(0,r.kt)("inlineCode",{parentName:"li"},"navigator.userAgent")," \u4e0d\u65ad\u53d8\u957f."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/faisalman/ua-parser-js"},"UserAgent Data Parser"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"console.log(navigator.userAgent);\n// 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko)\n// Chrome/101.0.4922.0 Safari/537.36 Edg/101.0.1198.0'\n")),(0,r.kt)("h3",{id:"screen"},"Screen"),(0,r.kt)("p",null,"\u6d4f\u89c8\u5668\u7a97\u53e3\u5916\u9762\u7684\u5ba2\u6237\u7aef\u663e\u793a\u5668\u7684\u4fe1\u606f:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Property"),(0,r.kt)("th",{parentName:"tr",align:null}))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"availHeight"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5c4f\u5e55\u50cf\u7d20\u9ad8\u5ea6\u51cf\u53bb\u7cfb\u7edf\u7ec4\u4ef6\u9ad8\u5ea6 (\u53ea\u8bfb)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"availWidth"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5c4f\u5e55\u50cf\u7d20\u5bbd\u5ea6\u51cf\u53bb\u7cfb\u7edf\u7ec4\u4ef6\u5bbd\u5ea6 (\u53ea\u8bfb)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"colorDepth"),(0,r.kt)("td",{parentName:"tr",align:null},"\u8868\u793a\u5c4f\u5e55\u989c\u8272\u7684\u4f4d\u6570: \u591a\u6570\u7cfb\u7edf\u662f 32 (\u53ea\u8bfb)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"height"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5c4f\u5e55\u50cf\u7d20\u9ad8\u5ea6")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"width"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5c4f\u5e55\u50cf\u7d20\u5bbd\u5ea6")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"pixelDepth"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5c4f\u5e55\u7684\u4f4d\u6df1 (\u53ea\u8bfb)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"orientation"),(0,r.kt)("td",{parentName:"tr",align:null},"Screen Orientation API \u4e2d\u5c4f\u5e55\u7684\u671d\u5411")))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const screen = window.screen;\n\nconsole.log(screen.colorDepth); // 24\nconsole.log(screen.pixelDepth); // 24\n\n// \u5782\u76f4\u770b\nconsole.log(screen.orientation.type); // portrait-primary\nconsole.log(screen.orientation.angle); // 0\n// \u5411\u5de6\u8f6c\nconsole.log(screen.orientation.type); // landscape-primary\nconsole.log(screen.orientation.angle); // 90\n// \u5411\u53f3\u8f6c\nconsole.log(screen.orientation.type); // landscape-secondary\nconsole.log(screen.orientation.angle); // 270\n")),(0,r.kt)("h3",{id:"history"},"History"),(0,r.kt)("h4",{id:"history-navigation"},"History Navigation"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const history = window.history;\n\n// \u540e\u9000\u4e00\u9875\nhistory.go(-1);\n// \u524d\u8fdb\u4e00\u9875\nhistory.go(1);\n// \u524d\u8fdb\u4e24\u9875\nhistory.go(2);\n// \u5bfc\u822a\u5230\u6700\u8fd1\u7684 new.com \u9875\u9762\nhistory.go('new.com');\n// \u5bfc\u822a\u5230\u6700\u8fd1\u7684 example.net \u9875\u9762\nhistory.go('example.net');\n// \u540e\u9000\u4e00\u9875\nhistory.back();\n// \u524d\u8fdb\u4e00\u9875\nhistory.forward();\n\nif (history.length === 1) {\n  console.log('\u8fd9\u662f\u7528\u6237\u7a97\u53e3\u4e2d\u7684\u7b2c\u4e00\u4e2a\u9875\u9762');\n}\n")),(0,r.kt)("h4",{id:"history-state-management"},"History State Management"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const history = window.history;\n\nconst stateObject = { foo: 'bar' };\nhistory.pushState(stateObject, 'My title', 'baz.html');\n\nhistory.replaceState({ newFoo: 'newBar' }, 'New title'); // No new history state.\n\nwindow.addEventListener('popstate', event => {\n  const state = event.state;\n\n  if (state) {\n    // \u7b2c\u4e00\u4e2a\u9875\u9762\u52a0\u8f7d\u65f6\u72b6\u6001\u662f null\n    processState(state);\n  }\n});\n")),(0,r.kt)("h3",{id:"browser-compatibility"},"Browser Compatibility"),(0,r.kt)("h4",{id:"user-agent-detection"},"User Agent Detection"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"class BrowserDetector {\n  constructor() {\n    // \u6d4b\u8bd5\u6761\u4ef6\u7f16\u8bd1\n    // IE6~10 \u652f\u6301\n    // eslint-disable-next-line spaced-comment\n    this.isIE_Gte6Lte10 = /*@cc_on!@*/ false;\n    // \u6d4b\u8bd5 documentMode\n    // IE7~11 \u652f\u6301\n    this.isIE_Gte7Lte11 = !!document.documentMode;\n    // \u6d4b\u8bd5 StyleMedia \u6784\u9020\u51fd\u6570\n    // Edge 20 \u53ca\u4ee5\u4e0a\u7248\u672c\u652f\u6301\n    this.isEdge_Gte20 = !!window.StyleMedia;\n    // \u6d4b\u8bd5 Firefox \u4e13\u6709\u6269\u5c55\u5b89\u88c5 API\n    // \u6240\u6709\u7248\u672c\u7684 Firefox \u90fd\u652f\u6301\n    this.isFirefox_Gte1 = typeof InstallTrigger !== 'undefined';\n    // \u6d4b\u8bd5 chrome \u5bf9\u8c61\u53ca\u5176 webstore \u5c5e\u6027\n    // Opera \u7684\u67d0\u4e9b\u7248\u672c\u6709 window.chrome, \u4f46\u6ca1\u6709 window.chrome.webstore\n    // \u6240\u6709\u7248\u672c\u7684 Chrome \u90fd\u652f\u6301\n    this.isChrome_Gte1 = !!window.chrome && !!window.chrome.webstore;\n    // Safari \u65e9\u671f\u7248\u672c\u4f1a\u7ed9\u6784\u9020\u51fd\u6570\u7684\u6807\u7b7e\u7b26\u8ffd\u52a0 \"Constructor\"\u5b57\u6837, \u5982:\n    // window.Element.toString(); // [object ElementConstructor]\n    // Safari 3~9.1 \u652f\u6301\n    this.isSafari_Gte3Lte9_1 = /constructor/i.test(window.Element);\n    // \u63a8\u9001\u901a\u77e5 API \u66b4\u9732\u5728 window \u5bf9\u8c61\u4e0a\n    // \u4f7f\u7528 IIFE \u9ed8\u8ba4\u53c2\u6570\u503c\u4ee5\u907f\u514d\u5bf9 undefined \u8c03\u7528 toString()\n    // Safari 7.1 \u53ca\u4ee5\u4e0a\u7248\u672c\u652f\u6301\n    this.isSafari_Gte7_1 = (({ pushNotification = {} } = {}) =>\n      pushNotification.toString() === '[object SafariRemoteNotification]')(\n      window.safari\n    );\n    // \u6d4b\u8bd5 addons \u5c5e\u6027\n    // Opera 20 \u53ca\u4ee5\u4e0a\u7248\u672c\u652f\u6301\n    this.isOpera_Gte20 = !!window.opr && !!window.opr.addons;\n  }\n\n  isIE() {\n    return this.isIE_Gte6Lte10 || this.isIE_Gte7Lte11;\n  }\n\n  isEdge() {\n    return this.isEdge_Gte20 && !this.isIE();\n  }\n\n  isFirefox() {\n    return this.isFirefox_Gte1;\n  }\n\n  isChrome() {\n    return this.isChrome_Gte1;\n  }\n\n  isSafari() {\n    return this.isSafari_Gte3Lte9_1 || this.isSafari_Gte7_1;\n  }\n\n  isOpera() {\n    return this.isOpera_Gte20;\n  }\n}\n")),(0,r.kt)("h4",{id:"browser-feature-detection"},"Browser Feature Detection"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u4e0d\u4f7f\u7528\u7279\u6027/\u6d4f\u89c8\u5668\u63a8\u65ad"),", \u5f80\u5f80\u5bb9\u6613\u63a8\u65ad\u9519\u8bef (\u4e14\u4f1a\u968f\u7740\u6d4f\u89c8\u5668\u66f4\u65b0\u4ea7\u751f\u65b0\u7684\u9519\u8bef)."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// \u68c0\u6d4b\u6d4f\u89c8\u5668\u662f\u5426\u652f\u6301 Netscape \u5f0f\u7684\u63d2\u4ef6\nconst hasNSPlugins = !!(navigator.plugins && navigator.plugins.length);\n// \u68c0\u6d4b\u6d4f\u89c8\u5668\u662f\u5426\u5177\u6709 DOM Level 1 \u80fd\u529b\nconst hasDOM1 = !!(\n  document.getElementById &&\n  document.createElement &&\n  document.getElementsByTagName\n);\n\n// \u7279\u6027\u68c0\u6d4b\nif (document.getElementById) {\n  element = document.getElementById(id);\n}\n")),(0,r.kt)("h2",{id:"dom"},"DOM"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"DOM Level 0."),(0,r.kt)("li",{parentName:"ul"},"DOM Level 1:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"DOM Core."),(0,r.kt)("li",{parentName:"ul"},"DOM XML."),(0,r.kt)("li",{parentName:"ul"},"DOM HTML."))),(0,r.kt)("li",{parentName:"ul"},"DOM Level 2:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"DOM2 Core."),(0,r.kt)("li",{parentName:"ul"},"DOM2 XML."),(0,r.kt)("li",{parentName:"ul"},"DOM2 HTML."),(0,r.kt)("li",{parentName:"ul"},"DOM2 Views."),(0,r.kt)("li",{parentName:"ul"},"DOM2 StyleSheets."),(0,r.kt)("li",{parentName:"ul"},"DOM2 CSS."),(0,r.kt)("li",{parentName:"ul"},"DOM2 CSS 2."),(0,r.kt)("li",{parentName:"ul"},"DOM2 Events."),(0,r.kt)("li",{parentName:"ul"},"DOM2 UIEvents."),(0,r.kt)("li",{parentName:"ul"},"DOM2 MouseEvents."),(0,r.kt)("li",{parentName:"ul"},"DOM2 MutationEvents (Deprecated)."),(0,r.kt)("li",{parentName:"ul"},"DOM2 HTMLEvents."),(0,r.kt)("li",{parentName:"ul"},"DOM2 Range."),(0,r.kt)("li",{parentName:"ul"},"DOM2 Traversal."))),(0,r.kt)("li",{parentName:"ul"},"DOM Level 3:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"DOM3 Core."),(0,r.kt)("li",{parentName:"ul"},"DOM3 XML."),(0,r.kt)("li",{parentName:"ul"},"DOM3 Events."),(0,r.kt)("li",{parentName:"ul"},"DOM3 UIEvents."),(0,r.kt)("li",{parentName:"ul"},"DOM3 MouseEvents."),(0,r.kt)("li",{parentName:"ul"},"DOM3 MutationEvents (Deprecated)."),(0,r.kt)("li",{parentName:"ul"},"DOM3 MutationNameEvents."),(0,r.kt)("li",{parentName:"ul"},"DOM3 TextEvents."),(0,r.kt)("li",{parentName:"ul"},"DOM3 Load and Save."),(0,r.kt)("li",{parentName:"ul"},"DOM3 Load and Save Async."),(0,r.kt)("li",{parentName:"ul"},"DOM3 Validation."),(0,r.kt)("li",{parentName:"ul"},"DOM3 XPath.")))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const hasXmlDom = document.implementation.hasFeature('XML', '1.0');\nconst hasHtmlDom = document.implementation.hasFeature('HTML', '1.0');\n")),(0,r.kt)("h3",{id:"dom-core"},"DOM Core"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"document.createElement('nodeName');\ndocument.createTextNode('String');\n\ndocument.getElementById(id);\n// eslint-disable-next-line no-restricted-globals\ndocument.getElementsByName(name);\ndocument.getElementsByTagName(tagName);\ndocument.getElementsByClassName(className); // HTML5\ndocument.querySelector(cssSelector); // Selectors API\ndocument.querySelectorAll(cssSelector); // Selectors API\n\nelement.getAttribute(attrName);\nelement.setAttribute(attrName, attrValue);\nelement.removeAttribute(attrName);\n\nelement.compareDocumentPosition(element);\nelement.contains(element);\nelement.isSameNode(element); // Same node reference\nelement.isEqualNode(element); // Same nodeName/nodeValue/attributes/childNodes\nelement.matches(cssSelector);\nelement.closest(cssSelector); // Returns closest ancestor matching selector\nelement.cloneNode();\nelement.normalize();\nelement.before(...elements);\nelement.after(...elements);\nelement.replaceWith(...elements);\nelement.remove();\n\nparentElement.hasChildNodes();\nparentElement.appendChild(childElement);\nparentElement.append(childElements);\nparentElement.insertBefore(newChild, targetChild);\nparentElement.replaceChild(newChild, targetChild);\nparentElement.replaceChildren(children);\nparentElement.removeChild(child);\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const showAlert = (type, message, duration = 3) => {\n  const div = document.createElement('div');\n  div.className = type;\n  div.appendChild(document.createTextNode(message));\n  container.insertBefore(div, form);\n  setTimeout(() => div.remove(), duration * 1000);\n};\n")),(0,r.kt)("h4",{id:"dom-node-type"},"DOM Node Type"),(0,r.kt)("p",null,"Node \u9664\u5305\u62ec\u5143\u7d20\u7ed3\u70b9 (tag) \u5916,\n\u5305\u62ec\u8bb8\u591a\u5176\u5b83\u7ed3\u70b9 (\u751a\u81f3\u7a7a\u683c\u7b26\u89c6\u4f5c\u4e00\u4e2a\u7ed3\u70b9),\n\u9700\u501f\u52a9 ",(0,r.kt)("inlineCode",{parentName:"p"},"nodeType")," \u627e\u51fa\u76ee\u6807\u7ed3\u70b9."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Node Type"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Node Representation"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Node Name"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Node Value"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"1"),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"ELEMENT_NODE")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Tag Name"),(0,r.kt)("td",{parentName:"tr",align:"left"},"null")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"2"),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"ATTRIBUTE_NODE")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Attr Name"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Attr Value")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"3"),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"TEXT_NODE")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"#text")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Text")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"4"),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"CDATA_SECTION_NODE")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"#cdata-section")),(0,r.kt)("td",{parentName:"tr",align:"left"},"CDATA Section")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"5"),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"ENTITY_REFERENCE_NODE")),(0,r.kt)("td",{parentName:"tr",align:"left"}),(0,r.kt)("td",{parentName:"tr",align:"left"})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"6"),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"ENTITY_NODE")),(0,r.kt)("td",{parentName:"tr",align:"left"}),(0,r.kt)("td",{parentName:"tr",align:"left"})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"8"),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"COMMENT_NODE")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"#comment")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Comment")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"9"),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"DOCUMENT_NODE")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"#document")),(0,r.kt)("td",{parentName:"tr",align:"left"},"null")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"10"),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"DOCUMENT_TYPE_NODE")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"html"),"/",(0,r.kt)("inlineCode",{parentName:"td"},"xml")),(0,r.kt)("td",{parentName:"tr",align:"left"},"null")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"11"),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"DOCUMENT_FRAGMENT_NODE")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"#document-fragment")),(0,r.kt)("td",{parentName:"tr",align:"left"},"null")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"12"),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"NOTATION_NODE")),(0,r.kt)("td",{parentName:"tr",align:"left"}),(0,r.kt)("td",{parentName:"tr",align:"left"})))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const type = node.nodeType;\nconst name = node.nodeName;\nconst value = node.nodeValue;\n\nif (someNode.nodeType === Node.ELEMENT_NODE) {\n  alert('Node is an element.');\n}\n")),(0,r.kt)("h4",{id:"dom-attribute-node"},"DOM Attribute Node"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const id = element.attributes.getNamedItem('id').nodeValue;\nconst id = element.attributes.id.nodeValue;\nelement.attributes.id.nodeValue = 'someOtherId';\nconst oldAttr = element.attributes.removeNamedItem('id');\nelement.attributes.setNamedItem(newAttr);\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const attr = document.createAttribute('align');\nattr.value = 'left';\nelement.setAttributeNode(attr);\n\nalert(element.attributes.align.value); // \"left\"\nalert(element.getAttributeNode('align').value); // \"left\"\nalert(element.getAttribute('align')); // \"left\"\n")),(0,r.kt)("h4",{id:"dom-text-node"},"DOM Text Node"),(0,r.kt)("p",null,"Text node methods:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"appendData(text): \u5411\u8282\u70b9\u672b\u5c3e\u6dfb\u52a0\u6587\u672c text."),(0,r.kt)("li",{parentName:"ul"},"deleteData(offset, count): \u4ece\u4f4d\u7f6e offset \u5f00\u59cb\u5220\u9664 count \u4e2a\u5b57\u7b26."),(0,r.kt)("li",{parentName:"ul"},"insertData(offset, text): \u5728\u4f4d\u7f6e offset \u63d2\u5165 text."),(0,r.kt)("li",{parentName:"ul"},"replaceData(offset, count, text): \u7528 text \u66ff\u6362\u4ece\u4f4d\u7f6e offset \u5230 offset + count \u7684\u6587\u672c."),(0,r.kt)("li",{parentName:"ul"},"splitText(offset): \u5728\u4f4d\u7f6e offset \u5c06\u5f53\u524d\u6587\u672c\u8282\u70b9\u62c6\u5206\u4e3a\u4e24\u4e2a\u6587\u672c\u8282\u70b9."),(0,r.kt)("li",{parentName:"ul"},"substringData(offset, count): \u63d0\u53d6\u4ece\u4f4d\u7f6e offset \u5230 offset + count \u7684\u6587\u672c.")),(0,r.kt)("p",null,"Normalize text nodes:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const element = document.createElement('div');\nelement.className = 'message';\n\nconst textNode = document.createTextNode('Hello world!');\nconst anotherTextNode = document.createTextNode('Yippee!');\n\nelement.appendChild(textNode);\nelement.appendChild(anotherTextNode);\ndocument.body.appendChild(element);\nalert(element.childNodes.length); // 2\n\nelement.normalize();\nalert(element.childNodes.length); // 1\nalert(element.firstChild.nodeValue); // \"Hello world!Yippee!\"\n")),(0,r.kt)("p",null,"Split text nodes:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const element = document.createElement('div');\nelement.className = 'message';\n\nconst textNode = document.createTextNode('Hello world!');\nelement.appendChild(textNode);\ndocument.body.appendChild(element);\n\nconst newNode = element.firstChild.splitText(5);\nalert(element.firstChild.nodeValue); // \"Hello\"\nalert(newNode.nodeValue); // \" world!\"\nalert(element.childNodes.length); // 2\n")),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"TextContent vs InnerText vs InnerHTML")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("ul",{parentName:"div"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"textContent"),":",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Security"),": Doesn\u2019t parse HTML."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Performance"),": Including ",(0,r.kt)("inlineCode",{parentName:"li"},"<script>")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"<style>")," text content."))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"innerText"),":",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Doesn't parse HTML."),(0,r.kt)("li",{parentName:"ul"},"Only show ",(0,r.kt)("strong",{parentName:"li"},"human-readable")," text content"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"innerText")," care CSS styles, read ",(0,r.kt)("inlineCode",{parentName:"li"},"innerText")," value will trigger ",(0,r.kt)("inlineCode",{parentName:"li"},"reflow"),"."))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"innerHTML"),":",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Do parse HTML.")))),(0,r.kt)("pre",{parentName:"div"},(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const textContent = element.textContent;\nconst innerText = element.innerText;\nconst innerHTML = element.innerHTML;\n")))),(0,r.kt)("h4",{id:"dom-document-node"},"DOM Document Node"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"document")," node (",(0,r.kt)("inlineCode",{parentName:"p"},"#document"),"):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},'alert(document.nodeType); // 9\nalert(document.nodeName); // "#document"\nalert(document.nodeValue); // null\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const html = document.documentElement;\nconst doctype = document.doctype;\nconst head = document.head; // HTML5 head.\nconst body = document.body;\n\nconst title = document.title; // \u53ef\u4fee\u6539.\nconst domain = document.domain; // \u53ef\u8bbe\u7f6e\u540c\u6e90\u57df\u540d.\nconst url = document.URL;\nconst referer = document.referer;\nconst charSet = document.characterSet; // HTML5 characterSet.\n\nconst anchors = documents.anchors;\nconst images = documents.images;\nconst links = documents.links;\nconst forms = documents.forms;\nconst formElements = documents.forms[0].elements; // \u7b2c\u4e00\u4e2a\u8868\u5355\u5185\u7684\u6240\u6709\u5b57\u6bb5\n\n// HTML5 compatMode:\nif (document.compatMode === 'CSS1Compat') {\n  console.log('Standards mode');\n} else if (document.compatMode === 'BackCompat') {\n  console.log('Quirks mode');\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"document.getElementById(id);\n// eslint-disable-next-line no-restricted-globals\ndocument.getElementsByName(name);\ndocument.getElementsByTagName(tagName);\ndocument.getElementsByClassName(className); // HTML5\ndocument.querySelector(cssSelector); // Selectors API\ndocument.querySelectorAll(cssSelector); // Selectors API\ndocument.write();\ndocument.writeln();\n")),(0,r.kt)("h4",{id:"dom-document-type-node"},"DOM Document Type Node"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'<!DOCTYPE html PUBLIC "-// W3C// DTD HTML 4.01// EN" "http:// www.w3.org/TR/html4/strict.dtd">\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"console.log(document.doctype.name); // \"html\"\nconsole.log(document.nodeType); // 10\nconsole.log(document.doctype.nodeName); // \"html\"\nconsole.log(document.doctype.nodeValue); // null\nconsole.log(document.doctype.publicId); // \"-// W3C// DTD HTML 4.01// EN\"\nconsole.log(document.doctype.systemId); // \"http://www.w3.org/TR/html4/strict.dtd\"\n\nconst doctype = document.implementation.createDocumentType(\n  'html',\n  '-// W3C// DTD HTML 4.01// EN',\n  'http://www.w3.org/TR/html4/strict.dtd'\n);\nconst doc = document.implementation.createDocument(\n  'http://www.w3.org/1999/xhtml',\n  'html',\n  doctype\n);\n")),(0,r.kt)("h4",{id:"dom-document-fragment-node"},"DOM Document Fragment Node"),(0,r.kt)("p",null,"\u51cf\u5c11 DOM \u64cd\u4f5c\u6b21\u6570, \u51cf\u5c11\u9875\u9762\u6e32\u67d3\u6b21\u6570:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const frag = document.createDocumentFragment();\n\nlet p;\nlet t;\n\np = document.createElement('p');\nt = document.createTextNode('first paragraph');\np.appendChild(t);\nfrag.appendChild(p);\n\np = document.createElement('p');\nt = document.createTextNode('second paragraph');\np.appendChild(t);\nfrag.appendChild(p);\n\n// \u53ea\u6e32\u67d3\u4e00\u6b21HTML\u9875\u9762\ndocument.body.appendChild(frag);\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const oldNode = document.getElementById('result');\nconst clone = oldNode.cloneNode(true);\n// work with the clone\n\n// when you're done:\noldNode.parentNode.replaceChild(clone, oldNode);\n")),(0,r.kt)("h3",{id:"dom-programming"},"DOM Programming"),(0,r.kt)("h4",{id:"append-dom-node"},"Append DOM Node"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Method"),(0,r.kt)("th",{parentName:"tr",align:null},"Node"),(0,r.kt)("th",{parentName:"tr",align:null},"HTML"),(0,r.kt)("th",{parentName:"tr",align:null},"Text"),(0,r.kt)("th",{parentName:"tr",align:null},"IE"),(0,r.kt)("th",{parentName:"tr",align:null},"Event Listeners"),(0,r.kt)("th",{parentName:"tr",align:null},"Secure"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"append"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Preserves"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"appendChild"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"Preserves"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"innerHTML"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"Loses"),(0,r.kt)("td",{parentName:"tr",align:null},"Careful")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"insertAdjacentHTML"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"Preserves"),(0,r.kt)("td",{parentName:"tr",align:null},"Careful")))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const testDiv = document.getElementById('testDiv');\n\nconst para = document.createElement('p');\ntestDiv.appendChild(para);\n\nconst txt = document.createTextNode('Hello World');\npara.appendChild(txt);\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"innerHTML"),": non-concrete, including all types of childNodes:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"div.innerHTML = '<p>Test<em>test</em>Test.</p>';\n// <div>\n//   <p>Test<em>test</em>Test.</p>\n// </div>\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"innerHTML")," performance:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// BAD\nfor (const value of values) {\n  ul.innerHTML += `<li>${value}</li>`; // \u522b\u8fd9\u6837\u505a\uff01\n}\n\n// GOOD\nlet itemsHtml = '';\nfor (const value of values) {\n  itemsHtml += `<li>${value}</li>`;\n}\nul.innerHTML = itemsHtml;\n\n// BEST\nul.innerHTML = values.map(value => `<li>${value}</li>`).join('');\n")),(0,r.kt)("h4",{id:"insert-dom-node"},"Insert DOM Node"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"function insertAfter(newElement, targetElement) {\n  const parent = targetElement.parentNode;\n  if (parent.lastChild === targetElement) {\n    parent.appendChild(newElement);\n  } else {\n    parent.insertBefore(newElement, targetElement.nextSibling);\n  }\n}\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"insertAdjacentHTML"),"/",(0,r.kt)("inlineCode",{parentName:"p"},"insertAdjacentText"),":"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"beforebegin: \u63d2\u5165\u524d\u4e00\u4e2a\u5144\u5f1f\u8282\u70b9."),(0,r.kt)("li",{parentName:"ul"},"afterbegin: \u63d2\u5165\u7b2c\u4e00\u4e2a\u5b50\u8282\u70b9."),(0,r.kt)("li",{parentName:"ul"},"beforeend: \u63d2\u5165\u6700\u540e\u4e00\u4e2a\u5b50\u8282\u70b9."),(0,r.kt)("li",{parentName:"ul"},"afterend: \u63d2\u5165\u4e0b\u4e00\u4e2a\u5144\u5f1f\u8282\u70b9.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// 4 positions:\n//\n// \x3c!-- beforebegin --\x3e\n// <p>\n// \x3c!-- afterbegin --\x3e\n// foo\n// \x3c!-- beforeend --\x3e\n// </p>\n// \x3c!-- afterend --\x3e\nconst p = document.querySelector('p');\n\np.insertAdjacentHTML('beforebegin', '<a></a>');\np.insertAdjacentText('afterbegin', 'foo');\n\n// simply be moved element, not copied element\np.insertAdjacentElement('beforebegin', link);\n")),(0,r.kt)("h4",{id:"replace-dom-node"},"Replace DOM Node"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"node.replaceChild(document.createTextNode(text), node.firstChild);\nnode.replaceChildren(...nodeList);\n")),(0,r.kt)("h4",{id:"remove-dom-node"},"Remove DOM Node"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// \u5220\u9664\u7b2c\u4e00\u4e2a\u5b50\u8282\u70b9\nconst formerFirstChild = someNode.removeChild(someNode.firstChild);\n// \u5220\u9664\u6700\u540e\u4e00\u4e2a\u5b50\u8282\u70b9\nconst formerLastChild = someNode.removeChild(someNode.lastChild);\n\nwhile (div.firstChild) {\n  div.removeChild(div.firstChild);\n}\n")),(0,r.kt)("h4",{id:"traverse-dom-node"},"Traverse DOM Node"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const parent = node.parentNode;\nconst children = node.childNodes;\nconst first = node.firstChild;\nconst last = node.lastChild;\nconst previous = node.previousSibling;\nconst next = node.nextSibling;\n")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.w3.org/TR/ElementTraversal"},"Element Traversal API"),":\nnavigation properties listed above refer to all nodes.\nFor instance,\nin ",(0,r.kt)("inlineCode",{parentName:"p"},"childNodes")," can see both text nodes, element nodes, and even comment nodes."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const count = node.childElementCount;\nconst parent = node.parentElement;\nconst children = node.children;\nconst first = node.firstElementChild;\nconst last = node.lastElementChild;\nconst previous = node.previousElementSibling;\nconst next = node.nextElementSibling;\n")),(0,r.kt)("p",null,"NodeList is iterable:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const elements = document.querySelectorAll('div');\n\nfor (const element of elements) {\n  console.log(element);\n}\n")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/NodeIterator"},"Node Iterator"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const div = document.getElementById('div1');\nconst filter = function (node) {\n  return node.tagName.toLowerCase() === 'li'\n    ? NodeFilter.FILTER_ACCEPT\n    : NodeFilter.FILTER_SKIP;\n};\nconst iterator = document.createNodeIterator(\n  div,\n  NodeFilter.SHOW_ELEMENT,\n  filter,\n  false\n);\n\nfor (\n  let node = iterator.nextNode();\n  node !== null;\n  node = iterator.nextNode()\n) {\n  console.log(node.tagName); // \u8f93\u51fa\u6807\u7b7e\u540d\n}\n")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/TreeWalker"},"Tree Walker"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const div = document.getElementById('div1');\nconst walker = document.createTreeWalker(\n  div,\n  NodeFilter.SHOW_ELEMENT,\n  null,\n  false\n);\n\nwalker.firstChild(); // \u524d\u5f80<p>\nwalker.nextSibling(); // \u524d\u5f80<ul>\n\nfor (\n  let node = walker.firstChild();\n  node !== null;\n  node = walker.nextSibling()\n) {\n  console.log(node.tagName); // \u904d\u5386 <li>\n}\n")),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"NodeIterator vs TreeWalker")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("ul",{parentName:"div"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"NodeFilter.acceptNode()")," ",(0,r.kt)("inlineCode",{parentName:"li"},"FILTER_REJECT"),":",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"For ",(0,r.kt)("inlineCode",{parentName:"li"},"NodeIterator"),", this flag is synonymous with ",(0,r.kt)("inlineCode",{parentName:"li"},"FILTER_SKIP"),"."),(0,r.kt)("li",{parentName:"ul"},"For ",(0,r.kt)("inlineCode",{parentName:"li"},"TreeWalker"),", child nodes are also rejected."))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"TreeWalker")," has more methods:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"firstChild"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"lastChild"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"previousSibling"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"nextSibling"),".")))))),(0,r.kt)("h4",{id:"attributes-dom-node"},"Attributes DOM Node"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"alert(div.getAttribute('id')); // \"myDiv\"\nalert(div.getAttribute('class')); // \"bd\"\ndiv.setAttribute('id', 'someOtherId');\ndiv.setAttribute('class', 'ft');\ndiv.removeAttribute('id');\ndiv.removeAttribute('class');\n")),(0,r.kt)("h4",{id:"select-dom-node"},"Select DOM Node"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/Range"},"Range API"),":"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"startContainer"),": \u8303\u56f4\u8d77\u70b9\u6240\u5728\u7684\u8282\u70b9 (\u9009\u533a\u4e2d\u7b2c\u4e00\u4e2a\u5b50\u8282\u70b9\u7684\u7236\u8282\u70b9)."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"startOffset"),": \u8303\u56f4\u8d77\u70b9\u5728 startContainer \u4e2d\u7684\u504f\u79fb\u91cf."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"endContainer"),": \u8303\u56f4\u7ec8\u70b9\u6240\u5728\u7684\u8282\u70b9 (\u9009\u533a\u4e2d\u6700\u540e\u4e00\u4e2a\u5b50\u8282\u70b9\u7684\u7236\u8282\u70b9)."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"endOffset"),": \u8303\u56f4\u8d77\u70b9\u5728 startContainer \u4e2d\u7684\u504f\u79fb\u91cf."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"commonAncestorContainer"),":\n\u6587\u6863\u4e2d\u4ee5 ",(0,r.kt)("inlineCode",{parentName:"li"},"startContainer")," \u548c ",(0,r.kt)("inlineCode",{parentName:"li"},"endContainer")," \u4e3a\u540e\u4ee3\u7684\u6700\u6df1\u7684\u8282\u70b9."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"setStartBefore(refNode)"),":\n\u628a\u8303\u56f4\u7684\u8d77\u70b9\u8bbe\u7f6e\u5230 refNode \u4e4b\u524d,\n\u4ece\u800c\u8ba9 refNode \u6210\u4e3a\u9009\u533a\u7684\u7b2c\u4e00\u4e2a\u5b50\u8282\u70b9."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"setStartAfter(refNode)"),":\n\u628a\u8303\u56f4\u7684\u8d77\u70b9\u8bbe\u7f6e\u5230 refNode \u4e4b\u540e,\n\u4ece\u800c\u5c06 refNode \u6392\u9664\u5728\u9009\u533a\u4e4b\u5916,\n\u8ba9\u5176\u4e0b\u4e00\u4e2a\u540c\u80de\u8282\u70b9\u6210\u4e3a\u9009\u533a\u7684\u7b2c\u4e00\u4e2a\u5b50\u8282\u70b9."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"setEndBefore(refNode)"),":\n\u628a\u8303\u56f4\u7684\u7ec8\u70b9\u8bbe\u7f6e\u5230 refNode \u4e4b\u524d,\n\u4ece\u800c\u5c06 refNode \u6392\u9664\u5728\u9009\u533a\u4e4b\u5916,\n\u8ba9\u5176\u4e0a\u4e00\u4e2a\u540c\u80de\u8282\u70b9\u6210\u4e3a\u9009\u533a\u7684\u6700\u540e\u4e00\u4e2a\u5b50\u8282\u70b9."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"setEndAfter(refNode)"),":\n\u628a\u8303\u56f4\u7684\u7ec8\u70b9\u8bbe\u7f6e\u5230 refNode \u4e4b\u540e,\n\u4ece\u800c\u8ba9 refNode \u6210\u4e3a\u9009\u533a\u7684\u6700\u540e\u4e00\u4e2a\u5b50\u8282\u70b9."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"setStart(refNode, offset)"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"setEnd(refNode, offset)"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"deleteContents()"),": remove."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"extractContents()"),": remove and return."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"cloneContents()"),": clone."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"insertNode(node)"),": \u5728\u8303\u56f4\u9009\u533a\u7684\u5f00\u59cb\u4f4d\u7f6e\u63d2\u5165\u4e00\u4e2a\u8282\u70b9."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"surroundContents(node)"),": \u63d2\u5165\u5305\u542b\u8303\u56f4\u7684\u5185\u5bb9."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"collapse(boolean)"),": \u8303\u56f4\u6298\u53e0."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"compareBoundaryPoints(Range.HOW, sourceRange)"),": \u786e\u5b9a\u8303\u56f4\u4e4b\u95f4\u662f\u5426\u5b58\u5728\u516c\u5171\u7684\u8fb9\u754c (\u8d77\u70b9\u6216\u7ec8\u70b9).")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'<!DOCTYPE html>\n<html>\n  <body>\n    <p id="p1"><b>Hello</b> world!</p>\n  </body>\n</html>\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const p1 = document.getElementById('p1');\nconst helloNode = p1.firstChild.firstChild;\nconst worldNode = p1.lastChild;\nconst range = document.createRange();\n\nrange.setStart(helloNode, 2);\nrange.setEnd(worldNode, 3);\nconst fragment1 = range.cloneContents(); // clone\nconst fragment2 = range.extractContents(); // remove and return\n\np1.parentNode.appendChild(fragment1);\np1.parentNode.appendChild(fragment2);\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const p1 = document.getElementById('p1');\nconst helloNode = p1.firstChild.firstChild;\nconst worldNode = p1.lastChild;\nconst range = document.createRange();\n\nconst span = document.createElement('span');\nspan.style.color = 'red';\nspan.appendChild(document.createTextNode('Inserted text'));\n\nrange.setStart(helloNode, 2);\nrange.setEnd(worldNode, 3);\nrange.insertNode(span);\n// <p id=\"p1\"><b>He<span style=\"color: red\">Inserted text</span>llo</b> world</p>\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const p1 = document.getElementById('p1');\nconst helloNode = p1.firstChild.firstChild;\nconst worldNode = p1.lastChild;\nconst range = document.createRange();\n\nconst span = document.createElement('span');\nspan.style.backgroundColor = 'yellow';\n\nrange.selectNode(helloNode);\nrange.surroundContents(span);\n// <p><b><span style=\"background-color:yellow\">Hello</span></b> world!</p>\n")),(0,r.kt)("h4",{id:"dynamic-scripts-loading"},"Dynamic Scripts Loading"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"function loadScript(url) {\n  const script = document.createElement('script');\n  script.src = url;\n  document.body.appendChild(script);\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"function loadScriptString(code) {\n  const script = document.createElement('script');\n  script.type = 'text/javascript';\n\n  try {\n    script.appendChild(document.createTextNode(code));\n  } catch (ex) {\n    script.text = code;\n  }\n\n  document.body.appendChild(script);\n}\n")),(0,r.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"InnerHTML Script")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"\u6240\u6709\u73b0\u4ee3\u6d4f\u89c8\u5668\u4e2d, \u901a\u8fc7 ",(0,r.kt)("inlineCode",{parentName:"p"},"innerHTML")," \u5c5e\u6027\u521b\u5efa\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"<script>")," \u5143\u7d20\u6c38\u8fdc\u4e0d\u4f1a\u6267\u884c."))),(0,r.kt)("h4",{id:"dynamic-styles-loading"},"Dynamic Styles Loading"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"function loadStyles(url) {\n  const link = document.createElement('link');\n  link.rel = 'stylesheet';\n  link.type = 'text/css';\n  link.href = url;\n\n  const head = document.getElementsByTagName('head')[0];\n  head.appendChild(link);\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"function loadStyleString(css) {\n  const style = document.createElement('style');\n  style.type = 'text/css';\n\n  try {\n    style.appendChild(document.createTextNode(css));\n  } catch (ex) {\n    style.styleSheet.cssText = css;\n  }\n\n  const head = document.getElementsByTagName('head')[0];\n  head.appendChild(style);\n}\n")),(0,r.kt)("div",{className:"admonition admonition-danger alert alert--danger"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"StyleSheet CSSText")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("ul",{parentName:"div"},(0,r.kt)("li",{parentName:"ul"},"\u82e5\u91cd\u7528\u540c\u4e00\u4e2a ",(0,r.kt)("inlineCode",{parentName:"li"},"<style>")," \u5143\u7d20\u5e76\u8bbe\u7f6e\u8be5\u5c5e\u6027\u8d85\u8fc7\u4e00\u6b21, \u5219\u53ef\u80fd\u5bfc\u81f4\u6d4f\u89c8\u5668\u5d29\u6e83."),(0,r.kt)("li",{parentName:"ul"},"\u5c06 ",(0,r.kt)("inlineCode",{parentName:"li"},"cssText")," \u8bbe\u7f6e\u4e3a\u7a7a\u5b57\u7b26\u4e32\u4e5f\u53ef\u80fd\u5bfc\u81f4\u6d4f\u89c8\u5668\u5d29\u6e83.")))),(0,r.kt)("h4",{id:"table-manipulation"},"Table Manipulation"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"<table>")," \u5143\u7d20\u6dfb\u52a0\u4e86\u4ee5\u4e0b\u5c5e\u6027\u548c\u65b9\u6cd5:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"caption"),": \u6307\u5411 ",(0,r.kt)("inlineCode",{parentName:"li"},"<caption>")," \u5143\u7d20\u7684\u6307\u9488 (\u5982\u679c\u5b58\u5728)."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"tBodies"),": \u5305\u542b ",(0,r.kt)("inlineCode",{parentName:"li"},"<tbody>")," \u5143\u7d20\u7684 HTMLCollection."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"tFoot"),": \u6307\u5411 ",(0,r.kt)("inlineCode",{parentName:"li"},"<tfoot>")," \u5143\u7d20 (\u5982\u679c\u5b58\u5728)."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"tHead"),": \u6307\u5411 ",(0,r.kt)("inlineCode",{parentName:"li"},"<thead>")," \u5143\u7d20 (\u5982\u679c\u5b58\u5728)."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"rows"),": \u5305\u542b\u8868\u793a\u6240\u6709\u884c\u7684 HTMLCollection."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"createTHead()"),": \u521b\u5efa ",(0,r.kt)("inlineCode",{parentName:"li"},"<thead>")," \u5143\u7d20, \u653e\u5230\u8868\u683c\u4e2d, \u8fd4\u56de\u5f15\u7528."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"createTFoot()"),": \u521b\u5efa ",(0,r.kt)("inlineCode",{parentName:"li"},"<tfoot>")," \u5143\u7d20, \u653e\u5230\u8868\u683c\u4e2d, \u8fd4\u56de\u5f15\u7528."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"createCaption()"),": \u521b\u5efa ",(0,r.kt)("inlineCode",{parentName:"li"},"<caption>")," \u5143\u7d20, \u653e\u5230\u8868\u683c\u4e2d, \u8fd4\u56de\u5f15\u7528."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"deleteTHead()"),": \u5220\u9664 ",(0,r.kt)("inlineCode",{parentName:"li"},"<thead>")," \u5143\u7d20."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"deleteTFoot()"),": \u5220\u9664 ",(0,r.kt)("inlineCode",{parentName:"li"},"<tfoot>")," \u5143\u7d20."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"deleteCaption()"),": \u5220\u9664 ",(0,r.kt)("inlineCode",{parentName:"li"},"<caption>")," \u5143\u7d20."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"deleteRow(pos)"),": \u5220\u9664\u7ed9\u5b9a\u4f4d\u7f6e\u7684\u884c."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"insertRow(pos)"),": \u5728\u884c\u96c6\u5408\u4e2d\u7ed9\u5b9a\u4f4d\u7f6e\u63d2\u5165\u4e00\u884c.")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"<tbody>")," \u5143\u7d20\u6dfb\u52a0\u4e86\u4ee5\u4e0b\u5c5e\u6027\u548c\u65b9\u6cd5:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"rows"),": \u5305\u542b ",(0,r.kt)("inlineCode",{parentName:"li"},"<tbody>")," \u5143\u7d20\u4e2d\u6240\u6709\u884c\u7684 HTMLCollection."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"deleteRow(pos)"),": \u5220\u9664\u7ed9\u5b9a\u4f4d\u7f6e\u7684\u884c."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"insertRow(pos)"),": \u5728\u884c\u96c6\u5408\u4e2d\u7ed9\u5b9a\u4f4d\u7f6e\u63d2\u5165\u4e00\u884c, \u8fd4\u56de\u8be5\u884c\u7684\u5f15\u7528.")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"<tr>")," \u5143\u7d20\u6dfb\u52a0\u4e86\u4ee5\u4e0b\u5c5e\u6027\u548c\u65b9\u6cd5:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"cells"),": \u5305\u542b ",(0,r.kt)("inlineCode",{parentName:"li"},"<tr>")," \u5143\u7d20\u6240\u6709\u8868\u5143\u7684 HTMLCollection."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"deleteCell(pos)"),": \u5220\u9664\u7ed9\u5b9a\u4f4d\u7f6e\u7684\u8868\u5143."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"insertCell(pos)"),": \u5728\u8868\u5143\u96c6\u5408\u7ed9\u5b9a\u4f4d\u7f6e\u63d2\u5165\u4e00\u4e2a\u8868\u5143, \u8fd4\u56de\u8be5\u8868\u5143\u7684\u5f15\u7528.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// \u521b\u5efa\u8868\u683c\nconst table = document.createElement('table');\ntable.border = 1;\ntable.width = '100%';\n\n// \u521b\u5efa\u8868\u4f53\nconst tbody = document.createElement('tbody');\ntable.appendChild(tbody);\n\n// \u521b\u5efa\u7b2c\u4e00\u884c\ntbody.insertRow(0);\ntbody.rows[0].insertCell(0);\ntbody.rows[0].cells[0].appendChild(document.createTextNode('Cell 1, 1'));\ntbody.rows[0].insertCell(1);\ntbody.rows[0].cells[1].appendChild(document.createTextNode('Cell 2, 1'));\n\n// \u521b\u5efa\u7b2c\u4e8c\u884c\ntbody.insertRow(1);\ntbody.rows[1].insertCell(0);\ntbody.rows[1].cells[0].appendChild(document.createTextNode('Cell 1, 2'));\ntbody.rows[1].insertCell(1);\ntbody.rows[1].cells[1].appendChild(document.createTextNode('Cell 2, 2'));\n\n// \u628a\u8868\u683c\u6dfb\u52a0\u5230\u6587\u6863\u4e3b\u4f53\ndocument.body.appendChild(table);\n")),(0,r.kt)("h3",{id:"cssom"},"CSSOM"),(0,r.kt)("p",null,"The CSS Object Model is a set of APIs allowing the manipulation of CSS from JavaScript.\nIt is much like the DOM, but for the CSS rather than the HTML.\nIt allows users to read and modify CSS style dynamically."),(0,r.kt)("h4",{id:"inline-styles"},"Inline Styles"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"interface Element {\n  style: CSSStyleDeclaration;\n}\n\nconst style = element.style.XX;\nconst font = element.style.fontFamily;\nconst mt = element.style.marginTopWidth;\n")),(0,r.kt)("h4",{id:"styles-getter-and-setter"},"Styles Getter and Setter"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"cssText"),": \u4e00\u6b21\u751f\u6548."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"length"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"getPropertyValue(name)"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"getPropertyPriority"),": return ",(0,r.kt)("inlineCode",{parentName:"li"},"''")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"important")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"item(index)"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"setProperty(name, value, priority)"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"removeProperty(name)"),".")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const box = document.querySelector('.box');\n\nbox.style.setProperty('color', 'orange');\nbox.style.setProperty('font-family', 'Georgia, serif');\nop.innerHTML = box.style.getPropertyValue('color');\nop2.innerHTML = `${box.style.item(0)}, ${box.style.item(1)}`;\n\nbox.style.setProperty('font-size', '1.5em');\nbox.style.item(0); // \"font-size\"\n\ndocument.body.style.removeProperty('font-size');\ndocument.body.style.item(0); // \"\"\n\nmyDiv.style.cssText = 'width: 25px; height: 100px; background-color: green';\n\nfor (let i = 0, len = myDiv.style.length; i < len; i++) {\n  console.log(myDiv.style[i]); // \u6216\u8005\u7528 myDiv.style.item(i)\n}\n")),(0,r.kt)("h4",{id:"computed-styles"},"Computed Styles"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Shorthand style for full property."),(0,r.kt)("li",{parentName:"ul"},"Longhand style for specific property."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"getPropertyValue")," can get css variables."),(0,r.kt)("li",{parentName:"ul"},"\u5728\u6240\u6709\u6d4f\u89c8\u5668\u4e2d\u8ba1\u7b97\u6837\u5f0f\u90fd\u662f",(0,r.kt)("strong",{parentName:"li"},"\u53ea\u8bfb"),"\u7684, \u4e0d\u80fd\u4fee\u6539 ",(0,r.kt)("inlineCode",{parentName:"li"},"getComputedStyle()")," \u65b9\u6cd5\u8fd4\u56de\u7684\u5bf9\u8c61.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const background = window.getComputedStyle(document.body).background;\n\n// dot notation, same as above\nconst backgroundColor = window.getComputedStyle(el).backgroundColor;\n\n// square bracket notation\nconst backgroundColor = window.getComputedStyle(el)['background-color'];\n\n// using getPropertyValue()\n// can get css variables property too\nwindow.getComputedStyle(el).getPropertyValue('background-color');\n")),(0,r.kt)("h4",{id:"css-class-list"},"CSS Class List"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"element.classList.add('class');\nelement.classList.remove('class');\nelement.classList.toggle('class');\nelement.classList.contains('class');\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"function addClassPolyfill(element, value) {\n  if (!element.className) {\n    element.className = value;\n  } else {\n    newClassName = element.className;\n    newClassName += ' ';\n    newClassName += value;\n    element.className = newClassName;\n  }\n}\n")),(0,r.kt)("h4",{id:"dom-stylesheets-api"},"DOM StyleSheets API"),(0,r.kt)("p",null,"\u4ee5\u4e0b\u662f CSSStyleSheet \u4ece StyleSheet \u7ee7\u627f\u7684\u5c5e\u6027:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"disabled: Boolean, \u8868\u793a\u6837\u5f0f\u8868\u662f\u5426\u88ab\u7981\u7528\u4e86 (\u8bbe\u7f6e\u4e3a true \u4f1a\u7981\u7528\u6837\u5f0f\u8868)."),(0,r.kt)("li",{parentName:"ul"},"href: ",(0,r.kt)("inlineCode",{parentName:"li"},"<link>")," URL/null."),(0,r.kt)("li",{parentName:"ul"},"media: \u6837\u5f0f\u8868\u652f\u6301\u7684\u5a92\u4f53\u7c7b\u578b\u96c6\u5408."),(0,r.kt)("li",{parentName:"ul"},"ownerNode: \u6307\u5411\u62e5\u6709\u5f53\u524d\u6837\u5f0f\u8868\u7684\u8282\u70b9 ",(0,r.kt)("inlineCode",{parentName:"li"},"<link>"),"/",(0,r.kt)("inlineCode",{parentName:"li"},"<style>"),"/null (",(0,r.kt)("inlineCode",{parentName:"li"},"@import"),")."),(0,r.kt)("li",{parentName:"ul"},"title: ownerNode \u7684 title \u5c5e\u6027."),(0,r.kt)("li",{parentName:"ul"},"parentStyleSheet: ",(0,r.kt)("inlineCode",{parentName:"li"},"@import")," parent."),(0,r.kt)("li",{parentName:"ul"},"type: \u6837\u5f0f\u8868\u7684\u7c7b\u578b (",(0,r.kt)("inlineCode",{parentName:"li"},"'text/css'"),")."),(0,r.kt)("li",{parentName:"ul"},"cssRules: \u5f53\u524d\u6837\u5f0f\u8868\u5305\u542b\u7684\u6837\u5f0f\u89c4\u5219\u7684\u96c6\u5408."),(0,r.kt)("li",{parentName:"ul"},"ownerRule: \u5982\u679c\u6837\u5f0f\u8868\u662f\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"li"},"@import")," \u5bfc\u5165\u7684, \u5219\u6307\u5411\u5bfc\u5165\u89c4\u5219."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"deleteRule(index)"),": \u5728\u6307\u5b9a\u4f4d\u7f6e\u5220\u9664 cssRules \u4e2d\u7684\u89c4\u5219."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"insertRule(rule, index)"),": \u5728\u6307\u5b9a\u4f4d\u7f6e\u5411 cssRules \u4e2d\u63d2\u5165\u89c4\u5219.")),(0,r.kt)("h5",{id:"css-rules-definition"},"CSS Rules Definition"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"CSSRule"),":"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"type of ",(0,r.kt)("inlineCode",{parentName:"li"},"CSSRule"),":\nSTYLE_RULE (1), IMPORT_RULE (3), MEDIA_RULE (4), KEYFRAMES_RULE (7)."),(0,r.kt)("li",{parentName:"ul"},"cssText: \u8fd4\u56de\u6574\u6761\u89c4\u5219\u7684\u6587\u672c."),(0,r.kt)("li",{parentName:"ul"},"selectorText: \u8fd4\u56de\u89c4\u5219\u7684\u9009\u62e9\u7b26\u6587\u672c."),(0,r.kt)("li",{parentName:"ul"},"style: \u8fd4\u56de CSSStyleDeclaration \u5bf9\u8c61, \u53ef\u4ee5\u8bbe\u7f6e\u548c\u83b7\u53d6\u5f53\u524d\u89c4\u5219\u4e2d\u7684\u6837\u5f0f."),(0,r.kt)("li",{parentName:"ul"},"parentRule: \u5982\u679c\u8fd9\u6761\u89c4\u5219\u88ab\u5176\u4ed6\u89c4\u5219 (\u5982 ",(0,r.kt)("inlineCode",{parentName:"li"},"@media"),") \u5305\u542b, \u5219\u6307\u5411\u5305\u542b\u89c4\u5219."),(0,r.kt)("li",{parentName:"ul"},"parentStyleSheet: \u5305\u542b\u5f53\u524d\u89c4\u5219\u7684\u6837\u5f0f\u8868.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const myRules = document.styleSheets[0].cssRules;\nconst p = document.querySelector('p');\n\nfor (i of myRules) {\n  if (i.type === 1) {\n    p.innerHTML += `<code>${i.selectorText}</code><br>`;\n  }\n\n  if (i.selectorText === 'a:hover') {\n    i.selectorText = 'a:hover, a:active';\n  }\n\n  const myStyle = i.style;\n\n  // Set the bg color on the body\n  myStyle.setProperty('background-color', 'peachPuff');\n\n  // Get the font size of the body\n  myStyle.getPropertyValue('font-size');\n\n  // Get the 5th item in the body's style rule\n  myStyle.item(5);\n\n  // Log the current length of the body style rule (8)\n  console.log(myStyle.length);\n\n  // Remove the line height\n  myStyle.removeProperty('line-height');\n\n  // log the length again (7)\n  console.log(myStyle.length);\n\n  // Check priority of font-family (empty string)\n  myStyle.getPropertyPriority('font-family');\n}\n")),(0,r.kt)("h5",{id:"media-rules"},"Media Rules"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"conditionText")," property of media rule."),(0,r.kt)("li",{parentName:"ul"},"Nested ",(0,r.kt)("inlineCode",{parentName:"li"},"cssRules"),".")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const myRules = document.styleSheets[0].cssRules;\nconst p = document.querySelector('.output');\n\nfor (i of myRules) {\n  if (i.type === 4) {\n    p.innerHTML += `<code>${i.conditionText}</code><br>`;\n\n    for (j of i.cssRules) {\n      p.innerHTML += `<code>${j.selectorText}</code><br>`;\n    }\n  }\n}\n")),(0,r.kt)("h5",{id:"keyframe-rules"},"Keyframe Rules"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"name")," property of keyframe rule"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"keyText")," property of keyframe rule."),(0,r.kt)("li",{parentName:"ul"},"Nested ",(0,r.kt)("inlineCode",{parentName:"li"},"cssRules"),".")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const myRules = document.styleSheets[0].cssRules;\nconst p = document.querySelector('.output');\n\nfor (i of myRules) {\n  if (i.type === 7) {\n    p.innerHTML += `<code>${i.name}</code><br>`;\n\n    for (j of i.cssRules) {\n      p.innerHTML += `<code>${j.keyText}</code><br>`;\n    }\n  }\n}\n")),(0,r.kt)("h5",{id:"manipulate-css-rules"},"Manipulate CSS Rules"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const myStylesheet = document.styleSheets[0];\nconsole.log(myStylesheet.cssRules.length); // 8\n\ndocument.styleSheets[0].insertRule(\n  'article { line-height: 1.5; font-size: 1.5em; }',\n  myStylesheet.cssRules.length\n);\nconsole.log(document.styleSheets[0].cssRules.length); // 9\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const myStylesheet = document.styleSheets[0];\nconsole.log(myStylesheet.cssRules.length); // 8\n\nmyStylesheet.deleteRule(3);\nconsole.log(myStylesheet.cssRules.length); // 7\n")),(0,r.kt)("h3",{id:"dom-events"},"DOM Events"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"event.preventDefault()"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"event.stopPropagation()"),"."),(0,r.kt)("li",{parentName:"ul"},"Default ",(0,r.kt)("inlineCode",{parentName:"li"},"bubble")," mode, can change to ",(0,r.kt)("inlineCode",{parentName:"li"},"capture")," mode."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"element.dispatchEvent(event)")," to trigger events.")),(0,r.kt)("h4",{id:"events-object"},"Events Object"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Property/Method"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null}))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"type"),(0,r.kt)("td",{parentName:"tr",align:null},"String"),(0,r.kt)("td",{parentName:"tr",align:null},"\u88ab\u89e6\u53d1\u7684\u4e8b\u4ef6\u7c7b\u578b")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"trusted"),(0,r.kt)("td",{parentName:"tr",align:null},"Boolean"),(0,r.kt)("td",{parentName:"tr",align:null},"\u6d4f\u89c8\u5668\u751f\u6210/JavaScript \u521b\u5efa")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"View"),(0,r.kt)("td",{parentName:"tr",align:null},"AbstractView"),(0,r.kt)("td",{parentName:"tr",align:null},"\u4e8b\u4ef6\u6240\u53d1\u751f\u7684 window \u5bf9\u8c61")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"currentTarget"),(0,r.kt)("td",{parentName:"tr",align:null},"Element"),(0,r.kt)("td",{parentName:"tr",align:null},"Event handler binding")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"target"),(0,r.kt)("td",{parentName:"tr",align:null},"Element"),(0,r.kt)("td",{parentName:"tr",align:null},"Event trigger")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"bubbles"),(0,r.kt)("td",{parentName:"tr",align:null},"Boolean"),(0,r.kt)("td",{parentName:"tr",align:null},"\u4e8b\u4ef6\u662f\u5426\u5192\u6ce1")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"cancelable"),(0,r.kt)("td",{parentName:"tr",align:null},"Boolean"),(0,r.kt)("td",{parentName:"tr",align:null},"\u662f\u5426\u53ef\u4ee5\u53d6\u6d88\u4e8b\u4ef6\u7684\u9ed8\u8ba4\u884c\u4e3a")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"eventPhase"),(0,r.kt)("td",{parentName:"tr",align:null},"Number"),(0,r.kt)("td",{parentName:"tr",align:null},"\u6355\u83b7\u9636\u6bb5/\u5230\u8fbe\u76ee\u6807/\u5192\u6ce1\u9636\u6bb5")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"defaultPrevented"),(0,r.kt)("td",{parentName:"tr",align:null},"Boolean"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"preventDefault()")," called")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"preventDefault()"),(0,r.kt)("td",{parentName:"tr",align:null},"Function"),(0,r.kt)("td",{parentName:"tr",align:null},"\u7528\u4e8e\u53d6\u6d88\u4e8b\u4ef6\u7684\u9ed8\u8ba4\u884c\u4e3a")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"stopPropagation()"),(0,r.kt)("td",{parentName:"tr",align:null},"Function"),(0,r.kt)("td",{parentName:"tr",align:null},"\u7528\u4e8e\u53d6\u6d88\u6240\u6709\u540e\u7eed\u4e8b\u4ef6\u6355\u83b7\u6216\u5192\u6ce1")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"stopImmediatePropagation()"),(0,r.kt)("td",{parentName:"tr",align:null},"Function"),(0,r.kt)("td",{parentName:"tr",align:null},"\u7528\u4e8e\u53d6\u6d88\u6240\u6709\u540e\u7eed\u4e8b\u4ef6\u6355\u83b7\u6216\u5192\u6ce1")))),(0,r.kt)("h4",{id:"events-checking"},"Events Checking"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"function handleEvent(event) {\n  node.matches(event.target); // return false or true\n  node.contains(event.target); // return false or true\n}\n")),(0,r.kt)("h4",{id:"global-ui-events"},"Global UI Events"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"DOMContentLoaded")," event:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5f53\u6587\u6863\u4e2d\u6ca1\u6709\u811a\u672c\u65f6, \u6d4f\u89c8\u5668\u89e3\u6790\u5b8c ",(0,r.kt)("inlineCode",{parentName:"li"},"HTML")," \u6587\u6863\u4fbf\u80fd\u89e6\u53d1 ",(0,r.kt)("inlineCode",{parentName:"li"},"DOMContentLoaded")," \u4e8b\u4ef6."),(0,r.kt)("li",{parentName:"ul"},"\u5982\u679c\u6587\u6863\u4e2d\u5305\u542b\u811a\u672c, \u5219\u811a\u672c\u4f1a\u963b\u585e\u6587\u6863\u7684\u89e3\u6790,\n\u811a\u672c\u9700\u8981\u7b49 ",(0,r.kt)("inlineCode",{parentName:"li"},"CSSOM")," \u6784\u5efa\u5b8c\u6210\u624d\u80fd\u6267\u884c:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u5728 ",(0,r.kt)("inlineCode",{parentName:"li"},"DOM"),"/",(0,r.kt)("inlineCode",{parentName:"li"},"CSSOM")," \u6784\u5efa\u5b8c\u6bd5, ",(0,r.kt)("inlineCode",{parentName:"li"},"async")," \u811a\u672c\u6267\u884c\u5b8c\u6210\u4e4b\u540e, ",(0,r.kt)("inlineCode",{parentName:"li"},"DOMContentLoaded")," \u4e8b\u4ef6\u89e6\u53d1."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"HTML")," \u6587\u6863\u6784\u5efa\u4e0d\u53d7 ",(0,r.kt)("inlineCode",{parentName:"li"},"defer")," \u811a\u672c\u5f71\u54cd,\n\u4e0d\u9700\u8981\u7b49\u5f85 ",(0,r.kt)("inlineCode",{parentName:"li"},"defer")," \u811a\u672c\u6267\u884c\u4e0e\u6837\u5f0f\u8868\u52a0\u8f7d,\n",(0,r.kt)("inlineCode",{parentName:"li"},"HTML")," \u89e3\u6790\u5b8c\u6bd5\u540e, ",(0,r.kt)("inlineCode",{parentName:"li"},"DOMContentLoaded")," \u7acb\u5373\u89e6\u53d1."))),(0,r.kt)("li",{parentName:"ul"},"\u5728\u4efb\u4f55\u60c5\u51b5\u4e0b, ",(0,r.kt)("inlineCode",{parentName:"li"},"DOMContentLoaded")," \u7684\u89e6\u53d1\u4e0d\u9700\u8981\u7b49\u5f85\u56fe\u7247\u7b49\u5176\u4ed6\u8d44\u6e90\u52a0\u8f7d\u5b8c\u6210."),(0,r.kt)("li",{parentName:"ul"},"\u5f53 ",(0,r.kt)("inlineCode",{parentName:"li"},"HTML")," \u6587\u6863\u89e3\u6790\u5b8c\u6210\u5c31\u4f1a\u89e6\u53d1 ",(0,r.kt)("inlineCode",{parentName:"li"},"DOMContentLoaded"),",\n",(0,r.kt)("strong",{parentName:"li"},"\u6240\u6709\u8d44\u6e90"),"\u52a0\u8f7d\u5b8c\u6210\u4e4b\u540e, ",(0,r.kt)("strong",{parentName:"li"},"load")," \u4e8b\u4ef6\u624d\u4f1a\u88ab\u89e6\u53d1.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"document.addEventListener('DOMContentLoaded', event => {\n  console.log('DOM fully loaded and parsed.');\n});\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"visibilitychange")," event, \u5207\u6362\u6807\u7b7e\u9875\u65f6\u6539\u53d8\u7f51\u9875\u6807\u9898/\u58f0\u97f3/\u89c6\u9891:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"window.addEventListener('visibilitychange', () => {\n  switch (document.visibilityState) {\n    case 'hidden':\n      console.log('Tab\u9690\u85cf');\n      break;\n    case 'visible':\n      console.log('Tab\u88ab\u805a\u7126');\n      break;\n    default:\n      throw new Error('Unsupported visibility!');\n  }\n});\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const videoElement = document.getElementById('videoElement');\n\n// AutoPlay the video if application is visible\nif (document.visibilityState === 'visible') {\n  videoElement.play();\n}\n\n// Handle page visibility change events\nfunction handleVisibilityChange() {\n  if (document.visibilityState === 'hidden') {\n    videoElement.pause();\n  } else {\n    videoElement.play();\n  }\n}\n\ndocument.addEventListener('visibilitychange', handleVisibilityChange, false);\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"readystatechange")," event:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"document.addEventListener('readystatechange', event => {\n  // HTML5 readyState\n  if (\n    document.readyState === 'interactive' ||\n    document.readyState === 'complete'\n  ) {\n    console.log('Content loaded');\n  } else if (document.readyState === 'loading') {\n    console.log('Loading');\n  }\n});\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"load")," event, \u52a0\u8f7d\u5b8c\u6210:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"window.addEventListener('load', () => {\n  const image = document.createElement('img');\n  image.addEventListener('load', event => {\n    console.log(event.target.src);\n  });\n  document.body.appendChild(image);\n  image.src = 'smile.gif';\n\n  const script = document.createElement('script');\n  script.addEventListener('load', event => {\n    console.log('Loaded');\n  });\n  script.src = 'example.js';\n  document.body.appendChild(script);\n\n  const link = document.createElement('link');\n  link.type = 'text/css';\n  link.rel = 'stylesheet';\n  link.addEventListener('load', event => {\n    console.log('css loaded');\n  });\n  link.href = 'example.css';\n  document.getElementsByTagName('head')[0].appendChild(link);\n});\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"beforeunload")," event."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"unload")," event: \u5378\u8f7d\u5b8c\u6210."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"abort")," event: \u63d0\u524d\u7ec8\u6b62."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"error")," event."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"select")," event: \u5728\u6587\u672c\u6846 (",(0,r.kt)("inlineCode",{parentName:"li"},"<input>")," \u6216 ",(0,r.kt)("inlineCode",{parentName:"li"},"textarea"),") \u4e0a\u9009\u62e9\u5b57\u7b26."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"resize")," event: \u7f29\u653e."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"scroll")," event: \u6eda\u52a8.")),(0,r.kt)("h4",{id:"form-events"},"Form Events"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"submit"),"/",(0,r.kt)("inlineCode",{parentName:"li"},"reset")," event."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/docs/Web/API/FormData"},"FromData API")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/docs/Web/API/HTMLSelectElement/checkValidity"},"CheckValidity API"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// <form className='validated-form' noValidate onSubmit={onSubmit}>\n\nconst onSubmit = event => {\n  event.preventDefault();\n\n  const form = event.target;\n  const isValid = form.checkValidity(); // returns true or false\n  const formData = new FormData(form);\n\n  const validationMessages = Array.from(formData.keys()).reduce((acc, key) => {\n    acc[key] = form.elements[key].validationMessage;\n    return acc;\n  }, {});\n\n  setErrors(validationMessages);\n\n  console.log({\n    validationMessages,\n    data,\n    isValid,\n  });\n\n  if (isValid) {\n    // here you do what you need to do if is valid\n    const data = Array.from(formData.keys()).reduce((acc, key) => {\n      acc[key] = formData.get(key);\n      return acc;\n    }, {});\n  } else {\n    // apply invalid class\n    Array.from(form.elements).forEach(i => {\n      if (i.checkValidity()) {\n        // field is valid\n        i.parentElement.classList.remove('invalid');\n      } else {\n        // field is invalid\n        i.parentElement.classList.add('invalid');\n        console.log(i.validity);\n      }\n    });\n  }\n};\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"document.querySelector('form').addEventListener('submit', event => {\n  const form = event.target;\n  const url = new URL(form.action || window.location.href);\n  const formData = new FormData(form);\n  const searchParameters = new URLSearchParams(formData);\n\n  const options = {\n    method: form.method,\n  };\n\n  if (options.method === 'post') {\n    // Modify request body to include form data\n    options.body =\n      form.enctype === 'multipart/form-data' ? formData : searchParameters;\n  } else {\n    // Modify URL to include form data\n    url.search = searchParameters;\n  }\n\n  fetch(url, options);\n  event.preventDefault();\n});\n")),(0,r.kt)("h4",{id:"input-events"},"Input Events"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"blur"),"/",(0,r.kt)("inlineCode",{parentName:"li"},"focus"),"/",(0,r.kt)("inlineCode",{parentName:"li"},"focusin"),"/",(0,r.kt)("inlineCode",{parentName:"li"},"focusout")," event."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"input"),"/",(0,r.kt)("inlineCode",{parentName:"li"},"change")," event."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"select")," event: \u5728\u6587\u672c\u6846 (",(0,r.kt)("inlineCode",{parentName:"li"},"<input>")," \u6216 ",(0,r.kt)("inlineCode",{parentName:"li"},"textarea"),") \u4e0a\u9009\u62e9\u5b57\u7b26.")),(0,r.kt)("h5",{id:"input-focus-event"},"Input Focus Event"),(0,r.kt)("p",null,"HTML5 focus management:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5728\u9875\u9762\u5b8c\u5168\u52a0\u8f7d\u4e4b\u524d, ",(0,r.kt)("inlineCode",{parentName:"li"},"document.activeElement")," \u4e3a null."),(0,r.kt)("li",{parentName:"ul"},"\u9ed8\u8ba4\u60c5\u51b5\u4e0b, ",(0,r.kt)("inlineCode",{parentName:"li"},"document.activeElement")," \u5728\u9875\u9762\u521a\u52a0\u8f7d\u5b8c\u4e4b\u540e\u4f1a\u8bbe\u7f6e\u4e3a ",(0,r.kt)("inlineCode",{parentName:"li"},"document.body"),".")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"document.getElementById('myButton').focus();\nconsole.log(document.activeElement === button); // true\nconsole.log(document.hasFocus()); // true\n")),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Focus Events")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"\u5f53\u7126\u70b9\u4ece\u9875\u9762\u4e2d\u7684\u4e00\u4e2a\u5143\u7d20\u79fb\u5230\u53e6\u4e00\u4e2a\u5143\u7d20\u4e0a\u65f6, \u4f1a\u4f9d\u6b21\u53d1\u751f\u5982\u4e0b\u4e8b\u4ef6:"),(0,r.kt)("ol",{parentName:"div"},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"focusout"),": \u5728\u5931\u53bb\u7126\u70b9\u7684\u5143\u7d20\u4e0a\u89e6\u53d1."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"focusin"),": \u5728\u83b7\u5f97\u7126\u70b9\u7684\u5143\u7d20\u4e0a\u89e6\u53d1"),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"blur"),": \u5728\u5931\u53bb\u7126\u70b9\u7684\u5143\u7d20\u4e0a\u89e6\u53d1"),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"DOMFocusOut"),": \u5728\u5931\u53bb\u7126\u70b9\u7684\u5143\u7d20\u4e0a\u89e6\u53d1"),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"focus"),": \u5728\u83b7\u5f97\u7126\u70b9\u7684\u5143\u7d20\u4e0a\u89e6\u53d1"),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"DOMFocusIn"),": \u5728\u83b7\u5f97\u7126\u70b9\u7684\u5143\u7d20\u4e0a\u89e6\u53d1.")))),(0,r.kt)("h5",{id:"input-change-event"},"Input Change Event"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"input")," event:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},'<input type="text" />'),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},'<input type="password"/>'),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"<textarea />"),"."))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"change")," event:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},'<input type="checkbox" />'),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},'<input type="radio" />'),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},'<input type="file" />'),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},'<input type="file" multiple />'),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"<select />"),".")))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const input = document.querySelector('input');\n\ninput.addEventListener('change', () => {\n  for (const file of Array.from(input.files)) {\n    const reader = new FileReader();\n    reader.addEventListener('load', () => {\n      console.log('File', file.name, 'starts with', reader.result.slice(0, 20));\n    });\n    reader.readAsText(file);\n  }\n});\n")),(0,r.kt)("h5",{id:"input-select-event"},"Input Select Event"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const input = document.querySelector('input');\n\ninput.addEventListener('select', event => {\n  const log = document.getElementById('log');\n  const selection = event.target.value.substring(\n    event.target.selectionStart,\n    event.target.selectionEnd\n  );\n  log.textContent = `You selected: ${selection}`;\n});\n")),(0,r.kt)("h4",{id:"clipboard-events"},"Clipboard Events"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/Clipboard_API"},"Clipboard API"),"\n(modern alternative for ",(0,r.kt)("inlineCode",{parentName:"p"},"document.execCommand(command)"),"):"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"copy")," event."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"cut")," event."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"paste")," event.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const source = document.querySelector('div.source');\n\nsource.addEventListener('copy', event => {\n  const selection = document.getSelection();\n  event.clipboardData.setData(\n    'text/plain',\n    selection.toString().concat('copyright information')\n  );\n  event.preventDefault();\n});\n")),(0,r.kt)("h4",{id:"mouse-events"},"Mouse Events"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"mousedown")," event."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"mouseup")," event."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"click")," event:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"mousedown")," \u4e0e ",(0,r.kt)("inlineCode",{parentName:"li"},"mouseup")," \u90fd\u89e6\u53d1\u540e, \u89e6\u53d1\u6b64\u4e8b\u4ef6."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"event.clientX"),"/",(0,r.kt)("inlineCode",{parentName:"li"},"event.clientY"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"event.pageX"),"/",(0,r.kt)("inlineCode",{parentName:"li"},"event.pageY"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"event.screenX"),"/",(0,r.kt)("inlineCode",{parentName:"li"},"event.screenY"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"event.shiftKey"),"/",(0,r.kt)("inlineCode",{parentName:"li"},"event.ctrlKey"),"/",(0,r.kt)("inlineCode",{parentName:"li"},"event.altKey"),"/",(0,r.kt)("inlineCode",{parentName:"li"},"event.metaKey"),"."))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"dbclick")," event: ",(0,r.kt)("inlineCode",{parentName:"li"},"click")," \u4e24\u6b21\u89e6\u53d1\u540e, \u89e6\u53d1\u6b64\u4e8b\u4ef6."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"mousemove")," event."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"mouseenter")," event."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"mouseleave")," event:\npointer has exited the element and all of its descendants."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"mouseout")," event:\npointer leaves the element or leaves one of the element's descendants."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"mouseover")," event."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"wheel")," event (replace deprecated ",(0,r.kt)("inlineCode",{parentName:"li"},"mousewheel")," event).")),(0,r.kt)("p",null,"For ",(0,r.kt)("inlineCode",{parentName:"p"},"click")," event, no need for X/Y to judge internal/outside state.\nUse ",(0,r.kt)("inlineCode",{parentName:"p"},"element.contains")," to check is a better way."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"window.addEventListener('click', event => {\n  if (document.getElementById('main').contains(event.target)) {\n    process();\n  }\n});\n")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/DragEvent"},"Drag Event"),":"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"dragstart: start point."),(0,r.kt)("li",{parentName:"ul"},"dragend"),(0,r.kt)("li",{parentName:"ul"},"dragenter: call ",(0,r.kt)("inlineCode",{parentName:"li"},"event.preventDefault()")," in drop zone."),(0,r.kt)("li",{parentName:"ul"},"dragover: call ",(0,r.kt)("inlineCode",{parentName:"li"},"event.preventDefault()")," in drop zone."),(0,r.kt)("li",{parentName:"ul"},"dragleave"),(0,r.kt)("li",{parentName:"ul"},"drop: end point.")),(0,r.kt)("p",null,"Key point for implementing DnD widget is\n",(0,r.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/DataTransfer"},"DataTransfer"),":"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Bindings between Drag Zone and Drop Zone."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"DataTransfer.dropEffect")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"DataTransfer.effectAllowed")," to define DnD UI type."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"DataTransfer.getData")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"DataTransfer.setData")," to transfer data."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"DataTransfer.files")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"DataTransfer.items")," to transfer data.")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/Element/contextmenu_event"},"Context Menu Event"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const noContext = document.getElementById('noContextMenu');\n\nnoContext.addEventListener('contextmenu', e => {\n  e.preventDefault();\n});\n")),(0,r.kt)("h4",{id:"keyboard-events"},"Keyboard Events"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"keydown"),"/",(0,r.kt)("inlineCode",{parentName:"p"},"keypress"),"/",(0,r.kt)("inlineCode",{parentName:"p"},"keyup")," event:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const textbox = document.getElementById('myText');\n\ntextbox.addEventListener('keyup', event => {\n  console.log(event.charCode || event.keyCode);\n});\n")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/key/Key_Values"},(0,r.kt)("inlineCode",{parentName:"a"},"event.key")),"\n(replace deprecated ",(0,r.kt)("inlineCode",{parentName:"p"},"event.keyCode"),"):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"'Alt';\n'CapsLock';\n'Control';\n'Fn';\n'Numlock';\n'Shift';\n'Enter';\n'Tab';\n' '; // space bar\n\n'ArrowDown';\n'ArrowLeft';\n'ArrowRight';\n'ArrowUp';\n'Home';\n'End';\n'PageDOwn';\n'PageUp';\n\n'Backspace';\n'Delete';\n'Redo';\n'Undo';\n")),(0,r.kt)("h4",{id:"device-events"},"Device Events"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"deviceorientation")," event."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"devicemotion")," event."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"touchstart")," event."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"touchmove")," event."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"touchend")," event."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"touchcancel")," event.")),(0,r.kt)("h4",{id:"dispatch-events"},"Dispatch Events"),(0,r.kt)("p",null,"Dispatch ",(0,r.kt)("inlineCode",{parentName:"p"},"MouseEvent"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const btn = document.getElementById('myBtn');\n\n// \u521b\u5efa event \u5bf9\u8c61\nconst event = new MouseEvent('click', {\n  bubbles: true,\n  cancelable: true,\n  view: document.defaultView,\n});\n\n// \u89e6\u53d1\u4e8b\u4ef6\nbtn.dispatchEvent(event);\n")),(0,r.kt)("p",null,"Dispatch ",(0,r.kt)("inlineCode",{parentName:"p"},"KeyboardEvent"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const textbox = document.getElementById('myTextbox');\n\n// \u6309\u7167 DOM3 \u7684\u65b9\u5f0f\u521b\u5efa event \u5bf9\u8c61\nif (document.implementation.hasFeature('KeyboardEvents', '3.0')) {\n  // \u521d\u59cb\u5316 event \u5bf9\u8c61\n  const event = new KeyboardEvent('keydown', {\n    bubbles: true,\n    cancelable: true,\n    view: document.defaultView,\n    key: 'a',\n    location: 0,\n    shiftKey: true,\n  });\n\n  // \u89e6\u53d1\u4e8b\u4ef6\n  textbox.dispatchEvent(event);\n}\n")),(0,r.kt)("p",null,"Dispatch ",(0,r.kt)("inlineCode",{parentName:"p"},"CustomEvent"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const div = document.getElementById('myDiv');\ndiv.addEventListener('myEvent', event => {\n  console.log(`DIV: ${event.detail}`);\n});\ndocument.addEventListener('myEvent', event => {\n  console.log(`DOCUMENT: ${event.detail}`);\n});\n\nif (document.implementation.hasFeature('CustomEvents', '3.0')) {\n  const event = new CustomEvent('myEvent', {\n    bubbles: true,\n    cancelable: true,\n    detail: 'Hello world!',\n  });\n  div.dispatchEvent(event);\n}\n")),(0,r.kt)("h4",{id:"events-util"},"Events Util"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"class EventUtil {\n  static getEvent(event) {\n    return event || window.event;\n  }\n\n  static getTarget(event) {\n    return event.target || event.srcElement;\n  }\n\n  static getRelatedTarget(event) {\n    // For `mouseover` and `mouseout` event:\n    if (event.relatedTarget) {\n      return event.relatedTarget;\n    } else if (event.toElement) {\n      return event.toElement;\n    } else if (event.fromElement) {\n      return event.fromElement;\n    } else {\n      return null;\n    }\n  }\n\n  static preventDefault(event) {\n    if (event.preventDefault) {\n      event.preventDefault();\n    } else {\n      event.returnValue = false;\n    }\n  }\n\n  static stopPropagation(event) {\n    if (event.stopPropagation) {\n      event.stopPropagation();\n    } else {\n      event.cancelBubble = true;\n    }\n  }\n\n  static addHandler(element, type, handler) {\n    if (element.addEventListener) {\n      element.addEventListener(type, handler, false);\n    } else if (element.attachEvent) {\n      element.attachEvent(`on${type}`, handler);\n    } else {\n      element[`on${type}`] = handler;\n    }\n  }\n\n  static removeHandler(element, type, handler) {\n    if (element.removeEventListener) {\n      element.removeEventListener(type, handler, false);\n    } else if (element.detachEvent) {\n      element.detachEvent(`on${type}`, handler);\n    } else {\n      element[`on${type}`] = null;\n    }\n  }\n}\n")),(0,r.kt)("h3",{id:"dom-rect"},"DOM Rect"),(0,r.kt)("h4",{id:"dom-width-and-height"},"DOM Width and Height"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"outerHeight: \u6574\u4e2a\u6d4f\u89c8\u5668\u7a97\u53e3\u7684\u5927\u5c0f, \u5305\u62ec\u7a97\u53e3\u6807\u9898/\u5de5\u5177\u680f/\u72b6\u6001\u680f\u7b49."),(0,r.kt)("li",{parentName:"ul"},"innerHeight: DOM \u89c6\u53e3\u7684\u5927\u5c0f, \u5305\u62ec\u6eda\u52a8\u6761."),(0,r.kt)("li",{parentName:"ul"},"offsetHeight: \u6574\u4e2a\u53ef\u89c6\u533a\u57df\u5927\u5c0f, \u5305\u62ec border \u548c scrollbar \u5728\u5185 (content + padding + border)."),(0,r.kt)("li",{parentName:"ul"},"clientHeight: \u5185\u90e8\u53ef\u89c6\u533a\u57df\u5927\u5c0f (content + padding)."),(0,r.kt)("li",{parentName:"ul"},"scrollHeight: \u5143\u7d20\u5185\u5bb9\u7684\u9ad8\u5ea6, \u5305\u62ec\u6ea2\u51fa\u90e8\u5206.")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Client Size",src:t(6161).Z,width:"683",height:"617"})),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// const supportInnerWidth = window.innerWidth !== undefined;\n// const supportInnerHeight = window.innerHeight !== undefined;\n// const isCSS1Compat = (document.compatMode || '') === 'CSS1Compat';\nconst width =\n  window.innerWidth ||\n  document.documentElement.clientWidth ||\n  document.body.clientWidth;\nconst height =\n  window.innerHeight ||\n  document.documentElement.clientHeight ||\n  document.body.clientHeight;\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// \u7f29\u653e\u5230 100\xd7100\nwindow.resizeTo(100, 100);\n// \u7f29\u653e\u5230 200\xd7150\nwindow.resizeBy(100, 50);\n// \u7f29\u653e\u5230 300\xd7300\nwindow.resizeTo(300, 300);\n")),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"DOM Rect API")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"In case of transforms,\nthe offsetWidth and offsetHeight returns the layout width and height (all the same),\nwhile getBoundingClientRect() returns the rendering width and height."))),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"getBoundingClientRect"),":"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/Element/getBoundingClientRect"},(0,r.kt)("img",{parentName:"a",src:"https://developer.mozilla.org/en-US/docs/Web/API/Element/getBoundingClientRect/element-box-diagram.png",alt:"Client Rect"}))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const isElementInViewport = el => {\n  const { top, height, left, width } = el.getBoundingClientRect();\n  const w =\n    window.innerWidth ||\n    document.documentElement.clientWidth ||\n    document.body.clientWidth;\n  const h =\n    window.innerHeight ||\n    document.documentElement.clientHeight ||\n    document.body.clientHeight;\n\n  return top <= h && top + height >= 0 && left <= w && left + width >= 0;\n};\n")),(0,r.kt)("h4",{id:"dom-left-and-top"},"DOM Left and Top"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"offsetLeft/offsetTop: \u8868\u793a\u8be5\u5143\u7d20\u7684\u5de6\u4e0a\u89d2 (\u8fb9\u6846\u5916\u8fb9\u7f18) \u4e0e\u5df2\u5b9a\u4f4d\u7684\u7236\u5bb9\u5668 (offsetParent \u5bf9\u8c61) \u5de6\u4e0a\u89d2\u7684\u8ddd\u79bb."),(0,r.kt)("li",{parentName:"ul"},"scrollLeft/scrollTop: \u5143\u7d20\u6eda\u52a8\u6761\u4f4d\u7f6e, \u88ab\u9690\u85cf\u7684\u5185\u5bb9\u533a\u57df\u5de6\u4fa7/\u4e0a\u65b9\u7684\u50cf\u7d20\u4f4d\u7f6e.")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Offset Size",src:t(8804).Z,width:"965",height:"614"})),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"function getElementLeft(element) {\n  let actualLeft = element.offsetLeft;\n  let current = element.offsetParent;\n\n  while (current !== null) {\n    actualLeft += current.offsetLeft;\n    current = current.offsetParent;\n  }\n\n  return actualLeft;\n}\n\nfunction getElementTop(element) {\n  let actualTop = element.offsetTop;\n  let current = element.offsetParent;\n\n  while (current !== null) {\n    actualTop += current.offsetTop;\n    current = current.offsetParent;\n  }\n\n  return actualTop;\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// \u628a\u7a97\u53e3\u79fb\u52a8\u5230\u5de6\u4e0a\u89d2\nwindow.moveTo(0, 0);\n// \u628a\u7a97\u53e3\u5411\u4e0b\u79fb\u52a8 100 \u50cf\u7d20\nwindow.moveBy(0, 100);\n// \u628a\u7a97\u53e3\u79fb\u52a8\u5230\u5750\u6807\u4f4d\u7f6e (200, 300)\nwindow.moveTo(200, 300);\n// \u628a\u7a97\u53e3\u5411\u5de6\u79fb\u52a8 50 \u50cf\u7d20\nwindow.moveBy(-50, 0);\n")),(0,r.kt)("h4",{id:"dom-scroll-size"},"DOM Scroll Size"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"scrollLeft/scrollX/PageXOffset: \u5143\u7d20\u5185\u5bb9\u5411\u53f3\u6eda\u52a8\u4e86\u591a\u5c11\u50cf\u7d20, \u5982\u679c\u6ca1\u6709\u6eda\u52a8\u5219\u4e3a 0."),(0,r.kt)("li",{parentName:"ul"},"scrollTop/scrollY/pageYOffset: \u5143\u7d20\u5185\u5bb9\u5411\u4e0a\u6eda\u52a8\u4e86\u591a\u5c11\u50cf\u7d20, \u5982\u679c\u6ca1\u6709\u6eda\u52a8\u5219\u4e3a 0.")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Scroll Size",src:t(7407).Z,width:"1162",height:"710"})),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// const supportPageOffset = window.pageXOffset !== undefined;\n// const isCSS1Compat = (document.compatMode || '') === 'CSS1Compat';\nconst x =\n  window.pageXOffset ||\n  document.documentElement.scrollLeft ||\n  document.body.scrollLeft;\nconst y =\n  window.pageYOffset ||\n  document.documentElement.scrollTop ||\n  document.body.scrollTop;\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"if (window.innerHeight + window.pageYOffset === document.body.scrollHeight) {\n  console.log('Scrolled to Bottom!');\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// \u76f8\u5bf9\u4e8e\u5f53\u524d\u89c6\u53e3\u5411\u4e0b\u6eda\u52a8 100 \u50cf\u7d20\nwindow.scrollBy(0, 100);\n// \u76f8\u5bf9\u4e8e\u5f53\u524d\u89c6\u53e3\u5411\u53f3\u6eda\u52a8 40 \u50cf\u7d20\nwindow.scrollBy(40, 0);\n\n// \u6eda\u52a8\u5230\u9875\u9762\u5de6\u4e0a\u89d2\nwindow.scrollTo(0, 0);\n// \u6eda\u52a8\u5230\u8ddd\u79bb\u5c4f\u5e55\u5de6\u8fb9\u53ca\u9876\u8fb9\u5404 100 \u50cf\u7d20\u7684\u4f4d\u7f6e\nwindow.scrollTo(100, 100);\n// \u6b63\u5e38\u6eda\u52a8\nwindow.scrollTo({\n  left: 100,\n  top: 100,\n  behavior: 'auto',\n});\n// \u5e73\u6ed1\u6eda\u52a8\nwindow.scrollTo({\n  left: 100,\n  top: 100,\n  behavior: 'smooth',\n});\n\ndocument.forms[0].scrollIntoView(); // \u7a97\u53e3\u6eda\u52a8\u540e, \u5143\u7d20\u5e95\u90e8\u4e0e\u89c6\u53e3\u5e95\u90e8\u5bf9\u9f50.\ndocument.forms[0].scrollIntoView(true); // \u7a97\u53e3\u6eda\u52a8\u540e, \u5143\u7d20\u9876\u90e8\u4e0e\u89c6\u53e3\u9876\u90e8\u5bf9\u9f50.\ndocument.forms[0].scrollIntoView({ block: 'start' });\ndocument.forms[0].scrollIntoView({ behavior: 'smooth', block: 'start' });\n")),(0,r.kt)("h3",{id:"dom-observer"},"DOM Observer"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserver"},"Intersection Observer")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver"},"Mutation Observer")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/en-US/docs/Web/API/ResizeObserver"},"Resize Observer")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/en-US/docs/Web/API/PerformanceObserver"},"Performance Observer")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/en-US/docs/Web/API/ReportingObserver"},"Reporting Observer"))),(0,r.kt)("h4",{id:"intersection-observer"},"Intersection Observer"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// <img class=\"lzy_img\" src=\"lazy_img.jpg\" data-src=\"real_img.jpg\" />\ndocument.addEventListener('DOMContentLoaded', () => {\n  const imageObserver = new IntersectionObserver((entries, imgObserver) => {\n    entries.forEach(entry => {\n      if (entry.isIntersecting) {\n        const lazyImage = entry.target;\n        console.log('Lazy loading ', lazyImage);\n        lazyImage.src = lazyImage.dataset.src;\n\n        // only load image once\n        lazyImage.classList.remove('lzy');\n        imgObserver.unobserve(lazyImage);\n      }\n    });\n  });\n\n  const lazyImages = document.querySelectorAll('img.lzy_img');\n  lazyImages.forEach(lazyImage => imageObserver.observe(lazyImage));\n});\n")),(0,r.kt)("h4",{id:"mutation-observer"},"Mutation Observer"),(0,r.kt)("p",null,"\u5982\u679c\u6587\u6863\u4e2d\u8fde\u7eed\u63d2\u5165 1000 \u4e2a ",(0,r.kt)("inlineCode",{parentName:"p"},"<li>")," \u5143\u7d20, \u5c31\u4f1a\u8fde\u7eed\u89e6\u53d1 1000 \u4e2a\u63d2\u5165\u4e8b\u4ef6,\n\u6267\u884c\u6bcf\u4e2a\u4e8b\u4ef6\u7684\u56de\u8c03\u51fd\u6570, \u8fd9\u5f88\u53ef\u80fd\u9020\u6210\u6d4f\u89c8\u5668\u7684\u5361\u987f;\nMutation Observer \u53ea\u4f1a\u5728 1000 \u4e2a\u6bb5\u843d\u90fd\u63d2\u5165\u7ed3\u675f\u540e\u624d\u4f1a\u89e6\u53d1, \u4e14\u53ea\u89e6\u53d1\u4e00\u6b21."),(0,r.kt)("p",null,"Mutation Observer \u6709\u4ee5\u4e0b\u7279\u70b9:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5b83\u7b49\u5f85\u6240\u6709\u811a\u672c\u4efb\u52a1\u5b8c\u6210\u540e, \u624d\u4f1a\u8fd0\u884c, \u5373\u91c7\u7528\u5f02\u6b65\u65b9\u5f0f."),(0,r.kt)("li",{parentName:"ul"},"\u5b83\u628a DOM \u53d8\u52a8\u8bb0\u5f55\u5c01\u88c5\u6210\u4e00\u4e2a\u6570\u7ec4\u8fdb\u884c\u5904\u7406, \u800c\u4e0d\u662f\u4e00\u6761\u6761\u5730\u4e2a\u522b\u5904\u7406 DOM \u53d8\u52a8."),(0,r.kt)("li",{parentName:"ul"},"\u8bb0\u5f55\u961f\u5217\u548c\u56de\u8c03\u5904\u7406\u7684\u9ed8\u8ba4\u884c\u4e3a\u662f\u8017\u5c3d\u8fd9\u4e2a\u961f\u5217, \u5904\u7406\u6bcf\u4e2a MutationRecord, \u7136\u540e\u8ba9\u5b83\u4eec\u8d85\u51fa\u4f5c\u7528\u57df\u5e76\u88ab\u5783\u573e\u56de\u6536."),(0,r.kt)("li",{parentName:"ul"},"MutationObserver \u5b9e\u4f8b\u62e5\u6709\u88ab\u89c2\u5bdf\u76ee\u6807\u8282\u70b9\u7684\u5f31\u5f15\u7528, \u4e0d\u4f1a\u59a8\u788d\u5783\u573e\u56de\u6536\u7a0b\u5e8f\u56de\u6536\u76ee\u6807\u8282\u70b9."),(0,r.kt)("li",{parentName:"ul"},"\u5b83\u5373\u53ef\u4ee5\u89c2\u5bdf\u53d1\u751f\u5728 DOM \u8282\u70b9\u7684\u6240\u6709\u53d8\u52a8, \u4e5f\u53ef\u4ee5\u89c2\u5bdf\u67d0\u4e00\u7c7b\u53d8\u52a8."),(0,r.kt)("li",{parentName:"ul"},"\u88ab\u89c2\u5bdf\u5b50\u6811\u4e2d\u7684\u8282\u70b9 (",(0,r.kt)("inlineCode",{parentName:"li"},"{ subtree: true }"),") \u88ab\u79fb\u51fa\u5b50\u6811\u4e4b\u540e\u4ecd\u7136\u80fd\u591f\u89e6\u53d1\u53d8\u5316\u4e8b\u4ef6.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const mutationObserver = new MutationObserver(mutations => {\n  mutations.forEach(mutation => {\n    console.log(mutation);\n  });\n});\n\n// \u5f00\u59cb\u4fa6\u542c\u9875\u9762\u7684\u6839 HTML \u5143\u7d20\u4e2d\u7684\u66f4\u6539.\nmutationObserver.observe(document.documentElement, {\n  attributes: true,\n  characterData: true,\n  childList: true,\n  subtree: true,\n  attributeOldValue: true,\n  characterDataOldValue: true,\n});\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const target = document.querySelector('#container');\nconst callback = (mutations, observer) => {\n  mutations.forEach(mutation => {\n    switch (mutation.type) {\n      case 'attributes':\n        // the name of the changed attribute is in\n        // mutation.attributeName\n        // and its old value is in mutation.oldValue\n        // the current value can be retrieved with\n        // target.getAttribute(mutation.attributeName)\n        break;\n      case 'childList':\n        // any added nodes are in mutation.addedNodes\n        // any removed nodes are in mutation.removedNodes\n        break;\n      default:\n        throw new Error('Unsupported mutation!');\n    }\n  });\n};\n\nconst observer = new MutationObserver(callback);\nobserver.observe(target, {\n  attributes: true,\n  attributeFilter: ['foo'], // only observe attribute 'foo'\n  attributeOldValue: true,\n  childList: true,\n});\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const observer = new MutationObserver(mutationRecords =>\n  console.log(mutationRecords)\n);\n\n// \u521b\u5efa\u4e24\u4e2a\u521d\u59cb\u5b50\u8282\u70b9\ndocument.body.appendChild(document.createElement('div'));\ndocument.body.appendChild(document.createElement('span'));\n\nobserver.observe(document.body, { childList: true });\n\n// \u4ea4\u6362\u5b50\u8282\u70b9\u987a\u5e8f\ndocument.body.insertBefore(document.body.lastChild, document.body.firstChild);\n// \u53d1\u751f\u4e86\u4e24\u6b21\u53d8\u5316: \u7b2c\u4e00\u6b21\u662f\u8282\u70b9\u88ab\u79fb\u9664, \u7b2c\u4e8c\u6b21\u662f\u8282\u70b9\u88ab\u6dfb\u52a0\n// [\n//   {\n//     addedNodes: NodeList[],\n//     attributeName: null,\n//     attributeNamespace: null,\n//     oldValue: null,\n//     nextSibling: null,\n//     previousSibling: div,\n//     removedNodes: NodeList[span],\n//     target: body,\n//     type: childList,\n//   },\n//   {\n//     addedNodes: NodeList[span],\n//     attributeName: null,\n//     attributeNamespace: null,\n//     oldValue: null,\n//     nextSibling: div,\n//     previousSibling: null,\n//     removedNodes: NodeList[],\n//     target: body,\n//     type: \"childList\",\n//   }\n// ]\n")),(0,r.kt)("h3",{id:"xml-namespace"},"XML Namespace"),(0,r.kt)("p",null,"XML \u547d\u540d\u7a7a\u95f4\u53ef\u4ee5\u5b9e\u73b0\u5728\u4e00\u4e2a\u683c\u5f0f\u89c4\u8303\u7684\u6587\u6863\u4e2d\u6df7\u7528\u4e0d\u540c\u7684 XML \u8bed\u8a00,\n\u907f\u514d\u5143\u7d20\u547d\u540d\u51b2\u7a81 (",(0,r.kt)("inlineCode",{parentName:"p"},"tagName"),"/",(0,r.kt)("inlineCode",{parentName:"p"},"localName"),"/",(0,r.kt)("inlineCode",{parentName:"p"},"namespaceURI"),"):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'<html xmlns="http://www.w3.org/1999/xhtml">\n  <head>\n    <title>Example XHTML page</title>\n  </head>\n  <body>\n    <s:svg\n      xmlns:s="http://www.w3.org/2000/svg"\n      version="1.1"\n      viewBox="0 0 100 100"\n      style="width:100%; height:100%"\n    >\n      <s:rect x="0" y="0" width="100" height="100" style="fill:red" />\n    </s:svg>\n  </body>\n</html>\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"console.log(document.body.isDefaultNamespace('http://www.w3.org/1999/xhtml'));\nconsole.log(svg.lookupPrefix('http://www.w3.org/2000/svg')); // \"s\"\nconsole.log(svg.lookupNamespaceURI('s')); // \"http://www.w3.org/2000/svg\"\n\nconst newSvg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\nconst newAttr = document.createAttributeNS(\n  'http://www.somewhere.com',\n  'random'\n);\nconst elems = document.getElementsByTagNameNS(\n  'http://www.w3.org/1999/xhtml',\n  '*'\n);\n")),(0,r.kt)("h2",{id:"javascript-engine"},"JavaScript Engine"),(0,r.kt)("h3",{id:"variables-lifecycle"},"Variables Lifecycle"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Creation phase (",(0,r.kt)("strong",{parentName:"li"},"Hoisting"),")",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Declaration phase: \u5728\u4f5c\u7528\u57df\u4e2d\u6ce8\u518c\u53d8\u91cf"),(0,r.kt)("li",{parentName:"ul"},"Initialization phase: \u5206\u914d\u5185\u5b58, \u5728\u4f5c\u7528\u57df\u4e2d\u7ed1\u5b9a\u53d8\u91cf (",(0,r.kt)("inlineCode",{parentName:"li"},"undefined"),")"))),(0,r.kt)("li",{parentName:"ul"},"Execution phase/Assignment phase")),(0,r.kt)("h3",{id:"execution-context"},"Execution Context"),(0,r.kt)("h4",{id:"global-execution-context"},"Global Execution Context"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Create global object (",(0,r.kt)("inlineCode",{parentName:"li"},"window"),")."),(0,r.kt)("li",{parentName:"ul"},"Create ",(0,r.kt)("inlineCode",{parentName:"li"},"this")," object(refer to ",(0,r.kt)("inlineCode",{parentName:"li"},"window"),")."),(0,r.kt)("li",{parentName:"ul"},"Declare and initialize variable(",(0,r.kt)("inlineCode",{parentName:"li"},"undefined"),")/function, store them into memory.")),(0,r.kt)("h4",{id:"function-execution-context"},"Function Execution Context"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Create arguments object."),(0,r.kt)("li",{parentName:"ul"},"Create ",(0,r.kt)("inlineCode",{parentName:"li"},"this")," object."),(0,r.kt)("li",{parentName:"ul"},"Declare and initialize variable(",(0,r.kt)("inlineCode",{parentName:"li"},"undefined"),")/function, store them into memory.")),(0,r.kt)("p",null,"\u5982\u679c JavaScript \u5f15\u64ce\u5728\u51fd\u6570\u6267\u884c\u4e0a\u4e0b\u6587\u4e2d\u627e\u4e0d\u5230\u53d8\u91cf,\n\u5b83\u4f1a\u5728\u6700\u8fd1\u7684\u7236\u7ea7\u6267\u884c\u4e0a\u4e0b\u6587\u4e2d\u67e5\u627e\u8be5\u53d8\u91cf.\n\u8fd9\u4e2a\u67e5\u627e\u94fe\u5c06\u4f1a\u4e00\u76f4\u6301\u7eed, \u76f4\u5230\u5f15\u64ce\u67e5\u627e\u5230\u5168\u5c40\u6267\u884c\u4e0a\u4e0b\u6587.\n\u8fd9\u79cd\u60c5\u51b5\u4e0b, \u5982\u679c\u5168\u5c40\u6267\u884c\u4e0a\u4e0b\u6587\u4e5f\u6ca1\u6709\u8be5\u53d8\u91cf, \u90a3\u4e48\u5c06\u4f1a\u629b\u51fa\u5f15\u7528\u9519\u8bef (Reference Error).\n\u5b50\u51fd\u6570",(0,r.kt)("strong",{parentName:"p"},"\u5305\u542b"),"\u5b83\u7236\u7ea7\u51fd\u6570\u7684\u53d8\u91cf\u73af\u5883, \u628a\u8fd9\u4e2a\u6982\u5ff5\u79f0\u4e3a",(0,r.kt)("strong",{parentName:"p"},"\u95ed\u5305(Closure)"),",\n\u5373\u4f7f\u7236\u7ea7\u51fd\u6570\u6267\u884c\u73af\u5883\u5df2\u7ecf\u4ece\u6267\u884c\u6808\u5f39\u51fa\u4e86, \u5b50\u51fd\u6570\u8fd8\u662f\u53ef\u4ee5\u8bbf\u95ee\u7236\u7ea7\u51fd\u6570\u53d8\u91cf x (\u901a\u8fc7\u4f5c\u7528\u57df\u94fe)."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Scope Chain",src:t(9103).Z,width:"1383",height:"865"})),(0,r.kt)("h3",{id:"event-loop"},"Event Loop"),(0,r.kt)("h4",{id:"browser-event-loop"},"Browser Event Loop"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Event Loop",src:t(3006).Z,width:"392",height:"740"})),(0,r.kt)("p",null,"The job of the ",(0,r.kt)("strong",{parentName:"p"},"event loop")," is to look into the call stack\nand determine if the call stack is empty or not.\nIf the ",(0,r.kt)("strong",{parentName:"p"},"call stack")," is empty,\nit looks into the ",(0,r.kt)("strong",{parentName:"p"},"ES6 job queue")," and ",(0,r.kt)("strong",{parentName:"p"},"message queue")," to see\nif there\u2019s any pending call back waiting to be executed:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"ES6 job queue: used by ",(0,r.kt)("inlineCode",{parentName:"li"},"Promises")," (higher priority)"),(0,r.kt)("li",{parentName:"ul"},"Message queue: used by ",(0,r.kt)("inlineCode",{parentName:"li"},"setTimeout"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"DOM events")),(0,r.kt)("li",{parentName:"ul"},"\u5fae\u4efb\u52a1 MicroTask (Jobs), \u6709\u7279\u6743, \u53ef\u4ee5\u63d2\u961f:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"process.nextTick"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Promises.then")," (",(0,r.kt)("strong",{parentName:"li"},"Promise \u6784\u9020\u51fd\u6570\u662f\u540c\u6b65\u51fd\u6570"),")."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Object.observer"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"MutationObserver"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"catch finally"),"."))),(0,r.kt)("li",{parentName:"ul"},"\u5b8f\u4efb\u52a1 MacroTask (Tasks), \u6ca1\u6709\u7279\u6743:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"scripts"),": \u6574\u4f53\u811a\u672c\u89c6\u4f5c\u4e00\u4e2a\u5b8f\u4efb\u52a1."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"MessageChannel"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"postMessage"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"setImmediate"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"I/O"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"setTimeout"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"setInterval"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"XHR")," callback function."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"requestAnimationFrame"),"."),(0,r.kt)("li",{parentName:"ul"},"UI interaction ",(0,r.kt)("inlineCode",{parentName:"li"},"events")," callback function."),(0,r.kt)("li",{parentName:"ul"},"UI rendering."))),(0,r.kt)("li",{parentName:"ul"},"MicroTask \u4f18\u5148\u4e8e MacroTask."),(0,r.kt)("li",{parentName:"ul"},"\u6d4f\u89c8\u5668\u4e3a\u4e86\u80fd\u591f\u4f7f\u5f97 JS \u5185\u90e8 (macro)task \u4e0e DOM \u4efb\u52a1\u80fd\u591f\u6709\u5e8f\u7684\u6267\u884c,\n\u4f1a\u5728\u4e00\u4e2a (macro)task \u6267\u884c\u7ed3\u675f\u540e, \u5728\u4e0b\u4e00\u4e2a (macro)task \u6267\u884c\u5f00\u59cb\u524d, \u5bf9\u9875\u9762\u8fdb\u884c\u91cd\u65b0\u6e32\u67d3.\n\u5f53 JS \u5f15\u64ce\u4ece\u4efb\u52a1\u961f\u5217\u4e2d\u53d6\u51fa\u4e00\u4e2a\u5b8f\u4efb\u52a1\u6765\u6267\u884c, \u5982\u679c\u6267\u884c\u8fc7\u7a0b\u4e2d\u6709\u9047\u5230\u5fae\u4efb\u52a1,\n\u90a3\u4e48\u6267\u884c\u5b8c\u8be5\u5b8f\u4efb\u52a1\u5c31\u4f1a\u53bb\u6267\u884c\u5b8f\u4efb\u52a1\u5185\u7684\u6240\u6709\u5fae\u4efb\u52a1, \u7136\u540e\u66f4\u65b0 UI.\n\u540e\u9762\u5c31\u662f\u518d\u4ece\u4efb\u52a1\u961f\u5217\u4e2d\u53d6\u51fa\u4e0b\u4e00\u4e2a\u5b8f\u4efb\u52a1\u6765\u7ee7\u7eed\u6267\u884c, \u4ee5\u6b64\u7c7b\u63a8."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Event Loop")," \u4e0e ",(0,r.kt)("inlineCode",{parentName:"li"},"Call Stack")," \u6709\u4e14\u4ec5\u6709\u4e00\u4e2a, ",(0,r.kt)("inlineCode",{parentName:"li"},"Task/Job/Message Queue")," \u53ef\u4ee5\u6709\u591a\u4e2a.")),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Event Loop")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"\u5b8f\u4efb\u52a1\u961f\u5217\u53d6\u5b8f\u4efb\u52a1 -> \u6267\u884c 1 \u4e2a\u5b8f\u4efb\u52a1 -> \u68c0\u67e5\u5fae\u4efb\u52a1\u961f\u5217\u5e76\u6267\u884c\u6240\u6709\u5fae\u4efb\u52a1\n-> requestAnimationFrame -> \u6d4f\u89c8\u5668\u91cd\u6392/\u91cd\u7ed8 -> requestIdleCallback\n-> \u5b8f\u4efb\u52a1\u961f\u5217\u53d6\u5b8f\u4efb\u52a1"))),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Event Loop")," simple model:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"for (macroTask of macroTaskQueue) {\n  // 1. Handle current MacroTask.\n  handleMacroTask(macroTask);\n\n  // 2. Handle all MicroTasks.\n  for (microTask of microTaskQueue) {\n    handleMicroTask(microTask);\n  }\n}\n")),(0,r.kt)("p",null,"Using ",(0,r.kt)("inlineCode",{parentName:"p"},"setTimeout")," with ",(0,r.kt)("inlineCode",{parentName:"p"},"0")," seconds timer\nhelps to defer execution of ",(0,r.kt)("inlineCode",{parentName:"p"},"Promise")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"bar")," until the ",(0,r.kt)("strong",{parentName:"p"},"stack")," is ",(0,r.kt)("strong",{parentName:"p"},"empty"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const bar = () => {\n  console.log('bar');\n};\n\nconst baz = () => {\n  console.log('baz');\n};\n\nconst foo = () => {\n  console.log('foo');\n  setTimeout(bar, 0);\n  new Promise((resolve, reject) => {\n    resolve('Promise resolved');\n  })\n    .then(res => console.log(res))\n    .catch(err => console.log(err));\n  baz();\n};\n\nfoo();\n\n// foo\n// baz\n// Promised resolved\n// bar\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"process.nextTick()")," run before ",(0,r.kt)("inlineCode",{parentName:"p"},"Promise.then()"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"console.log('1');\n\nsetTimeout(() => {\n  console.log(2);\n  Promise.resolve().then(() => {\n    console.log(3);\n    process.nextTick(function foo() {\n      console.log(4);\n    });\n  });\n});\n\nPromise.resolve().then(() => {\n  console.log(5);\n  setTimeout(() => {\n    console.log(6);\n  });\n  Promise.resolve().then(() => {\n    console.log(7);\n  });\n});\n\nprocess.nextTick(function foo() {\n  console.log(8);\n  process.nextTick(function foo() {\n    console.log(9);\n  });\n});\n\nconsole.log('10');\n// 1 10 8 9 5 7 2 3 4 6\n")),(0,r.kt)("p",null,"Promise \u6784\u9020\u51fd\u6570\u672c\u8eab\u662f\u540c\u6b65\u51fd\u6570:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"console.log('script start');\n\nconst promise1 = new Promise(function (resolve) {\n  console.log('promise1');\n  resolve();\n  console.log('promise1 end');\n}).then(function () {\n  console.log('promise2');\n});\n\nsetTimeout(function () {\n  console.log('setTimeout');\n});\n\nconsole.log('script end');\n\n// \u8f93\u51fa\u987a\u5e8f:\n// script start\n// promise1\n// promise1 end\n// script end\n// promise2\n// setTimeout.\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"await a(); b()")," \u7b49\u4ef7\u4e8e ",(0,r.kt)("inlineCode",{parentName:"p"},"Promise(a()).then(b())"),": a \u662f\u540c\u6b65\u6267\u884c, b \u662f MicroTask:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"async function async1() {\n  console.log('async1 start');\n  await async2();\n  console.log('async1 end');\n}\n\nasync function async2() {\n  console.log('async2');\n}\n\nconsole.log('script start');\n\nsetTimeout(function () {\n  console.log('setTimeout');\n}, 0);\n\nasync1();\n\nnew Promise(function (resolve) {\n  console.log('promise1');\n  resolve();\n}).then(function () {\n  console.log('promise2');\n});\n\nconsole.log('script end');\n\n// script start\n// async1 start\n// async2\n// promise1\n// script end\n// async1 end\n// promise2\n// setTimeout\n")),(0,r.kt)("p",null,"\u5f53\u8c03\u7528\u6808\u6ca1\u6709\u540c\u6b65\u51fd\u6570\u65f6, \u6e05\u7a7a MicroTask \u4efb\u52a1\u961f\u5217\u91cc\u7684\u51fd\u6570,\n\u518d\u4ece MacroTask \u4efb\u52a1\u961f\u5217\u91cc\u53d6\u51fa\u4e00\u4e2a\u51fd\u6570\u6267\u884c (\u7b2c\u4e8c\u6b21 Event Loop):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"function test() {\n  console.log('start');\n\n  setTimeout(() => {\n    console.log('children2');\n    Promise.resolve().then(() => {\n      console.log('children2-1');\n    });\n  }, 0);\n\n  setTimeout(() => {\n    console.log('children3');\n    Promise.resolve().then(() => {\n      console.log('children3-1');\n    });\n  }, 0);\n\n  Promise.resolve().then(() => {\n    console.log('children1');\n  });\n\n  console.log('end');\n}\n\ntest();\n\n// start\n// end\n// children1\n// children2\n// children2-1\n// children3\n// children3-1\n")),(0,r.kt)("h4",{id:"node-event-loop"},"Node Event Loop"),(0,r.kt)("p",null,"Node.js can run I/O operations in a non-blocking way,\nmeaning other code (and even other I/O operations) can be executed\nwhile an I/O operation is in progress."),(0,r.kt)("p",null,"Instead of having to \u2018wait\u2019 for an I/O operation to complete\n(and essentially waste CPU cycles sitting idle),\nNode.js can use the time to execute other tasks."),(0,r.kt)("p",null,"When the I/O operation completes,\n",(0,r.kt)("strong",{parentName:"p"},"event loop")," give back control to the piece of code\nthat is waiting for the result of that I/O operation."),(0,r.kt)("p",null,"The Node.js execution model was designed to cater to the needs of most web servers,\nwhich tend to be ",(0,r.kt)("strong",{parentName:"p"},"I/O-intensive")," (due to non-blocking I/O)."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"console.log('glob1');\n\nsetTimeout(function () {\n  console.log('timeout1');\n  process.nextTick(function () {\n    console.log('timeout1_nextTick');\n  });\n  new Promise(function (resolve) {\n    console.log('timeout1_promise');\n    resolve();\n  }).then(function () {\n    console.log('timeout1_then');\n  });\n});\n\nsetImmediate(function () {\n  console.log('immediate1');\n  process.nextTick(function () {\n    console.log('immediate1_nextTick');\n  });\n  new Promise(function (resolve) {\n    console.log('immediate1_promise');\n    resolve();\n  }).then(function () {\n    console.log('immediate1_then');\n  });\n});\n\nprocess.nextTick(function () {\n  console.log('glob1_nextTick');\n});\nnew Promise(function (resolve) {\n  console.log('glob1_promise');\n  resolve();\n}).then(function () {\n  console.log('glob1_then');\n});\n\nsetTimeout(function () {\n  console.log('timeout2');\n  process.nextTick(function () {\n    console.log('timeout2_nextTick');\n  });\n  new Promise(function (resolve) {\n    console.log('timeout2_promise');\n    resolve();\n  }).then(function () {\n    console.log('timeout2_then');\n  });\n});\n\nprocess.nextTick(function () {\n  console.log('glob2_nextTick');\n});\nnew Promise(function (resolve) {\n  console.log('glob2_promise');\n  resolve();\n}).then(function () {\n  console.log('glob2_then');\n});\n\nsetImmediate(function () {\n  console.log('immediate2');\n  process.nextTick(function () {\n    console.log('immediate2_nextTick');\n  });\n  new Promise(function (resolve) {\n    console.log('immediate2_promise');\n    resolve();\n  }).then(function () {\n    console.log('immediate2_then');\n  });\n});\n\nconsole.log('glob2');\n\n// glob1\n// glob1_promise\n// glob2_promise\n// glob2\n// glob1_nextTick\n// glob2_nextTick\n// glob1_then\n// glob2_then\n// timeout1\n// timeout1_promise\n// timeout1_nextTick\n// timeout1_then\n// timeout2\n// timeout2_promise\n// timeout2_nextTick\n// timeout2_then\n// immediate1\n// immediate1_promise\n// immediate1_nextTick\n// immediate1_then\n// immediate2\n// immediate2_promise\n// immediate2_nextTick\n// immediate2_then\n")),(0,r.kt)("h2",{id:"v8-good-parts"},"V8 Good Parts"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"source code (parser) AST (interpreter) bytecode"),(0,r.kt)("li",{parentName:"ul"},"send profiling data from bytecode to optimizing compiler, generate optimized code"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Ignition")," interpreter"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"TurboFan")," optimizing compiler (2 for SpiderMonkey/Edge, 3 for Safari)"),(0,r.kt)("li",{parentName:"ul"},"JavaScript implementation ",(0,r.kt)("a",{parentName:"li",href:"https://notes.eatonphil.com/javascript-implementations.html"},"list"),".")),(0,r.kt)("h3",{id:"v8-object-shape"},"V8 Object Shape"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://mathiasbynens.be/notes/shapes-ics"},"Shapes ICS"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// o1 and o2 have the same shape\n// JSObject(1, 2) => Shape('x', 'y')\n// JSObject(3, 4) => Shape('x', 'y')\n// 'x' => 0 Offset, Writable, Enumerable, Configurable\n// 'y' => 1 Offset, Writable, Enumerable, Configurable\nconst o1 = { x: 1, y: 2 };\nconst o2 = { x: 3, y: 4 };\n")),(0,r.kt)("p",null,"Shape Transform"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// Shape chain: Shape(empty) => Shape(x) => Shape(x, y)\nconst o = {};\no.x = 1;\no.y = 2;\n\n// Shape chain: Shape(empty) => Shape(y) => Shape(y, x)\nconst o = {};\no.y = 2;\no.x = 1;\n\n// Shape chain: Shape(x)\nconst o = { x: 1 };\n")),(0,r.kt)("p",null,"array shape: Shape('length'), 'length' => 0 Offset, Writable"),(0,r.kt)("h3",{id:"v8-inline-cache"},"V8 Inline Cache"),(0,r.kt)("p",null,"V8 use ICs to memorize information (same shape) where to find properties on objects:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"always initialize objects in the same way (generate the same shape)"),(0,r.kt)("li",{parentName:"ul"},"don't add property to objects dynamically (invalid inline cache)"),(0,r.kt)("li",{parentName:"ul"},"don't mess with property attributes of array elements")),(0,r.kt)("h3",{id:"v8-garbage-collection"},"V8 Garbage Collection"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://mp.weixin.qq.com/s/VbAUPGt3sUVzEQHxWYmlBw"},"Introduction"),"\nto V8 garbage collection.")),(0,r.kt)("p",null,"V8 \u5206\u4ee3\u5783\u573e\u56de\u6536\u7b97\u6cd5, \u5c06\u5806\u5206\u4e3a\u4e24\u4e2a\u7a7a\u95f4:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u65b0\u751f\u4ee3: \u5b58\u653e\u77ed\u5468\u671f\u5bf9\u8c61, \u7a7a\u95f4\u5c0f, \u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"li"},"Scavenge")," \u56de\u6536\u7b97\u6cd5, \u526f\u5783\u573e\u56de\u6536\u5668."),(0,r.kt)("li",{parentName:"ul"},"\u8001\u751f\u4ee3: \u5b58\u653e\u957f\u5468\u671f\u5bf9\u8c61, \u7a7a\u95f4\u5927, \u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"li"},"Mark-Sweep-Compact")," \u56de\u6536\u7b97\u6cd5, \u4e3b\u5783\u573e\u56de\u6536\u5668.")),(0,r.kt)("h4",{id:"v8-scavenge-gc-algorithm"},"V8 Scavenge GC Algorithm"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u7a7a\u95f4\u6362\u65f6\u95f4\u7b97\u6cd5 (\u590d\u5236\u7b97\u6cd5)."),(0,r.kt)("li",{parentName:"ul"},"\u6807\u8bb0\u6d3b\u52a8\u5bf9\u8c61\u548c\u975e\u6d3b\u52a8\u5bf9\u8c61."),(0,r.kt)("li",{parentName:"ul"},"\u590d\u5236 from-space \u4e2d\u7684\u6d3b\u52a8\u5bf9\u8c61\u5230 to-space \u4e2d\u5e76\u8fdb\u884c\u6392\u5e8f."),(0,r.kt)("li",{parentName:"ul"},"\u6e05\u9664 from-space \u4e2d\u7684\u6240\u6709\u5bf9\u8c61."),(0,r.kt)("li",{parentName:"ul"},"\u5c06 from-space \u548c to-space \u8fdb\u884c\u89d2\u8272\u4e92\u6362, \u7b49\u5f85\u4e0b\u4e00\u6b21 GC."),(0,r.kt)("li",{parentName:"ul"},"\u65b0\u751f\u4ee3\u5bf9\u8c61\u664b\u5347 (\u8ba1\u7b97\u5b58\u6d3b\u5468\u671f, \u521d\u59cb\u4e3a nursery \u5b50\u4ee3):\nallocation -> nursery \u5b50\u4ee3 -> intermediate \u5b50\u4ee3 -> \u8001\u751f\u4ee3.")),(0,r.kt)("h4",{id:"v8-mark-sweep-compact-gc-algorithm"},"V8 Mark-Sweep-Compact GC Algorithm"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u8001\u751f\u4ee3\u7a7a\u95f4\u5927, \u65e0\u6cd5\u4f7f\u7528\u7a7a\u95f4\u6362\u65f6\u95f4 (\u590d\u5236) \u7b97\u6cd5."),(0,r.kt)("li",{parentName:"ul"},"\u6807\u8bb0\u9636\u6bb5: \u5bf9\u8001\u751f\u4ee3\u5bf9\u8c61\u8fdb\u884c\u7b2c\u4e00\u6b21\u626b\u63cf, \u5bf9\u6d3b\u52a8\u5bf9\u8c61\u8fdb\u884c\u6807\u8bb0."),(0,r.kt)("li",{parentName:"ul"},"\u6e05\u7406\u9636\u6bb5: \u5bf9\u8001\u751f\u4ee3\u5bf9\u8c61\u8fdb\u884c\u7b2c\u4e8c\u6b21\u626b\u63cf, \u6e05\u9664\u672a\u6807\u8bb0\u7684\u5bf9\u8c61."),(0,r.kt)("li",{parentName:"ul"},"\u538b\u7f29\u9636\u6bb5: \u6bcf\u6b21\u6e05\u7406\u5b8c\u975e\u6d3b\u52a8\u5bf9\u8c61, \u628a\u5269\u4e0b\u6d3b\u52a8\u5bf9\u8c61\u6574\u7406\u5230\u5185\u5b58\u7684\u4e00\u4fa7, \u56de\u6536\u6389\u8fb9\u754c\u4e0a\u7684\u5185\u5b58 (\u4ee5\u5907\u540e\u7eed\u5927\u5bf9\u8c61\u8001\u751f\u4ee3).")),(0,r.kt)("h4",{id:"v8-gc-stop-the-world"},"V8 GC Stop-The-World"),(0,r.kt)("p",null,"\u5783\u573e\u56de\u6536\u4f18\u5148\u4e8e\u4ee3\u7801\u6267\u884c, \u4f1a\u5148\u505c\u6b62\u4ee3\u7801\u7684\u6267\u884c,\n\u7b49\u5230\u5783\u573e\u56de\u6536\u5b8c\u6bd5, \u518d\u6267\u884c JS \u4ee3\u7801, \u6210\u4e3a\u5168\u505c\u987f."),(0,r.kt)("p",null,"Orinoco \u4f18\u5316 (\u4f18\u5316\u5168\u505c\u987f\u73b0\u8c61):"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Incremental marking (time slice): ",(0,r.kt)("inlineCode",{parentName:"li"},"JS + Mark + JS + Mark ..."),"."),(0,r.kt)("li",{parentName:"ul"},"Lazy sweeping."),(0,r.kt)("li",{parentName:"ul"},"Concurrent GC."),(0,r.kt)("li",{parentName:"ul"},"Parallel GC.")),(0,r.kt)("h3",{id:"v8-performance-tools"},"V8 Performance Tools"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/thlorenz/deoptigate"},"Deoptigate")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/thlorenz/turbolizer"},"Turbolizer")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/thlorenz/v8-map-processor"},"v8 map processor"))),(0,r.kt)("h3",{id:"v8-performance-reference"},"V8 Performance Reference"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/thlorenz/v8-perf"},"v8 perf"))),(0,r.kt)("h2",{id:"browser-engine"},"Browser Engine"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Chrome: Blink (based on Webkit) + V8."),(0,r.kt)("li",{parentName:"ul"},"Firefox: Gecko + SpiderMonkey."),(0,r.kt)("li",{parentName:"ul"},"Safari: Webkit + JavaScriptCore (Nitro)."),(0,r.kt)("li",{parentName:"ul"},"Edge: Trident/EdgeHTML + Chakra -> Chromium.")),(0,r.kt)("h3",{id:"browser-process"},"Browser Process"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u6d4f\u89c8\u5668\u8fdb\u7a0b: \u4e3b\u8981\u8d1f\u8d23\u754c\u9762\u663e\u793a/\u7528\u6237\u4ea4\u4e92/\u5b50\u8fdb\u7a0b\u7ba1\u7406, \u540c\u65f6\u63d0\u4f9b\u5b58\u50a8\u7b49\u529f\u80fd."),(0,r.kt)("li",{parentName:"ul"},"GPU \u8fdb\u7a0b: \u5b9e\u73b0 3D CSS, \u7ed8\u5236 UI \u754c\u9762."),(0,r.kt)("li",{parentName:"ul"},"\u7f51\u7edc\u8fdb\u7a0b: \u4e3b\u8981\u8d1f\u8d23\u9875\u9762\u7684\u7f51\u7edc\u8d44\u6e90\u52a0\u8f7d."),(0,r.kt)("li",{parentName:"ul"},"\u6e32\u67d3\u8fdb\u7a0b: \u6838\u5fc3\u4efb\u52a1\u662f\u5c06 HTML/CSS \u548c JavaScript \u8f6c\u6362\u4e3a\u7528\u6237\u53ef\u4ee5\u4e0e\u4e4b\u4ea4\u4e92\u7684\u7f51\u9875,\n\u6392\u7248\u5f15\u64ce Blink \u548c JavaScript \u5f15\u64ce V8 \u90fd\u662f\u8fd0\u884c\u5728\u8be5\u8fdb\u7a0b\u4e2d.\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b, Chrome \u4f1a\u4e3a\u6bcf\u4e2a Tab \u6807\u7b7e\u521b\u5efa\u4e00\u4e2a\u6e32\u67d3\u8fdb\u7a0b.\n\u51fa\u4e8e\u5b89\u5168\u8003\u8651, \u6e32\u67d3\u8fdb\u7a0b\u90fd\u662f\u8fd0\u884c\u5728\u6c99\u7bb1\u6a21\u5f0f\u4e0b."),(0,r.kt)("li",{parentName:"ul"},"\u63d2\u4ef6\u8fdb\u7a0b: \u4e3b\u8981\u662f\u8d1f\u8d23\u63d2\u4ef6\u7684\u8fd0\u884c, \u56e0\u63d2\u4ef6\u6613\u5d29\u6e83, \u6240\u4ee5\u9700\u8981\u901a\u8fc7\u9694\u79bb\u4ee5\u4fdd\u8bc1\u63d2\u4ef6\u8fdb\u7a0b\u5d29\u6e83\u4e0d\u4f1a\u5bf9\u6d4f\u89c8\u5668\u548c\u9875\u9762\u9020\u6210\u5f71\u54cd.")),(0,r.kt)("h3",{id:"render-engine"},"Render Engine"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Download HTML"),(0,r.kt)("li",{parentName:"ul"},"Parser/Script"),(0,r.kt)("li",{parentName:"ul"},"DOM and CSSOM Construction"),(0,r.kt)("li",{parentName:"ul"},"Render Tree = DOM Tree + Styled Tree"),(0,r.kt)("li",{parentName:"ul"},"Layout"),(0,r.kt)("li",{parentName:"ul"},"Paint"),(0,r.kt)("li",{parentName:"ul"},"Composite")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://sia.codes/posts/render-blocking-resources/#critical-render-path-js"},(0,r.kt)("img",{alt:"Critical Render Path",src:t(9686).Z,width:"795",height:"859"}))),(0,r.kt)("p",null,"RenderNG pipeline\n(Main Thread + Compositor Thread + Viz Process):"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Animate."),(0,r.kt)("li",{parentName:"ul"},"Style."),(0,r.kt)("li",{parentName:"ul"},"Layout."),(0,r.kt)("li",{parentName:"ul"},"Pre-paint."),(0,r.kt)("li",{parentName:"ul"},"Scroll."),(0,r.kt)("li",{parentName:"ul"},"Paint."),(0,r.kt)("li",{parentName:"ul"},"Commit."),(0,r.kt)("li",{parentName:"ul"},"Layerize."),(0,r.kt)("li",{parentName:"ul"},"Raster, decode and paint worklet."),(0,r.kt)("li",{parentName:"ul"},"Activate."),(0,r.kt)("li",{parentName:"ul"},"Aggregate."),(0,r.kt)("li",{parentName:"ul"},"Draw.")),(0,r.kt)("h4",{id:"html-parser"},"HTML Parser"),(0,r.kt)("p",null,"DTD is context-sensitive grammar.\nUse State Machine pattern to implement a tokenizer:"),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Tokenizer")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Data -> Tag Open -> Tag Name -> Tag Close -> Data."))),(0,r.kt)("p",null,"tokenizer send tokens to constructor, constructing DOM tree:"),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"DOM Tree Constructor")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"initial -> before HTML -> before head -> in head -> after head\n-> in body -> after body -> after after body -> EOF token."))),(0,r.kt)("p",null,"HTML parser performance:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"<= 1500")," DOM nodes."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"<= 60")," children nodes."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"<= 32")," levels.")),(0,r.kt)("h4",{id:"css-parser"},"CSS Parser"),(0,r.kt)("p",null,"CSS is context-free grammar.\nWebkit use flex/bison (bottom-to-up), Gecko use up-to-bottom."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"ruleSet\n  : selector [ ',' S* selector ]*\n    '{' S* declaration [ ';' S* declaration ]* '}' S*\n  ;\nselector\n  : simple_selector [ combinator selector | S+ [ combinator? selector ]? ]?\n  ;\nsimple_selector\n  : element_name [ HASH | class | attrib | pseudo ]*\n  | [ HASH | class | attrib | pseudo ]+\n  ;\nclass\n  : '.' IDENT\n  ;\nelement_name\n  : IDENT | '*'\n  ;\nattrib\n  : '[' S* IDENT S* [ [ '=' | INCLUDES | DASHMATCH ] S*\n    [ IDENT | STRING ] S* ] ']'\n  ;\npseudo\n  : ':' [ IDENT | FUNCTION S* [IDENT S*] ')' ]\n  ;\n")),(0,r.kt)("h4",{id:"render-blocking-resources-type"},"Render Blocking Resources Type"),(0,r.kt)("p",null,"Render blocking resources are files that 'press pause'\non the critical rendering path.\nThey interrupt one or more of the steps:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"HTML is technically render blocking resources\n(but not usually the cause of rendering performance problem)"),(0,r.kt)("li",{parentName:"ul"},"CSS is render blocking:\nrender tree can't continue until both the CSSOM and DOM are created."),(0,r.kt)("li",{parentName:"ul"},"JavaScript can be render blocking:\nwhen browser encounters a script meant to run synchronously,\nit will stop DOM creation until script finished."),(0,r.kt)("li",{parentName:"ul"},"If CSS appears before a script,\nthe script will not be executed until the CSSOM is created:\nCSSOM -> CSS block JS -> JS block HTML parser."),(0,r.kt)("li",{parentName:"ul"},"Images and fonts are not render blocking.")),(0,r.kt)("h4",{id:"render-blocking-resources-performance"},"Render Blocking Resources Performance"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Reduce CSS and JavaScript bytes."),(0,r.kt)("li",{parentName:"ul"},"Lazy loading non-critical CSS and JavaScript."),(0,r.kt)("li",{parentName:"ul"},"Use the ",(0,r.kt)("inlineCode",{parentName:"li"},"defer"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"async"),", or ",(0,r.kt)("inlineCode",{parentName:"li"},"module")," attribute on scripts.")),(0,r.kt)("h4",{id:"layout"},"Layout"),(0,r.kt)("p",null,"\u4e3a\u907f\u514d\u5bf9\u6240\u6709\u7ec6\u5c0f\u66f4\u6539\u90fd\u8fdb\u884c\u6574\u4f53\u5e03\u5c40, \u6d4f\u89c8\u5668\u91c7\u7528\u4e86\u4e00\u79cd ",(0,r.kt)("inlineCode",{parentName:"p"},"dirty bit")," \u7cfb\u7edf.\n\u5982\u679c\u67d0\u4e2a\u5448\u73b0\u5668\u53d1\u751f\u4e86\u66f4\u6539, \u6216\u8005\u5c06\u81ea\u8eab\u53ca\u5176\u5b50\u4ee3\u6807\u6ce8\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"dirty"),", \u5219\u9700\u8981\u8fdb\u884c\u5e03\u5c40:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u7236\u5448\u73b0\u5668\u786e\u5b9a\u81ea\u5df1\u7684\u5bbd\u5ea6."),(0,r.kt)("li",{parentName:"ul"},"\u7236\u5448\u73b0\u5668\u4f9d\u6b21\u5904\u7406\u5b50\u5448\u73b0\u5668, \u5e76\u4e14:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u653e\u7f6e\u5b50\u5448\u73b0\u5668 (\u8bbe\u7f6e ",(0,r.kt)("inlineCode",{parentName:"li"},"(x, y)")," \u5750\u6807)."),(0,r.kt)("li",{parentName:"ul"},"\u5982\u679c\u6709\u5fc5\u8981, \u8c03\u7528\u5b50\u5448\u73b0\u5668\u7684\u5e03\u5c40 (\u5982\u679c\u5b50\u5448\u73b0\u5668\u662f dirty \u7684, \u6216\u8005\u8fd9\u662f\u5168\u5c40\u5e03\u5c40, \u6216\u51fa\u4e8e\u5176\u4ed6\u67d0\u4e9b\u539f\u56e0),\n\u8fd9\u4f1a\u8ba1\u7b97\u5b50\u5448\u73b0\u5668\u7684\u9ad8\u5ea6."))),(0,r.kt)("li",{parentName:"ul"},"\u7236\u5448\u73b0\u5668\u6839\u636e\u5b50\u5448\u73b0\u5668\u7684\u7d2f\u52a0\u9ad8\u5ea6\u4ee5\u53ca\u8fb9\u8ddd\u548c\u8865\u767d\u7684\u9ad8\u5ea6\u6765\u8bbe\u7f6e\u81ea\u8eab\u9ad8\u5ea6, \u6b64\u503c\u4e5f\u53ef\u4f9b\u7236\u5448\u73b0\u5668\u7684\u7236\u5448\u73b0\u5668\u4f7f\u7528."),(0,r.kt)("li",{parentName:"ul"},"\u5c06\u5176 ",(0,r.kt)("inlineCode",{parentName:"li"},"dirty \u4f4d")," \u8bbe\u7f6e\u4e3a ",(0,r.kt)("inlineCode",{parentName:"li"},"false"),".")),(0,r.kt)("h4",{id:"paint"},"Paint"),(0,r.kt)("p",null,"Paint order:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u80cc\u666f\u989c\u8272"),(0,r.kt)("li",{parentName:"ul"},"\u80cc\u666f\u56fe\u7247"),(0,r.kt)("li",{parentName:"ul"},"\u8fb9\u6846"),(0,r.kt)("li",{parentName:"ul"},"\u5b50\u4ee3"),(0,r.kt)("li",{parentName:"ul"},"\u8f6e\u5ed3")),(0,r.kt)("p",null,"\u6e32\u67d3\u8fdb\u7a0b (",(0,r.kt)("inlineCode",{parentName:"p"},"Render Process"),") \u4e2d\u4e3b\u7ebf\u7a0b (",(0,r.kt)("inlineCode",{parentName:"p"},"Main Thread"),") ",(0,r.kt)("inlineCode",{parentName:"p"},"Layout")," \u9636\u6bb5\u4e0e ",(0,r.kt)("inlineCode",{parentName:"p"},"Paint")," \u9636\u6bb5\u4e0d\u8d1f\u8d23\u5b9e\u9645\u7684\u7ed8\u5236\u64cd\u4f5c,\n",(0,r.kt)("inlineCode",{parentName:"p"},"Layout")," \u9636\u6bb5\u6267\u884c ",(0,r.kt)("inlineCode",{parentName:"p"},"Update Layer Tree"),", \u66f4\u65b0\u6bcf\u5c42\u4fe1\u606f,\n",(0,r.kt)("inlineCode",{parentName:"p"},"Paint")," \u9636\u6bb5\u6574\u7406\u6bcf\u5c42\u9875\u9762\u7684\u7ed8\u5236\u4fe1\u606f, \u6784\u5efa\u7ed8\u5236\u5217\u8868,\n\u4ee5\u4e0a\u9636\u6bb5\u7684\u6570\u636e\u6700\u7ec8\u4f1a\u4ea4\u7ed9\u6e32\u67d3\u8fdb\u7a0b (",(0,r.kt)("inlineCode",{parentName:"p"},"Render Process"),") \u4e2d\u5408\u6210\u7ebf\u7a0b (",(0,r.kt)("inlineCode",{parentName:"p"},"Compositor Thread"),") \u6267\u884c\u5b9e\u9645\u7684\u7ed8\u5236\u64cd\u4f5c."),(0,r.kt)("p",null,"JavaScript \u963b\u585e\u6e32\u67d3:\nJavaScript \u963b\u585e\u4e86\u540c\u5728\u4e3b\u7ebf\u7a0b\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"Layout")," \u9636\u6bb5\u4e0e ",(0,r.kt)("inlineCode",{parentName:"p"},"Paint")," \u9636\u6bb5,\n\u95f4\u63a5\u963b\u585e\u4e86\u5408\u6210\u7ebf\u7a0b\u7684\u7ed8\u5236\u64cd\u4f5c."),(0,r.kt)("h3",{id:"browser-engine-reference"},"Browser Engine Reference"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Chromium rendering engine: ",(0,r.kt)("a",{parentName:"li",href:"https://developer.chrome.com/blog/renderingng"},"RenderingNG"),"."),(0,r.kt)("li",{parentName:"ul"},"Chromium RenderingNG ",(0,r.kt)("a",{parentName:"li",href:"https://developer.chrome.com/blog/renderingng-architecture"},"architecture"),"."),(0,r.kt)("li",{parentName:"ul"},"Chromium RenderingNG ",(0,r.kt)("a",{parentName:"li",href:"https://developer.chrome.com/blog/renderingng-data-structures"},"key data structures"),"."),(0,r.kt)("li",{parentName:"ul"},"Chromium ",(0,r.kt)("a",{parentName:"li",href:"https://developer.chrome.com/blog/videong"},"video rendering architecture"),".")),(0,r.kt)("h2",{id:"effective-javascript"},"Effective JavaScript"),(0,r.kt)("h3",{id:"memory-leak"},"Memory Leak"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Useless global vars (bind to window or document)."),(0,r.kt)("li",{parentName:"ul"},"Useless DOM reference."),(0,r.kt)("li",{parentName:"ul"},"Incorrect closure.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Unnecessary closure creation:\n\u95ed\u5305\u4f1a\u4fdd\u7559\u5b83\u4eec\u5305\u542b\u51fd\u6570\u7684\u4f5c\u7528\u57df, \u6240\u4ee5\u6bd4\u5176\u4ed6\u51fd\u6570\u66f4\u5360\u7528\u5185\u5b58."),(0,r.kt)("li",{parentName:"ul"},"Useless callback functions."),(0,r.kt)("li",{parentName:"ul"},"Forgotten timer from ",(0,r.kt)("inlineCode",{parentName:"li"},"setTimeout"),"/",(0,r.kt)("inlineCode",{parentName:"li"},"setInterval"),":\nclear with ",(0,r.kt)("inlineCode",{parentName:"li"},"clearTimeout"),"/",(0,r.kt)("inlineCode",{parentName:"li"},"clearInterval"),"."))),(0,r.kt)("li",{parentName:"ul"},"Forgotten tick timer."),(0,r.kt)("li",{parentName:"ul"},"Forgotten event listener:\nclear with ",(0,r.kt)("inlineCode",{parentName:"li"},"removeEventListener"),"."),(0,r.kt)("li",{parentName:"ul"},"Forgotten subscriber:\nclear with ",(0,r.kt)("inlineCode",{parentName:"li"},"unsubscribe(id)"),"."),(0,r.kt)("li",{parentName:"ul"},"Forgotten console log:\nclear with ",(0,r.kt)("inlineCode",{parentName:"li"},"babel"),"/",(0,r.kt)("inlineCode",{parentName:"li"},"tsc"),"."),(0,r.kt)("li",{parentName:"ul"},"Forgotten ",(0,r.kt)("inlineCode",{parentName:"li"},"Set"),"/",(0,r.kt)("inlineCode",{parentName:"li"},"Map"),":\n",(0,r.kt)("inlineCode",{parentName:"li"},"WeakSet"),"/",(0,r.kt)("inlineCode",{parentName:"li"},"WeakMap")," don't bother GC."),(0,r.kt)("li",{parentName:"ul"},"Circular reference."),(0,r.kt)("li",{parentName:"ul"},"Bad Delete Operator:\n",(0,r.kt)("inlineCode",{parentName:"li"},"delete")," \u64cd\u4f5c\u7b26\u5e76\u4e0d\u4f1a\u91ca\u653e\u5185\u5b58,\n\u800c\u4e14\u4f1a\u4f7f\u5f97\u9644\u52a0\u5230\u5bf9\u8c61\u4e0a\u7684 ",(0,r.kt)("inlineCode",{parentName:"li"},"hidden class"),"\n(",(0,r.kt)("inlineCode",{parentName:"li"},"V8")," \u4e3a\u4e86\u4f18\u5316\u5c5e\u6027\u8bbf\u95ee\u65f6\u95f4\u800c\u521b\u5efa\u7684\u9690\u85cf\u7c7b)\u5931\u6548,\n\u8ba9\u5bf9\u8c61\u53d8\u6210 ",(0,r.kt)("inlineCode",{parentName:"li"},"slow object"),".")),(0,r.kt)("h3",{id:"danger-features"},"Danger Features"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"eval()"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"with () {}"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"new Function()"),".")),(0,r.kt)("h3",{id:"function-performance"},"Function Performance"),(0,r.kt)("h4",{id:"local-variables-performance"},"Local Variables Performance"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5c40\u90e8\u53d8\u91cf\u5f15\u7528\u5168\u5c40\u53d8\u91cf/\u5168\u5c40\u53d8\u91cf\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165\u51fd\u6570: \u52a0\u5feb\u7b26\u53f7\u89e3\u6790."),(0,r.kt)("li",{parentName:"ul"},"\u5c40\u90e8\u53d8\u91cf\u7f13\u5b58 DOM \u5143\u7d20."),(0,r.kt)("li",{parentName:"ul"},"\u5c40\u90e8\u53d8\u91cf\u7f13\u5b58\u5e03\u5c40\u4fe1\u606f."),(0,r.kt)("li",{parentName:"ul"},"\u5c40\u90e8\u53d8\u91cf\u5f15\u7528\u5d4c\u5957\u6210\u5458: \u52a0\u5feb\u539f\u578b\u94fe\u67e5\u627e."),(0,r.kt)("li",{parentName:"ul"},"\u5c40\u90e8\u53d8\u91cf\u5f15\u7528\u65b9\u6cd5\u65f6, \u5e94\u6ce8\u610f\u4f1a\u52a8\u6001\u6539\u53d8 this \u6307\u9488.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const DOM = tazimi.util.Dom;\n\nDOM.method.call(/* \u5173\u6ce8 this \u6307\u9488 */);\n")),(0,r.kt)("h4",{id:"scope-chain-performance"},"Scope Chain Performance"),(0,r.kt)("p",null,"\u7531\u4e8e\u4f5c\u7528\u57df\u94fe\u7684\u5173\u7cfb, \u6807\u8bc6\u7b26\u89e3\u6790\u65f6,\n\u5bfb\u627e\u5c40\u90e8\u53d8\u91cf\u901f\u5ea6\u8fdc\u5feb\u4e8e\u5bfb\u627e\u5168\u5c40\u53d8\u91cf\u901f\u5ea6 (\u4f5c\u7528\u57df\u94fe\u8d8a\u957f, \u67e5\u627e\u53d8\u91cf\u6240\u9700\u65f6\u95f4\u8d8a\u957f).\n\u6545\u5e94\u5c06\u5168\u5c40\u53d8\u91cf\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165\u51fd\u6570\u8fdb\u884c\u8c03\u7528, \u4e0d\u4f46\u6548\u7387\u9ad8, \u800c\u4e14\u6613\u4e8e\u7ef4\u62a4\u4e0e\u6d4b\u8bd5.\n\u5373",(0,r.kt)("strong",{parentName:"p"},"\u5229\u7528\u5c40\u90e8\u53d8\u91cf\u5f15\u7528\u5168\u5c40\u53d8\u91cf, \u52a0\u5feb\u6807\u8bc6\u7b26\u89e3\u6790"),"."),(0,r.kt)("h3",{id:"loop-performance"},"Loop Performance"),(0,r.kt)("p",null,"\u5012\u5e8f\u5faa\u73af\u53ef\u63d0\u5347\u6027\u80fd:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"for (let i = item.length; i--; ) {\n  process(items[i]);\n}\n\nlet j = items.length;\nwhile (j--) {\n  process(items[i]);\n}\n\nlet k = items.length;\ndo {\n  process(items[k]);\n} while (k--);\n")),(0,r.kt)("p",null,"Duff's Device:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"let i = items.length % 8;\n\nwhile (i) {\n  process(items[i--]);\n}\n\ni = Math.floor(items.length / 8);\n\nwhile (i) {\n  process(items[i--]);\n  process(items[i--]);\n  process(items[i--]);\n  process(items[i--]);\n  process(items[i--]);\n  process(items[i--]);\n  process(items[i--]);\n  process(items[i--]);\n}\n")),(0,r.kt)("h3",{id:"event-delegation"},"Event Delegation"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u4e8b\u4ef6\u59d4\u6258\u5229\u7528\u7684\u662f\u4e8b\u4ef6\u5192\u6ce1\u673a\u5236, \u53ea\u5236\u5b9a\u4e00\u4e8b\u4ef6\u5904\u7406\u7a0b\u5e8f, \u5c31\u53ef\u4ee5\u7ba1\u7406\u67d0\u4e00\u7c7b\u578b\u7684\u6240\u6709\u4e8b\u4ef6."),(0,r.kt)("li",{parentName:"ul"},"Increases performance and reduces memory consumption:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u4f7f\u7528\u4e8b\u4ef6\u59d4\u6258, \u53ea\u9700\u5728 DOM \u6811\u4e2d\u5c3d\u91cf\u6700\u9ad8\u7684\u5c42\u6b21\u4e0a\u6dfb\u52a0\u4e00\u4e2a\u4e8b\u4ef6\u5904\u7406\u7a0b\u5e8f."),(0,r.kt)("li",{parentName:"ul"},"No need to register new event listeners for newer children."))),(0,r.kt)("li",{parentName:"ul"},"DOM Event:\nEvent Capturing (default false) ->\nEvent Target ->\nEvent Bubbling (default true).")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"window.onload = function () {\n  const oUl = document.getElementById('ul');\n  const aLi = oUl.getElementsByTagName('li');\n\n  oUl.onmouseover = function (e) {\n    const e = e || window.event;\n    const target = e.target || e.srcElement;\n\n    // alert(target.innerHTML);\n\n    if (target.nodeName.toLowerCase() === 'li') {\n      target.style.background = 'red';\n    }\n\n    // \u963b\u6b62\u9ed8\u8ba4\u884c\u4e3a\u5e76\u53d6\u6d88\u5192\u6ce1\n    if (typeof e.preventDefault === 'function') {\n      e.preventDefault();\n      e.stopPropagation();\n    } else {\n      e.returnValue = false;\n      e.cancelBubble = true;\n    }\n  };\n\n  oUl.onmouseout = function (e) {\n    const e = e || window.event;\n    const target = e.target || e.srcElement;\n\n    // alert(target.innerHTML);\n\n    if (target.nodeName.toLowerCase() === 'li') {\n      target.style.background = '';\n    }\n\n    // \u963b\u6b62\u9ed8\u8ba4\u884c\u4e3a\u5e76\u53d6\u6d88\u5192\u6ce1\n    if (typeof e.preventDefault === 'function') {\n      e.preventDefault();\n      e.stopPropagation();\n    } else {\n      e.returnValue = false;\n      e.cancelBubble = true;\n    }\n  };\n};\n")),(0,r.kt)("h3",{id:"cache-pattern"},"Cache Pattern"),(0,r.kt)("p",null,"\u7f13\u5b58\u5bf9\u8c61\u5c5e\u6027\u4e0e DOM \u5bf9\u8c61."),(0,r.kt)("h3",{id:"script-loading-performance"},"Script Loading Performance"),(0,r.kt)("p",null,"\u5408\u5e76\u811a\u672c\u540e\u518d\u8fdb\u884c\u9ad8\u7ea7\u52a0\u8f7d\u6280\u672f."),(0,r.kt)("h4",{id:"script-lazy-loading"},"Script Lazy Loading"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},"<html>\n  <body>\n    ... The full body of the page ...\n    <script>\n      window.onload = function () {\n        const script = document.createElement('script');\n        script.src = 'all_lazy_20100426.js';\n        document.documentElement.firstChild.appendChild(script);\n      };\n    <\/script>\n  </body>\n</html>\n")),(0,r.kt)("h4",{id:"script-dynamic-loading"},"Script Dynamic Loading"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"function requireScript(file, callback) {\n  const script = document.getElementsByTagName('script')[0];\n  const newJS = document.createElement('script');\n\n  // IE\n  newJS.onreadystatechange = function () {\n    if (newJS.readyState === 'loaded' || newJS.readyState === 'complete') {\n      newJS.onreadystatechange = null;\n      callback();\n    }\n  };\n  // others\n  newJS.onload = function () {\n    callback();\n  };\n\n  // \u6dfb\u52a0\u81f3html\u9875\u9762\n  newJS.src = file;\n  script.parentNode.insertBefore(newJS, script);\n}\n\nrequireScript('the_rest.js', function () {\n  Application.init();\n});\n")),(0,r.kt)("h3",{id:"dom-performance"},"DOM Performance"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5c40\u90e8\u53d8\u91cf\u7f13\u5b58 DOM \u5143\u7d20."),(0,r.kt)("li",{parentName:"ul"},"\u5c40\u90e8\u53d8\u91cf\u7f13\u5b58\u5e03\u5c40\u4fe1\u606f.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const btn = document.getElementById('btn');\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"HTML Collection \u8f6c\u5316\u6210\u6570\u7ec4\u518d\u64cd\u4f5c.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"function toArray(coll) {\n  for (let i = 0, a = [], len = coll.length; i < len; i++) {\n    a[i] = coll[i];\n  }\n\n  return a;\n}\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"children")," \u4f18\u4e8e ",(0,r.kt)("inlineCode",{parentName:"li"},"childNodes"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"childElementCount")," \u4f18\u4e8e ",(0,r.kt)("inlineCode",{parentName:"li"},"childNodes.length"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"firstElementChild")," \u4f18\u4e8e ",(0,r.kt)("inlineCode",{parentName:"li"},"firstChild"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"lastElementChild")," \u4f18\u4e8e ",(0,r.kt)("inlineCode",{parentName:"li"},"lastChild"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"nextElementSibling")," \u4f18\u4e8e ",(0,r.kt)("inlineCode",{parentName:"li"},"nextSibling")," \u4f18\u4e8e ",(0,r.kt)("inlineCode",{parentName:"li"},"childNodes[next]"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"previousElementSibling")," \u4f18\u4e8e ",(0,r.kt)("inlineCode",{parentName:"li"},"previousSibling"),".")),(0,r.kt)("h4",{id:"layout-and-paint-performance"},"Layout and Paint Performance"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u91cd\u6392: \u91cd\u65b0\u6784\u9020\u6e32\u67d3\u6811."),(0,r.kt)("li",{parentName:"ul"},"\u91cd\u7ed8: \u91cd\u65b0\u7ed8\u5236\u53d7\u5f71\u54cd\u90e8\u5206.")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u83b7\u53d6"),"\u6216\u6539\u53d8\u5e03\u5c40\u7684\u64cd\u4f5c\u4f1a\u5bfc\u81f4\u6e32\u67d3\u6811",(0,r.kt)("strong",{parentName:"p"},"\u53d8\u5316\u961f\u5217"),"\u5237\u65b0,\n\u6267\u884c\u6e32\u67d3\u961f\u5217\u4e2d\u7684",(0,r.kt)("strong",{parentName:"p"},"\u5f85\u5904\u7406\u53d8\u5316"),",\n\u91cd\u6392 DOM \u5143\u7d20."),(0,r.kt)("h4",{id:"dom-manipulation-performance"},"DOM Manipulation Performance"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5148 ",(0,r.kt)("inlineCode",{parentName:"li"},'display="none"'),", \u4fee\u6539\u5b8c\u6210\u540e, ",(0,r.kt)("inlineCode",{parentName:"li"},'display=""'),"."),(0,r.kt)("li",{parentName:"ul"},"\u4f7f\u5f85\u4fee\u6539 DOM \u5143\u7d20\u8131\u79bb\u6807\u51c6\u6587\u6863\u6d41(\u6539\u53d8\u5e03\u5c40\uff0f\u5b9a\u4f4d\u65b9\u5f0f), \u53ef\u51cf\u5c11\u5176\u4ed6\u5143\u7d20\u7684\u91cd\u7ed8\u6b21\u6570."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"document.createDocumentFragment()"),".")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const fragment = document.createDocumentFragment();\nappendDataToElement(fragment, data);\ndocument.getElementById('myList').appendChild(fragment);\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"oldNode.cloneNode(true);")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const old = document.getElementById('myList');\nconst clone = old.cloneNode(true);\n\nappendDataToElement(clone, data);\nold.parentNode.replaceChild(clone, old);\n")),(0,r.kt)("h4",{id:"animation-frame-performance"},"Animation Frame Performance"),(0,r.kt)("p",null,"run scripts as early as possible:\n",(0,r.kt)("inlineCode",{parentName:"p"},"requestAnimationFrame()")," runs after the CPU work is done (UI events and JS scripts),\nand just before the frame is rendered (layout, paint, composite etc.)."),(0,r.kt)("h3",{id:"css-performance"},"CSS Performance"),(0,r.kt)("p",null,"\u5728 js \u4e2d(\u9664\u5b9a\u4f4d\u5c5e\u6027) \u5916, \u4e0d\u76f4\u63a5\u64cd\u4f5c element.style.attr/element.cssText:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"element.classList.add('className');\nelement.className += ' className';\n")),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Pipeline")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Script -> Style ->Layout -> Paint -> Composite."))),(0,r.kt)("p",null,"Make ",(0,r.kt)("inlineCode",{parentName:"p"},"script")," stage become: read then write.\nInterleaved read and write will trigger multiple times\nof re-layout/repaint/re-composite."),(0,r.kt)("div",{className:"admonition admonition-danger alert alert--danger"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"Forced Synchronous Layout")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"read css -> write css (re-layout/paint/composite)\n-> read css -> write css (re-layout/paint/composite)\n-> read css -> write css (re-layout/paint/composite)."))),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"High Performance")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"read css -> write css (only re-layout/paint/composite once)."))),(0,r.kt)("h3",{id:"timer-performance"},"Timer Performance"),(0,r.kt)("p",null,"JavaScript \u4ee3\u7801\u4e0e UI \u5171\u4eab\u7ebf\u7a0b."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"setTimeout"),"/",(0,r.kt)("inlineCode",{parentName:"p"},"setInterval"),":"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u7b2c\u4e8c\u4e2a\u53c2\u6570: \u4e0d\u662f\u6267\u884c\u65f6\u95f4, \u662f\u52a0\u5165\u6267\u884c\u961f\u5217\u65f6\u95f4."),(0,r.kt)("li",{parentName:"ul"},"\u82e5\u5176\u4ed6\u4f4d\u4e8e\u6267\u884c\u961f\u5217\u4e2d\u7684\u51fd\u6570\u6267\u884c\u65f6\u95f4\u8d85\u8fc7\u5ef6\u65f6, \u5219\u7528\u6237\u611f\u89c9\u4e0d\u5230\u5ef6\u65f6\u7684\u5b58\u5728."),(0,r.kt)("li",{parentName:"ul"},"\u6a21\u62df\u6709\u95f4\u9699\u7684\u5faa\u73af, \u4f7f\u5f97 UI \u66f4\u65b0\u5f97\u4ee5\u8fdb\u5165\u6d4f\u89c8\u5668\u7ebf\u7a0b\u7684\u6267\u884c\u961f\u5217\u4e2d."),(0,r.kt)("li",{parentName:"ul"},"\u901a\u8fc7 MicroTask/MicroTask \u5b9e\u73b0\u65f6\u95f4\u5206\u7247\u8c03\u5ea6\u5668,\n\u4f7f\u5f97\u957f\u4efb\u52a1\u4e0d\u963b\u585e\u9875\u9762\u64cd\u4f5c (60 FPS):\ne.g React Scheduler and Reconciler, Vue ",(0,r.kt)("inlineCode",{parentName:"li"},"nextTick")," API.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const button = document.getElementById('myButton');\n\nbutton.onclick = function () {\n  oneMethod();\n\n  setTimeout(function () {\n    document.getElementById('notice').style.color = 'red';\n  }, 250);\n};\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"/*\n * usage: start -> stop -> getTime\n */\nconst Timer = {\n  _data: {},\n  start(key) {\n    Timer._data[key] = new Date();\n  },\n  stop(key) {\n    const time = Timer._data[key];\n\n    if (time) {\n      Timer._data[key] = new Date() - time;\n    }\n  },\n  getTime(key) {\n    return Timer._data[key];\n  },\n};\n")),(0,r.kt)("h4",{id:"time-slicing-pattern"},"Time Slicing Pattern"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"function saveDocument(id) {\n  // \u5229\u7528\u95ed\u5305\u5c01\u88c5\u5f85\u6267\u884c\u4efb\u52a1\n  const tasks = [openDocument, writeText, closeDocument, updateUI];\n\n  setTimeout(function sliceTask() {\n    // \u6267\u884c\u4e0b\u4e00\u4e2a\u4efb\u52a1\n    const task = tasks.shift();\n    task(id);\n\n    // \u68c0\u67e5\u662f\u5426\u8fd8\u6709\u5176\u4ed6\u4efb\u52a1\n    if (tasks.length > 0) {\n      // \u9012\u5f52\u8c03\u7528(\u6bcf\u6b21\u53c2\u6570\u4e0d\u540c)\n      setTimeout(sliceTask, 25);\n    }\n  }, 25);\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"function processArray(items, process, callback) {\n  // \u514b\u9686\u539f\u6570\u7ec4\n  const todo = items.concat();\n\n  setTimeout(function sliceTask() {\n    process(todo.shift());\n\n    if (todo.length > 0) {\n      setTimeout(sliceTask, 25);\n    } else {\n      callback(items);\n    }\n  }, 25);\n}\n")),(0,r.kt)("h4",{id:"task-batching-pattern"},"Task Batching Pattern"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"function timedProcessArray(items, process, callback) {\n  // \u514b\u9686\u539f\u59cb\u6570\u7ec4\n  const todo = items.concat();\n\n  setTimeout(function sliceTask() {\n    const start = +new Date();\n\n    // \u4e00\u6b21\u6279\u5904\u7406\u4efb\u52a1\u6301\u7eed 0.05s\n    do {\n      process(todo.shift());\n    } while (todo.length < 0 && +new Date() - start < 50);\n\n    if (todo.length > 0) {\n      setTimeout(sliceTask, 25);\n    } else {\n      callback(items);\n    }\n  }, 25);\n}\n")),(0,r.kt)("h3",{id:"reduce-repeat-manipulation"},"Reduce Repeat Manipulation"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u7279\u6027/\u6d4f\u89c8\u5668\u68c0\u6d4b\u4ee3\u7801\u53ea\u8fd0\u884c\u4e00\u6b21."),(0,r.kt)("li",{parentName:"ul"},"\u60f0\u6027\u5b9a\u4e49\u6a21\u5f0f/\u81ea\u5b9a\u4e49\u6a21\u5f0f.")),(0,r.kt)("h4",{id:"debounce-and-throttle"},"Debounce and Throttle"),(0,r.kt)("p",null,"\u9632\u6296\u52a8\u548c\u8282\u6d41\u672c\u8d28\u662f\u4e0d\u4e00\u6837\u7684:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"debounce"),":\n\u9632\u6296\u52a8\u662f\u5c06\u591a\u6b21\u6267\u884c\u53d8\u4e3a\u6700\u540e\u4e00\u6b21\u6267\u884c (\u53ef\u7528\u4e8e\u68c0\u6d4b\u67d0\u4e2a\u8fde\u7eed\u7684 DOM \u64cd\u4f5c\u7ed3\u675f, \u5982 ",(0,r.kt)("inlineCode",{parentName:"li"},"resize"),"/",(0,r.kt)("inlineCode",{parentName:"li"},"scroll")," \u505c\u6b62)."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"throttle"),":\n\u8282\u6d41\u662f\u5c06\u591a\u6b21\u6267\u884c\u53d8\u6210\u6bcf\u9694\u4e00\u6bb5\u65f6\u95f4\u6267\u884c (\u4fdd\u8bc1\u4e00\u5b9a\u65f6\u95f4\u5185\u53ea\u6267\u884c\u4e00\u6b21).")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// Simple debounce:\nfunction debounce(action, delay) {\n  let timer = null;\n\n  return function () {\n    if (timer) clearTimeout(timer);\n    timer = setTimeout(() => {\n      action();\n    }, delay);\n  };\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// Simple throttle:\nfunction throttle(action) {\n  let isRunning = false;\n\n  return function () {\n    if (isRunning) return;\n    isRunning = true;\n    window.requestAnimationFrame(() => {\n      action();\n      isRunning = false;\n    });\n  };\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// \u8fd9\u4e2a\u662f\u7528\u6765\u83b7\u53d6\u5f53\u524d\u65f6\u95f4\u6233\u7684\nfunction now() {\n  return +new Date();\n}\n\n/**\n * \u9632\u6296\u51fd\u6570, \u8fd4\u56de\u51fd\u6570\u8fde\u7eed\u8c03\u7528\u65f6, \u7a7a\u95f2\u65f6\u95f4\u5fc5\u987b\u5927\u4e8e\u6216\u7b49\u4e8e wait, func \u624d\u4f1a\u6267\u884c\n *\n * @param  {function} func        \u56de\u8c03\u51fd\u6570\n * @param  {number}   wait        \u8868\u793a\u65f6\u95f4\u7a97\u53e3\u7684\u95f4\u9694\n * @param  {boolean}  immediate   \u8bbe\u7f6e\u4e3a true \u65f6, \u662f\u5426\u7acb\u5373\u8c03\u7528\u51fd\u6570\n * @return {function}             \u8fd4\u56de\u5ba2\u6237\u8c03\u7528\u51fd\u6570\n */\nfunction debounce(func, wait = 50, immediate = true) {\n  let timer, context, args;\n\n  // \u5ef6\u8fdf\u6267\u884c\u51fd\u6570\n  const later = () =>\n    setTimeout(() => {\n      // \u5ef6\u8fdf\u51fd\u6570\u6267\u884c\u5b8c\u6bd5, \u6e05\u7a7a\u7f13\u5b58\u7684\u5b9a\u65f6\u5668\u5e8f\u53f7\n      timer = null;\n      // \u5ef6\u8fdf\u6267\u884c\u7684\u60c5\u51b5\u4e0b, \u51fd\u6570\u4f1a\u5728\u5ef6\u8fdf\u51fd\u6570\u4e2d\u6267\u884c\n      // \u4f7f\u7528\u5230\u4e4b\u524d\u7f13\u5b58\u7684\u53c2\u6570\u548c\u4e0a\u4e0b\u6587\n      if (!immediate) {\n        func.apply(context, args);\n        context = args = null;\n      }\n    }, wait);\n\n  // \u8fd9\u91cc\u8fd4\u56de\u7684\u51fd\u6570\u662f\u6bcf\u6b21\u5b9e\u9645\u8c03\u7528\u7684\u51fd\u6570\n  return function (...params) {\n    // \u5982\u679c\u6ca1\u6709\u521b\u5efa\u5ef6\u8fdf\u6267\u884c\u51fd\u6570 (later), \u5c31\u521b\u5efa\u4e00\u4e2a\n    if (!timer) {\n      timer = later();\n      // \u5982\u679c\u662f\u7acb\u5373\u6267\u884c, \u8c03\u7528\u51fd\u6570\n      // \u5426\u5219\u7f13\u5b58\u53c2\u6570\u548c\u8c03\u7528\u4e0a\u4e0b\u6587\n      if (immediate) {\n        func.apply(this, params);\n      } else {\n        // eslint-disable-next-line @typescript-eslint/no-this-alias\n        context = this;\n        args = params;\n      }\n    } else {\n      // \u5982\u679c\u5df2\u6709\u5ef6\u8fdf\u6267\u884c\u51fd\u6570 (later), \u8c03\u7528\u7684\u65f6\u5019\u6e05\u9664\u539f\u6765\u7684\u5e76\u91cd\u65b0\u8bbe\u5b9a\u4e00\u4e2a\n      // \u8fd9\u6837\u505a\u5ef6\u8fdf\u51fd\u6570\u4f1a\u91cd\u65b0\u8ba1\u65f6\n      clearTimeout(timer);\n      timer = later();\n    }\n  };\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"/**\n * underscore \u8282\u6d41\u51fd\u6570, \u8fd4\u56de\u51fd\u6570\u8fde\u7eed\u8c03\u7528\u65f6, func \u6267\u884c\u9891\u7387\u9650\u5b9a\u4e3a \u6b21 / wait\n *\n * @param  {function}   func      \u56de\u8c03\u51fd\u6570\n * @param  {number}     wait      \u8868\u793a\u65f6\u95f4\u7a97\u53e3\u7684\u95f4\u9694\n * @param  {object}     options   \u5982\u679c\u60f3\u5ffd\u7565\u5f00\u59cb\u51fd\u6570\u7684\u7684\u8c03\u7528, \u4f20\u5165{leading: false}.\n *                                \u5982\u679c\u60f3\u5ffd\u7565\u7ed3\u5c3e\u51fd\u6570\u7684\u8c03\u7528, \u4f20\u5165{trailing: false}\n *                                \u4e24\u8005\u4e0d\u80fd\u5171\u5b58, \u5426\u5219\u51fd\u6570\u4e0d\u80fd\u6267\u884c\n * @return {function}             \u8fd4\u56de\u5ba2\u6237\u8c03\u7528\u51fd\u6570\n */\n_.throttle = function (func, wait, options) {\n  let context, args, result;\n  let timeout = null;\n  // \u4e4b\u524d\u7684\u65f6\u95f4\u6233\n  let previous = 0;\n  // \u5982\u679c options \u6ca1\u4f20\u5219\u8bbe\u4e3a\u7a7a\u5bf9\u8c61\n  if (!options) options = {};\n\n  // \u5b9a\u65f6\u5668\u56de\u8c03\u51fd\u6570\n  const later = function () {\n    // \u5982\u679c\u8bbe\u7f6e\u4e86 leading, \u5c31\u5c06 previous \u8bbe\u4e3a 0\n    // \u7528\u4e8e\u4e0b\u9762\u51fd\u6570\u7684\u7b2c\u4e00\u4e2a if \u5224\u65ad\n    previous = options.leading === false ? 0 : _.now();\n    // \u7f6e\u7a7a\u4e00\u662f\u4e3a\u4e86\u9632\u6b62\u5185\u5b58\u6cc4\u6f0f, \u4e8c\u662f\u4e3a\u4e86\u4e0b\u9762\u7684\u5b9a\u65f6\u5668\u5224\u65ad\n    timeout = null;\n    result = func.apply(context, args);\n    if (!timeout) context = args = null;\n  };\n\n  return function (...original_args) {\n    // \u83b7\u5f97\u5f53\u524d\u65f6\u95f4\u6233\n    const now = _.now();\n\n    // \u9996\u6b21\u8fdb\u5165\u524d\u8005\u80af\u5b9a\u4e3a true\n    // \u5982\u679c\u9700\u8981\u7b2c\u4e00\u6b21\u4e0d\u6267\u884c\u51fd\u6570\n    // \u5c31\u5c06\u4e0a\u6b21\u65f6\u95f4\u6233\u8bbe\u4e3a\u5f53\u524d\u7684\n    // \u8fd9\u6837\u5728\u63a5\u4e0b\u6765\u8ba1\u7b97 remaining \u7684\u503c\u65f6\u4f1a\u5927\u4e8e0\n    if (!previous && options.leading === false) previous = now;\n\n    // \u8ba1\u7b97\u5269\u4f59\u65f6\u95f4\n    const remaining = wait - (now - previous);\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    context = this;\n    args = original_args;\n\n    // \u5982\u679c\u5f53\u524d\u8c03\u7528\u5df2\u7ecf\u5927\u4e8e\u4e0a\u6b21\u8c03\u7528\u65f6\u95f4 + wait\n    // \u6216\u8005\u7528\u6237\u624b\u52a8\u8c03\u4e86\u65f6\u95f4\n    // \u5982\u679c\u8bbe\u7f6e\u4e86 trailing, \u53ea\u4f1a\u8fdb\u5165\u8fd9\u4e2a\u6761\u4ef6\n    // \u5982\u679c\u6ca1\u6709\u8bbe\u7f6e leading, \u90a3\u4e48\u7b2c\u4e00\u6b21\u4f1a\u8fdb\u5165\u8fd9\u4e2a\u6761\u4ef6\n    // \u8fd8\u6709\u4e00\u70b9, \u4f60\u53ef\u80fd\u4f1a\u89c9\u5f97\u5f00\u542f\u4e86\u5b9a\u65f6\u5668\u90a3\u4e48\u5e94\u8be5\u4e0d\u4f1a\u8fdb\u5165\u8fd9\u4e2a if \u6761\u4ef6\u4e86\n    // \u5176\u5b9e\u8fd8\u662f\u4f1a\u8fdb\u5165\u7684, \u56e0\u4e3a\u5b9a\u65f6\u5668\u7684\u5ef6\u65f6\n    // \u5e76\u4e0d\u662f\u51c6\u786e\u7684\u65f6\u95f4, \u5f88\u53ef\u80fd\u4f60\u8bbe\u7f6e\u4e862\u79d2\n    // \u4f46\u662f\u4ed6\u9700\u89812.2\u79d2\u624d\u89e6\u53d1, \u8fd9\u65f6\u5019\u5c31\u4f1a\u8fdb\u5165\u8fd9\u4e2a\u6761\u4ef6\n    if (remaining <= 0 || remaining > wait) {\n      // \u5982\u679c\u5b58\u5728\u5b9a\u65f6\u5668\u5c31\u6e05\u7406\u6389\u5426\u5219\u4f1a\u8c03\u7528\u4e8c\u6b21\u56de\u8c03\n      if (timeout) {\n        clearTimeout(timeout);\n        timeout = null;\n      }\n\n      previous = now;\n      result = func.apply(context, args);\n      if (!timeout) context = args = null;\n    } else if (!timeout && options.trailing !== false) {\n      // \u5224\u65ad\u662f\u5426\u8bbe\u7f6e\u4e86\u5b9a\u65f6\u5668\u548c trailing\n      // \u6ca1\u6709\u7684\u8bdd\u5c31\u5f00\u542f\u4e00\u4e2a\u5b9a\u65f6\u5668\n      // \u5e76\u4e14\u4e0d\u80fd\u4e0d\u80fd\u540c\u65f6\u8bbe\u7f6e leading \u548c trailing\n      timeout = setTimeout(later, remaining);\n    }\n\n    return result;\n  };\n};\n")),(0,r.kt)("h4",{id:"animation-frame-throttling"},"Animation Frame Throttling"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"function useAnimation() {\n  const frameId = useRef(0);\n  const ticking = useRef(false);\n\n  const handleResize = event => {\n    if (ticking.current) return;\n    ticking.current = true;\n    frameId.current = requestAnimationFrame(() => handleUpdate(event));\n  };\n\n  const handleUpdate = event => {\n    console.log('resize update');\n    ticking.current = false;\n  };\n\n  useMount(() => {\n    window.addEventListener('resize', handleResize);\n    handleUpdate();\n\n    return () => {\n      window.removeEventListener('resize', handleResize);\n      cancelAnimationFrame(frameId.current);\n    };\n  });\n}\n")),(0,r.kt)("h3",{id:"math-performance"},"Math Performance"),(0,r.kt)("h4",{id:"bit-operators"},"Bit Operators"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"i%2")," => ",(0,r.kt)("inlineCode",{parentName:"li"},"i&0x1"),"."),(0,r.kt)("li",{parentName:"ul"},"\u4f4d\u63a9\u7801")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const OPTION_A = 1;\nconst OPTION_B = 2;\nconst OPTION_C = 4;\nconst OPTION_D = 8;\nconst OPTION_E = 16;\n\nconst options = OPTION_A | OPTION_C | OPTION_D;\n")),(0,r.kt)("h2",{id:"browser-performance"},"Browser Performance"),(0,r.kt)("h3",{id:"browser-caches"},"Browser Caches"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/ljianshu/Blog/issues/23"},"Dive into Browser Caches"),":\n\u4ece\u7f13\u5b58\u4f4d\u7f6e\u4e0a\u6765\u8bf4\u5206\u4e3a\u56db\u79cd, \u5e76\u4e14\u5404\u81ea\u6709\u4f18\u5148\u7ea7,\n\u5f53\u4f9d\u6b21\u67e5\u627e\u7f13\u5b58\u4e14\u90fd\u6ca1\u6709\u547d\u4e2d\u7684\u65f6\u5019, \u624d\u4f1a\u53bb\u8bf7\u6c42\u7f51\u7edc:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Service Worker: PWA"),(0,r.kt)("li",{parentName:"ul"},"(In-) Memory Cache: reload Tab page"),(0,r.kt)("li",{parentName:"ul"},"(On-) Disk Cache: big files"),(0,r.kt)("li",{parentName:"ul"},"Push Cache: HTTP/2")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// eslint-disable-next-line no-restricted-globals\nself.addEventListener('install', event => {\n  async function buildCache() {\n    const cache = await caches.open(cacheName);\n    return cache.addAll(['/main.css', '/main.mjs', '/offline.html']);\n  }\n  event.waitUntil(buildCache());\n});\n\n// eslint-disable-next-line no-restricted-globals\nself.addEventListener('fetch', event => {\n  async function cachedFetch(event) {\n    const cache = await caches.open(cacheName);\n    let response = await cache.match(event.request);\n    if (response) return response;\n    response = await fetch(event.request);\n    cache.put(event.request, response.clone());\n    return response;\n  }\n  event.respondWith(cachedFetch(event));\n});\n")),(0,r.kt)("h4",{id:"http-cache"},"HTTP Cache"),(0,r.kt)("p",null,"\u6d4f\u89c8\u5668\u7f13\u5b58, \u4e5f\u79f0 HTTP \u7f13\u5b58,\n\u5206\u4e3a\u5f3a\u7f13\u5b58\u548c\u534f\u5546\u7f13\u5b58.\n\u4f18\u5148\u7ea7\u8f83\u9ad8\u7684\u662f\u5f3a\u7f13\u5b58,\n\u5728\u547d\u4e2d\u5f3a\u7f13\u5b58\u5931\u8d25\u7684\u60c5\u51b5\u4e0b\u6216\u8005",(0,r.kt)("inlineCode",{parentName:"p"},"Cache-Control: no-cache"),"\u65f6,\n\u624d\u4f1a\u8d70\u534f\u5546\u7f13\u5b58."),(0,r.kt)("p",null,"\u5f3a\u7f13\u5b58\u662f\u5229\u7528 HTTP \u5934\u4e2d\u7684 Expires \u548c Cache-Control \u4e24\u4e2a\u5b57\u6bb5\u6765\u63a7\u5236\u7684.\n\u5f3a\u7f13\u5b58\u4e2d, \u5f53\u8bf7\u6c42\u518d\u6b21\u53d1\u51fa\u65f6, \u6d4f\u89c8\u5668\u4f1a\u6839\u636e\u5176\u4e2d\u7684 expires \u548c cache-control \u5224\u65ad\u76ee\u6807\u8d44\u6e90\u662f\u5426 ",(0,r.kt)("inlineCode",{parentName:"p"},"\u547d\u4e2d")," \u5f3a\u7f13\u5b58,\n\u82e5\u547d\u4e2d\u5219\u76f4\u63a5\u4ece\u7f13\u5b58\u4e2d\u83b7\u53d6\u8d44\u6e90, \u4e0d\u4f1a\u518d\u4e0e\u670d\u52a1\u7aef\u53d1\u751f\u901a\u4fe1.\nCache-Control \u76f8\u5bf9\u4e8e expires \u66f4\u52a0\u51c6\u786e, \u5b83\u7684\u4f18\u5148\u7ea7\u4e5f\u66f4\u9ad8.\n\u5f53 Cache-Control \u4e0e expires \u540c\u65f6\u51fa\u73b0\u65f6, \u4ee5 Cache-Control \u4e3a\u51c6."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"expires: Wed, 12 Sep 2019 06:12:18 GMT\ncache-control: max-age=31536000\n")),(0,r.kt)("p",null,"\u534f\u5546\u7f13\u5b58\u673a\u5236\u4e0b,\n\u6d4f\u89c8\u5668\u9700\u8981\u5411\u670d\u52a1\u5668\u53bb\u8be2\u95ee\u7f13\u5b58\u7684\u76f8\u5173\u4fe1\u606f,\n\u8fdb\u800c\u5224\u65ad\u662f\u91cd\u65b0\u53d1\u8d77\u8bf7\u6c42/\u4e0b\u8f7d\u5b8c\u6574\u7684\u54cd\u5e94,\n\u8fd8\u662f\u4ece\u672c\u5730\u83b7\u53d6\u7f13\u5b58\u7684\u8d44\u6e90.\n\u5982\u679c\u670d\u52a1\u7aef\u63d0\u793a\u7f13\u5b58\u8d44\u6e90\u672a\u6539\u52a8 (Not Modified),\n\u8d44\u6e90\u4f1a\u88ab\u91cd\u5b9a\u5411\u5230\u6d4f\u89c8\u5668\u7f13\u5b58,\n\u8fd9\u79cd\u60c5\u51b5\u4e0b\u7f51\u7edc\u8bf7\u6c42\u5bf9\u5e94\u7684\u72b6\u6001\u7801\u662f ",(0,r.kt)("inlineCode",{parentName:"p"},"304"),"."),(0,r.kt)("p",null,"Last-Modified \u662f\u4e00\u4e2a\u65f6\u95f4\u6233,\n\u5982\u679c\u542f\u7528\u4e86\u534f\u5546\u7f13\u5b58,\n\u5b83\u4f1a\u5728\u9996\u6b21\u8bf7\u6c42\u65f6\u968f\u7740 Response Headers \u8fd4\u56de:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"Last-Modified: Fri, 27 Oct 2017 06:35:57 GMT\n")),(0,r.kt)("p",null,"\u968f\u540e\u6bcf\u6b21\u8bf7\u6c42\u65f6, \u4f1a\u5e26\u4e0a\u4e00\u4e2a\u53eb If-Modified-Since \u7684\u65f6\u95f4\u6233\u5b57\u6bb5,\n\u5b83\u7684\u503c\u6b63\u662f\u4e0a\u4e00\u6b21 response \u8fd4\u56de\u7ed9\u5b83\u7684 last-modified \u503c:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"If-Modified-Since: Fri, 27 Oct 2017 06:35:57 GMT\n")),(0,r.kt)("p",null,"\u670d\u52a1\u5668\u53ef\u80fd\u65e0\u6cd5\u6b63\u786e\u611f\u77e5\u6587\u4ef6\u7684\u53d8\u5316 (\u672a\u5b9e\u9645\u6539\u52a8\u6216\u6539\u52a8\u8fc7\u5feb),\n\u4e3a\u4e86\u89e3\u51b3\u8fd9\u6837\u7684\u95ee\u9898, Etag \u4f5c\u4e3a Last-Modified \u7684\u8865\u5145\u51fa\u73b0\u4e86.\nEtag \u662f\u7531\u670d\u52a1\u5668\u4e3a\u6bcf\u4e2a\u8d44\u6e90\u751f\u6210\u7684\u552f\u4e00\u7684\u6807\u8bc6\u5b57\u7b26\u4e32,\n\u8fd9\u4e2a\u6807\u8bc6\u5b57\u7b26\u4e32\u53ef\u4ee5\u662f\u57fa\u4e8e\u6587\u4ef6\u5185\u5bb9\u7f16\u7801\u7684,\n\u56e0\u6b64 Etag \u80fd\u591f\u7cbe\u51c6\u5730\u611f\u77e5\u6587\u4ef6\u7684\u53d8\u5316."),(0,r.kt)("h4",{id:"code-cache"},"Code Cache"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"cold run: ",(0,r.kt)("inlineCode",{parentName:"li"},"download -> compile -> store into on-disk cache")),(0,r.kt)("li",{parentName:"ul"},"warm run: ",(0,r.kt)("inlineCode",{parentName:"li"},"fetch from browser cache -> compile -> store metadata")),(0,r.kt)("li",{parentName:"ul"},"hot run: ",(0,r.kt)("inlineCode",{parentName:"li"},"fetch scripts and metadata from browser cache -> skip compile")),(0,r.kt)("li",{parentName:"ul"},"positive case: IIFE function heuristics"),(0,r.kt)("li",{parentName:"ul"},"passive case: too small (",(0,r.kt)("inlineCode",{parentName:"li"},"< 1KB"),") and inline scripts")),(0,r.kt)("h3",{id:"performance-monitoring"},"Performance Monitoring"),(0,r.kt)("p",null,"\u524d\u7aef\u6027\u80fd\u76d1\u63a7\u5206\u4e3a\u4e24\u79cd\u65b9\u5f0f,\n\u4e00\u79cd\u53eb\u505a\u5408\u6210\u76d1\u63a7 (Synthetic Monitoring, SYN),\n\u53e6\u4e00\u79cd\u662f\u771f\u5b9e\u7528\u6237\u76d1\u63a7 (Real User Monitoring, RUM)."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("a",{parentName:"p",href:"https://developers.google.com/web/tools/chrome-user-experience-report"},"Chrome UX Report"))),(0,r.kt)("h4",{id:"synthetic-monitoring"},"Synthetic Monitoring"),(0,r.kt)("p",null,"\u5728\u4e00\u4e2a\u6a21\u62df\u573a\u666f\u91cc, \u53bb\u63d0\u4ea4\u4e00\u4e2a\u9700\u8981\u505a\u6027\u80fd\u5ba1\u8ba1\u7684\u9875\u9762,\n\u901a\u8fc7\u4e00\u7cfb\u5217\u7684\u5de5\u5177/\u89c4\u5219\u53bb\u8fd0\u884c\u4f60\u7684\u9875\u9762, \u63d0\u53d6\u4e00\u4e9b\u6027\u80fd\u6307\u6807, \u5f97\u51fa\u4e00\u4e2a\u5ba1\u8ba1\u62a5\u544a."),(0,r.kt)("p",null,"\u5e38\u89c1\u7684\u5de5\u5177\u6709 Google \u7684 Lighthouse, WebPageTest, PageSpeed \u7b49"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"\u4f18\u70b9"),(0,r.kt)("th",{parentName:"tr",align:"center"},"\u7f3a\u70b9"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"\u5b9e\u73b0\u7b80\u5355"),(0,r.kt)("td",{parentName:"tr",align:"center"},"\u65e0\u6cd5\u8fd8\u539f\u5168\u90e8\u771f\u5b9e\u573a\u666f")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"\u80fd\u91c7\u96c6\u5230\u4e30\u5bcc\u7684\u6570\u636e, \u5982\u786c\u4ef6\u6307\u6807\u6216\u7011\u5e03\u56fe"),(0,r.kt)("td",{parentName:"tr",align:"center"},"\u767b\u5f55\u7b49\u573a\u666f\u9700\u8981\u989d\u5916\u89e3\u51b3")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"\u4e0d\u5f71\u54cd\u771f\u5b9e\u7528\u6237\u7684\u8bbf\u95ee\u6027\u80fd"),(0,r.kt)("td",{parentName:"tr",align:"center"},"\u5355\u6b21\u6570\u636e\u4e0d\u591f\u7a33\u5b9a")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"\u53ef\u4ee5\u63d0\u4f9b\u9875\u9762\u52a0\u8f7d\u5e7b\u706f\u7247\u7b49\u53ef\u89c6\u5316\u5206\u6790\u9014\u5f84"),(0,r.kt)("td",{parentName:"tr",align:"center"},"\u6570\u636e\u91cf\u8f83\u5c0f, \u65e0\u6cd5\u53d1\u6325\u66f4\u5927\u4ef7\u503c")))),(0,r.kt)("h4",{id:"real-user-monitoring"},"Real User Monitoring"),(0,r.kt)("p",null,"\u7528\u6237\u5728\u9875\u9762\u8bbf\u95ee\u4e4b\u540e\u5c31\u4f1a\u4ea7\u751f\u5404\u79cd\u5404\u6837\u7684\u6027\u80fd\u6307\u6807,\n\u4e4b\u540e\u4f1a\u5c06\u8fd9\u4e9b\u6027\u80fd\u6307\u6807\u4e0a\u4f20\u7684\u6211\u4eec\u7684\u65e5\u5fd7\u670d\u52a1\u5668\u4e0a,\n\u8fdb\u884c\u6570\u636e\u7684\u63d0\u8d77\u6e05\u6d17\u52a0\u5de5,\n\u6700\u540e\u5728\u76d1\u63a7\u5e73\u53f0\u4e0a\u8fdb\u884c\u5c55\u793a\u548c\u5206\u6790\u7684\u4e00\u4e2a\u8fc7\u7a0b."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u771f\u5b9e\u7528\u6237\u76d1\u63a7\u7684\u4f18\u7f3a\u70b9")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"\u4f18\u70b9"),(0,r.kt)("th",{parentName:"tr",align:"left"},"\u7f3a\u70b9"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"\u65e0\u9700\u914d\u7f6e\u6a21\u62df\u6761\u4ef6, \u5b8c\u5168\u8fd8\u539f\u771f\u5b9e\u573a\u666f"),(0,r.kt)("td",{parentName:"tr",align:"left"},"\u5f71\u54cd\u771f\u5b9e\u7528\u6237\u7684\u8bbf\u95ee\u6027\u80fd\u53ca\u6d41\u91cf\u6d88\u8017")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"\u4e0d\u5b58\u5728\u767b\u5f55\u7b49\u9700\u8981\u989d\u5916\u89e3\u51b3\u7684\u573a\u666f"),(0,r.kt)("td",{parentName:"tr",align:"left"},"\u65e0\u6cd5\u91c7\u96c6\u786c\u4ef6\u76f8\u5173\u6307\u6807")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"\u6570\u636e\u6837\u672c\u8db3\u591f\u5e9e\u5927, \u53ef\u4ee5\u51cf\u5c11\u7edf\u8ba1\u8bef\u5dee"),(0,r.kt)("td",{parentName:"tr",align:"left"},"\u65e0\u6cd5\u91c7\u96c6\u5b8c\u6574\u7684\u8d44\u6e90\u52a0\u8f7d\u7011\u5e03\u56fe")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"\u65b0\u5e74\u6570\u636e\u53ef\u4e0e\u5176\u5b83\u6570\u636e\u5173\u8054, \u4ea7\u751f\u66f4\u5927\u4ef7\u503c"),(0,r.kt)("td",{parentName:"tr",align:"left"},"\u65e0\u6cd5\u53ef\u89c6\u5316\u5c55\u793a\u52a0\u8f7d\u8fc7\u7a0b")))),(0,r.kt)("h4",{id:"syn-and-rum"},"SYN and RUM"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"\u5bf9\u6bd4\u9879"),(0,r.kt)("th",{parentName:"tr",align:"left"},"\u5408\u6210\u76d1\u63a7"),(0,r.kt)("th",{parentName:"tr",align:"left"},"\u771f\u5b9e\u7528\u6237\u76d1\u63a7"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"\u5b9e\u73b0\u96be\u5ea6\u53ca\u6210\u672c"),(0,r.kt)("td",{parentName:"tr",align:"left"},"\u8f83\u4f4e"),(0,r.kt)("td",{parentName:"tr",align:"left"},"\u8f83\u9ad8")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"\u91c7\u96c6\u6570\u636e\u4e30\u5bcc\u5ea6"),(0,r.kt)("td",{parentName:"tr",align:"left"},"\u4e30\u5bcc"),(0,r.kt)("td",{parentName:"tr",align:"left"},"\u57fa\u7840")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"\u6570\u636e\u6837\u672c\u91cf"),(0,r.kt)("td",{parentName:"tr",align:"left"},"\u8f83\u5c0f"),(0,r.kt)("td",{parentName:"tr",align:"left"},"\u5927(\u89c6\u4e1a\u52a1\u4f53\u91cf)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"\u9002\u5408\u573a\u666f"),(0,r.kt)("td",{parentName:"tr",align:"left"},"\u5b9a\u6027\u5206\u6790, \u5c0f\u6570\u636e\u91cf\u5206\u6790"),(0,r.kt)("td",{parentName:"tr",align:"left"},"\u5b9a\u91cf\u5206\u6790, \u4e1a\u52a1\u6570\u636e\u6df1\u5ea6\u6316\u6398")))),(0,r.kt)("h4",{id:"monitoring-methods"},"Monitoring Methods"),(0,r.kt)("p",null,"\u5728\u771f\u5b9e\u7528\u6237\u6027\u80fd\u6570\u636e\u91c7\u96c6\u65f6, \u8981\u5173\u6ce8\u56db\u4e2a\u65b9\u9762\u7684\u4e1c\u897f:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u4f7f\u7528\u6807\u51c6\u7684 API"),(0,r.kt)("li",{parentName:"ul"},"\u5b9a\u4e49\u5408\u9002\u7684\u6307\u6807"),(0,r.kt)("li",{parentName:"ul"},"\u91c7\u96c6\u6b63\u786e\u7684\u6570\u636e"),(0,r.kt)("li",{parentName:"ul"},"\u4e0a\u62a5\u5173\u8054\u7684\u7ef4\u5ea6")),(0,r.kt)("h4",{id:"monitoring-standard-api"},"Monitoring Standard API"),(0,r.kt)("p",null,"\u91c7\u96c6\u6027\u80fd\u6570\u636e\u65f6\u5148\u62b9\u5e73 Navigation Timing spec \u5dee\u5f02\n\u4f18\u5148\u4f7f\u7528 PerformanceTimeline API\n(\u5728\u590d\u6742\u573a\u666f, \u4ea6\u53ef\u8003\u8651\u4f18\u5148\u4f7f\u7528 PerformanceObserver):"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u91cd\u5b9a\u5411\u8017\u65f6 = redirectEnd - redirectStart."),(0,r.kt)("li",{parentName:"ul"},"DNS \u67e5\u8be2\u8017\u65f6 = domainLookupEnd - domainLookupStart."),(0,r.kt)("li",{parentName:"ul"},"TCP \u94fe\u63a5\u8017\u65f6 = connectEnd - connectStart."),(0,r.kt)("li",{parentName:"ul"},"HTTP \u8bf7\u6c42\u8017\u65f6 = responseEnd - responseStart."),(0,r.kt)("li",{parentName:"ul"},"\u89e3\u6790 DOM \u6811\u8017\u65f6 = domComplete - domInteractive."),(0,r.kt)("li",{parentName:"ul"},"\u767d\u5c4f\u65f6\u95f4 = responseStart - navigationStart."),(0,r.kt)("li",{parentName:"ul"},"DOMReady \u65f6\u95f4 = domContentLoadedEventEnd - navigationStart."),(0,r.kt)("li",{parentName:"ul"},"onload \u65f6\u95f4 = loadEventEnd - navigationStart.")),(0,r.kt)("h4",{id:"monitoring-statistics-data"},"Monitoring Statistics Data"),(0,r.kt)("p",null,"First Meaningful Paint: \u9996\u6b21\u6709\u6548\u6e32\u67d3\u65f6\u957f,\n\u5b83\u7684\u4e00\u4e2a\u6838\u5fc3\u7684\u60f3\u6cd5\u662f\u6e32\u67d3\u5e76\u4e0d\u4e00\u5b9a\u4ee3\u8868\u7740\u7528\u6237\u770b\u5230\u4e86\u4e3b\u8981\u5185\u5bb9,\nLoad \u4e5f\u4e0d\u4e00\u5b9a\u4ee3\u8868\u7528\u6237\u770b\u5230\u4e3b\u8981\u5185\u5bb9.\n\u5047\u8bbe\u5f53\u4e00\u4e2a\u7f51\u9875\u7684 DOM \u7ed3\u6784\u53d1\u751f\u5267\u70c8\u7684\u53d8\u5316\u7684\u65f6\u5019,\n\u5c31\u662f\u8fd9\u4e2a\u7f51\u9875\u4e3b\u8981\u5185\u5bb9\u51fa\u73b0\u7684\u65f6\u5019,\n\u90a3\u4e48\u5728\u8fd9\u6837\u7684\u4e00\u4e2a\u65f6\u95f4\u70b9\u4e0a,\n\u5c31\u662f\u7528\u6237\u770b\u5230\u4e3b\u8981\u5185\u5bb9\u7684\u4e00\u4e2a\u65f6\u95f4\u70b9."),(0,r.kt)("p",null,"\u5b83\u7684\u4f18\u70b9\u662f\u76f8\u5bf9\u6821\u51c6\u7684\u4f30\u7b97\u51fa\u5185\u5bb9\u6e32\u67d3\u65f6\u95f4, \u8d34\u8fd1\u7528\u6237\u611f\u77e5.\n\u4f46\u7f3a\u70b9\u662f\u65e0\u539f\u751f API \u652f\u6301, \u7b97\u6cd5\u63a8\u5bfc\u65f6 DOM \u8282\u70b9\u542b\u6743\u91cd."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"First Paint (FP): 0 ~ 1 ~ 2.5s."),(0,r.kt)("li",{parentName:"ul"},"First Contentful Paint (FCP): 0 ~ 2 ~ 4s."),(0,r.kt)("li",{parentName:"ul"},"First Meaningful Paint (FMP)"),(0,r.kt)("li",{parentName:"ul"},"Largest Contentful Paint (LCP): 0 ~ 2.5 ~ 4s."),(0,r.kt)("li",{parentName:"ul"},"Time to Interactive (TTI): 0 ~ 3.8 ~ 7.3s."),(0,r.kt)("li",{parentName:"ul"},"First Input Delay (FID): 0 ~ 0.1 ~ 0.3s.")),(0,r.kt)("p",null,"Google Core Web Vitals:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u52a0\u8f7d (Loading): LCP."),(0,r.kt)("li",{parentName:"ul"},"\u4ea4\u4e92 (Interactivity): FID."),(0,r.kt)("li",{parentName:"ul"},"\u89c6\u89c9\u7a33\u5b9a (Visual Stability): CLS.")),(0,r.kt)("h4",{id:"monitoring-report-dimension"},"Monitoring Report Dimension"),(0,r.kt)("p",null,"\u4e0d\u540c\u7684\u9875\u9762\u64cd\u4f5c/\u9875\u9762\u6253\u5f00\u65b9\u5f0f/\u6d4f\u89c8\u5668\u73af\u5883\u90fd\u4f1a\u5bf9\u6211\u4eec\u9875\u9762\u52a0\u8f7d\u7684\u6027\u80fd\u4f1a\u6709\u5f71\u54cd,\n\u9700\u8981\u4e0a\u62a5\u8fd9\u4e9b\u7ef4\u5ea6\u7684\u6570\u636e, \u4ee5\u4fbf\u6df1\u5165\u6027\u80fd\u5206\u6790:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5f53\u524d\u9875\u9762\u662f\u5426\u53ef\u89c1."),(0,r.kt)("li",{parentName:"ul"},"\u9875\u9762\u52a0\u8f7d\u65b9\u5f0f: \u76f4\u63a5\u6253\u5f00/\u5237\u65b0\u6253\u5f00/\u524d\u8fdb\u540e\u9000\u6253\u5f00."),(0,r.kt)("li",{parentName:"ul"},"\u662f\u5426\u542f\u7528 HTTP2."),(0,r.kt)("li",{parentName:"ul"},"\u662f\u5426\u542f\u7528 Service Worker.")),(0,r.kt)("h4",{id:"monitoring-report-performance"},"Monitoring Report Performance"),(0,r.kt)("p",null,"\u89e3\u51b3\u4e0a\u62a5\u5bf9\u6027\u80fd\u7684\u5f71\u54cd\u95ee\u9898\u6709\u4ee5\u4e0b\u65b9\u6848:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5ef6\u8fdf\u5408\u5e76\u4e0a\u62a5: \u5ef6\u8fdf\u5230 ",(0,r.kt)("inlineCode",{parentName:"li"},"onload")," \u4e8b\u4ef6\u540e, \u5e76\u5408\u5e76\u591a\u4e2a\u4e0a\u62a5\u8bf7\u6c42."),(0,r.kt)("li",{parentName:"ul"},"\u4f7f\u7528 ",(0,r.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/en-US/docs/Web/API/Beacon_API"},"Beacon API"),":",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Sent reliably (even if page unload)."),(0,r.kt)("li",{parentName:"ul"},"Sent asynchronously."),(0,r.kt)("li",{parentName:"ul"},"Not impact loading of next page."))),(0,r.kt)("li",{parentName:"ul"},"\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"li"},"post")," \u4e0a\u62a5."),(0,r.kt)("li",{parentName:"ul"},"Prefer ",(0,r.kt)("inlineCode",{parentName:"li"},"visibilitychange"),"/",(0,r.kt)("inlineCode",{parentName:"li"},"pagehide")," event.\n",(0,r.kt)("inlineCode",{parentName:"li"},"unload"),"/",(0,r.kt)("inlineCode",{parentName:"li"},"beforeunload")," event not precise for mobile users:\ne.g switch to another app not trigger ",(0,r.kt)("inlineCode",{parentName:"li"},"unload")," event.")),(0,r.kt)("h3",{id:"images-performance"},"Images Performance"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Responsive images with ",(0,r.kt)("inlineCode",{parentName:"li"},"srcset")," (LCP):",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Modern format: WebP/SVG."),(0,r.kt)("li",{parentName:"ul"},"Correspond size."))),(0,r.kt)("li",{parentName:"ul"},"Hero images pre-fetch loading (LCP)."),(0,r.kt)("li",{parentName:"ul"},"Offscreen images lazy loading (FID)."),(0,r.kt)("li",{parentName:"ul"},"Critical render path blocking images (FID):",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Images compression and minification."),(0,r.kt)("li",{parentName:"ul"},"Images CDN."))),(0,r.kt)("li",{parentName:"ul"},"Images placeholder with ",(0,r.kt)("inlineCode",{parentName:"li"},"aspect-ratio")," (CLS).")),(0,r.kt)("h4",{id:"responsive-images"},"Responsive Images"),(0,r.kt)("p",null,"Responsive images provide 3 ~ 5 different sizes\nreduce image transfer sizes by average of ",(0,r.kt)("strong",{parentName:"p"},"~20%"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'<picture>\n  <source srcset="keyboard.avif" type="image/avif" />\n  <source srcset="keyboard.webp" type="image/webp" />\n  <source srcset="keyboard.jpg" type="image/jpeg" />\n  <img src="keyboard.jpg" alt="Omg a keyboard" />\n</picture>\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'<img\n  src="keyboard-800w.jpg"\n  alt="A beautiful pink keyboard."\n  width="400"\n  height="400"\n  srcset="keyboard-400w.jpg 400w, keyboard-800w.jpg 800w"\n  sizes="(max-width: 640px) 400px, 800px"\n/>\n')),(0,r.kt)("h4",{id:"pre-fetch-loading-images"},"Pre-fetch Loading Images"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'<link\n  rel="preload"\n  as="image"\n  href="keyboard.jpg"\n  imagesrcset="poster_400px.jpg 400w, poster_800px.jpg 800w, poster_1600px.jpg 1600w"\n  imagesizes="50vw"\n/>\n')),(0,r.kt)("h4",{id:"lazy-loading-images"},"Lazy Loading Images"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'<img\n  src="donut-800w.jpg"\n  alt="A delicious pink donut"\n  width="400"\n  height="400"\n  srcset="donut-400w.jpg 400w, donut-800w.jpg 800w"\n  sizes="(max-width: 640px) 400px, 800px"\n  loading="lazy"\n/>\n')),(0,r.kt)("h4",{id:"placeholder-images"},"Placeholder Images"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'<img\n  src="donut-800w.jpg"\n  alt="A delicious donut"\n  width="400"\n  height="400"\n  srcset="donut-400w.jpg 400w, donut-800w.jpg 800w"\n  sizes="(max-width: 640px) 400px, 800px"\n  loading="lazy"\n  decoding="async"\n  style="\n    background-image: url(\'data:image/svg+xml;base64,[svg text]\');\n    background-size: cover;\n  "\n/>\n')),(0,r.kt)("h4",{id:"images-format"},"Images Format"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"mp4")," smaller than ",(0,r.kt)("inlineCode",{parentName:"p"},"gif")," (",(0,r.kt)("inlineCode",{parentName:"p"},"ffmpeg"),"):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'\x3c!-- ffmpeg -i dog.gif dog.mp4 --\x3e\n<video autoplay loop muted playsinline>\n  <source src="dog.mp4" type="video/mp4" />\n</video>\n')),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"WebP")," 25~35% smaller than ",(0,r.kt)("inlineCode",{parentName:"p"},"jpg"),"/",(0,r.kt)("inlineCode",{parentName:"p"},"png"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'<picture>\n  <source type="image/webp" srcset="flower.webp" />\n  <source type="image/jpeg" srcset="flower.jpg" />\n  <img src="flower.jpg" />\n</picture>\n')),(0,r.kt)("h4",{id:"images-compression-and-minification"},"Images Compression and Minification"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/lovell/sharp"},"Sharp")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/oliver-moran/jimp"},"Jimp")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/Klathmon/imagemin-webpack-plugin"},"Imagemin"))),(0,r.kt)("h4",{id:"images-performance-reference"},"Images Performance Reference"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Images format ",(0,r.kt)("a",{parentName:"li",href:"https://evilmartians.com/chronicles/images-done-right-web-graphics-good-to-the-last-byte-optimization-techniques"},"guide"),"."),(0,r.kt)("li",{parentName:"ul"},"Images optimization ",(0,r.kt)("a",{parentName:"li",href:"https://www.keycdn.com/blog/optimize-images-for-web"},"guide"),"."),(0,r.kt)("li",{parentName:"ul"},"Images optimization ",(0,r.kt)("a",{parentName:"li",href:"https://stackoverflow.blog/2022/03/28/picture-perfect-images-with-the-modern-element"},"blog"),"."),(0,r.kt)("li",{parentName:"ul"},"Images optimization ",(0,r.kt)("a",{parentName:"li",href:"https://www.smashingmagazine.com/printed-books/image-optimization"},"book"),".")),(0,r.kt)("h3",{id:"data-loading"},"Data Loading"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://web.dev/priority-hints"},"Fetch Priority")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://web.dev/prioritize-resources"},"Resources Priority"))),(0,r.kt)("h4",{id:"data-preloading"},"Data Preloading"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'<link rel="preload" as="script" href="critical.js" />\n<link rel="modulepreload" href="critical-module.mjs" />\n<link rel="preload" as="image" href="..." />\n<link rel="preload" as="font" href="..." crossorigin />\n<link rel="preload" as="fetch" href="..." crossorigin />\n')),(0,r.kt)("h4",{id:"images-lazy-loading"},"Images Lazy Loading"),(0,r.kt)("p",null,"Lazy Loading Polyfill:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'<img data-src="flower.jpg" class="lazyload" />\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"window.addEventListener('scroll', function (event) {\n  Array.from(document.querySelectorAll('.lazyload')).forEach(image => {\n    if (image.slideIntoView(event.getBoundingClientRect())) {\n      image.setAttribute('src', image.dataset.src);\n    }\n  });\n});\n")),(0,r.kt)("p",null,"Observer Lazy Loading:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const observer = new IntersectionObserver(nodes => {\n  nodes.forEach(v => {\n    if (v.isIntersecting) {\n      v.target.src = v.target.dataset.src;\n      observer.unobserve(v.target);\n    }\n  });\n});\n\nconst images = document.querySelectorAll('img.lazyload');\nimages.forEach(v => observer.observe(v));\n")),(0,r.kt)("p",null,"Native Lazy Loading:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'<img src="flower.jpg" lazyload="auto" />\n<img src="flower.jpg" lazyload="on" />\n<img src="flower.jpg" lazyload="off" />\n')),(0,r.kt)("h4",{id:"javascript-lazy-loading"},"JavaScript Lazy Loading"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://addyosmani.com/blog/script-priorities"},"Script Priorities")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"async"),":\ndownloads script during parsing document,\nbut will ",(0,r.kt)("strong",{parentName:"li"},"pause")," parser to execute script."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"defer"),":\ndownloads script during parsing document,\nand waits until document has finished parsing before executing it."),(0,r.kt)("li",{parentName:"ul"},"If the script is independent, use ",(0,r.kt)("inlineCode",{parentName:"li"},"async"),"."),(0,r.kt)("li",{parentName:"ul"},"If the scripts rely on each other, use ",(0,r.kt)("inlineCode",{parentName:"li"},"defer"),"."),(0,r.kt)("li",{parentName:"ul"},"If put JavaScript in ",(0,r.kt)("inlineCode",{parentName:"li"},"<head>"),",\nin such script can't access DOM directly\n(DOM haven't get parsed).")),(0,r.kt)("p",null,"Best practice: lazy loading scripts not execute immediately.\n(",(0,r.kt)("strong",{parentName:"p"},"Chrome Coverage Devtools"),")"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://sia.codes/posts/render-blocking-resources/#deep-dive%3A-optimizing-javascript-for-the-critical-rendering-path"},(0,r.kt)("img",{alt:"Scripting Type",src:t(1816).Z,width:"820",height:"200"}))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'<script src="myScript.js"><\/script>\n<script src="myScript.js" async><\/script>\n<script src="myScript.js" defer><\/script>\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"const DetailsComponent = lazy(() => import('./details'));\nconst PageComponent = () => {\n  <Suspense fallback={<div>Loading...</div>}>\n    <DetailsComponent />\n  </Suspense>;\n};\n")),(0,r.kt)("h4",{id:"prefetch-and-preload"},"PreFetch and PreLoad"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/GoogleChromeLabs/quicklink"},"Quick Link"),"\nprefetch library."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'<link rel="prefetch"></link>\n<link rel="preload"></link>\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Generally, preloads will load in order parser gets to them for anything >= ",(0,r.kt)("inlineCode",{parentName:"li"},"Medium"),"."),(0,r.kt)("li",{parentName:"ul"},"Font preloads are probably best towards end of ",(0,r.kt)("inlineCode",{parentName:"li"},"<head>")," or beginning of ",(0,r.kt)("inlineCode",{parentName:"li"},"<body>"),"."),(0,r.kt)("li",{parentName:"ul"},"Import preloads should be done after ",(0,r.kt)("inlineCode",{parentName:"li"},"<script>")," tag that needs the import."),(0,r.kt)("li",{parentName:"ul"},"Image preloads will have a low priority (async scripts).")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://addyosmani.com/blog/what-not-to-prefetch-prerender"},"PreFetch and PreRender Pitfalls"),":"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Avoid prefetching pages for authentication."),(0,r.kt)("li",{parentName:"ul"},"Avoid over-prefetching to limit accidental DOS."),(0,r.kt)("li",{parentName:"ul"},"Avoid prefetching pages key to checkout."),(0,r.kt)("li",{parentName:"ul"},"Avoid prefetching large resources."),(0,r.kt)("li",{parentName:"ul"},"Avoid prefetching cross-origin resources.")),(0,r.kt)("h4",{id:"babel-configuration-for-javascript"},"Babel Configuration for JavaScript"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"modules"),": always ",(0,r.kt)("inlineCode",{parentName:"li"},"false"),", keep ",(0,r.kt)("inlineCode",{parentName:"li"},"esm")," for bundler (e.g webpack) tree shaking."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"useBuiltIns"),":",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"entry"),": \u5c06 ",(0,r.kt)("inlineCode",{parentName:"li"},"core-js import")," \u66ff\u6362\u4e3a\u7279\u6027\u5217\u8868."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"usage"),": \u6309\u4f7f\u7528\u5f15\u5165\u7528\u5230\u7684\u7279\u6027\u5217\u8868.")))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "presets": [\n    [\n      "@babel/preset-env",\n      {\n        "targets": {\n          "esmodules": true,\n          "node": ">= 8",\n          "browsers": "> 0.25%"\n        },\n        "modules": false,\n        "useBuiltIns": "usage"\n      }\n    ]\n  ]\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'<script type="module" src="main.mjs"><\/script>\n<script nomodule src="legacy.js"><\/script>\n')),(0,r.kt)("h4",{id:"data-loading-best-practice"},"Data Loading Best Practice"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u975e\u5fc5\u8981\u9759\u6001\u8d44\u6e90\u4e0a\u4f20 CDN."),(0,r.kt)("li",{parentName:"ul"},"\u51b7\u542f\u52a8\u5f00\u542f\u6570\u636e\u9884\u62c9\u53d6."),(0,r.kt)("li",{parentName:"ul"},"\u9875\u9762\u8def\u7531\u5207\u6362\u65f6\u8fdb\u884c\u6570\u636e\u9884\u62c9\u53d6 (\u5e76\u7f13\u5b58\u6570\u636e).")),(0,r.kt)("h3",{id:"performance-api"},"Performance API"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"performance.mark('mainThread-start');\nexpensiveCalculation();\nperformance.mark('mainThread-stop');\nperformance.measure('mainThread', 'mainThread-start', 'mainThread-stop');\n")),(0,r.kt)("h4",{id:"first-paint-time"},"First Paint Time"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const entryHandler = list => {\n  for (const entry of list.getEntries()) {\n    if (entry.name === 'first-paint') {\n      observer.disconnect();\n    }\n\n    console.log(entry);\n  }\n};\n\nconst observer = new PerformanceObserver(entryHandler);\nobserver.observe({ type: 'paint', buffered: true });\n\n// {\n//   duration: 0,\n//   entryType: \"paint\",\n//   name: \"first-paint\",\n//   startTime: 359,\n// }\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"document.addEventListener('DOMContentLoaded', function () {\n  console.log('DOM \u6302\u8f7d\u65f6\u95f4: ', Date.now() - timerStart);\n\n  // \u6027\u80fd\u65e5\u5fd7\u4e0a\u62a5...\n});\n\nwindow.addEventListener('load', function () {\n  console.log('\u6240\u6709\u8d44\u6e90\u52a0\u8f7d\u5b8c\u6210\u65f6\u95f4: ', Date.now() - timerStart);\n\n  // \u6027\u80fd\u65e5\u5fd7\u4e0a\u62a5...\n});\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// \u8ba1\u7b97\u52a0\u8f7d\u65f6\u95f4.\nfunction getPerformanceTiming() {\n  const performance = window.performance;\n\n  if (!performance) {\n    // \u5f53\u524d\u6d4f\u89c8\u5668\u4e0d\u652f\u6301.\n    console.log('\u4f60\u7684\u6d4f\u89c8\u5668\u4e0d\u652f\u6301 performance \u63a5\u53e3');\n    return;\n  }\n\n  const t = performance.timing;\n  const times = {};\n\n  // \u3010\u91cd\u8981\u3011\u9875\u9762\u52a0\u8f7d\u5b8c\u6210\u7684\u65f6\u95f4.\n  // \u3010\u539f\u56e0\u3011\u51e0\u4e4e\u4ee3\u8868\u4e86\u7528\u6237\u7b49\u5f85\u9875\u9762\u53ef\u7528\u7684\u65f6\u95f4.\n  times.loadPage = t.loadEventEnd - t.navigationStart;\n\n  // \u3010\u91cd\u8981\u3011\u89e3\u6790 DOM \u6811\u7ed3\u6784\u7684\u65f6\u95f4.\n  // \u3010\u539f\u56e0\u3011DOM \u6811\u5d4c\u5957\u8fc7\u591a.\n  times.domReady = t.domComplete - t.responseEnd;\n\n  // \u3010\u91cd\u8981\u3011\u91cd\u5b9a\u5411\u7684\u65f6\u95f4.\n  // \u3010\u539f\u56e0\u3011\u62d2\u7edd\u91cd\u5b9a\u5411. e.g http://example.com/ \u4e0d\u5e94\u5199\u6210 http://example.com.\n  times.redirect = t.redirectEnd - t.redirectStart;\n\n  // \u3010\u91cd\u8981\u3011DNS \u67e5\u8be2\u65f6\u95f4.\n  // \u3010\u539f\u56e0\u3011DNS \u9884\u52a0\u8f7d\u505a\u4e86\u4e48? \u9875\u9762\u5185\u662f\u4e0d\u662f\u4f7f\u7528\u4e86\u592a\u591a\u4e0d\u540c\u7684\u57df\u540d\u5bfc\u81f4\u57df\u540d\u67e5\u8be2\u7684\u65f6\u95f4\u592a\u957f?\n  // \u53ef\u4f7f\u7528 HTML5 Prefetch \u9884\u67e5\u8be2 DNS, \u89c1: [HTML5 prefetch](http://segmentfault.com/a/1190000000633364).\n  times.lookupDomain = t.domainLookupEnd - t.domainLookupStart;\n\n  // \u3010\u91cd\u8981\u3011\u8bfb\u53d6\u9875\u9762\u7b2c\u4e00\u4e2a\u5b57\u8282\u7684\u65f6\u95f4.\n  // \u3010\u539f\u56e0\u3011\u8fd9\u53ef\u4ee5\u7406\u89e3\u4e3a\u7528\u6237\u62ff\u5230\u4f60\u7684\u8d44\u6e90\u5360\u7528\u7684\u65f6\u95f4, \u52a0\u5f02\u5730\u673a\u623f\u4e86\u4e48, \u52a0CDN \u5904\u7406\u4e86\u4e48? \u52a0\u5e26\u5bbd\u4e86\u4e48? \u52a0 CPU \u8fd0\u7b97\u901f\u5ea6\u4e86\u4e48?\n  // TTFB \u5373 Time To First Byte \u7684\u610f\u601d.\n  // \u7ef4\u57fa\u767e\u79d1: https://en.wikipedia.org/wiki/Time_To_First_Byte.\n  times.ttfb = t.responseStart - t.navigationStart;\n\n  // \u3010\u91cd\u8981\u3011\u5185\u5bb9\u52a0\u8f7d\u5b8c\u6210\u7684\u65f6\u95f4.\n  // \u3010\u539f\u56e0\u3011\u9875\u9762\u5185\u5bb9\u7ecf\u8fc7 gzip \u538b\u7f29\u4e86\u4e48, \u9759\u6001\u8d44\u6e90 `CSS`/`JS` \u7b49\u538b\u7f29\u4e86\u4e48?\n  times.request = t.responseEnd - t.requestStart;\n\n  // \u3010\u91cd\u8981\u3011\u6267\u884c onload \u56de\u8c03\u51fd\u6570\u7684\u65f6\u95f4.\n  // \u3010\u539f\u56e0\u3011\u662f\u5426\u592a\u591a\u4e0d\u5fc5\u8981\u7684\u64cd\u4f5c\u90fd\u653e\u5230 onload \u56de\u8c03\u51fd\u6570\u91cc\u6267\u884c\u4e86, \u8003\u8651\u8fc7\u5ef6\u8fdf\u52a0\u8f7d/\u6309\u9700\u52a0\u8f7d\u7684\u7b56\u7565\u4e48?\n  times.loadEvent = t.loadEventEnd - t.loadEventStart;\n\n  // DNS \u7f13\u5b58\u65f6\u95f4.\n  times.appCache = t.domainLookupStart - t.fetchStart;\n\n  // \u5378\u8f7d\u9875\u9762\u7684\u65f6\u95f4.\n  times.unloadEvent = t.unloadEventEnd - t.unloadEventStart;\n\n  // TCP \u5efa\u7acb\u8fde\u63a5\u5b8c\u6210\u63e1\u624b\u7684\u65f6\u95f4.\n  times.connect = t.connectEnd - t.connectStart;\n  return times;\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const [pageNav] = performance.getEntriesByType('navigation');\n\n// Measuring DNS lookup time.\nconst totalLookupTime = pageNav.domainLookupEnd - pageNav.domainLookupStart;\n\n// Quantifying total connection time.\nconst connectionTime = pageNav.connectEnd - pageNav.connectStart;\nlet tlsTime = 0; // <-- Assume 0 to start with\n\n// Was there TLS negotiation?\nif (pageNav.secureConnectionStart > 0) {\n  // Awesome! Calculate it!\n  tlsTime = pageNav.connectEnd - pageNav.secureConnectionStart;\n}\n\n// Cache seek plus response time of the current document.\nconst fetchTime = pageNav.responseEnd - pageNav.fetchStart;\n\n// Service worker time plus response time.\nlet workerTime = 0;\n\nif (pageNav.workerStart > 0) {\n  workerTime = pageNav.responseEnd - pageNav.workerStart;\n}\n\n// Request time only (excluding redirects, DNS, and connection/TLS time).\nconst requestTime = pageNav.responseStart - pageNav.requestStart;\n\n// Response time only (download).\nconst responseTime = pageNav.responseEnd - pageNav.responseStart;\n\n// Request + response time.\nconst requestResponseTime = pageNav.responseEnd - pageNav.requestStart;\n")),(0,r.kt)("h4",{id:"fcp"},"FCP"),(0,r.kt)("p",null,"First Contentful Paint:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Add the ",(0,r.kt)("inlineCode",{parentName:"li"},"defer")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"async")," attributes to ",(0,r.kt)("inlineCode",{parentName:"li"},"<script>")," tags."),(0,r.kt)("li",{parentName:"ul"},"Minify the JavaScript and CSS files."),(0,r.kt)("li",{parentName:"ul"},"Remove unused CSS (e.g Tailwind.css JIT mode)."),(0,r.kt)("li",{parentName:"ul"},"Lazy importing components not for first page."),(0,r.kt)("li",{parentName:"ul"},"Server side rendering."),(0,r.kt)("li",{parentName:"ul"},"Reduce server response time (e.g CDN)."),(0,r.kt)("li",{parentName:"ul"},"TBT (Total Blocking Time) = TTI (Time to Interactive) - FCP (First Contentful Paint).")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const entryHandler = list => {\n  for (const entry of list.getEntries()) {\n    if (entry.name === 'first-contentful-paint') {\n      observer.disconnect();\n    }\n\n    console.log(entry);\n  }\n};\n\nconst observer = new PerformanceObserver(entryHandler);\nobserver.observe({ type: 'paint', buffered: true });\n\n// {\n//   duration: 0,\n//   entryType: \"paint\",\n//   name: \"first-contentful-paint\",\n//   startTime: 459,\n// }\n")),(0,r.kt)("h4",{id:"lcp"},"LCP"),(0,r.kt)("p",null,"Largest Contentful Paint:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Use a CDN for assets like images and video."),(0,r.kt)("li",{parentName:"ul"},"Compress images:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Minify images."),(0,r.kt)("li",{parentName:"ul"},"Convert images from JPEG/PNG to WebP."))),(0,r.kt)("li",{parentName:"ul"},"Responsive images:\nsize image based on device size with ",(0,r.kt)("inlineCode",{parentName:"li"},"srcset")," on ",(0,r.kt)("inlineCode",{parentName:"li"},"<img>")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"<picture>"),"."),(0,r.kt)("li",{parentName:"ul"},"LCP optimization ",(0,r.kt)("a",{parentName:"li",href:"https://csswizardry.com/2022/03/optimising-largest-contentful-paint"},"guide"),".")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const entryHandler = list => {\n  if (observer) {\n    observer.disconnect();\n  }\n\n  for (const entry of list.getEntries()) {\n    console.log(entry);\n  }\n};\n\nconst observer = new PerformanceObserver(entryHandler);\nobserver.observe({ type: 'largest-contentful-paint', buffered: true });\n\n// {\n//   duration: 0,\n//   element: p,\n//   entryType: 'largest-contentful-paint',\n//   id: '',\n//   loadTime: 0,\n//   name: '',\n//   renderTime: 1021.299,\n//   size: 37932,\n//   startTime: 1021.299,\n//   url: '',\n// }\n")),(0,r.kt)("h4",{id:"cls"},"CLS"),(0,r.kt)("p",null,"Cumulative Layout Shift:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Set ",(0,r.kt)("inlineCode",{parentName:"li"},"height")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"width")," attributes of image or video,\nso that it won\u2019t move content around it once it\u2019s loaded."),(0,r.kt)("li",{parentName:"ul"},"Avoid using ",(0,r.kt)("inlineCode",{parentName:"li"},"popups")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"overlays"),"\nunless they appear when the user interacts with the page."),(0,r.kt)("li",{parentName:"ul"},"When it\u2019s necessary to move elements, use ",(0,r.kt)("inlineCode",{parentName:"li"},"transform")," animations.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"let sessionValue = 0;\nlet sessionEntries = [];\nconst cls = {\n  subType: 'layout-shift',\n  name: 'layout-shift',\n  type: 'performance',\n  pageURL: getPageURL(),\n  value: 0,\n};\n\nconst entryHandler = list => {\n  for (const entry of list.getEntries()) {\n    // Only count layout shifts without recent user input.\n    if (!entry.hadRecentInput) {\n      const firstSessionEntry = sessionEntries[0];\n      const lastSessionEntry = sessionEntries[sessionEntries.length - 1];\n\n      // If the entry occurred less than 1 second after the previous entry and\n      // less than 5 seconds after the first entry in the session, include the\n      // entry in the current session. Otherwise, start a new session.\n      if (\n        sessionValue &&\n        entry.startTime - lastSessionEntry.startTime < 1000 &&\n        entry.startTime - firstSessionEntry.startTime < 5000\n      ) {\n        sessionValue += entry.value;\n        sessionEntries.push(formatCLSEntry(entry));\n      } else {\n        sessionValue = entry.value;\n        sessionEntries = [formatCLSEntry(entry)];\n      }\n\n      // If the current session value is larger than the current CLS value,\n      // update CLS and the entries contributing to it.\n      if (sessionValue > cls.value) {\n        cls.value = sessionValue;\n        cls.entries = sessionEntries;\n        cls.startTime = performance.now();\n        lazyReportCache(deepCopy(cls));\n      }\n    }\n  }\n};\n\nconst observer = new PerformanceObserver(entryHandler);\nobserver.observe({ type: 'layout-shift', buffered: true });\n\n// {\n//   duration: 0,\n//   entryType: \"layout-shift\",\n//   hadRecentInput: false,\n//   lastInputTime: 0,\n//   name: \"\",\n//   sources: (2) [LayoutShiftAttribution, LayoutShiftAttribution],\n//   startTime: 1176.199999999255,\n//   value: 0.000005752046026677329,\n// }\n")),(0,r.kt)("h3",{id:"prpl-pattern"},"PRPL Pattern"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"PRPL")," pattern focuses on 4 main performance considerations:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Pushing critical resources efficiently:\nminimize amount of round trips to server and reducing loading time."),(0,r.kt)("li",{parentName:"ul"},"Rendering initial route soon as possible:\nimprove user experience."),(0,r.kt)("li",{parentName:"ul"},"Pre-caching assets in the background for frequently visited routes:\nminimize amount of requests to server and enable better offline experience."),(0,r.kt)("li",{parentName:"ul"},"Lazily loading routes and assets that aren\u2019t requested as frequently.")),(0,r.kt)("h3",{id:"performance-best-practice"},"Performance Best Practice"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Code optimization:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Fast CSS styles (",(0,r.kt)("inlineCode",{parentName:"li"},"CSS Performance"),"):"),(0,r.kt)("li",{parentName:"ul"},"Fast JavaScript code (",(0,r.kt)("inlineCode",{parentName:"li"},"Effective JavaScript"),"):",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"DOM performance."),(0,r.kt)("li",{parentName:"ul"},"React performance."),(0,r.kt)("li",{parentName:"ul"},"Concurrency: asynchronous/web worker."))))),(0,r.kt)("li",{parentName:"ul"},"Resource optimization (HTML/CSS/JS/Images/Audio/Video/Fonts):",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Remove useless files."),(0,r.kt)("li",{parentName:"ul"},"Tree shaking."),(0,r.kt)("li",{parentName:"ul"},"Zip."),(0,r.kt)("li",{parentName:"ul"},"CDN."))),(0,r.kt)("li",{parentName:"ul"},"Code splitting: Webpack ",(0,r.kt)("inlineCode",{parentName:"li"},"splitChunks"),"."),(0,r.kt)("li",{parentName:"ul"},"Use monomorphic objects due to shape and inline caches."),(0,r.kt)("li",{parentName:"ul"},"Use monomorphic function in hot code paths."),(0,r.kt)("li",{parentName:"ul"},"Offline caching (PWA)."),(0,r.kt)("li",{parentName:"ul"},"CDN."),(0,r.kt)("li",{parentName:"ul"},"PreFetch/PreLoad/PreRendering (SSR)."),(0,r.kt)("li",{parentName:"ul"},"Lazy loading: HTML/CSS/JS/Images/Audio/Video/Fonts.")),(0,r.kt)("h3",{id:"performance-and-analysis-tools"},"Performance and Analysis Tools"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/reference"},"Chrome DevTools")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://developers.google.com/web/tools/chrome-user-experience-report"},"Chrome UX Report")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://developers.google.com/web/fundamentals/performance/speed-tools"},"Speedup Tools")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/GoogleChromeLabs/first-input-delay"},"FID Tracking")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://developers.google.com/speed/pagespeed/insights"},"PageSpeed Insights")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/GoogleChrome/lighthouse"},"Lighthouse Audit Tab)")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/treosh/lighthouse-ci-action"},"LightHouse CI Action")),(0,r.kt)("li",{parentName:"ul"},"Audits Chrome: PWA, SEO, performance, device simulator.")),(0,r.kt)("h4",{id:"inspect-android-device"},"Inspect Android Device"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Enable development mode and USB debugging in Android Device."),(0,r.kt)("li",{parentName:"ul"},"Link Android and PC with USB cable."),(0,r.kt)("li",{parentName:"ul"},"Open ",(0,r.kt)("inlineCode",{parentName:"li"},"chrome://inspect/#devices")," to start inspecting.")),(0,r.kt)("h3",{id:"performance-reference"},"Performance Reference"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"web.dev")," performance complete ",(0,r.kt)("a",{parentName:"li",href:"https://web.dev/fast"},"guide"),"."),(0,r.kt)("li",{parentName:"ul"},"LCP optimization ",(0,r.kt)("a",{parentName:"li",href:"https://web.dev/optimize-lcp"},"guide"),"."),(0,r.kt)("li",{parentName:"ul"},"FID optimization ",(0,r.kt)("a",{parentName:"li",href:"https://web.dev/optimize-fid"},"guide"),"."),(0,r.kt)("li",{parentName:"ul"},"CLS optimization ",(0,r.kt)("a",{parentName:"li",href:"https://web.dev/optimize-cls"},"guide"),"."),(0,r.kt)("li",{parentName:"ul"},"Fetch priority ",(0,r.kt)("a",{parentName:"li",href:"https://web.dev/priority-hints"},"guide"),"."),(0,r.kt)("li",{parentName:"ul"},"Resources priority ",(0,r.kt)("a",{parentName:"li",href:"https://web.dev/prioritize-resources"},"guide"),"."),(0,r.kt)("li",{parentName:"ul"},"3rd-party scripts loading ",(0,r.kt)("a",{parentName:"li",href:"https://www.patterns.dev/posts/third-party"},"guide")),(0,r.kt)("li",{parentName:"ul"},"Web vitals real world ",(0,r.kt)("a",{parentName:"li",href:"https://mp.weixin.qq.com/s/zJMM4SF7pc6LZPCsQfWOxw"},"case"),"."),(0,r.kt)("li",{parentName:"ul"},"Web monitor real world ",(0,r.kt)("a",{parentName:"li",href:"https://zhuanlan.zhihu.com/p/420330110"},"case"),".")),(0,r.kt)("h2",{id:"testing-and-debugging"},"Testing and Debugging"),(0,r.kt)("h3",{id:"log"},"Log"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u65f6\u95f4, \u5305\u542b\u65f6\u533a\u4fe1\u606f\u548c\u6beb\u79d2."),(0,r.kt)("li",{parentName:"ul"},"\u65e5\u5fd7\u7ea7\u522b."),(0,r.kt)("li",{parentName:"ul"},"\u4f1a\u8bdd\u6807\u8bc6."),(0,r.kt)("li",{parentName:"ul"},"\u529f\u80fd\u6807\u8bc6."),(0,r.kt)("li",{parentName:"ul"},"\u7cbe\u70bc\u7684\u5185\u5bb9: \u573a\u666f\u4fe1\u606f, \u72b6\u6001\u4fe1\u606f (\u5f00\u59cb/\u4e2d\u65ad/\u7ed3\u675f), \u91cd\u8981\u53c2\u6570."),(0,r.kt)("li",{parentName:"ul"},"\u5176\u4ed6\u4fe1\u606f: \u7248\u672c\u53f7, \u7ebf\u7a0b\u53f7.")),(0,r.kt)("h4",{id:"log-clock"},"Log Clock"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"performance.now()")," is more precise (100 us)"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"performance.now()")," is strictly monotonic (unaffected by changes of machine time)")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"let lastVisibilityChange = 0;\n\nwindow.addEventListener('visibilitychange', () => {\n  lastVisibilityChange = performance.now();\n});\n\n// don\u2019t log any metrics started before the last visibility change\n// don't log any metrics if the page is hidden\n// discard perf data from when the machine was not running app at full speed\nfunction metrics() {\n  if (metric.start < lastVisibilityChange || document.hidden) {\n    return;\n  }\n\n  process();\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"requestAnimationFrame(() => {\n  requestAnimationFrame(timestamp => {\n    metric.finish(timestamp);\n  });\n});\n")),(0,r.kt)("h3",{id:"headless-testing"},"Headless Testing"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://pptr.dev/#?product=Puppeteer&version=v1.16.0&show=api-class-page"},"Puppeteer")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://addyosmani.com/blog/puppeteer-recipes"},"Puppeteer Recipes"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const puppeteer = require('puppeteer');\n\n(async () => {\n  const browser = await puppeteer.launch();\n  const page = await browser.newPage();\n  await page.goto('https://example.com');\n  await page.screenshot({ path: 'example.png' });\n  await browser.close();\n})();\n")),(0,r.kt)("h4",{id:"browser-context"},"Browser Context"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// Create a new incognito browser context\nconst context = await browser.createIncognitoBrowserContext();\n// Create a new page inside context.\nconst page = await context.newPage();\n// ... do stuff with page ...\nawait page.goto('https://example.com');\n// Dispose context once it's no longer needed.\nawait context.close();\n")),(0,r.kt)("h4",{id:"dom-testing"},"DOM Testing"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"page.$(selector)")," same to ",(0,r.kt)("inlineCode",{parentName:"p"},"querySelector")),(0,r.kt)("h4",{id:"event-testing"},"Event Testing"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// wait for selector\nawait page.waitFor('.foo');\n// wait for 1 second\nawait page.waitFor(1000);\n// wait for predicate\nawait page.waitFor(() => !!document.querySelector('.foo'));\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const puppeteer = require('puppeteer');\n\npuppeteer.launch().then(async browser => {\n  const page = await browser.newPage();\n  const watchDog = page.waitForFunction('window.innerWidth < 100');\n  await page.setViewport({ width: 50, height: 50 });\n  await watchDog;\n  await browser.close();\n});\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const [response] = await Promise.all([\n  page.waitForNavigation(), // The promise resolves after navigation has finished\n  page.click('a.my-link'), // Clicking the link will indirectly cause a navigation\n]);\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const firstRequest = await page.waitForRequest('http://example.com/resource');\nconst finalRequest = await page.waitForRequest(\n  request =>\n    request.url() === 'http://example.com' && request.method() === 'GET'\n);\nreturn firstRequest.url();\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const firstResponse = await page.waitForResponse(\n  'https://example.com/resource'\n);\nconst finalResponse = await page.waitForResponse(\n  response =>\n    response.url() === 'https://example.com' && response.status() === 200\n);\nreturn finalResponse.ok();\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"await page.evaluate(() => window.open('https://www.example.com/'));\nconst newWindowTarget = await browserContext.waitForTarget(\n  target => target.url() === 'https://www.example.com/'\n);\n")),(0,r.kt)("h4",{id:"operation-simulation-testing"},"Operation Simulation Testing"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const [response] = await Promise.all([\n  page.waitForNavigation(waitOptions),\n  page.click(selector, clickOptions),\n]);\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// Using \u2018page.mouse\u2019 to trace a 100x100 square.\nawait page.mouse.move(0, 0);\nawait page.mouse.down();\nawait page.mouse.move(0, 100);\nawait page.mouse.move(100, 100);\nawait page.mouse.move(100, 0);\nawait page.mouse.move(0, 0);\nawait page.mouse.up();\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"await page.keyboard.type('Hello World!');\nawait page.keyboard.press('ArrowLeft');\n\nawait page.keyboard.down('Shift');\nfor (let i = 0; i < ' World'.length; i++)\n  await page.keyboard.press('ArrowLeft');\nawait page.keyboard.up('Shift');\n\nawait page.keyboard.press('Backspace');\n// Result text will end up saying 'Hello!'\n")),(0,r.kt)("h4",{id:"tracing-testing"},"Tracing Testing"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"await page.tracing.start({ path: 'trace.json' });\nawait page.goto('https://www.google.com');\nawait page.tracing.stop();\n")),(0,r.kt)("h4",{id:"puppeteer-testing-api"},"Puppeteer Testing API"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"page.setOfflineMode")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"page.setGeolocation")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"page.metrics")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"page.accessibility")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"page.coverage"))),(0,r.kt)("h3",{id:"testing-frameworks"},"Testing Frameworks"),(0,r.kt)("h4",{id:"unit-testing-frameworks"},"Unit Testing Frameworks"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Jasmine"),(0,r.kt)("li",{parentName:"ul"},"Mocha")),(0,r.kt)("h4",{id:"ui-testing-frameworks"},"UI Testing Frameworks"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u7528\u6237\u884c\u4e3a: Karma/Selenium."),(0,r.kt)("li",{parentName:"ul"},"\u529f\u80fd\u6d4b\u8bd5: Phantom.js/Slimer.js/Karma.")),(0,r.kt)("h3",{id:"testable-code"},"Testable Code"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5b8c\u6574\u6ce8\u91ca."),(0,r.kt)("li",{parentName:"ul"},"\u6700\u5c0f\u590d\u6742\u5ea6 = (\u6247\u5165 ",(0,r.kt)("inlineCode",{parentName:"li"},"*")," \u6247\u51fa) ^ 2."),(0,r.kt)("li",{parentName:"ul"},"\u53ef\u9694\u79bb\u6027: \u6700\u5c0f\u4f9d\u8d56\u6027 + \u677e\u8026\u5408\u6027."),(0,r.kt)("li",{parentName:"ul"},"\u4f7f\u7528\u4f9d\u8d56\u6ce8\u5165, \u5c06\u5916\u90e8\u5bf9\u8c61\u79fb\u81f3\u51fd\u6570\u53c2\u6570\u5904(\u4e0d\u5728\u51fd\u6570\u5185\u90e8\u8c03\u7528\u6784\u9020\u5668): \u6613\u4e8e\u6784\u9020 mock/stub, \u964d\u4f4e\u6247\u51fa(\u51fd\u6570\u590d\u6742\u5ea6).")),(0,r.kt)("h3",{id:"\u5708\u590d\u6742\u5ea6"},"\u5708\u590d\u6742\u5ea6"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"V(G) = e - n + 2"),": ",(0,r.kt)("inlineCode",{parentName:"p"},"**<10**"),"."),(0,r.kt)("h3",{id:"\u51fd\u6570\u590d\u6742\u5ea6"},"\u51fd\u6570\u590d\u6742\u5ea6"),(0,r.kt)("p",null,"\u51fd\u6570\u590d\u6742\u5ea6 = (\u6247\u5165 ",(0,r.kt)("inlineCode",{parentName:"p"},"*")," \u6247\u51fa) ^ 2."),(0,r.kt)("h4",{id:"\u6247\u51fa"},"\u6247\u51fa"),(0,r.kt)("p",null,"\u5f15\u7528:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u6240\u5f15\u7528\u5916\u90e8\u5bf9\u8c61/\u65b9\u6cd5\u4e4b\u548c."),(0,r.kt)("li",{parentName:"ul"},"\u6247\u51fa: ",(0,r.kt)("inlineCode",{parentName:"li"},"**<7**"),"."),(0,r.kt)("li",{parentName:"ul"},"\u9ad8\u6247\u51fa: \u9ad8\u590d\u6742\u5ea6/\u9ad8\u4f9d\u8d56\u6027/\u9ad8\u8026\u5408\u5ea6.")),(0,r.kt)("h4",{id:"\u6247\u5165"},"\u6247\u5165"),(0,r.kt)("p",null,"\u88ab\u5f15\u7528:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5176\u4ed6\u5bf9\u8c61/\u65b9\u6cd5\u5f15\u7528\u6b64\u51fd\u6570\u7684\u6b21\u6570\u4e4b\u548c."),(0,r.kt)("li",{parentName:"ul"},"\u9876\u5c42\u62bd\u8c61\u4ee3\u7801 \u4e0e \u4e0d\u5e38\u7528\u529f\u80fd \u5e94\u4fdd\u6301\u4f4e\u6247\u5165.")),(0,r.kt)("h3",{id:"\u8026\u5408\u5ea6"},"\u8026\u5408\u5ea6"),(0,r.kt)("h4",{id:"\u5185\u5bb9\u8026\u5408"},"\u5185\u5bb9\u8026\u5408"),(0,r.kt)("p",null,"5 \u7ea7\u8026\u5408\u5ea6:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"O.property = 'tazimi';\nO.method = function () {};\nO.prototype.method = function () {};\n")),(0,r.kt)("h4",{id:"\u516c\u5171\u8026\u5408"},"\u516c\u5171\u8026\u5408"),(0,r.kt)("p",null,"4 \u7ea7\u8026\u5408\u5ea6, \u5171\u4eab\u5168\u5c40\u53d8\u91cf:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"let Global = 'global';\n\nfunction A() {\n  Global = 'A';\n}\nfunction B() {\n  Global = 'B';\n}\n")),(0,r.kt)("h4",{id:"\u63a7\u5236\u8026\u5408"},"\u63a7\u5236\u8026\u5408"),(0,r.kt)("p",null,"3 \u7ea7\u8026\u5408\u5ea6:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const absFactory = new AbstractFactory({ env: 'TEST' });\n")),(0,r.kt)("h4",{id:"\u5370\u8bb0\u8026\u5408"},"\u5370\u8bb0\u8026\u5408"),(0,r.kt)("p",null,"2 \u7ea7\u8026\u5408\u5ea6:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"O.prototype.makeBread = function (args) {\n  return new Bread(args.type, args.size);\n};\n\nO.makeBread({ type: wheat, size: 99, name: 'foo' });\n")),(0,r.kt)("h4",{id:"\u6570\u636e\u8026\u5408"},"\u6570\u636e\u8026\u5408"),(0,r.kt)("p",null,"1 \u7ea7\u8026\u5408\u5ea6."),(0,r.kt)("h4",{id:"\u65e0\u8026\u5408"},"\u65e0\u8026\u5408"),(0,r.kt)("p",null,"0 \u7ea7\u8026\u5408\u5ea6."),(0,r.kt)("h3",{id:"unit-testing"},"Unit Testing"),(0,r.kt)("h4",{id:"unit-testing-principles"},"Unit Testing Principles"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u4ee3\u7801\u8986\u76d6\u7387."),(0,r.kt)("li",{parentName:"ul"},"\u975e\u6cd5\u503c\u6d4b\u8bd5."),(0,r.kt)("li",{parentName:"ul"},"\u8fb9\u754c\u6d4b\u8bd5."),(0,r.kt)("li",{parentName:"ul"},"\u975e\u8fb9\u754c\u6d4b\u8bd5.")),(0,r.kt)("h4",{id:"testing-code-isolation"},"Testing Code Isolation"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u7f16\u5199\u4ee3\u7801\u65f6, \u4fdd\u6301\u6700\u5c0f\u590d\u6742\u5ea6(\u6700\u5c0f\u4f9d\u8d56, \u6700\u4f4e\u8026\u5408)."),(0,r.kt)("li",{parentName:"ul"},"\u5229\u7528 mock/stub \u6a21\u62df\u5916\u90e8\u4f9d\u8d56/\u6d4b\u8bd5\u6570\u636e.")),(0,r.kt)("h4",{id:"mock-testing"},"Mock Testing"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"mock: \u6a21\u62df\u5bf9\u8c61\u4e2d\u7684\u65b9\u6cd5/\u63a5\u53e3"),(0,r.kt)("li",{parentName:"ul"},"stub: \u6a21\u62df\u5bf9\u8c61\u4e2d\u7684\u8fd4\u56de\u503c"),(0,r.kt)("li",{parentName:"ul"},"spy: \u5728\u539f\u6709\u5bf9\u8c61\u7684\u57fa\u7840\u4e0a, \u589e\u52a0\u76d1\u89c6\u7528\u53d8\u91cf/\u65b9\u6cd5 e.g assert/\u8c03\u7528\u6b21\u6570/\u53c2\u6570\u9650\u5236")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const mockery = require('mockery');\nmockery.enable();\n\ndescribe('Sum suite File', function () {\n  beforeEach(function () {\n    mockery.registerAllowable('./mySumFS', true);\n  });\n\n  afterEach(function () {\n    mockery.deregisterAllowable('./mySumFS');\n  });\n\n  it('Adds Integers!', function () {\n    const filename = 'numbers';\n    const fsMock = {\n      readFileSync(path, encoding) {\n        expect(path).toEqual(filename);\n        expect(encoding).toEqual('utf8');\n        return JSON.stringify({ a: 9, b: 3 });\n      },\n    };\n\n    mockery.registerMock('fs', fsMock);\n    const mySum = require('./mySumFS');\n    expect(mySum.sum(filename)).toEqual(12);\n    mockery.deregisterMock('fs');\n  });\n});\n")),(0,r.kt)("h3",{id:"monkey-patch"},"Monkey Patch"),(0,r.kt)("h4",{id:"window-state-injection"},"Window State Injection"),(0,r.kt)("p",null,"Inject trace function (log, monitor, report service)\nto window ",(0,r.kt)("inlineCode",{parentName:"p"},"pushState")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"replaceState"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const _wr = function (type) {\n  const orig = window.history[type];\n\n  return function (...args) {\n    const rv = orig.apply(this, args);\n    const e = new Event(type.toLowerCase());\n    e.arguments = args;\n    window.dispatchEvent(e);\n    return rv;\n  };\n};\n\nwindow.history.pushState = _wr('pushState');\nwindow.history.replaceState = _wr('replaceState');\n\nwindow.addEventListener('pushstate', function (event) {\n  console.trace('pushState');\n});\n\nwindow.addEventListener('replacestate', function (event) {\n  console.trace('replaceState');\n});\n")),(0,r.kt)("h4",{id:"event-propagation-injection"},"Event Propagation Injection"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const originalStopPropagation = MouseEvent.prototype.stopPropagation;\n\nMouseEvent.prototype.stopPropagation = function (...args) {\n  console.trace('stopPropagation');\n  originalStopPropagation.call(this, ...args);\n};\n")),(0,r.kt)("h4",{id:"window-scroll-injection"},"Window Scroll Injection"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"let originalScrollTop = element.scrollTop;\n\nObject.defineProperty(element, 'scrollTop', {\n  get() {\n    return originalScrollTop;\n  },\n  set(newVal) {\n    console.trace('scrollTop');\n    originalScrollTop = newVal;\n  },\n});\n")),(0,r.kt)("h3",{id:"console-api"},"Console API"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"console.XXX"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"copy"),": copy complex object to clipboard."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"monitor"),": monitor object.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const devtools = /./;\ndevtools.toString = function () {\n  this.opened = true;\n};\n\nconsole.log('%c', devtools);\n// devtools.opened will become true if/when the console is opened\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// Basic console functions\nconsole.assert();\nconsole.clear();\nconsole.log();\nconsole.debug();\nconsole.info();\nconsole.warn();\nconsole.error();\n\n// Different output styles\nconsole.dir();\nconsole.dirxml();\nconsole.table();\nconsole.group();\nconsole.groupCollapsed();\nconsole.groupEnd();\n\n// Trace console functions\nconsole.trace();\nconsole.count();\nconsole.countReset();\nconsole.time();\nconsole.timeEnd();\nconsole.timeLog();\n\n// Non-standard console functions\nconsole.profile();\nconsole.profileEnd();\nconsole.timeStamp();\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"console.log")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// `sprinf` style log\nconsole.log('%d %o %s', integer, object, string);\nconsole.log('%c ...', 'css style');\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"console.table")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// display array of object (tabular data)\nconst transactions = [\n  {\n    id: '7cb1-e041b126-f3b8',\n    seller: 'WAL0412',\n    buyer: 'WAL3023',\n    price: 203450,\n    time: 1539688433,\n  },\n  {\n    id: '1d4c-31f8f14b-1571',\n    seller: 'WAL0452',\n    buyer: 'WAL3023',\n    price: 348299,\n    time: 1539688433,\n  },\n  {\n    id: 'b12c-b3adf58f-809f',\n    seller: 'WAL0012',\n    buyer: 'WAL2025',\n    price: 59240,\n    time: 1539688433,\n  },\n];\n\nconsole.table(data, ['id', 'price']);\n")),(0,r.kt)("h3",{id:"javascript-testing-and-tracing-api"},"JavaScript Testing and Tracing API"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"debugger"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// debugger;\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"copy(obj); // to clipboard\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"window.onerror = function (errorMessage, scriptURI, lineNo, columnNo, error) {\n  console.log(`errorMessage: ${errorMessage}`); // \u5f02\u5e38\u4fe1\u606f\n  console.log(`scriptURI: ${scriptURI}`); // \u5f02\u5e38\u6587\u4ef6\u8def\u5f84\n  console.log(`lineNo: ${lineNo}`); // \u5f02\u5e38\u884c\u53f7\n  console.log(`columnNo: ${columnNo}`); // \u5f02\u5e38\u5217\u53f7\n  console.log(`error: ${error}`); // \u5f02\u5e38\u5806\u6808\u4fe1\u606f\n  // ...\n  // \u5f02\u5e38\u4e0a\u62a5\n};\n\nwindow.addEventListener('error', function () {\n  console.log(error);\n  // ...\n  // \u5f02\u5e38\u4e0a\u62a5\n});\n")),(0,r.kt)("h4",{id:"trace-property"},"Trace Property"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const traceProperty = (object, property) => {\n  let value = object[property];\n  Object.defineProperty(object, property, {\n    get() {\n      console.trace(`${property} requested`);\n      return value;\n    },\n    set(newValue) {\n      console.trace(`setting ${property} to `, newValue);\n      value = newValue;\n    },\n  });\n};\n")),(0,r.kt)("h3",{id:"node-testing-api"},"Node Testing API"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"node --inspect"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/GoogleChromeLabs/ndb"},"ndb"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"node --inspect\nndb index.js\n")),(0,r.kt)("h2",{id:"jest-testing"},"Jest Testing"),(0,r.kt)("h3",{id:"jest-installation"},"Jest Installation"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npm i -D jest ts-jest @types/jest react-test-renderer\n")),(0,r.kt)("h3",{id:"jest-configuration"},"Jest Configuration"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"jest.config.js"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const { pathsToModuleNameMapper } = require('ts-jest/utils');\nconst { compilerOptions } = require('./tsconfig.json');\nconst paths = pathsToModuleNameMapper(compilerOptions.paths, {\n  prefix: '<rootDir>/',\n});\n\n/** @type {import('ts-jest/dist/types').InitialOptionsTsJest} */\nmodule.exports = {\n  roots: ['<rootDir>/src'],\n  collectCoverage: true,\n  coverageDirectory: 'coverage',\n  transform: {\n    '^.+\\\\.jsx?$': '<rootDir>/jest.transformer.js',\n    '^.+\\\\.tsx?$': 'ts-jest',\n  },\n  transformIgnorePatterns: ['node_modules/(?!(gatsby)/)'],\n  moduleFileExtensions: ['ts', 'tsx', 'js', 'jsx', 'json', 'node'],\n  moduleNameMapper: {\n    '.+\\\\.(css|styl|less|sass|scss)$': 'identity-obj-proxy',\n    '.+\\\\.(jpg|jpeg|png|gif|eot|otf|webp|svg|ttf|woff|woff2|mp4|webm|wav|mp3|m4a|aac|oga)$':\n      '<rootDir>/__mocks__/jest.mock.js',\n    ...paths,\n    '^@components/(.*)$': '<rootDir>/src/components/$1',\n    '^@hooks/(.*)$': '<rootDir>/src/hooks/$1',\n    '^@layouts/(.*)$': '<rootDir>/src/layouts/$1',\n    '^@types/(.*)$': '<rootDir>/src/types/$1',\n  },\n  testPathIgnorePatterns: ['node_modules', '\\\\.cache', '<rootDir>.*/build'],\n  testRegex: '(/__tests__/.*|(\\\\.|/)(test|spec))\\\\.(jsx?|tsx?)$',\n  globals: {\n    window: {},\n    'ts-jest': {\n      tsConfig: './tsconfig.json',\n    },\n  },\n  testURL: 'http://localhost',\n  testEnvironment: 'jsdom',\n  setupFiles: ['<rootDir>/jest.env.setup.js'],\n  setupFilesAfterEnv: ['<rootDir>/jest.setup.js'],\n  setupTestFrameworkScriptFile: '<rootDir>/src/setupEnzyme.ts',\n};\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"jest.env.setup.js"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import path from 'path';\nimport dotenv from 'dotenv';\n\nconsole.log(`============ env-setup Loaded ===========`);\ndotenv.config({\n  path: path.resolve(process.cwd(), 'tests', 'settings', '.test.env'),\n});\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"jest.setup.js"),":"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Mock missing JSDOM functions."),(0,r.kt)("li",{parentName:"ul"},"Inject more expect DOM assertion."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/testing-library/jest-dom"},"Jest DOM Expect API"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import '@testing-library/jest-dom/extend-expect';\n\n// Global/Window object Stubs for Jest\nwindow.matchMedia =\n  window.matchMedia ||\n  function () {\n    return {\n      matches: false,\n      addListener() {},\n      removeListener() {},\n    };\n  };\n\nObject.defineProperty(window, 'matchMedia', {\n  writable: true,\n  value: jest.fn().mockImplementation(query => ({\n    matches: false,\n    media: query,\n    onchange: null,\n    addListener: jest.fn(), // deprecated\n    removeListener: jest.fn(), // deprecated\n    addEventListener: jest.fn(),\n    removeEventListener: jest.fn(),\n    dispatchEvent: jest.fn(),\n  })),\n});\n\nwindow.requestAnimationFrame = function (callback) {\n  setTimeout(callback);\n};\n\nwindow.cancelAnimationFrame = window.clearTimeout;\n\nwindow.localStorage = {\n  getItem() {},\n  setItem() {},\n};\n\nObject.values = () => [];\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"setupEnzyme.ts"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import { configure } from 'enzyme';\nimport * as EnzymeAdapter from 'enzyme-adapter-react-16';\n\nconfigure({ adapter: new EnzymeAdapter() });\n")),(0,r.kt)("h3",{id:"jest-basic-testing"},"Jest Basic Testing"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"describe")," block."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"test")," statement."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"it")," statement."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"test.todo"),":",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Skip empty todo tests."),(0,r.kt)("li",{parentName:"ul"},"Skip temporary broken tests.")))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"import * as React from 'react';\nimport { shallow } from 'enzyme';\nimport { Checkbox } from './Checkbox';\n\ndescribe('Checkbox should', () => {\n  test('changes the text after click', () => {\n    const checkbox = shallow(<Checkbox labelOn=\"On\" labelOff=\"Off\" />);\n    expect(checkbox.text()).toEqual('Off');\n    checkbox.find('input').simulate('change');\n    expect(checkbox.text()).toEqual('On');\n  });\n});\n")),(0,r.kt)("h3",{id:"jest-snapshot-testing"},"Jest Snapshot Testing"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"When you run jest first time,\nit will produce an snapshot file."),(0,r.kt)("li",{parentName:"ul"},"The next time run the tests,\nrendered output will be compared to previously created snapshot."),(0,r.kt)("li",{parentName:"ul"},"If change is expected,\nuse ",(0,r.kt)("inlineCode",{parentName:"li"},"jest -u")," to overwrite existing snapshot.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"// Link.react.test.js\nimport React from 'react';\nimport renderer from 'react-test-renderer';\nimport Link from '@components/Link';\n\ndescribe('Link should', () => {\n  test('changes the class when hovered', () => {\n    const component = renderer.create(\n      <Link page=\"http://www.facebook.com\">Facebook</Link>\n    );\n\n    let tree = component.toJSON();\n    expect(tree).toMatchSnapshot();\n\n    // manually trigger the callback\n    tree.props.onMouseEnter();\n    // re-rendering\n    tree = component.toJSON();\n    expect(tree).toMatchSnapshot();\n\n    // manually trigger the callback\n    tree.props.onMouseLeave();\n    // re-rendering\n    tree = component.toJSON();\n    expect(tree).toMatchSnapshot();\n  });\n});\n")),(0,r.kt)("h3",{id:"jest-async-testing"},"Jest Async Testing"),(0,r.kt)("p",null,"Jest async ",(0,r.kt)("a",{parentName:"p",href:"https://jestjs.io/docs/tutorial-async"},"guide"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"await expect(asyncCall()).resolves.toEqual('Expected');\nawait expect(asyncCall()).rejects.toThrowError();\n")),(0,r.kt)("h3",{id:"jest-mocks"},"Jest Mocks"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"__mocks__"),":"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"jest.createMockFromModule('moduleName')"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"jest.requireActual('moduleName')"),".")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"// react-dom.js\nimport React from 'react';\nconst reactDom = jest.requireActual('react-dom');\n\nfunction mockCreatePortal(element, target) {\n  return (\n    <div>\n      <div id=\"content\">{element}</div>\n      <div id=\"target\" data-target-tag-name={target.tagName}></div>\n    </div>\n  );\n}\n\nreactDom.createPortal = mockCreatePortal;\n\nmodule.exports = reactDom;\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// gatsby.js\nimport React from 'react';\nconst gatsby = jest.requireActual('gatsby');\n\nmodule.exports = {\n  ...gatsby,\n  graphql: jest.fn(),\n  Link: jest\n    .fn()\n    .mockImplementation(\n      ({\n        activeClassName,\n        activeStyle,\n        getProps,\n        innerRef,\n        partiallyActive,\n        ref,\n        replace,\n        to,\n        ...rest\n      }) =>\n        React.createElement('a', {\n          ...rest,\n          href: to,\n        })\n    ),\n  StaticQuery: jest.fn(),\n  useStaticQuery: jest.fn(),\n};\n")),(0,r.kt)("h3",{id:"jest-internals"},"Jest Internals"),(0,r.kt)("p",null,"Running tests in\n",(0,r.kt)("a",{parentName:"p",href:"https://2ality.com/2022/04/shadow-realms.html#use-cases-for-shadowrealms"},(0,r.kt)("inlineCode",{parentName:"a"},"ShadowRealms")),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// demo.test.js\nimport { test } from './TestLib.js';\n\ntest('succeeds', () => {\n  assert.equal(3, 3);\n});\n\ntest('fails', () => {\n  assert.equal(1, 3);\n});\n\n// This statement can add by `babel`.\n// eslint-disable-next-line import/no-anonymous-default-export\nexport default true;\n\n// TestLib.js\nconst testSuites = [];\n\nexport function test(description, callback) {\n  testSuites.push({ description, callback });\n}\n\nexport function runTests() {\n  const testResults = [];\n\n  for (const testSuite of testSuites) {\n    try {\n      testSuite.callback();\n      testResults.push(`${testSuite.description}: OK\\n`);\n    } catch (err) {\n      testResults.push(`${testSuite.description}: ${err}\\n`);\n    }\n  }\n\n  return testResults.join('');\n}\n\n// TestRunner.js\nasync function runTestModule(moduleSpecifier) {\n  const sr = new ShadowRealm();\n  await sr.importValue(moduleSpecifier, 'default');\n  const runTests = await sr.importValue('./TestLib.js', 'runTests');\n  const result = runTests();\n  console.log(result);\n}\n\nawait runTestModule('./demo.test.js');\n")),(0,r.kt)("p",null,"A simple\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/typicode/xv"},"test runner"),"\nimplementation:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import { promises as fs } from 'fs';\nimport { basename, dirname, join } from 'path';\nimport { pathToFileURL } from 'url';\n\nasync function* walk(dir: string): AsyncGenerator<string> {\n  for await (const d of await fs.opendir(dir)) {\n    const entry = join(dir, d.name);\n\n    if (d.isDirectory()) {\n      yield* walk(entry);\n    } else if (d.isFile()) {\n      yield entry;\n    }\n  }\n}\n\nasync function runTestFile(file: string): Promise<void> {\n  for (const value of Object.values(\n    await import(pathToFileURL(file).toString())\n  )) {\n    if (typeof value === 'function') {\n      try {\n        await value();\n      } catch (e) {\n        console.error(e instanceof Error ? e.stack : e);\n        process.exit(1);\n      }\n    }\n  }\n}\n\nasync function run(arg = '.') {\n  if ((await fs.lstat(arg)).isFile()) {\n    return runTestFile(arg);\n  }\n\n  for await (const file of walk(arg)) {\n    if (\n      !dirname(file).includes('node_modules') &&\n      (basename(file) === 'test.js' || file.endsWith('.test.js'))\n    ) {\n      console.log(file);\n      await runTestFile(file);\n    }\n  }\n}\n\nrun(process.argv[2]);\n")),(0,r.kt)("h2",{id:"e2e-testing"},"E2E Testing"),(0,r.kt)("p",null,"When it comes to test heavy visual features,\n(e.g fixed navigation based on window scroll event),\nE2E testing helps a lot."),(0,r.kt)("h3",{id:"cypress-installation"},"Cypress Installation"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"mkdir e2e\ncd e2e\nnpm init -y\nnpm install cypress webpack @cypress/webpack-preprocessor typescript ts-loader\nnpx cypress open\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"cypress open")," will initialize the cypress folder structure for us."),(0,r.kt)("h3",{id:"cypress-configuration"},"Cypress Configuration"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"e2e/plugins/index.js"),": setup TypeScript to transpile tests:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const wp = require('@cypress/webpack-preprocessor');\n\nmodule.exports = on => {\n  const options = {\n    webpackOptions: {\n      resolve: {\n        extensions: ['.ts', '.tsx', '.js', '.jsx'],\n      },\n      module: {\n        rules: [\n          {\n            test: /\\.tsx?$/,\n            loader: 'ts-loader',\n            options: { transpileOnly: true },\n          },\n        ],\n      },\n    },\n  };\n\n  on('file:preprocessor', wp(options));\n};\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"e2e/tsconfig.json"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "compilerOptions": {\n    "strict": true,\n    "sourceMap": true,\n    "module": "commonjs",\n    "target": "es5",\n    "lib": ["DOM", "ES6"],\n    "jsx": "react",\n    "experimentalDecorators": true\n  },\n  "compileOnSave": false\n}\n')),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"e2e/package.json"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "scripts": {\n    "cypress:open": "cypress open",\n    "cypress:run": "cypress run"\n  }\n}\n')),(0,r.kt)("h3",{id:"basic-cypress-testing"},"Basic Cypress Testing"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"support/commands.ts"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import '@testing-library/cypress/add-commands';\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"integration/component.spec.ts"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"/// <reference types=\"cypress\"/>\n\ndescribe('component', () => {\n  it('should work', () => {\n    cy.visit('http://localhost:8000');\n    cy.get('#onOff')\n      .should('have.text', 'off')\n      .click()\n      .should('have.text', 'on');\n  });\n});\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"integration/payment.spec.ts"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import { v4 as uuid } from 'uuid';\n\ndescribe('payment', () => {\n  it('user can make payment', () => {\n    //  Login.\n    cy.visit('/');\n    cy.findByRole('textbox', { name: /username/i }).type('sabertaz');\n    cy.findByLabelText(/password/i).type('secret');\n    cy.findByRole('checkbox', { name: /remember me/i }).check();\n    cy.findByRole('button', { name: /sign in/i }).click();\n\n    // Check account balance.\n    let oldBalance;\n    cy.get('[data-test=nav-user-balance]').then(\n      $balance => (oldBalance = $balance.text())\n    );\n\n    // Click on new button.\n    cy.findByRole('button', { name: /new/i }).click();\n\n    // Search for user.\n    cy.findByRole('textbox').type('devon becker');\n    cy.findByText(/devon becker/i).click();\n\n    // Add amount and note and click pay.\n    const paymentAmount = '5.00';\n    cy.findByPlaceholderText(/amount/i).type(paymentAmount);\n    const note = uuid();\n    cy.findByPlaceholderText(/add a note/i).type(note);\n    cy.findByRole('button', { name: /pay/i }).click();\n\n    // Return to transactions.\n    cy.findByRole('button', { name: /return to transactions/i }).click();\n\n    // Go to personal payments.\n    cy.findByRole('tab', { name: /mine/i }).click();\n\n    // Click on payment.\n    cy.findByText(note).click({ force: true });\n\n    // Verify if payment was made.\n    cy.findByText(`-$${paymentAmount}`).should('be.visible');\n    cy.findByText(note).should('be.visible');\n\n    // Verify if payment amount was deducted.\n    cy.get('[data-test=nav-user-balance]').then($balance => {\n      const convertedOldBalance = parseFloat(oldBalance.replace(/\\$|,/g, ''));\n      const convertedNewBalance = parseFloat(\n        $balance.text().replace(/\\$|,/g, '')\n      );\n      expect(convertedOldBalance - convertedNewBalance).to.equal(\n        parseFloat(paymentAmount)\n      );\n    });\n  });\n});\n")),(0,r.kt)("h3",{id:"cypress-reference"},"Cypress Reference"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Cypress official ",(0,r.kt)("a",{parentName:"li",href:"https://learn.cypress.io"},"guide"),"."),(0,r.kt)("li",{parentName:"ul"},"Blank page testing ",(0,r.kt)("a",{parentName:"li",href:"https://glebbahmutov.com/blog/visit-blank-page-between-tests"},"example"),"."),(0,r.kt)("li",{parentName:"ul"},"Cypress CI ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/cypress-io/github-action"},"action"),".")),(0,r.kt)("h2",{id:"chrome-devtools"},"Chrome DevTools"),(0,r.kt)("h3",{id:"devtools-detection"},"DevTools Detection"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/546669204/fuck-debugger-extensions"},"DevTools detection guide"))),(0,r.kt)("h4",{id:"console-devtools-detection"},"Console DevTools Detection"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const x = document.createElement('div');\n\nObject.defineProperty(x, 'id', {\n  get() {\n    // devtool opened.\n    return 'id';\n  },\n});\n\nconsole.log(x);\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// eslint-disable-next-line prefer-regex-literals\nconst c = new RegExp('1');\n\nc.toString = function () {\n  // devtool opened\n};\n\nconsole.log(c);\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Anti Method: hook ",(0,r.kt)("inlineCode",{parentName:"p"},"console")," object, disable all outputs.")),(0,r.kt)("h4",{id:"debugger-detection"},"Debugger Detection"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"(function () {}.constructor('debugger')());\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"(() => {\n  function block() {\n    if (\n      window.outerHeight - window.innerHeight > 200 ||\n      window.outerWidth - window.innerWidth > 200\n    ) {\n      document.body.innerHTML = 'Debug detected, please reload page!';\n    }\n\n    setInterval(() => {\n      (function () {\n        return false;\n      }\n        .constructor('debugger')\n        .call());\n    }, 50);\n  }\n\n  try {\n    block();\n  } catch (err) {}\n})();\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const startTime = new Date();\n// debugger;\nconst endTime = new Date();\nconst isDev = endTime - startTime > 100;\n\nwhile (true) {\n  // debugger;\n}\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Anti Method: use chrome protocol to block all ",(0,r.kt)("inlineCode",{parentName:"p"},"debugger")," request.\nAnti Method: hook ",(0,r.kt)("inlineCode",{parentName:"p"},"Function.prototype.constructor")," and replace ",(0,r.kt)("inlineCode",{parentName:"p"},"debugger")," string.")),(0,r.kt)("h3",{id:"chrome-devtools-shortcuts"},"Chrome DevTools Shortcuts"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"c-d: go to next word"),(0,r.kt)("li",{parentName:"ul"},"c-f in ",(0,r.kt)("inlineCode",{parentName:"li"},"Elements")," panel: search DOM node"),(0,r.kt)("li",{parentName:"ul"},"c-m: go to next bracket"),(0,r.kt)("li",{parentName:"ul"},"c-p: go to files"),(0,r.kt)("li",{parentName:"ul"},"cs-p: go to anywhere"),(0,r.kt)("li",{parentName:"ul"},"cs-o: go to functions")),(0,r.kt)("p",null,"long click reload: multiple reload options e.g clean cache"),(0,r.kt)("h3",{id:"elements-panel"},"Elements Panel"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Break on elements."),(0,r.kt)("li",{parentName:"ul"},"Inspect elements a11y.")),(0,r.kt)("h4",{id:"style-tab"},"Style Tab"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"color picker"),(0,r.kt)("li",{parentName:"ul"},"filter: class filter, pseudo filter, css style filter")),(0,r.kt)("h3",{id:"console-panel"},"Console Panel"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"getEventListeners(dom)"),(0,r.kt)("li",{parentName:"ul"},"monitorEvents(dom, events)"),(0,r.kt)("li",{parentName:"ul"},"unmonitorEvents(dom)"),(0,r.kt)("li",{parentName:"ul"},"debug(fn)"),(0,r.kt)("li",{parentName:"ul"},"undebug(fn)"),(0,r.kt)("li",{parentName:"ul"},"monitor(fn)"),(0,r.kt)("li",{parentName:"ul"},"unmonitor(fn)")),(0,r.kt)("h4",{id:"console-settings"},"Console Settings"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"preserve log"),(0,r.kt)("li",{parentName:"ul"},"show timestamps"),(0,r.kt)("li",{parentName:"ul"},"Verbose: additional performance log"),(0,r.kt)("li",{parentName:"ul"},"click filename, filter error messages"),(0,r.kt)("li",{parentName:"ul"},"add folder to workspace")),(0,r.kt)("h4",{id:"capture-default-event-listener"},"Capture Default Event Listener"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"$0"),": the reference to the currently selected element in the Elements panel."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const listener = getEventListeners($0).click[0].listener;\n$0.removeEventListener('click', listener);\n$0.addEventListener('click', e => {\n  // do something\n  // ...\n\n  // then\n  listener(e);\n});\n")),(0,r.kt)("h3",{id:"source-panel"},"Source Panel"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Add log points."),(0,r.kt)("li",{parentName:"ul"},"Multiple breakpoints: source, XHR/fetch, DOM, global/event listeners."),(0,r.kt)("li",{parentName:"ul"},"Open a source file, right click code, ",(0,r.kt)("inlineCode",{parentName:"li"},"Blackbox script")," item."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://developers.google.com/web/updates/2018/01/devtools#overrides"},"Local Overrides"),"\nfor persistent changes to css styles.")),(0,r.kt)("p",null,"Same thing in ",(0,r.kt)("inlineCode",{parentName:"p"},"VSCode")," debug panel (log points, break points etc)."),(0,r.kt)("h3",{id:"network-panel"},"Network Panel"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"throttling: simulate different network environment."),(0,r.kt)("li",{parentName:"ul"},"initiator: go to files.")),(0,r.kt)("h3",{id:"performance-panel"},"Performance Panel"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"C+S+P"),": performance monitor."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"C+S+P"),": FPS."),(0,r.kt)("li",{parentName:"ul"},"Performance tips."),(0,r.kt)("li",{parentName:"ul"},"Memory panel."),(0,r.kt)("li",{parentName:"ul"},"Timeline events: ",(0,r.kt)("inlineCode",{parentName:"li"},"script -> style -> layout -> paint -> composite"),"."),(0,r.kt)("li",{parentName:"ul"},"Timeline events ",(0,r.kt)("a",{parentName:"li",href:"https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/performance-reference"},"reference"),"."),(0,r.kt)("li",{parentName:"ul"},"Performance analysis ",(0,r.kt)("a",{parentName:"li",href:"https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/reference"},"reference"),"."),(0,r.kt)("li",{parentName:"ul"},"Performance tools ",(0,r.kt)("a",{parentName:"li",href:"https://zhuanlan.zhihu.com/p/41017888"},"guide"),".")),(0,r.kt)("h3",{id:"simulation-devtools"},"Simulation DevTools"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"cs-p: type ",(0,r.kt)("inlineCode",{parentName:"li"},"3G")," (slow network)"),(0,r.kt)("li",{parentName:"ul"},"cs-p: type ",(0,r.kt)("inlineCode",{parentName:"li"},"sensor")," (geolocation)")),(0,r.kt)("h3",{id:"audit-devtool"},"Audit DevTool"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"cs-p: type ",(0,r.kt)("inlineCode",{parentName:"li"},"audit"))),(0,r.kt)("h3",{id:"coverage-tool"},"Coverage Tool"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"cs-p: type ",(0,r.kt)("inlineCode",{parentName:"li"},"coverage")),(0,r.kt)("li",{parentName:"ul"},"Use to eliminate ",(0,r.kt)("strong",{parentName:"li"},"unused")," CSS/JS code.")),(0,r.kt)("h3",{id:"memory-panel"},"Memory Panel"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Heap snapshot")),(0,r.kt)("h3",{id:"js-profiler-panel"},"JS Profiler Panel"),(0,r.kt)("h3",{id:"layer-panel"},"Layer Panel"),(0,r.kt)("p",null,"Tool for composite stage analysis:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"layers")),(0,r.kt)("h3",{id:"rendering-panel"},"Rendering Panel"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"re-paint area"),(0,r.kt)("li",{parentName:"ul"},"FPS monitor"),(0,r.kt)("li",{parentName:"ul"},"scroll event"),(0,r.kt)("li",{parentName:"ul"},"paint flashing"),(0,r.kt)("li",{parentName:"ul"},"layout/layer border")),(0,r.kt)("h3",{id:"animation-panel"},"Animation Panel"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"animations")),(0,r.kt)("h2",{id:"javascript-style-guide"},"JavaScript Style Guide"),(0,r.kt)("h3",{id:"eslint"},"ESLint"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/xjamundx/eslint-plugin-promise"},"ESLint Promise")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/import-js/eslint-plugin-import"},"ESLint Import")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/sindresorhus/eslint-plugin-unicorn"},"ESLint Unicorn")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/jsx-eslint/eslint-plugin-jsx-a11y"},"ESLint JSX A11Y")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/nodesecurity/eslint-plugin-security"},"ESLint Node Security")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/alexgorbatchev/eslint-import-resolver-typescript"},"ESLint TypeScript Import Resolver"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "env": {\n    "browser": true,\n    "es2021": true,\n    "node": true,\n    "jest": true\n  },\n  "extends": [\n    "eslint:recommended",\n    "plugin:import/recommended",\n    "plugin:jsx-a11y/recommended",\n    "plugin:react/recommended",\n    "plugin:react-hooks/recommended",\n    "plugin:unicorn/recommended",\n    "plugin:promise/recommended",\n    "plugin:@typescript-eslint/recommended",\n    "plugin:prettier/recommended"\n  ],\n  "parser": "@typescript-eslint/parser",\n  "parserOptions": {\n    "ecmaFeatures": {\n      "jsx": true\n    },\n    "ecmaVersion": 12,\n    "sourceType": "module"\n  },\n  "plugins": [\n    "import",\n    "jsx-a11y",\n    "react",\n    "react-hooks",\n    "@typescript-eslint"\n  ],\n  "settings": {\n    "react": {\n      "version": "detect"\n    },\n    "import/parsers": {\n      "@typescript-eslint/parser": [".ts", ".tsx"]\n    },\n    "import/resolver": {\n      "typescript": {\n        "alwaysTryTypes": true,\n        "project": "./"\n      }\n    }\n  },\n  "rules": {\n    "react/prop-types": 0,\n    "react/jsx-props-no-spreading": 0\n  }\n}\n')),(0,r.kt)("h3",{id:"naming-style"},"Naming Style"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u53d8\u91cf: \u540d\u8bcd\u524d\u7f00."),(0,r.kt)("li",{parentName:"ul"},"\u65b9\u6cd5 / \u51fd\u6570: \u52a8\u8bcd\u524d\u7f00."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"_method"),": \u8868\u793a\u79c1\u6709\u5316\u65b9\u6cd5."),(0,r.kt)("li",{parentName:"ul"},"\u666e\u901a\u51fd\u6570: \u9a7c\u5cf0\u547d\u540d\u6cd5 (camelCase)."),(0,r.kt)("li",{parentName:"ul"},"\u6784\u9020\u51fd\u6570: \u5e15\u65af\u5361\u547d\u540d\u6cd5 (PascalCase)."),(0,r.kt)("li",{parentName:"ul"},"\u7f29\u7565\u8bcd\u548c\u7f29\u5199\u90fd\u5fc5\u987b\u662f\u5168\u90e8\u5927\u5199 / \u5c0f\u5199."),(0,r.kt)("li",{parentName:"ul"},"\u5bf9\u4e8e ",(0,r.kt)("inlineCode",{parentName:"li"},"jQuery")," \u5bf9\u8c61\u7684\u53d8\u91cf\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"li"},"$")," \u4f5c\u4e3a\u524d\u7f00.")),(0,r.kt)("h3",{id:"variable-style"},"Variable Style"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"No single ",(0,r.kt)("inlineCode",{parentName:"li"},"let/const")," for multiple variables."),(0,r.kt)("li",{parentName:"ul"},"Sort ",(0,r.kt)("inlineCode",{parentName:"li"},"let/const"),"."),(0,r.kt)("li",{parentName:"ul"},"No chains assignment (create implicit global variable)."),(0,r.kt)("li",{parentName:"ul"},"Prefer ",(0,r.kt)("inlineCode",{parentName:"li"},"()")," wrap multiple line.")),(0,r.kt)("h3",{id:"object-style"},"Object Style"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Prefer literal not ",(0,r.kt)("inlineCode",{parentName:"li"},"Object()")," constructor."),(0,r.kt)("li",{parentName:"ul"},"Prefer object-shorthand."),(0,r.kt)("li",{parentName:"ul"},"Prefer ",(0,r.kt)("inlineCode",{parentName:"li"},"Object.prototype.XX")," not ",(0,r.kt)("inlineCode",{parentName:"li"},"object.xx"),"."),(0,r.kt)("li",{parentName:"ul"},"Prefer object spread (",(0,r.kt)("inlineCode",{parentName:"li"},"..."),") not ",(0,r.kt)("inlineCode",{parentName:"li"},"object.assign"),":")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// very bad\nconst original = { a: 1, b: 2 };\nconst copy = Object.assign(original, { c: 3 }); // \u53d8\u5f02\u7684 `original` \u0ca0_\u0ca0\ndelete copy.a; // \u8fd9....\n\n// bad\nconst original = { a: 1, b: 2 };\nconst copy = Object.assign({}, original, { c: 3 });\n\n// good\nconst original = { a: 1, b: 2 };\nconst copy = { ...original, c: 3 }; // copy => { a: 1, b: 2, c: 3 }\n\nconst { a, ...noA } = copy; // noA => { b: 2, c: 3 }\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Prefer ",(0,r.kt)("inlineCode",{parentName:"li"},".")," for static name, prefer ",(0,r.kt)("inlineCode",{parentName:"li"},"[]")," for variable name:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// good\nconst isJedi = luke.jedi;\n\nfunction getProp(prop) {\n  return luke[prop];\n}\n")),(0,r.kt)("h3",{id:"array-style"},"Array Style"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Prefer literal."),(0,r.kt)("li",{parentName:"ul"},"Prefer ",(0,r.kt)("inlineCode",{parentName:"li"},"push")," not ",(0,r.kt)("inlineCode",{parentName:"li"},"[]"),"."),(0,r.kt)("li",{parentName:"ul"},"Prefer array spread (",(0,r.kt)("inlineCode",{parentName:"li"},"..."),") (best) or ",(0,r.kt)("inlineCode",{parentName:"li"},"Array.from")," (good):")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const foo = document.querySelectorAll('.foo');\n\n// good\nconst nodes = Array.from(foo);\n\n// best\nconst nodes = [...foo];\n")),(0,r.kt)("h3",{id:"destruct-style"},"Destruct Style"),(0,r.kt)("p",null,"\u5bf9\u4e8e\u591a\u4e2a\u8fd4\u56de\u503c\u4f7f\u7528\u5bf9\u8c61\u89e3\u6784, \u800c\u4e0d\u662f\u6570\u7ec4\u89e3\u6784:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// bad\nfunction processInputBad(input) {\n  // \u5904\u7406\u4ee3\u7801...\n  return [left, right, top, bottom];\n}\n\n// \u8c03\u7528\u8005\u9700\u8981\u8003\u8651\u8fd4\u56de\u6570\u636e\u7684\u987a\u5e8f.\nconst [left, __, top] = processInputBad(input);\n\n// good\nfunction processInput(input) {\n  // \u5904\u7406\u4ee3\u7801 ...\n  process();\n\n  return { left, right, top, bottom };\n}\n\n// \u8c03\u7528\u8005\u53ea\u9009\u62e9\u4ed6\u4eec\u9700\u8981\u7684\u6570\u636e.\nconst { left, top } = processInput(input);\n")),(0,r.kt)("h3",{id:"string-style"},"String Style"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Prefer ",(0,r.kt)("inlineCode",{parentName:"li"},"'")," not ",(0,r.kt)("inlineCode",{parentName:"li"},'"'),"."),(0,r.kt)("li",{parentName:"ul"},"Prefer template literals not ",(0,r.kt)("inlineCode",{parentName:"li"},"'str1' + 'str2'"),".")),(0,r.kt)("h3",{id:"function-style"},"Function Style"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"No reassign parameters (implicit side effect and bad performance)."),(0,r.kt)("li",{parentName:"ul"},"Prefer ",(0,r.kt)("inlineCode",{parentName:"li"},"...args")," not ",(0,r.kt)("inlineCode",{parentName:"li"},"arguments"),"."),(0,r.kt)("li",{parentName:"ul"},"Prefer ES6 default parameters not default expression pattern.")),(0,r.kt)("h3",{id:"arrow-function-style"},"Arrow Function Style"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Prefer ",(0,r.kt)("inlineCode",{parentName:"li"},"()")," wrap multiple line return value.")),(0,r.kt)("h3",{id:"module-style"},"Module Style"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"No duplicated export path:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// bad\n// import foo from 'foo';\n// import { named1, named2 } from 'foo';\n\n// good\nimport foo, { named1, named2 } from 'foo';\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"No export ",(0,r.kt)("inlineCode",{parentName:"li"},"let"),":")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// bad\n// let foo = 3;\n// export { foo };\n\n// good\nconst foo = 3;\nexport { foo };\n")),(0,r.kt)("h3",{id:"iterator-and-generator-style"},"Iterator and Generator Style"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"li"},"Object.keys() / Object.values() / Object.entries()")," \u8fed\u4ee3\u5bf9\u8c61\u751f\u6210\u6570\u7ec4."),(0,r.kt)("li",{parentName:"ul"},"\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"li"},"map/reduce/filter/any/every/some/find/findIndex/ ...")," \u904d\u5386\u6570\u7ec4."),(0,r.kt)("li",{parentName:"ul"},"Prefer functional style iterator:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const numbers = [1, 2, 3, 4, 5];\n\n// bad\nlet sum = 0;\nfor (const num of numbers) {\n  // eslint-disable-next-line no-const-assign\n  sum += num;\n}\nconsole.log(sum === 15);\n\n// good\nlet sum = 0;\nnumbers.forEach(num => {\n  // eslint-disable-next-line no-const-assign\n  sum += num;\n});\nconsole.log(sum === 15);\n\n// best (use the functional force)\nconst sum = numbers.reduce((total, num) => total + num, 0);\nconsole.log(sum === 15);\n\n// bad\nconst increasedByOne = [];\nfor (let i = 0; i < numbers.length; i++) {\n  increasedByOne.push(numbers[i] + 1);\n}\n\n// good\nconst increasedByOne = [];\nnumbers.forEach(num => {\n  increasedByOne.push(num + 1);\n});\n\n// best (keeping it functional)\nconst increasedByOne = numbers.map(num => num + 1);\n")),(0,r.kt)("h3",{id:"expression-style"},"Expression Style"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"if")," \u8bed\u53e5\u4f7f\u7528 ToBoolean \u7684\u62bd\u8c61\u65b9\u6cd5\u6765\u8ba1\u7b97\u8868\u8fbe\u5f0f\u7684\u7ed3\u679c:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Object"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"true"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"undefined"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"false"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"null"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"false"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"boolean"),": \u5e03\u5c14\u503c\u7684\u53d6\u503c."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"number"),": \u5982\u679c\u4e3a ",(0,r.kt)("inlineCode",{parentName:"li"},"+0"),"/",(0,r.kt)("inlineCode",{parentName:"li"},"-0"),"/",(0,r.kt)("inlineCode",{parentName:"li"},"NaN")," \u503c\u4e3a ",(0,r.kt)("inlineCode",{parentName:"li"},"false"),", \u5426\u5219\u4e3a ",(0,r.kt)("inlineCode",{parentName:"li"},"true"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"string"),": \u5982\u679c\u662f\u4e00\u4e2a\u7a7a\u5b57\u7b26\u4e32 ",(0,r.kt)("inlineCode",{parentName:"li"},"''")," \u503c\u4e3a ",(0,r.kt)("inlineCode",{parentName:"li"},"false"),", \u5426\u5219\u4e3a ",(0,r.kt)("inlineCode",{parentName:"li"},"true"),".")),(0,r.kt)("p",null,"\u5bf9\u4e8e\u5e03\u5c14\u503c\u4f7f\u7528\u7b80\u5199, \u4f46\u662f\u5bf9\u4e8e\u5b57\u7b26\u4e32\u548c\u6570\u5b57\u8fdb\u884c\u663e\u5f0f\u6bd4\u8f83:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// bad\nif (isValid === true) {\n  // ...\n}\n\n// good\nif (isValid) {\n  // ...\n}\n\n// bad\nif (someName) {\n  // ...\n}\n\n// good\nif (someName !== '') {\n  // ...\n}\n\n// bad\nif (collection.length) {\n  // ...\n}\n\n// good\nif (collection.length > 0) {\n  // ...\n}\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Prefer ",(0,r.kt)("inlineCode",{parentName:"li"},"{}")," warp ",(0,r.kt)("inlineCode",{parentName:"li"},"case")," when exists ",(0,r.kt)("inlineCode",{parentName:"li"},"const"),"/",(0,r.kt)("inlineCode",{parentName:"li"},"let"),"/",(0,r.kt)("inlineCode",{parentName:"li"},"function"),"/",(0,r.kt)("inlineCode",{parentName:"li"},"class")," declaration:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// good\nswitch (foo) {\n  case 1: {\n    const x = 1;\n    break;\n  }\n  case 2: {\n    const y = 2;\n    break;\n  }\n  case 3: {\n    function f() {\n      // ...\n    }\n    break;\n  }\n  case 4:\n    bar();\n    break;\n  default: {\n    class C {}\n  }\n}\n")),(0,r.kt)("h3",{id:"space-style"},"Space Style"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u952e\u5165\u6700\u540e\u4e00\u4e2a\u8fd0\u7b97\u7b26\u540e\u518d\u6362\u884c, \u8fd0\u7b97\u7b26\u7f6e\u4e8e\u884c\u5c3e\u53ef\u4f7f ",(0,r.kt)("inlineCode",{parentName:"li"},"Automatic Semicolon Insertion")," \u673a\u5236\u5931\u6548."),(0,r.kt)("li",{parentName:"ul"},"\u6362\u884c\u540e\u4fdd\u6301 2 \u4e2a\u7f29\u8fdb\u5c42\u6b21."),(0,r.kt)("li",{parentName:"ul"},"Good places to use a white space include:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},","),"/",(0,r.kt)("inlineCode",{parentName:"li"},";")," \u540e."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"+"),",",(0,r.kt)("inlineCode",{parentName:"li"},"-"),",",(0,r.kt)("inlineCode",{parentName:"li"},"*"),",",(0,r.kt)("inlineCode",{parentName:"li"},"/"),",",(0,r.kt)("inlineCode",{parentName:"li"},"<"),",",(0,r.kt)("inlineCode",{parentName:"li"},">"),",",(0,r.kt)("inlineCode",{parentName:"li"},"=")," \u524d\u540e."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"function () {}"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"function foo() {}"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"} if/for/while () {}"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"} else {}"),"."),(0,r.kt)("li",{parentName:"ul"},"inner ",(0,r.kt)("inlineCode",{parentName:"li"},"{}"),"."),(0,r.kt)("li",{parentName:"ul"},"No space inner ",(0,r.kt)("inlineCode",{parentName:"li"},"()")," ",(0,r.kt)("inlineCode",{parentName:"li"},"[]"),".")))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"let d = 0;\nlet a = b + 1;\n\nif (a && b && c) {\n  d = a % c;\n  a += d;\n}\n")),(0,r.kt)("h3",{id:"comments-style"},"Comments Style"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u4e0a\u65b9\u63d2\u5165\u7a7a\u884c."),(0,r.kt)("li",{parentName:"ul"},"\u4e0e\u4e0b\u65b9\u8bed\u53e5\u7edf\u4e00\u7f29\u8fdb.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"/**\n * comments\n * comments\n */\n\n/**\n * @module app\n * @namespace APP\n */\n\n/**\n * @class mathStuff\n */\n\n/**\n * @property propertyName\n * @type {import('@jest/types').Config}\n */\n\n/**\n * @constructor\n * @method sum\n * @param {number} id\n * @param {string} instructions\n * @returns {number} result\n */\n")),(0,r.kt)("h2",{id:"web-animations"},"Web Animations"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"KeyframeEffect"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Animation"),".")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const rabbitDownKeyframes = new KeyframeEffect(\n  whiteRabbit, // element to animate\n  [\n    { transform: 'translateY(0%)' }, // keyframe\n    { transform: 'translateY(100%)' }, // keyframe\n  ],\n  { duration: 3000, fill: 'forwards' } // keyframe options\n);\n\nconst rabbitDownAnimation = new Animation(\n  rabbitDownKeyFrames,\n  document.timeline\n);\n\nwhiteRabbit.addEventListener('click', downHandler);\n\nfunction downHandler() {\n  rabbitDownAnimation.play();\n  whiteRabbit.removeEventListener('click', downHandler);\n}\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"element.animate"),".")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const animationKeyframes = [\n  {\n    transform: 'rotate(0)',\n    color: '#000',\n  },\n  {\n    color: '#431236',\n    offset: 0.3,\n  },\n  {\n    transform: 'rotate(360deg)',\n    color: '#000',\n  },\n];\n\nconst animationTiming = {\n  duration: 3000,\n  iterations: Infinity,\n};\n\nconst animation = document\n  .querySelector('alice')\n  .animate(animationKeyframes, animationTiming);\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"animation.currentTime"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"animation.playState"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"animation.effect"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"animation.pause()/play()/reverse()/finish()/cancel()"),".")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"animation.pause();\nanimation.currentTime = animation.effect.getComputedTiming().duration / 2;\n\nfunction currentTime(time = 0) {\n  animations.forEach(function (animation) {\n    if (typeof animation.currentTime === 'function') {\n      animation.currentTime(time);\n    } else {\n      animation.currentTime = time;\n    }\n  });\n}\n\nfunction createPlayer(animations) {\n  return Object.freeze({\n    play() {\n      animations.forEach(animation => animation.play());\n    },\n    pause() {\n      animations.forEach(animation => animation.pause());\n    },\n    currentTime(time = 0) {\n      animations.forEach(animation => (animation.currentTime = time));\n    },\n  });\n}\n")),(0,r.kt)("h2",{id:"web-canvas"},"Web Canvas"),(0,r.kt)("h3",{id:"canvas-basic-usage"},"Canvas Basic Usage"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Path2D \u5bf9\u8c61."),(0,r.kt)("li",{parentName:"ul"},"\u7ed8\u5236\u8def\u5f84: ",(0,r.kt)("inlineCode",{parentName:"li"},"beginPath()")," -> ",(0,r.kt)("inlineCode",{parentName:"li"},"draw()")," -> ",(0,r.kt)("inlineCode",{parentName:"li"},"closePath()"),"."),(0,r.kt)("li",{parentName:"ul"},"\u7ed8\u5236\u6837\u5f0f: \u989c\u8272/\u6e10\u53d8/\u53d8\u6362/\u9634\u5f71."),(0,r.kt)("li",{parentName:"ul"},"\u7ed8\u5236\u56fe\u5f62: ",(0,r.kt)("inlineCode",{parentName:"li"},"fill"),"/",(0,r.kt)("inlineCode",{parentName:"li"},"stroke"),"/",(0,r.kt)("inlineCode",{parentName:"li"},"clip"),"."),(0,r.kt)("li",{parentName:"ul"},"\u7ed8\u5236\u6587\u5b57: ",(0,r.kt)("inlineCode",{parentName:"li"},"font"),"/",(0,r.kt)("inlineCode",{parentName:"li"},"fillText()"),"/",(0,r.kt)("inlineCode",{parentName:"li"},"measureText()"),".")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const context = canvas.getContext('2d');\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// \u6839\u636e\u53c2\u6570\u753b\u7ebf\nfunction drawLine(fromX, fromY, toX, toY) {\n  context.moveTo(fromX, fromY);\n  context.lineTo(toX, toY);\n  context.stroke();\n}\n\n// \u6839\u636e\u53c2\u6570\u753b\u5706\nfunction drawCircle(x, y, radius, color) {\n  context.fillStyle = color;\n  context.beginPath();\n  context.arc(x, y, radius, 0, Math.PI * 2, true);\n  context.closePath();\n  context.fill();\n  context.stroke();\n}\n\n// \u6539\u53d8 canvas \u4e2d\u56fe\u5f62\u989c\u8272\nfunction changeColor(color) {\n  context.fillStyle = color;\n  context.fill();\n}\n")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://eloquentjavascript.net/17_canvas.html"},"Recursive tree"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},"<canvas width=\"600\" height=\"300\"></canvas>\n<script>\n  const cx = document.querySelector('canvas').getContext('2d');\n\n  function branch(length, angle, scale) {\n    cx.fillRect(0, 0, 1, length);\n    if (length < 8) return;\n    cx.save();\n    cx.translate(0, length);\n    cx.rotate(-angle);\n    branch(length * scale, angle, scale);\n    cx.rotate(2 * angle);\n    branch(length * scale, angle, scale);\n    cx.restore();\n  }\n\n  cx.translate(300, 0);\n  branch(60, 0.5, 0.8);\n<\/script>\n")),(0,r.kt)("h3",{id:"canvas-game-loop"},"Canvas Game Loop"),(0,r.kt)("p",null,"For all objects:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"constructor: ",(0,r.kt)("inlineCode",{parentName:"li"},"position{x, y}"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"speed{x, y}"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"size{x, y}")),(0,r.kt)("li",{parentName:"ul"},"update(deltaTime): change position or speed"),(0,r.kt)("li",{parentName:"ul"},"draw(ctx): use canvas api and object properties (position/size) to render objects")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const canvas = document.getElementById('gameScreen');\nconst ctx = canvas.getContext('2d');\n\nconst GAME_WIDTH = 800;\nconst GAME_HEIGHT = 600;\n\nconst game = new Game(GAME_WIDTH, GAME_HEIGHT);\n\nlet lastTime = 0;\n\nfunction gameLoop(timestamp) {\n  const deltaTime = timestamp - lastTime;\n  lastTime = timestamp;\n\n  ctx.clearRect(0, 0, GAME_WIDTH, GAME_HEIGHT);\n\n  game.update(deltaTime);\n  game.draw(ctx);\n\n  requestAnimationFrame(gameLoop);\n}\n\nrequestAnimationFrame(gameLoop);\n")),(0,r.kt)("h3",{id:"canvas-performance"},"Canvas Performance"),(0,r.kt)("p",null,"Canvas buffer:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"frontCanvasContext.drawImage(bufferCanvas, 0, 0);\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"multiple canvas: top layer, background layer, interactive layer"),(0,r.kt)("li",{parentName:"ul"},"disable alpha path")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const ctx = canvas.getContext('2d', { alpha: false });\n")),(0,r.kt)("p",null,"Offscreen canvas:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// index.js\nconst offscreenCanvas = document.querySelector('#frame2');\nconst offscreen = offscreenCanvas.transferControlToOffscreen();\nconst worker = new Worker('./worker.js');\nworker.postMessage({ canvas: offscreen }, [offscreen]);\n\n// worker.js\nonmessage = function (event) {\n  canvas = event.data.canvas;\n  context = canvas.getContext('2d');\n};\n")),(0,r.kt)("h3",{id:"canvas-reference"},"Canvas Reference"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API"},"Canvas API")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial"},"Canvas Tutorial")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://joshondesign.com/p/books/canvasdeepdive/toc.html"},"Canvas Deep Dive")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://devhints.io/canvas"},"Canvas Cheat Sheet")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial/Optimizing_canvas"},"Canvas Performance")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://zhuanlan.zhihu.com/p/438142235"},"Canvas Real World Case"))),(0,r.kt)("h2",{id:"web-audio"},"Web Audio"),(0,r.kt)("h3",{id:"oscillator"},"Oscillator"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"                         -3  -1   1       4   6       9   11\n                       -4  -2   0   2   3   5   7   8   10  12\n  .___________________________________________________________________________.\n  :  | |  |  | | | |  |  | | | | | |  |  | | | |  |  | | | | | |  |  | | | |  :\n  :  | |  |  | | | |  |  | | | | | |  |  | | | |  |  | | | | | |  |  | | | |  :\n  :  | |  |  | | | |  |  | | | | | |  |  | | | |  |  | | | | | |  |  | | | |  :\n<-:  |_|  |  |_| |_|  |  |_| |_| |_|  |  |_| |_|  |  |_| |_| |_|  |  |_| |_|  :->\n  :   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   :\n  : A | B | C | D | E | F | G | A | B | C | D | E | F | G | A | B | C | D | E :\n  :___|___|___|___|___|___|___|___|___|___|___|___|___|___|___|___|___|___|___:\n    ^                           ^           ^               ^           ^\n  220 Hz                      440 Hz      523.25 Hz       880 Hz     1174.65 Hz\n(-1 Octave)                 (middle A)                 (+1 Octave)\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const audioContext = new AudioContext();\n\nconst baseFrequency = 440;\nconst getNoteFreq = (base, pitch) => base * Math.pow(2, pitch / 12);\n// oscillator.frequency.value = getNoteFreq(440, 7);\n\nconst getNoteDetune = pitch => pitch * 100;\n// oscillator.detune.value = getNoteDetune(7);\n\nconst play = (type, delay, pitch, duration) => {\n  const oscillator = audioContext.createOscillator();\n  oscillator.connect(audioContext.destination);\n\n  oscillator.type = type;\n  oscillator.detune.value = getNoteDetune(pitch);\n\n  const startTime = audioContext.currentTime + delay;\n  const stopTime = startTime + duration;\n  oscillator.start(startTime);\n  oscillator.stop(stopTime);\n};\n")),(0,r.kt)("h3",{id:"music-data"},"Music Data"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const sampleSize = 1024; // number of samples to collect before analyzing data\nconst audioUrl = 'viper.mp3';\n\nlet audioData = null;\nlet audioPlaying = false;\n\nconst audioContext = new AudioContext();\nconst sourceNode = audioContext.createBufferSource();\nconst analyserNode = audioContext.createAnalyser();\nconst javascriptNode = audioContext.createScriptProcessor(sampleSize, 1, 1);\n\n// Create the array for the data values\nconst amplitudeArray = new Uint8Array(analyserNode.frequencyBinCount);\n\n// Now connect the nodes together\nsourceNode.connect(audioContext.destination);\nsourceNode.connect(analyserNode);\nanalyserNode.connect(javascriptNode);\njavascriptNode.connect(audioContext.destination);\n\n// setup the event handler that is triggered\n// every time enough samples have been collected\n// trigger the audio analysis and draw the results\njavascriptNode.onaudioprocess = function () {\n  // get the Time Domain data for this sample\n  analyserNode.getByteTimeDomainData(amplitudeArray);\n\n  // draw the display if the audio is playing\n  // if (audioPlaying == true) {\n  // requestAnimFrame(drawTimeDomain);\n  // }\n};\n\n// Load the audio from the URL via Ajax and store it in global variable audioData\n// Note that the audio load is asynchronous\nfunction loadSound(url) {\n  fetch(url)\n    .then(response => {\n      audioContext.decodeAudioData(response, buffer => {\n        audioData = buffer;\n        playSound(audioData);\n      });\n    })\n    .catch(error => {\n      console.error(error);\n    });\n}\n\n// Play the audio and loop until stopped\nfunction playSound(buffer) {\n  sourceNode.buffer = buffer;\n  sourceNode.start(0); // Play the sound now\n  sourceNode.loop = true;\n  audioPlaying = true;\n}\n\nfunction stopSound() {\n  sourceNode.stop(0);\n  audioPlaying = false;\n}\n")),(0,r.kt)("h3",{id:"audio-bar-chart"},"Audio Bar Chart"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/zh-CN/docs/Web/API/AnalyserNode/getByteFrequencyData"},"AnalyserNode.getByteFrequencyData API")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/bogdan-cornianu/swave/blob/master/src/visualizer.ts"},"Github Demo"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const WIDTH = this.canvas.clientWidth;\nconst HEIGHT = this.canvas.clientHeight;\nthis.analyserNode.fftSize = 256;\nconst bufferLengthAlt = this.analyserNode.frequencyBinCount;\nconst dataArrayAlt = new Uint8Array(bufferLengthAlt);\n\nthis.ctx.clearRect(0, 0, WIDTH, HEIGHT);\n\nconst draw = () => {\n  const drawVisual = requestAnimationFrame(draw);\n  this.analyserNode.getByteFrequencyData(dataArrayAlt);\n\n  this.ctx.fillStyle = 'rgb(255, 255, 255)';\n  this.ctx.fillRect(0, 0, WIDTH, HEIGHT);\n\n  const barWidth = (WIDTH / bufferLengthAlt) * 2.5;\n  let barHeight;\n  let x = 0;\n\n  for (let i = 0; i < bufferLengthAlt; i++) {\n    barHeight = dataArrayAlt[i];\n\n    this.ctx.fillStyle = `rgb(${barHeight + 100},15,156)`;\n    this.ctx.fillRect(x, HEIGHT - barHeight / 2, barWidth, barHeight / 2);\n\n    x += barWidth + 1;\n  }\n};\n\ndraw();\n")),(0,r.kt)("h2",{id:"media-session"},"Media Session"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://w3c.github.io/mediasession/"},"W3C Media Session Specification")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/en-US/docs/Web/API/MediaSession/"},"MDN Media Session Documentation")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://web.dev/media-session/"},"Google Media Session Blog"))),(0,r.kt)("h2",{id:"web-storage"},"Web Storage"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Cookie for session state."),(0,r.kt)("li",{parentName:"ul"},"DOM storage for Web Component state."),(0,r.kt)("li",{parentName:"ul"},"Web Storage for simple UI options (dark mode, sidebar size, etc.)."),(0,r.kt)("li",{parentName:"ul"},"IndexedDB for large binary objects and data dumps."),(0,r.kt)("li",{parentName:"ul"},"Cache API for offline and quick file access."),(0,r.kt)("li",{parentName:"ul"},"JavaScript variables for everything else.")),(0,r.kt)("h3",{id:"cookie"},"Cookie"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"name=value"),".."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"expires=expiration_time"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"path=domain_path"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"domain=domain_name"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"secure"),".")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"HTTP/1.1 200 OK\nContent-type: text/html\nSet-Cookie: name=value; expires=Mon, 22-Jan-07 07:10:24 GMT; domain=.foo.com\nOther-header: other-header-value\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"HTTP/1.1 200 OK\nContent-type: text/html\nSet-Cookie: name=value; domain=.foo.com; path=/; secure\nOther-header: other-header-value\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"class CookieUtil {\n  static get(name) {\n    const cookieName = `${encodeURIComponent(name)}=`;\n    const cookieStart = document.cookie.indexOf(cookieName);\n    let cookieValue = null;\n\n    if (cookieStart > -1) {\n      let cookieEnd = document.cookie.indexOf(';', cookieStart);\n\n      if (cookieEnd === -1) {\n        cookieEnd = document.cookie.length;\n      }\n\n      cookieValue = decodeURIComponent(\n        document.cookie.substring(cookieStart + cookieName.length, cookieEnd)\n      );\n    }\n\n    return cookieValue;\n  }\n\n  static set(name, value, { expires, path, domain, secure }) {\n    let cookieText = `${encodeURIComponent(name)}=${encodeURIComponent(value)}`;\n\n    if (expires instanceof Date) {\n      cookieText += `; expires=${expires.toGMTString()}`;\n    }\n\n    if (path) {\n      cookieText += `; path=${path}`;\n    }\n\n    if (domain) {\n      cookieText += `; domain=${domain}`;\n    }\n\n    if (secure) {\n      cookieText += '; secure';\n    }\n\n    document.cookie = cookieText;\n  }\n\n  static unset(name, { path, domain, secure }) {\n    CookieUtil.set(name, '', new Date(0), path, domain, secure);\n  }\n}\n")),(0,r.kt)("h3",{id:"local-storage"},"Local Storage"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u534f\u540c Cookie."),(0,r.kt)("li",{parentName:"ul"},"\u5bf9\u4e8e\u590d\u6742\u5bf9\u8c61\u7684\u8bfb\u53d6\u4e0e\u5b58\u50a8,\n\u9700\u8981\u501f\u52a9 ",(0,r.kt)("inlineCode",{parentName:"li"},"JSON.parse")," \u4e0e ",(0,r.kt)("inlineCode",{parentName:"li"},"JSON.stringify"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/en-US/docs/Web/API/Storage"},(0,r.kt)("inlineCode",{parentName:"a"},"Storage")," object"),":",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Storage.length"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Storage.key()"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Storage.getItem()"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Storage.setItem()"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Storage.removeItem()"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Storage.clear()"),"."))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"storage")," event: \u6bcf\u5f53 ",(0,r.kt)("inlineCode",{parentName:"li"},"Storage")," \u5bf9\u8c61\u53d1\u751f\u53d8\u5316\u65f6, \u90fd\u4f1a\u5728\u6587\u6863\u4e0a\u89e6\u53d1 ",(0,r.kt)("inlineCode",{parentName:"li"},"storage")," \u4e8b\u4ef6.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"event.domain"),": \u5b58\u50a8\u53d8\u5316\u5bf9\u5e94\u7684\u57df."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"event.key"),": \u88ab\u8bbe\u7f6e\u6216\u5220\u9664\u7684\u952e."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"event.newValue"),": \u952e\u88ab\u8bbe\u7f6e\u7684\u65b0\u503c, \u82e5\u952e\u88ab\u5220\u9664\u5219\u4e3a null."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"event.oldValue"),": \u952e\u53d8\u5316\u4e4b\u524d\u7684\u503c.")))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"if (!localStorage.getItem('bgColor')) {\n  populateStorage();\n} else {\n  setStyles();\n}\n\nfunction populateStorage() {\n  localStorage.setItem('bgColor', document.getElementById('bgColor').value);\n  localStorage.setItem('font', document.getElementById('font').value);\n  localStorage.setItem('image', document.getElementById('image').value);\n\n  setStyles();\n}\n\nfunction setStyles() {\n  const currentColor = localStorage.getItem('bgColor');\n  const currentFont = localStorage.getItem('font');\n  const currentImage = localStorage.getItem('image');\n\n  document.getElementById('bgColor').value = currentColor;\n  document.getElementById('font').value = currentFont;\n  document.getElementById('image').value = currentImage;\n\n  htmlElem.style.backgroundColor = `#${currentColor}`;\n  pElem.style.fontFamily = currentFont;\n  imgElem.setAttribute('src', currentImage);\n}\n")),(0,r.kt)("h3",{id:"indexdb"},"IndexDB"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"class IndexedDB {\n  constructor(dbName, dbVersion, dbUpgrade) {\n    return new Promise((resolve, reject) => {\n      this.db = null;\n\n      if (!('indexedDB' in window)) {\n        reject(new Error('not supported'));\n      }\n\n      const dbOpen = indexedDB.open(dbName, dbVersion);\n\n      if (dbUpgrade) {\n        dbOpen.onupgradeneeded = e => {\n          dbUpgrade(dbOpen.result, e.oldVersion, e.newVersion);\n        };\n      }\n\n      dbOpen.onsuccess = () => {\n        this.db = dbOpen.result;\n        resolve(this);\n      };\n\n      dbOpen.onerror = e => {\n        reject(new Error(`IndexedDB error: ${e.target.errorCode}`));\n      };\n    });\n  }\n\n  get(storeName, name) {\n    return new Promise((resolve, reject) => {\n      const transaction = this.db.transaction(storeName, 'readonly');\n      const store = transaction.objectStore(storeName);\n      const request = store.get(name);\n\n      request.onsuccess = () => {\n        resolve(request.result);\n      };\n\n      request.onerror = () => {\n        reject(request.error);\n      };\n    });\n  }\n\n  set(storeName, name, value) {\n    return new Promise((resolve, reject) => {\n      const transaction = this.db.transaction(storeName, 'readwrite');\n      const store = transaction.objectStore(storeName);\n\n      store.put(value, name);\n\n      transaction.oncomplete = () => {\n        resolve(true);\n      };\n\n      transaction.onerror = () => {\n        reject(transaction.error);\n      };\n    });\n  }\n}\n\nexport class State {\n  static dbName = 'stateDB';\n  static dbVersion = 1;\n  static storeName = 'state';\n  static DB = null;\n  static target = new EventTarget();\n\n  constructor(observed, updateCallback) {\n    this.updateCallback = updateCallback;\n    this.observed = new Set(observed);\n\n    // subscribe `set` event with `updateCallback`\n    State.target.addEventListener('set', e => {\n      if (this.updateCallback && this.observed.has(e.detail.name)) {\n        this.updateCallback(e.detail.name, e.detail.value);\n      }\n    });\n  }\n\n  async dbConnect() {\n    State.DB =\n      State.DB ||\n      (await new IndexedDB(\n        State.dbName,\n        State.dbVersion,\n        (db, oldVersion, newVersion) => {\n          // upgrade database\n          switch (oldVersion) {\n            case 0: {\n              db.createObjectStore(State.storeName);\n              break;\n            }\n            default:\n              throw new Error('Unsupported version!');\n          }\n        }\n      ));\n\n    return State.DB;\n  }\n\n  async get(name) {\n    this.observedSet.add(name);\n    const db = await this.dbConnect();\n    return await db.get(State.storeName, name);\n  }\n\n  async set(name, value) {\n    this.observed.add(name);\n    const db = await this.dbConnect();\n    await db.set(State.storeName, name, value);\n\n    // publish event to subscriber\n    const event = new CustomEvent('set', { detail: { name, value } });\n    State.target.dispatchEvent(event);\n  }\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const store = db.transaction('users').objectStore('users');\nconst index = store.createIndex('username', 'username', { unique: true });\nconst range = IDBKeyRange.bound('007', 'ace');\n\nconst request = store.openCursor(range, 'next');\nconst request = index.openCursor(range, 'next');\n\nrequest.onsuccess = function (event) {\n  const cursor = event.target.result;\n\n  if (cursor) {\n    // \u6c38\u8fdc\u8981\u68c0\u67e5\n    console.log(`Key: ${cursor.key}, Value: ${JSON.stringify(cursor.value)}`);\n    cursor.continue(); // \u79fb\u52a8\u5230\u4e0b\u4e00\u6761\u8bb0\u5f55\n  } else {\n    console.log('Done!');\n  }\n};\n")),(0,r.kt)("h3",{id:"file-api"},"File API"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"function readFileText(file) {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.addEventListener('load', () => resolve(reader.result));\n    reader.addEventListener('error', () => reject(reader.error));\n    reader.readAsText(file);\n  });\n}\n\nfunction readFileBuffer(file) {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.addEventListener('load', () => resolve(reader.result));\n    reader.addEventListener('error', () => reject(reader.error));\n    reader.readAsArrayBuffer(file);\n  });\n}\n\nconst fileInput = document.querySelector('fileInput');\n\nfor (const file of fileInput.files) {\n  const text = await readFileText(file);\n  const buffer = await readFileBuffer(file);\n}\n")),(0,r.kt)("h2",{id:"web-rtc"},"Web RTC"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://dzone.com/articles/webrtc-security-vulnerabilities-you-should-know-ab"},"WebRTC Security List"))),(0,r.kt)("h2",{id:"web-gamepad"},"Web Gamepad"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/zh-CN/docs/Games/Techniques/Controls_Gamepad_API"},"Gamepad API"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const gamepads = {};\n\nfunction gamepadHandler(event, connecting) {\n  // gamepad === navigator.getGamepads()[gamepad.index]\n  const { gamepad } = event;\n\n  if (connecting) {\n    gamepads[gamepad.index] = gamepad;\n  } else {\n    delete gamepads[gamepad.index];\n  }\n}\n\nwindow.addEventListener('gamepadconnected', e => {\n  gamepadHandler(e, true);\n});\n\nwindow.addEventListener('gamepaddisconnected', e => {\n  gamepadHandler(e, false);\n});\n")),(0,r.kt)("h2",{id:"pwa"},"PWA"),(0,r.kt)("p",null,"Progressive Web Apps:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Served over ",(0,r.kt)("inlineCode",{parentName:"li"},"HTTPS"),"."),(0,r.kt)("li",{parentName:"ul"},"Provide a manifest."),(0,r.kt)("li",{parentName:"ul"},"Register a ",(0,r.kt)("inlineCode",{parentName:"li"},"ServiceWorker"),"\n(web cache for offline and performance)."),(0,r.kt)("li",{parentName:"ul"},"Consists of website, web app manifest,\nservice worker, expanded capabilities\nand OS integration.")),(0,r.kt)("h3",{id:"service-worker"},"Service Worker"),(0,r.kt)("h4",{id:"service-worker-pros"},"Service Worker Pros"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Cache."),(0,r.kt)("li",{parentName:"ul"},"Offline."),(0,r.kt)("li",{parentName:"ul"},"Background."),(0,r.kt)("li",{parentName:"ul"},"Custom request to minimize network."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerRegistration/showNotification"},"Notification API"),".")),(0,r.kt)("h4",{id:"service-worker-costs"},"Service Worker Costs"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Need startup time.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// 20~100 ms for desktop\n// 100 ms for mobile\nconst entry = performance.getEntriesByName(url)[0];\nconst swStartupTime = entry.requestStart - entry.workerStart;\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"cache reads aren't always instant:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"cache hit time = read time (only this case better than ",(0,r.kt)("inlineCode",{parentName:"li"},"NO SW"),"),"),(0,r.kt)("li",{parentName:"ul"},"cache miss time = read time + network latency,"),(0,r.kt)("li",{parentName:"ul"},"cache slow time = slow read time + network latency,"),(0,r.kt)("li",{parentName:"ul"},"SW asleep = SW boot latency + read time ( + network latency),"),(0,r.kt)("li",{parentName:"ul"},"NO SW = network latency.")))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const entry = performance.getEntriesByName(url)[0];\n\n// no remote request means this was handled by the cache\nif (entry.transferSize === 0) {\n  const cacheTime = entry.responseStart - entry.requestStart;\n}\n\nasync function handleRequest(event) {\n  const cacheStart = performance.now();\n  const response = await caches.match(event.request);\n  const cacheEnd = performance.now();\n}\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u670d\u52a1\u5de5\u4f5c\u8005\u7ebf\u7a0b\u7f13\u5b58\u4e0d\u81ea\u52a8\u7f13\u5b58\u4efb\u4f55\u8bf7\u6c42, \u6240\u6709\u7f13\u5b58\u90fd\u5fc5\u987b\u660e\u786e\u6307\u5b9a."),(0,r.kt)("li",{parentName:"ul"},"\u670d\u52a1\u5de5\u4f5c\u8005\u7ebf\u7a0b\u7f13\u5b58\u6ca1\u6709\u5230\u671f\u5931\u6548\u7684\u6982\u5ff5."),(0,r.kt)("li",{parentName:"ul"},"\u670d\u52a1\u5de5\u4f5c\u8005\u7ebf\u7a0b\u7f13\u5b58\u5fc5\u987b\u624b\u52a8\u66f4\u65b0\u548c\u5220\u9664."),(0,r.kt)("li",{parentName:"ul"},"\u7f13\u5b58\u7248\u672c\u5fc5\u987b\u624b\u52a8\u7ba1\u7406:\n\u6bcf\u6b21\u670d\u52a1\u5de5\u4f5c\u8005\u7ebf\u7a0b\u66f4\u65b0, \u65b0\u670d\u52a1\u5de5\u4f5c\u8005\u7ebf\u7a0b\u8d1f\u8d23\u63d0\u4f9b\u65b0\u7684\u7f13\u5b58\u952e\u4ee5\u4fdd\u5b58\u65b0\u7f13\u5b58."),(0,r.kt)("li",{parentName:"ul"},"\u552f\u4e00\u7684\u6d4f\u89c8\u5668\u5f3a\u5236\u9010\u51fa\u7b56\u7565\u57fa\u4e8e\u670d\u52a1\u5de5\u4f5c\u8005\u7ebf\u7a0b\u7f13\u5b58\u5360\u7528\u7684\u7a7a\u95f4.\n\u7f13\u5b58\u8d85\u8fc7\u6d4f\u89c8\u5668\u9650\u5236\u65f6, \u6d4f\u89c8\u5668\u4f1a\u57fa\u4e8e LRU \u539f\u5219\u4e3a\u65b0\u7f13\u5b58\u817e\u51fa\u7a7a\u95f4.")),(0,r.kt)("h4",{id:"service-worker-caching-strategy"},"Service Worker Caching Strategy"),(0,r.kt)("p",null,"5 caching strategy in ",(0,r.kt)("a",{parentName:"p",href:"https://developer.chrome.com/docs/workbox/caching-strategies-overview"},"workbox"),"."),(0,r.kt)("p",null,"Stale-While-Revalidate:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// eslint-disable-next-line no-restricted-globals\nself.addEventListener('fetch', function (event) {\n  event.respondWith(\n    caches.open(cacheName).then(function (cache) {\n      cache.match(event.request).then(function (cacheResponse) {\n        fetch(event.request).then(function (networkResponse) {\n          cache.put(event.request, networkResponse);\n        });\n\n        return cacheResponse || networkResponse;\n      });\n    })\n  );\n});\n")),(0,r.kt)("p",null,"Cache first, then Network:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// eslint-disable-next-line no-restricted-globals\nself.addEventListener('fetch', function (event) {\n  event.respondWith(\n    caches.open(cacheName).then(function (cache) {\n      cache.match(event.request).then(function (cacheResponse) {\n        if (cacheResponse) return cacheResponse;\n\n        return fetch(event.request).then(function (networkResponse) {\n          cache.put(event.request, networkResponse.clone());\n          return networkResponse;\n        });\n      });\n    })\n  );\n});\n")),(0,r.kt)("p",null,"Network first, then Cache:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// eslint-disable-next-line no-restricted-globals\nself.addEventListener('fetch', function (event) {\n  event.respondWith(\n    fetch(event.request).catch(function () {\n      return caches.match(event.request);\n    })\n  );\n});\n")),(0,r.kt)("p",null,"Cache only:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// eslint-disable-next-line no-restricted-globals\nself.addEventListener('fetch', function (event) {\n  event.respondWith(\n    caches.open(cacheName).then(function (cache) {\n      cache.match(event.request).then(function (cacheResponse) {\n        return cacheResponse;\n      });\n    })\n  );\n});\n")),(0,r.kt)("p",null,"Network only:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// eslint-disable-next-line no-restricted-globals\nself.addEventListener('fetch', function (event) {\n  event.respondWith(\n    fetch(event.request).then(function (networkResponse) {\n      return networkResponse;\n    })\n  );\n});\n")),(0,r.kt)("h4",{id:"service-worker-usage"},"Service Worker Usage"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// Check that service workers are registered\nif ('serviceWorker' in navigator) {\n  // Use the window load event to keep the page load performance\n  window.addEventListener('load', () => {\n    navigator.serviceWorker.register('/sw.js');\n  });\n}\n")),(0,r.kt)("p",null,"Broken images use case:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"function isImage(fetchRequest) {\n  return fetchRequest.method === 'GET' && fetchRequest.destination === 'image';\n}\n\n// eslint-disable-next-line no-restricted-globals\nself.addEventListener('fetch', e => {\n  e.respondWith(\n    fetch(e.request)\n      .then(response => {\n        if (response.ok) return response;\n\n        // User is online, but response was not ok\n        if (isImage(e.request)) {\n          // Get broken image placeholder from cache\n          return caches.match('/broken.png');\n        }\n      })\n      .catch(err => {\n        // User is probably offline\n        if (isImage(e.request)) {\n          // Get broken image placeholder from cache\n          return caches.match('/broken.png');\n        }\n        process(err);\n      })\n  );\n});\n\n// eslint-disable-next-line no-restricted-globals\nself.addEventListener('install', e => {\n  // eslint-disable-next-line no-restricted-globals\n  self.skipWaiting();\n  e.waitUntil(\n    caches.open('precache').then(cache => {\n      // Add /broken.png to \"precache\"\n      cache.add('/broken.png');\n    })\n  );\n});\n")),(0,r.kt)("h3",{id:"pwa-library"},"PWA Library"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/GoogleChrome/workbox"},"Workbox"))),(0,r.kt)("h3",{id:"pwa-reference"},"PWA Reference"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://web.dev/offline-cookbook"},"Offline Cookbook")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.smashingmagazine.com/2018/11/guide-pwa-progressive-web-applications"},"Extensive Guide")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://developers.google.com/web/fundamentals/primers/service-workers"},"Service Worker"),".")),(0,r.kt)("h2",{id:"jamstack"},"JamStack"),(0,r.kt)("p",null,"JamStack \u6307\u7684\u662f\u4e00\u5957\u7528\u4e8e\u6784\u5efa\u73b0\u4ee3\u7f51\u7ad9\u7684\u6280\u672f\u6808:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"JavaScript: enhancing with JavaScript."),(0,r.kt)("li",{parentName:"ul"},"APIs: supercharging with services."),(0,r.kt)("li",{parentName:"ul"},"Markup: pre-rendering.")),(0,r.kt)("h3",{id:"rendering-patterns"},"Rendering Patterns"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"CSR (Client Side Rendering): SPA."),(0,r.kt)("li",{parentName:"ul"},"SSR (Server Side Rendering): SPA with SEO."),(0,r.kt)("li",{parentName:"ul"},"SSG (Static Site Generation): SPA with pre-rendering."),(0,r.kt)("li",{parentName:"ul"},"ISR (Incremental Static Regeneration): SSG + SSR."),(0,r.kt)("li",{parentName:"ul"},"SSR + CSR: HomePage with SSR, dynamic with CSR."),(0,r.kt)("li",{parentName:"ul"},"SSG + CSR: HomePage with SSG, dynamic with CSR."),(0,r.kt)("li",{parentName:"ul"},"SSG + SSR: static with SSG, dynamic with SSR.")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.patterns.dev/posts/rendering-patterns"},(0,r.kt)("img",{alt:"Rendering Patterns",src:t(1748).Z,width:"1463",height:"2457"}))),(0,r.kt)("h3",{id:"csr"},"CSR"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"CSR hit API after the page loads (LOADING indicator)."),(0,r.kt)("li",{parentName:"ul"},"Data is fetched on every page request.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"import { TimeSection } from '@components';\n\nexport default function CSRPage() {\n  const [dateTime, setDateTime] = React.useState<string>();\n\n  React.useEffect(() => {\n    axios\n      .get('https://worldtimeapi.org/api/ip')\n      .then(res => {\n        setDateTime(res.data.datetime);\n      })\n      .catch(error => console.error(error));\n  }, []);\n\n  return (\n    <main>\n      <TimeSection dateTime={dateTime} />\n    </main>\n  );\n}\n")),(0,r.kt)("h3",{id:"ssr"},"SSR"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://developers.google.com/web/tools/puppeteer/articles/ssr"},"Server Side Rendering with Puppeteer")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://developers.google.com/web/updates/2019/02/rendering-on-the-web"},"Rendering on the Web"))),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.patterns.dev/posts/ssr"},(0,r.kt)("img",{alt:"Server Side Rendering",src:t(9601).Z,width:"1315",height:"864"}))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"if (isBotAgent) {\n  // return pre-rendering static html to search engine crawler\n  // like Gatsby\n} else {\n  // server side rendering at runtime for real interactive users\n  // ReactDOMServer.renderToString()\n}\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"SSR hit API before the page loads (DELAY before render, and no LOADING indicator)."),(0,r.kt)("li",{parentName:"ul"},"Data is fetched on every page request.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"import { TimeSection } from '@components';\n\nexport default function SSRPage({ dateTime }: SSRPageProps) {\n  return (\n    <main>\n      <TimeSection dateTime={dateTime} />\n    </main>\n  );\n}\n\nexport const getServerSideProps: GetServerSideProps = async () => {\n  const res = await axios.get('https://worldtimeapi.org/api/ip');\n\n  return {\n    props: { dateTime: res.data.datetime },\n  };\n};\n")),(0,r.kt)("h3",{id:"ssg"},"SSG"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Reloading did not change anything."),(0,r.kt)("li",{parentName:"ul"},"Hit API when running ",(0,r.kt)("inlineCode",{parentName:"li"},"npm run build"),"."),(0,r.kt)("li",{parentName:"ul"},"Data will not change because no further fetch.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"import { TimeSection } from '@components';\n\nexport default function SSGPage({ dateTime }: SSGPageProps) {\n  return (\n    <main>\n      <TimeSection dateTime={dateTime} />\n    </main>\n  );\n}\n\nexport const getStaticProps: GetStaticProps = async () => {\n  const res = await axios.get('https://worldtimeapi.org/api/ip');\n\n  return {\n    props: { dateTime: res.data.datetime },\n  };\n};\n")),(0,r.kt)("h3",{id:"isr"},"ISR"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Based on SSG, with ",(0,r.kt)("strong",{parentName:"li"},"revalidate limit"),"."),(0,r.kt)("li",{parentName:"ul"},"Cooldown state: reloading doesn't trigger changes and pages rebuilds."),(0,r.kt)("li",{parentName:"ul"},"First person that visits when cooldown state is off,\nis going to trigger a rebuild.\nThat person won't be seeing changes.\nBut, the changes will be served for the next full reload.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"import { TimeSection } from '@components';\n\nexport default function ISR20Page({ dateTime }: ISR20PageProps) {\n  return (\n    <main>\n      <TimeSection dateTime={dateTime} />\n    </main>\n  );\n}\n\nexport const getStaticProps: GetStaticProps = async () => {\n  const res = await axios.get('https://worldtimeapi.org/api/ip');\n\n  return {\n    props: { dateTime: res.data.datetime },\n    revalidate: 20,\n  };\n};\n")),(0,r.kt)("h2",{id:"seo"},"SEO"),(0,r.kt)("h3",{id:"seo-metadata"},"SEO Metadata"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"import { Helmet } from 'react-helmet';\n\nfunction App() {\n  const seo = {\n    title: 'About',\n    description:\n      'This is an awesome site that you definitely should check out.',\n    url: 'https://www.mydomain.com/about',\n    image: 'https://mydomain.com/images/home/logo.png',\n  };\n\n  return (\n    <Helmet\n      title={`${seo.title} | Code Mochi`}\n      meta={[\n        {\n          name: 'description',\n          property: 'og:description',\n          content: seo.description,\n        },\n        { property: 'og:title', content: `${seo.title} | Code Mochi` },\n        { property: 'og:url', content: seo.url },\n        { property: 'og:image', content: seo.image },\n        { property: 'og:image:type', content: 'image/jpeg' },\n        { property: 'twitter:image:src', content: seo.image },\n        { property: 'twitter:title', content: `${seo.title} | Code Mochi` },\n        { property: 'twitter:description', content: seo.description },\n      ]}\n    />\n  );\n}\n")),(0,r.kt)("h3",{id:"seo-best-practice"},"SEO Best Practice"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://css-tricks.com/server-side-react-rendering"},"Server side rendering"),"\n(e.g Next.js)."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/chrisvfritz/prerender-spa-plugin"},"Pre-Rendering")),(0,r.kt)("li",{parentName:"ul"},"Mobile performance optimization\n(e.g minify resources, code splitting, CDN, lazy loading, minimize reflows)."),(0,r.kt)("li",{parentName:"ul"},"SEO-friendly ",(0,r.kt)("a",{parentName:"li",href:"https://reacttraining.com/react-router"},"routing")," and URL management."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.google.com/webmasters"},"Google webmaster tools")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"<title>")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"<meta>")," in ",(0,r.kt)("inlineCode",{parentName:"li"},"<head>")," (with tool like ",(0,r.kt)("inlineCode",{parentName:"li"},"react-helmet"),")."),(0,r.kt)("li",{parentName:"ul"},"Includes a ",(0,r.kt)("inlineCode",{parentName:"li"},"robots.txt")," file.")),(0,r.kt)("h3",{id:"seo-reference"},"SEO Reference"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://developers.google.com/search/docs/guides/javascript-seo-basics"},"SEO Basics")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://snipcart.com/spa-seo"},"SPA SEO Basics"))),(0,r.kt)("h2",{id:"network"},"Network"),(0,r.kt)("h3",{id:"json"},"JSON"),(0,r.kt)("p",null,"JSON (JavaScript Object Notation) methods:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const obj = JSON.parse(json);\nconst json = JSON.stringify(obj);\n")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://exploringjs.com/impatient-js/ch_json.html#json-replacers-revivers"},(0,r.kt)("inlineCode",{parentName:"a"},"JSON.stringify(value, filter, space)")),":"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Symbol"),"/",(0,r.kt)("inlineCode",{parentName:"li"},"function"),"/",(0,r.kt)("inlineCode",{parentName:"li"},"NaN"),"/",(0,r.kt)("inlineCode",{parentName:"li"},"Infinity"),"/",(0,r.kt)("inlineCode",{parentName:"li"},"undefined"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"null"),"/ignored."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"BitInt"),": throw ",(0,r.kt)("inlineCode",{parentName:"li"},"TypeError"),"."),(0,r.kt)("li",{parentName:"ul"},"Circular reference object: throw ",(0,r.kt)("inlineCode",{parentName:"li"},"TypeError"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"toJSON")," method:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const obj = {\n  name: 'zc',\n  toJSON() {\n    return 'return toJSON';\n  },\n};\n\n// return toJSON\nconsole.log(JSON.stringify(obj));\n\n// \"2022-03-06T08:24:56.138Z\"\nJSON.stringify(new Date());\n")),(0,r.kt)("h3",{id:"ajax"},"AJAX"),(0,r.kt)("h4",{id:"ajax-data-format"},"AJAX Data Format"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Format"),(0,r.kt)("th",{parentName:"tr",align:"right"},"Size (bytes)"),(0,r.kt)("th",{parentName:"tr",align:"right"},"Download (ms)"),(0,r.kt)("th",{parentName:"tr",align:"right"},"Parse (ms)"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Verbose XML"),(0,r.kt)("td",{parentName:"tr",align:"right"},"582,960"),(0,r.kt)("td",{parentName:"tr",align:"right"},"999.4"),(0,r.kt)("td",{parentName:"tr",align:"right"},"343.1")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Verbose JSON-P"),(0,r.kt)("td",{parentName:"tr",align:"right"},"487,913"),(0,r.kt)("td",{parentName:"tr",align:"right"},"598.2"),(0,r.kt)("td",{parentName:"tr",align:"right"},"0.0")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Simple XML"),(0,r.kt)("td",{parentName:"tr",align:"right"},"437,960"),(0,r.kt)("td",{parentName:"tr",align:"right"},"475.1"),(0,r.kt)("td",{parentName:"tr",align:"right"},"83.1")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Verbose JSON"),(0,r.kt)("td",{parentName:"tr",align:"right"},"487,895"),(0,r.kt)("td",{parentName:"tr",align:"right"},"527.7"),(0,r.kt)("td",{parentName:"tr",align:"right"},"26.7")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Simple JSON"),(0,r.kt)("td",{parentName:"tr",align:"right"},"392,895"),(0,r.kt)("td",{parentName:"tr",align:"right"},"498.7"),(0,r.kt)("td",{parentName:"tr",align:"right"},"29.0")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Simple JSON-P"),(0,r.kt)("td",{parentName:"tr",align:"right"},"392,913"),(0,r.kt)("td",{parentName:"tr",align:"right"},"454.0"),(0,r.kt)("td",{parentName:"tr",align:"right"},"3.1")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Array JSON"),(0,r.kt)("td",{parentName:"tr",align:"right"},"292,895"),(0,r.kt)("td",{parentName:"tr",align:"right"},"305.4"),(0,r.kt)("td",{parentName:"tr",align:"right"},"18.6")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Array JSON-P"),(0,r.kt)("td",{parentName:"tr",align:"right"},"292,912"),(0,r.kt)("td",{parentName:"tr",align:"right"},"316.0"),(0,r.kt)("td",{parentName:"tr",align:"right"},"3.4")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Custom Format (script insertion)"),(0,r.kt)("td",{parentName:"tr",align:"right"},"222,912"),(0,r.kt)("td",{parentName:"tr",align:"right"},"66.3"),(0,r.kt)("td",{parentName:"tr",align:"right"},"11.7")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Custom Format (XHR)"),(0,r.kt)("td",{parentName:"tr",align:"right"},"222,892"),(0,r.kt)("td",{parentName:"tr",align:"right"},"63.1"),(0,r.kt)("td",{parentName:"tr",align:"right"},"14.5")))),(0,r.kt)("h4",{id:"ajax-usage"},"Ajax Usage"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const XHR = (function () {\n  const standard = {\n    createXHR() {\n      return new XMLHttpRequest();\n    },\n  };\n  const newActionXObject = {\n    createXHR() {\n      return new ActionXObject('Msxml12.XMLHTTP');\n    },\n  };\n  const oldActionXObject = {\n    createXHR() {\n      return new ActionXObject('Microsoft.XMLHTTP');\n    },\n  };\n\n  // \u6839\u636e\u517c\u5bb9\u6027\u8fd4\u56de\u5bf9\u5e94\u7684\u5de5\u5382\u5bf9\u8c61\n  // \u6b64\u7acb\u5373\u51fd\u6570\u8fd0\u884c\u4e00\u6b21\u5373\u53ef\u5b8c\u6210\u517c\u5bb9\u6027\u68c0\u67e5, \u9632\u6b62\u91cd\u590d\u68c0\u67e5\n  if (standard.createXHR()) {\n    return standard;\n  } else {\n    try {\n      newActionXObject.createXHR();\n      return newActionXObject;\n    } catch (o) {\n      oldActionXObject.createXHR();\n      return oldActionXObject;\n    }\n  }\n})();\n\nconst request = XHR.createXHR();\n\n// 3rd argument : async mode\nrequest.open('GET', 'example.txt', true);\n\nrequest.onreadystatechange = function () {\n  // do something\n  /*\n  switch(request.readyState) {\n    case 0: initialize\n    case 1: loading\n    case 2: loaded\n    case 3: transaction\n    case 4: complete\n  }\n  */\n  if (request.readyState === 4) {\n    const para = document.createElement('p');\n    const txt = document.createTextNode(request.responseText);\n    para.appendChild(txt);\n    document.getElementById('new').appendChild(para);\n  }\n};\n\nrequest.send(null);\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"ajax({\n  url: './TestXHR.aspx', // \u8bf7\u6c42\u5730\u5740\n  type: 'POST', // \u8bf7\u6c42\u65b9\u5f0f\n  data: { name: 'super', age: 20 }, // \u8bf7\u6c42\u53c2\u6570\n  dataType: 'json',\n  success(response, xml) {\n    // \u6b64\u5904\u653e\u6210\u529f\u540e\u6267\u884c\u7684\u4ee3\u7801\n  },\n  fail(status) {\n    // \u6b64\u5904\u653e\u5931\u8d25\u540e\u6267\u884c\u7684\u4ee3\u7801\n  },\n});\n\nfunction ajax(options) {\n  options = options || {};\n  options.type = (options.type || 'GET').toUpperCase();\n  options.dataType = options.dataType || 'json';\n  const params = formatParams(options.data);\n  let xhr;\n\n  // \u521b\u5efa - \u975eIE6 - \u7b2c\u4e00\u6b65\n  if (window.XMLHttpRequest) {\n    xhr = new XMLHttpRequest();\n  } else {\n    // IE6\u53ca\u5176\u4ee5\u4e0b\u7248\u672c\u6d4f\u89c8\u5668\n    xhr = new ActiveXObject('Microsoft.XMLHTTP');\n  }\n\n  // \u63a5\u6536 - \u7b2c\u4e09\u6b65\n  xhr.onreadystatechange = function () {\n    if (xhr.readyState === 4) {\n      const status = xhr.status;\n      if (status >= 200 && status < 300) {\n        options.success && options.success(xhr.responseText, xhr.responseXML);\n      } else {\n        options.fail && options.fail(status);\n      }\n    }\n  };\n\n  // \u8fde\u63a5 \u548c \u53d1\u9001 - \u7b2c\u4e8c\u6b65\n  if (options.type === 'GET') {\n    xhr.open('GET', `${options.url}?${params}`, true);\n    xhr.send(null);\n  } else if (options.type === 'POST') {\n    xhr.open('POST', options.url, true);\n    // \u8bbe\u7f6e\u8868\u5355\u63d0\u4ea4\u65f6\u7684\u5185\u5bb9\u7c7b\u578b\n    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\n    xhr.send(params);\n  }\n}\n\n// \u683c\u5f0f\u5316\u53c2\u6570\nfunction formatParams(data) {\n  const arr = [];\n\n  for (const name in data) {\n    arr.push(`${encodeURIComponent(name)}=${encodeURIComponent(data[name])}`);\n  }\n\n  arr.push(`v=${Math.random()}`.replace('.', ''));\n  return arr.join('&');\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"function getJSON(url) {\n  return new Promise((resolve, reject) => {\n    const request = new XMLHttpRequest();\n\n    request.open('GET', url);\n\n    request.onload = function () {\n      try {\n        if (this.status === 200) {\n          resolve(JSON.parse(this.response));\n        } else {\n          reject(Error(`${this.status} ${this.statusText}`));\n        }\n      } catch (e) {\n        reject(e.message);\n      }\n    };\n\n    request.onerror = function () {\n      reject(Error(`${this.status} ${this.statusText}`));\n    };\n\n    request.send();\n  });\n}\n\ngetJSON('data/sample.json')\n  .then(ninjas => {\n    assert(ninjas !== null, 'Get data');\n  })\n  .catch(e => handleError(`Error: ${e}`));\n")),(0,r.kt)("h4",{id:"ajax-cross-origin-request"},"Ajax Cross Origin Request"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'\x3c!-- HTML --\x3e\n<meta http-equiv="Access-Control-Allow-Origin" content="*" />\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"Response.Headers.Add('Access-Control-Allow-Origin', '*');\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"$.ajax({\n  url: 'http://map.oicqzone.com/gpsApi.php?lat=22.502412986242&lng=113.93832783228',\n  type: 'GET',\n  dataType: 'JSONP', // \u5904\u7406Ajax \u8de8\u57df\u95ee\u9898.\n  success(data) {\n    $('body').append(`Name: ${data}`);\n  },\n});\n")),(0,r.kt)("h4",{id:"ajax-alternatives"},"AJAX Alternatives"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"client.request(config)"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"client.get(url[, config])"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"client.delete(url[, config])"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"client.head(url[, config])"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"client.options(url[, config])"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"client.post(url[, data[, config]])"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"client.put(url[, data[, config]])"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"client.patch(url[, data[, config]])"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"client.getUri([config])"),".")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const client = axios.create({\n  baseURL: 'https://some-domain.com/api/',\n  timeout: 1000,\n  headers: { 'X-Custom-Header': 'foobar' },\n});\n\n// Add a request interceptor\nclient.interceptors.request.use(\n  config => {\n    // Do something before request is sent.\n    return config;\n  },\n  error => {\n    // Do something with request error.\n    return Promise.reject(error);\n  }\n);\n\nclient.interceptors.response.use(\n  response => {\n    // Any status code that lie within the range of 2xx trigger this function.\n    // Do something with response data.\n    return response;\n  },\n  error => {\n    // Any status codes that falls outside the range of 2xx trigger this function.\n    // Do something with response error.\n    return Promise.reject(error);\n  }\n);\n")),(0,r.kt)("h3",{id:"fetch"},"Fetch"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"GET: read resources."),(0,r.kt)("li",{parentName:"ul"},"POST: create resources."),(0,r.kt)("li",{parentName:"ul"},"PUT: fully update resources."),(0,r.kt)("li",{parentName:"ul"},"PATCH: partially update resources."),(0,r.kt)("li",{parentName:"ul"},"DELETE: delete resources.")),(0,r.kt)("h4",{id:"fetch-basis-usage"},"Fetch Basis Usage"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const response = await fetch('/api/names', {\n  headers: {\n    Accept: 'application/json',\n  },\n});\n\nconst response = await fetch('/api/names', {\n  method: 'POST',\n  body: JSON.stringify(object),\n  headers: {\n    'Content-Type': 'application/json',\n  },\n});\n")),(0,r.kt)("h4",{id:"fetch-form-data"},"Fetch Form Data"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const imageFormData = new FormData();\nconst imageInput = document.querySelector('input[type=\"file\"][multiple]');\nconst imageFiles = imageInput.files;\n\nfor (const file of imageFiles) {\n  imageFormData.append('image', file);\n}\n\nfetch('/img-upload', {\n  method: 'POST',\n  body: imageFormData,\n});\n")),(0,r.kt)("h4",{id:"fetch-aborting"},"Fetch Aborting"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const abortController = new AbortController();\n\nfetch('wikipedia.zip', { signal: abortController.signal }).catch(() =>\n  console.log('Aborted!')\n);\n\n// 10 \u6beb\u79d2\u540e\u4e2d\u65ad\u8bf7\u6c42\nsetTimeout(() => abortController.abort(), 10);\n")),(0,r.kt)("h4",{id:"fetch-objects-api"},"Fetch Objects API"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/Headers"},(0,r.kt)("inlineCode",{parentName:"a"},"Headers")," object"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const myHeaders = new Headers();\nmyHeaders.append('Content-Type', 'text/xml');\nmyHeaders.get('Content-Type'); // should return 'text/xml'\n")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/Request"},(0,r.kt)("inlineCode",{parentName:"a"},"Request")," object"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const request = new Request('/api/names', {\n  method: 'POST',\n  body: JSON.stringify(object),\n  headers: {\n    'Content-Type': 'application/json',\n  },\n});\n\nconst response = await fetch(request);\n")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/Response"},(0,r.kt)("inlineCode",{parentName:"a"},"Response")," object"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},'fetch(\'//foo.com\').then(console.log);\n// Response {\n//   body: (...)\n//   bodyUsed: false\n//   headers: Headers {}\n//   ok: true\n//   redirected: false\n//   status: 200\n//   statusText: "OK"\n//   type: "basic"\n//   url: "https://foo.com/"\n// }\n\nfetch(\'//foo.com/redirect-me\').then(console.log);\n// Response {\n//   body: (...)\n//   bodyUsed: false\n//   headers: Headers {}\n//   ok: true\n//   redirected: true\n//   status: 200\n//   statusText: "OK"\n//   type: "basic"\n//   url: "https://foo.com/redirected-url/"\n// }\n\nfetch(\'//foo.com/does-not-exist\').then(console.log);\n// Response {\n//   body: (...)\n//   bodyUsed: false\n//   headers: Headers {}\n//   ok: false\n//   redirected: true\n//   status: 404\n//   statusText: "Not Found"\n//   type: "basic"\n//   url: "https://foo.com/does-not-exist/"\n// }\n\nfetch(\'//foo.com/throws-error\').then(console.log);\n// Response {\n//   body: (...)\n//   bodyUsed: false\n//   headers: Headers {}\n//   ok: false\n//   redirected: true\n//   status: 500\n//   statusText: "Internal Server Error"\n//   type: "basic"\n//   url: "https://foo.com/throws-error/"\n// }\n')),(0,r.kt)("h4",{id:"fetch-streaming"},"Fetch Streaming"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Request"),"/",(0,r.kt)("inlineCode",{parentName:"p"},"Response")," ",(0,r.kt)("inlineCode",{parentName:"p"},"body")," (",(0,r.kt)("inlineCode",{parentName:"p"},"ReadableStream"),") methods:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"text()"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"json()"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"formData()"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"arrayBuffer()"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"blob()"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"bodyUsed"),": \u5e03\u5c14\u503c, \u8868\u793a ",(0,r.kt)("inlineCode",{parentName:"li"},"ReadableStream")," \u662f\u5426\u5df2\u6444\u53d7 (",(0,r.kt)("inlineCode",{parentName:"li"},"disturbed"),").")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"fetch('https://fetch.spec.whatwg.org/')\n  .then(response => response.body)\n  .then(body => {\n    const reader = body.getReader();\n\n    function processNextChunk({ value, done }) {\n      if (done) {\n        return;\n      }\n\n      console.log(value);\n      return reader.read().then(processNextChunk);\n    }\n\n    return reader.read().then(processNextChunk);\n  });\n// { value: Uint8Array{}, done: false }\n// { value: Uint8Array{}, done: false }\n// { value: Uint8Array{}, done: false }\n// ...\n\nfetch('https://fetch.spec.whatwg.org/')\n  .then(response => response.body)\n  .then(async body => {\n    const reader = body.getReader();\n\n    while (true) {\n      const { value, done } = await reader.read();\n\n      if (done) {\n        break;\n      }\n\n      console.log(value);\n    }\n  });\n// { value: Uint8Array{}, done: false }\n// { value: Uint8Array{}, done: false }\n// { value: Uint8Array{}, done: false }\n// ...\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"fetch('https://fetch.spec.whatwg.org/')\n  .then(response => response.body)\n  .then(async body => {\n    const reader = body.getReader();\n    const asyncIterable = {\n      [Symbol.asyncIterator]() {\n        return {\n          next() {\n            return reader.read();\n          },\n        };\n      },\n    };\n\n    for await (const chunk of asyncIterable) {\n      console.log(chunk);\n    }\n  });\n// { value: Uint8Array{}, done: false }\n// { value: Uint8Array{}, done: false }\n// { value: Uint8Array{}, done: false }\n// ...\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},'async function* streamGenerator(stream) {\n  const reader = stream.getReader();\n\n  try {\n    while (true) {\n      const { value, done } = await reader.read();\n\n      if (done) {\n        break;\n      }\n\n      yield value;\n    }\n  } finally {\n    reader.releaseLock();\n  }\n}\n\nconst decoder = new TextDecoder();\n\nfetch(\'https://fetch.spec.whatwg.org/\')\n  .then(response => response.body)\n  .then(async body => {\n    for await (const chunk of streamGenerator(body)) {\n      console.log(decoder.decode(chunk, { stream: true }));\n    }\n  });\n// <!doctype html><html lang="en"> ...\n// whether a <a data-link-type="dfn" href="#concept-header" ...\n// result to <var>rangeValue</var>. ...\n// ...\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},'fetch(\'https://fetch.spec.whatwg.org/\')\n  .then(response => response.body)\n  .then(body => {\n    const reader = body.getReader();\n    // \u521b\u5efa\u7b2c\u4e8c\u4e2a\u6d41\n    return new ReadableStream({\n      async start(controller) {\n        try {\n          while (true) {\n            const { value, done } = await reader.read();\n\n            if (done) {\n              break;\n            }\n\n            // \u5c06\u4e3b\u4f53\u6d41\u7684\u5757\u63a8\u5230\u7b2c\u4e8c\u4e2a\u6d41\n            controller.enqueue(value);\n          }\n        } finally {\n          controller.close();\n          reader.releaseLock();\n        }\n      },\n    });\n  })\n  .then(secondaryStream => new Response(secondaryStream))\n  .then(response => response.text())\n  .then(console.log);\n// <!doctype html><html lang="en"><head><meta charset="utf-8"> ...\n')),(0,r.kt)("h3",{id:"websocket"},"WebSocket"),(0,r.kt)("h4",{id:"websocket-message-header"},"WebSocket Message Header"),(0,r.kt)("p",null,"Request Header:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"GET /chat HTTP/1.1\nHost: example.com\nUpgrade: websocket\nConnection: Upgrade\nSec-WebSocket-Key: 16-byte, base64 encoded\nSec-WebSocket-Version: 13\nSec-Websocket-Protocol: protocol [,protocol]*\nSec-Websocket-Extension: extension [,extension]*\n")),(0,r.kt)("p",null,"Response Header:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'HTTP/1.1 101 "Switching Protocols" or other description\nUpgrade: websocket\nConnection: Upgrade\nSec-WebSocket-Accept: 20-byte, MD5 hash in base64\nSec-Websocket-Protocol: protocol [,protocol]*\nSec-Websocket-Extension: extension [,extension]*\n')),(0,r.kt)("h4",{id:"websocket-basic-usage"},"WebSocket Basic Usage"),(0,r.kt)("p",null,"\u901a\u4fe1\u529f\u80fd:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"data"),":",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"string"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ArrayBuffer"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Blob"),"."))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"readyState"),":",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"WebSocket.OPENING"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"0"),", \u8fde\u63a5\u6b63\u5728\u5efa\u7acb."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"WebSocket.OPEN"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"1"),", \u8fde\u63a5\u5df2\u7ecf\u5efa\u7acb."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"WebSocket.CLOSING"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"2"),", \u8fde\u63a5\u6b63\u5728\u5173\u95ed."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"WebSocket.CLOSE"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"3"),", \u8fde\u63a5\u5df2\u7ecf\u5173\u95ed.")))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"function WebSocketTest() {\n  if ('WebSocket' in window) {\n    alert('WebSocket is supported by your Browser!');\n    // Let us open a web socket\n    const ws = new WebSocket('ws://localhost:9998/echo');\n\n    ws.onopen = function () {\n      // WebSocket is connected, send data using send()\n      ws.send('Message to send');\n      alert('Message is sent...');\n    };\n\n    ws.onmessage = function (event) {\n      const receivedMessage = event.data;\n      alert('Message is received...');\n    };\n\n    ws.onclose = function (event) {\n      // websocket is closed.\n      console.log(\n        `As clean? ${event.wasClean} Code=${event.code} Reason=${event.reason}`\n      );\n    };\n\n    ws.onerror = function () {\n      alert('Connection error.');\n    };\n  } else {\n    // The browser doesn't support WebSocket\n    alert('WebSocket NOT supported by your Browser!');\n  }\n}\n")),(0,r.kt)("h4",{id:"websocket-heartbeat-mechanism"},"WebSocket HeartBeat Mechanism"),(0,r.kt)("p",null,"\u8fde\u63a5\u7ec8\u6b62\u65f6, WebSocket \u4e0d\u4f1a\u81ea\u52a8\u6062\u590d,\n\u9700\u8981\u81ea\u5df1\u5b9e\u73b0, \u901a\u5e38\u4e3a\u4e86\u4fdd\u6301\u8fde\u63a5\u72b6\u6001, \u9700\u8981\u589e\u52a0\u5fc3\u8df3\u673a\u5236."),(0,r.kt)("p",null,"\u6bcf\u9694\u4e00\u6bb5\u65f6\u95f4\u4f1a\u5411\u670d\u52a1\u5668\u53d1\u9001\u4e00\u4e2a\u6570\u636e\u5305, \u544a\u8bc9\u670d\u52a1\u5668\u81ea\u5df1 Alive,\n\u670d\u52a1\u5668\u7aef\u5982\u679c Alive, \u5c31\u4f1a\u56de\u4f20\u4e00\u4e2a\u6570\u636e\u5305\u7ed9\u5ba2\u6237\u7aef.\n\u4e3b\u8981\u5728\u4e00\u4e9b",(0,r.kt)("strong",{parentName:"p"},"\u957f\u65f6\u95f4\u8fde\u63a5"),"\u7684\u5e94\u7528\u573a\u666f\u9700\u8981\u8003\u8651\u5fc3\u8df3\u673a\u5236\u53ca\u91cd\u8fde\u673a\u5236,\n\u4ee5\u4fdd\u8bc1\u957f\u65f6\u95f4\u7684\u8fde\u63a5\u53ca\u6570\u636e\u4ea4\u4e92."),(0,r.kt)("h3",{id:"restful"},"RESTful"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Client - Server architecture"),(0,r.kt)("li",{parentName:"ul"},"Stateless"),(0,r.kt)("li",{parentName:"ul"},"Cacheable"),(0,r.kt)("li",{parentName:"ul"},"Layer system"),(0,r.kt)("li",{parentName:"ul"},"Code via need"),(0,r.kt)("li",{parentName:"ul"},"Isomorphic interface")),(0,r.kt)("h3",{id:"https"},"HTTPS"),(0,r.kt)("p",null,"HyperText Transfer Protocol (HTTP) + Transport Layer Security (TLS):"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u9a8c\u8bc1\u8eab\u4efd: \u901a\u8fc7\u8bc1\u4e66\u8ba4\u8bc1\u5ba2\u6237\u7aef\u8bbf\u95ee\u7684\u662f\u81ea\u5df1\u7684\u670d\u52a1\u5668."),(0,r.kt)("li",{parentName:"ul"},"\u5185\u5bb9\u52a0\u5bc6: \u91c7\u7528\u6df7\u5408\u52a0\u5bc6\u6280\u672f (\u7ed3\u5408\u5bf9\u79f0\u52a0\u5bc6\u548c\u975e\u5bf9\u79f0\u52a0\u5bc6\u6280\u672f), \u4e2d\u95f4\u8005\u65e0\u6cd5\u76f4\u63a5\u67e5\u770b\u660e\u6587\u5185\u5bb9."),(0,r.kt)("li",{parentName:"ul"},"\u4fdd\u62a4\u6570\u636e\u5b8c\u6574\u6027: \u9632\u6b62\u4f20\u8f93\u7684\u5185\u5bb9\u88ab\u4e2d\u95f4\u4eba\u5192\u5145\u6216\u8005\u7be1\u6539."),(0,r.kt)("li",{parentName:"ul"},"CA (Certificate Authority) \u8ba4\u8bc1\u4f53\u7cfb\u662f HTTPS \u9632\u6b62\u4e2d\u95f4\u4eba\u653b\u51fb (HTTP \u660e\u6587\u4f20\u8f93) \u7684\u6838\u5fc3,\n\u5ba2\u6237\u7aef\u9700\u8981\u5bf9\u670d\u52a1\u5668\u53d1\u6765\u7684\u8bc1\u4e66\u8fdb\u884c\u5b89\u5168\u6027\u6821\u9a8c (\u4f7f\u5f97\u4e2d\u95f4\u4eba\u65e0\u6cd5\u66ff\u6362\u8bc1\u4e66\u548c\u516c\u79c1\u94a5)."),(0,r.kt)("li",{parentName:"ul"},"\u901a\u8fc7 CA \u8ba4\u8bc1\u4f53\u7cfb\u907f\u514d\u4e86\u4e2d\u95f4\u4eba\u7a83\u53d6 AES \u5bc6\u94a5\u5e76\u53d1\u8d77\u62e6\u622a\u548c\u4fee\u6539 HTTP \u901a\u8baf\u7684\u62a5\u6587.")),(0,r.kt)("h4",{id:"https-\u901a\u4fe1\u8fc7\u7a0b"},"HTTPS \u901a\u4fe1\u8fc7\u7a0b"),(0,r.kt)("p",null,"\u8bc1\u4e66\u83b7\u53d6\u53ca\u9a8c\u8bc1\u8fc7\u7a0b (CA \u8ba4\u8bc1\u4f53\u7cfb):"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u6d4f\u89c8\u5668\u53d1\u8d77\u4e00\u4e2a HTTPS \u7684\u8bf7\u6c42."),(0,r.kt)("li",{parentName:"ul"},"\u670d\u52a1\u5668\u63a5\u6536\u5230\u8bf7\u6c42, \u8fd4\u56de\u4e00\u4e2a HTTPS \u8bc1\u4e66, \u8be5\u8bc1\u4e66\u5185\u5305\u542b\u670d\u52a1\u5668\u79c1\u94a5\u5bf9\u5e94\u7684\u516c\u94a5\u4fe1\u606f."),(0,r.kt)("li",{parentName:"ul"},"\u6d4f\u89c8\u5668\u901a\u8fc7 CA \u8ba4\u8bc1\u4f53\u7cfb (CA \u670d\u52a1\u5668) \u9a8c\u8bc1\u8bc1\u4e66\u662f\u5426\u5408\u6cd5 (\u6d4f\u89c8\u5668\u5730\u5740\u680f\u8fdb\u884c\u76f8\u5e94\u63d0\u793a).")),(0,r.kt)("p",null,"\u52a0\u5bc6\u5bc6\u94a5\u4f20\u8f93 (B \u7aef\u52a0\u5bc6 - \u4f20\u8f93 - S \u7aef\u89e3\u5bc6):"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u6d4f\u89c8\u5668\u7aef\u751f\u6210\u4e00\u4e2a\u968f\u673a\u6570\u5e76\u901a\u8fc7\u516c\u94a5\u52a0\u5bc6, \u4f20\u8f93\u7ed9\u670d\u52a1\u5668."),(0,r.kt)("li",{parentName:"ul"},"\u670d\u52a1\u5668\u4f7f\u7528\u79c1\u94a5\u5bf9\u968f\u673a\u6570\u8fdb\u884c\u89e3\u5bc6, \u5e76\u5b58\u50a8\u968f\u673a\u6570\u4f5c\u4e3a\u5bf9\u79f0\u52a0\u5bc6\u7684\u5bc6\u94a5.")),(0,r.kt)("p",null,"\u52a0\u5bc6\u62a5\u6587\u4f20\u8f93 (S \u7aef\u52a0\u5bc6 - \u4f20\u8f93 - B \u7aef\u89e3\u5bc6):"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u670d\u52a1\u5668\u4f7f\u7528\u968f\u673a\u6570\u5bf9\u6570\u636e\u8fdb\u884c\u5bf9\u79f0\u52a0\u5bc6, \u5e76\u5c06\u52a0\u5bc6\u4fe1\u606f\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef."),(0,r.kt)("li",{parentName:"ul"},"\u5ba2\u6237\u7aef\u83b7\u5f97\u52a0\u5bc6\u6570\u636e, \u4f7f\u7528\u968f\u673a\u6570\u4f5c\u4e3a\u5bc6\u94a5\u57fa\u4e8e\u5bf9\u79f0\u52a0\u5bc6\u7b97\u6cd5\u5bf9\u62a5\u6587\u8fdb\u884c\u89e3\u5bc6.")),(0,r.kt)("h4",{id:"https-\u5b89\u5168\u6027"},"HTTPS \u5b89\u5168\u6027"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5f53\u6d4f\u89c8\u5668\u83b7\u9a8c\u8bc1\u5047\u516c\u94a5\u4e0d\u5408\u6cd5\u65f6, \u4f1a\u5bf9\u7528\u6237\u8fdb\u884c\u98ce\u9669\u63d0\u793a, \u4f46\u7528\u6237\u4ecd\u53ef\u4ee5\u6388\u6743\u4fe1\u4efb\u8bc1\u4e66\u7ee7\u7eed\u64cd\u4f5c."),(0,r.kt)("li",{parentName:"ul"},"HTTPS \u91cd\u70b9\u5173\u6ce8\u4f20\u8f93\u5b89\u5168, \u65e0\u6cd5\u4fdd\u8bc1\u672c\u5730\u968f\u673a\u6570\u7684\u5b58\u50a8\u5b89\u5168 (\u6728\u9a6c, \u6d4f\u89c8\u5668\u6f0f\u6d1e).")),(0,r.kt)("h3",{id:"http-2"},"HTTP 2"),(0,r.kt)("p",null,"\u5728 HTTP/1.x \u4e2d, \u6bcf\u6b21\u8bf7\u6c42\u90fd\u4f1a\u5efa\u7acb\u4e00\u6b21 HTTP \u8fde\u63a5:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u4e32\u884c\u7684\u6587\u4ef6\u4f20\u8f93. \u5f53\u8bf7\u6c42 a \u6587\u4ef6\u65f6, b \u6587\u4ef6\u53ea\u80fd\u7b49\u5f85."),(0,r.kt)("li",{parentName:"ul"},"\u8fde\u63a5\u6570\u8fc7\u591a.")),(0,r.kt)("p",null,"HTTP/2 \u7684\u591a\u8def\u590d\u7528\u5c31\u662f\u4e3a\u4e86\u89e3\u51b3\u4e0a\u8ff0\u7684\u4e24\u4e2a\u6027\u80fd\u95ee\u9898.\n\u5728 HTTP/2 \u4e2d, \u6709\u4e24\u4e2a\u975e\u5e38\u91cd\u8981\u7684\u6982\u5ff5, \u5206\u522b\u662f\u5e27 (frame) \u548c\u6d41 (stream).\n\u5e27\u4ee3\u8868\u7740\u6700\u5c0f\u7684\u6570\u636e\u5355\u4f4d, \u6bcf\u4e2a\u5e27\u4f1a\u6807\u8bc6\u51fa\u8be5\u5e27\u5c5e\u4e8e\u54ea\u4e2a\u6d41, \u6d41\u4e5f\u5c31\u662f\u591a\u4e2a\u5e27\u7ec4\u6210\u7684\u6570\u636e\u6d41.\n\u591a\u8def\u590d\u7528, \u5c31\u662f\u5728\u4e00\u4e2a TCP \u8fde\u63a5\u4e2d\u53ef\u4ee5\u5b58\u5728\u591a\u6761\u6d41, \u907f\u514d\u961f\u5934\u963b\u585e\u95ee\u9898\u548c\u8fde\u63a5\u6570\u8fc7\u591a\u95ee\u9898."),(0,r.kt)("p",null,"HTTP/2 = ",(0,r.kt)("inlineCode",{parentName:"p"},"HTTP")," + ",(0,r.kt)("inlineCode",{parentName:"p"},"HPack / Stream")," + ",(0,r.kt)("inlineCode",{parentName:"p"},"TLS 1.2+")," + ",(0,r.kt)("inlineCode",{parentName:"p"},"TCP"),":"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u4e8c\u8fdb\u5236\u4f20\u8f93 (\u4e71\u5e8f\u4e8c\u8fdb\u5236\u5e27 Stream)."),(0,r.kt)("li",{parentName:"ul"},"Header \u538b\u7f29 (HPack)."),(0,r.kt)("li",{parentName:"ul"},"\u591a\u8def\u590d\u7528."),(0,r.kt)("li",{parentName:"ul"},"Server Push."),(0,r.kt)("li",{parentName:"ul"},"\u4e8b\u5b9e\u52a0\u5bc6 (Chrome/Firefox \u53ea\u652f\u6301 HTTP/2 over TLS 1.2+).")),(0,r.kt)("p",null,"HTTP/2 \u867d\u7136\u901a\u8fc7\u591a\u8def\u590d\u7528\u89e3\u51b3\u4e86 HTTP \u5c42\u7684\u961f\u5934\u963b\u585e, \u4f46\u4ecd\u7136\u5b58\u5728 TCP \u5c42\u7684\u961f\u5934\u963b\u585e."),(0,r.kt)("h3",{id:"http-3"},"HTTP 3"),(0,r.kt)("p",null,"HTTP/3 = ",(0,r.kt)("inlineCode",{parentName:"p"},"HTTP")," + ",(0,r.kt)("inlineCode",{parentName:"p"},"QPack / Stream")," + ",(0,r.kt)("inlineCode",{parentName:"p"},"QUIC / TLS 1.3+")," + ",(0,r.kt)("inlineCode",{parentName:"p"},"UDP"),":"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u89e3\u51b3\u591a\u6b21\u63e1\u624b\u9ad8\u5ef6\u8fdf\u95ee\u9898."),(0,r.kt)("li",{parentName:"ul"},"\u89e3\u51b3\u961f\u5934 (\u6570\u636e\u91cd\u4f20) \u963b\u585e (\u540e\u7eed\u6570\u636e) \u95ee\u9898."),(0,r.kt)("li",{parentName:"ul"},"QUIC \u534f\u8bae\u4fdd\u8bc1\u4f20\u8f93\u53ef\u9760/\u5b9e\u73b0\u5feb\u901f\u63e1\u624b/\u96c6\u6210 TLS \u52a0\u5bc6/\u5b9e\u73b0\u591a\u8def\u590d\u7528."),(0,r.kt)("li",{parentName:"ul"},"QUIC \u7ed9\u6bcf\u4e2a\u8bf7\u6c42\u6d41 (Stream ID) \u90fd\u5206\u914d\u4e00\u4e2a\u72ec\u7acb\u7684\u6ed1\u52a8\u7a97\u53e3, \u5b9e\u73b0\u65e0\u961f\u5934\u963b\u585e\u7684\u591a\u8def\u590d\u7528, \u89e3\u51b3 TCP \u5c42\u7684\u961f\u5934\u963b\u585e.")),(0,r.kt)("h3",{id:"http-response-status-codes"},"HTTP Response Status Codes"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Status"},"RFC 2616"),":"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Informational responses: 100\u2013199."),(0,r.kt)("li",{parentName:"ul"},"Successful responses: 200\u2013299.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"200 OK."),(0,r.kt)("li",{parentName:"ul"},"201 Created."),(0,r.kt)("li",{parentName:"ul"},"202 Accepted."))),(0,r.kt)("li",{parentName:"ul"},"Redirects: 300\u2013399.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"301 Moved Permanently."),(0,r.kt)("li",{parentName:"ul"},"302 Found."),(0,r.kt)("li",{parentName:"ul"},"304 Not Modified."),(0,r.kt)("li",{parentName:"ul"},"307 Temporary Redirect."),(0,r.kt)("li",{parentName:"ul"},"308 Permanent Redirect."))),(0,r.kt)("li",{parentName:"ul"},"Client errors: 400\u2013499.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"400 Bad Request."),(0,r.kt)("li",{parentName:"ul"},"401 Unauthorized."),(0,r.kt)("li",{parentName:"ul"},"403 Forbidden."),(0,r.kt)("li",{parentName:"ul"},"404 Not Found."),(0,r.kt)("li",{parentName:"ul"},"405 Method Not Allowed."),(0,r.kt)("li",{parentName:"ul"},"406 Not Acceptable."))),(0,r.kt)("li",{parentName:"ul"},"Server errors: 500\u2013599.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"500 Internal Server Error."),(0,r.kt)("li",{parentName:"ul"},"501 Not Implemented."),(0,r.kt)("li",{parentName:"ul"},"502 Bad Gateway."),(0,r.kt)("li",{parentName:"ul"},"503 Service Unavailable."),(0,r.kt)("li",{parentName:"ul"},"504 Gateway Timeout.")))),(0,r.kt)("p",null,"Use reasonable HTTP status codes:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"200: general success."),(0,r.kt)("li",{parentName:"ul"},"201: successful creation."),(0,r.kt)("li",{parentName:"ul"},"400: bad requests from client."),(0,r.kt)("li",{parentName:"ul"},"401: unauthorized requests."),(0,r.kt)("li",{parentName:"ul"},"403: missing permissions."),(0,r.kt)("li",{parentName:"ul"},"404: missing resources."),(0,r.kt)("li",{parentName:"ul"},"429: too many requests."),(0,r.kt)("li",{parentName:"ul"},"5xx: internal errors (these should be avoided at all costs).")),(0,r.kt)("h3",{id:"cors"},"CORS"),(0,r.kt)("p",null,"Cross Origin Resource Sharing:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Same origin:\nURLs (Uniform Resource Locator) with same ",(0,r.kt)("inlineCode",{parentName:"li"},"protocol + host + port"),"."),(0,r.kt)("li",{parentName:"ul"},"CORS-safeListed response header:\n",(0,r.kt)("inlineCode",{parentName:"li"},"Cache-Control"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"Content-Language"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"Content-Length"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"Content-Type"),",\n",(0,r.kt)("inlineCode",{parentName:"li"},"Expires"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"Last-Modified"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"Pragma"),".")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"Access-Control-Allow-Origin: *\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"Access-Control-Expose-Headers: X-Custom-Header, Content-Encoding\nAccess-Control-Expose-Headers: *\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"Access-Control-Allow-Credentials: true\nAccess-Control-Allow-Origin: https://example.com\nVary: Cookie, Origin\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"Access-Control-Max-Age: 600\nAccess-Control-Allow-Methods: Custom-Method, CUSTOM-METHOD\nAccess-Control-Allow-Headers: X-Custom-Header\n")),(0,r.kt)("h2",{id:"web-authentication"},"Web Authentication"),(0,r.kt)("h3",{id:"http-basic-authentication"},"HTTP Basic Authentication"),(0,r.kt)("p",null,"HTTP basic authentication is 401 authentication:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5ba2\u6237\u7aef\u5411\u670d\u52a1\u5668\u8bf7\u6c42\u6570\u636e:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},"Get /index.html HTTP/1.0\nHost:www.google.com\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u670d\u52a1\u5668\u5411\u5ba2\u6237\u7aef\u53d1\u9001\u9a8c\u8bc1\u8bf7\u6c42\u4ee3\u7801 ",(0,r.kt)("inlineCode",{parentName:"li"},"401")," ",(0,r.kt)("inlineCode",{parentName:"li"},'WWW-Authenticate: Basic realm="google.com"'))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},'HTTP/1.0 401 Unauthorized\nServer: SokEvo/1.0\nWWW-Authenticate: Basic realm="google.com"\nContent-Type: text/html\nContent-Length: xxx\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5f53\u7b26\u5408 HTTP/1.0 \u6216 HTTP/1.1 \u7684\u5ba2\u6237\u7aef\u6536\u5230 401 \u8fd4\u56de\u503c\u65f6,\n\u5c06\u81ea\u52a8\u5f39\u51fa\u4e00\u4e2a\u767b\u5f55\u7a97\u53e3, \u8981\u6c42\u7528\u6237\u8f93\u5165\u7528\u6237\u540d\u548c\u5bc6\u7801."),(0,r.kt)("li",{parentName:"ul"},"\u7528\u6237\u8f93\u5165\u7528\u6237\u540d\u548c\u5bc6\u7801\u540e, \u5c06\u7528\u6237\u540d\u53ca\u5bc6\u7801\u4ee5 BASE64 \u52a0\u5bc6\u65b9\u5f0f\u52a0\u5bc6, \u5e76\u5c06\u5bc6\u6587\u653e\u5165\u524d\u4e00\u6761\u8bf7\u6c42\u4fe1\u606f\u4e2d"),(0,r.kt)("li",{parentName:"ul"},"\u670d\u52a1\u5668\u6536\u5230\u4e0a\u8ff0\u8bf7\u6c42\u4fe1\u606f\u540e, \u5c06 Authorization \u5b57\u6bb5\u540e\u7684\u7528\u6237\u4fe1\u606f\u53d6\u51fa/\u89e3\u5bc6,\n\u5c06\u89e3\u5bc6\u540e\u7684\u7528\u6237\u540d\u53ca\u5bc6\u7801\u4e0e\u7528\u6237\u6570\u636e\u5e93\u8fdb\u884c\u6bd4\u8f83\u9a8c\u8bc1")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},"Get /index.html HTTP/1.0\nHost:www.google.com\nAuthorization: Basic d2FuZzp3YW5n\n")),(0,r.kt)("h3",{id:"session-cookie"},"Session Cookie"),(0,r.kt)("h4",{id:"session-cookie-basis"},"Session Cookie Basis"),(0,r.kt)("p",null,"HTTP \u534f\u8bae\u662f\u4e00\u4e2a\u65e0\u72b6\u6001\u7684\u534f\u8bae,\n\u670d\u52a1\u5668\u4e0d\u4f1a\u77e5\u9053\u5230\u5e95\u662f\u54ea\u4e00\u53f0\u6d4f\u89c8\u5668\u8bbf\u95ee\u4e86\u5b83,\n\u56e0\u6b64\u9700\u8981\u4e00\u4e2a\u6807\u8bc6\u7528\u6765\u8ba9\u670d\u52a1\u5668\u533a\u5206\u4e0d\u540c\u7684\u6d4f\u89c8\u5668.\nCookie \u5c31\u662f\u8fd9\u4e2a\u7ba1\u7406\u670d\u52a1\u5668\u4e0e\u5ba2\u6237\u7aef\u4e4b\u95f4\u72b6\u6001\u7684\u6807\u8bc6.\nResponse header with ",(0,r.kt)("inlineCode",{parentName:"p"},"Set-Cookie"),", Request header with ",(0,r.kt)("inlineCode",{parentName:"p"},"Cookie"),"."),(0,r.kt)("p",null,"\u6d4f\u89c8\u5668\u7b2c\u4e00\u6b21\u8bbf\u95ee\u670d\u52a1\u7aef, \u670d\u52a1\u7aef\u5c31\u4f1a\u521b\u5efa\u4e00\u6b21 Session, \u5728\u4f1a\u8bdd\u4e2d\u4fdd\u5b58\u6807\u8bc6\u8be5\u6d4f\u89c8\u5668\u7684\u4fe1\u606f.\nSession \u7f13\u5b58\u5728\u670d\u52a1\u7aef, Cookie \u7f13\u5b58\u5728\u5ba2\u6237\u7aef,\n\u4ed6\u4eec\u90fd\u7531\u670d\u52a1\u7aef\u751f\u6210, \u5b9e\u73b0 HTTP \u534f\u8bae\u7684\u72b6\u6001."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5ba2\u6237\u7aef\u53d1\u9001\u767b\u5f55\u4fe1\u606f (ID, Password)."),(0,r.kt)("li",{parentName:"ul"},"\u670d\u52a1\u5668\u6536\u5230\u5ba2\u6237\u7aef\u9996\u6b21\u8bf7\u6c42\u5e76\u9a8c\u8bc1\u6210\u529f\u540e,\n\u4f1a\u5728\u670d\u52a1\u5668\u7aef\u521b\u5efa Session \u5e76\u4fdd\u5b58\u552f\u4e00\u7684\u6807\u8bc6\u5b57\u7b26\u4e32 Session ID (Key-Value Store),\n\u5728 Response Header \u4e2d\u8bbe\u7f6e ",(0,r.kt)("inlineCode",{parentName:"li"},"Set-Cookie: <Session ID>"),"."),(0,r.kt)("li",{parentName:"ul"},"\u5ba2\u6237\u7aef\u540e\u7eed\u53d1\u9001\u8bf7\u6c42\u90fd\u9700\u5728 Request Header \u4e2d\u8bbe\u7f6e: ",(0,r.kt)("inlineCode",{parentName:"li"},"Cookie: <Session ID>"),"."),(0,r.kt)("li",{parentName:"ul"},"\u670d\u52a1\u5668\u6839\u636e ",(0,r.kt)("inlineCode",{parentName:"li"},"<Session ID>")," \u8fdb\u884c\u7528\u6237\u9a8c\u8bc1,\n\u5229\u7528 Session Cookie \u673a\u5236\u53ef\u4ee5\u7b80\u5355\u5730\u5b9e\u73b0",(0,r.kt)("strong",{parentName:"li"},"\u7528\u6237\u767b\u5f55\u72b6\u6001\u9a8c\u8bc1"),",\n\u4fdd\u62a4\u9700\u8981\u767b\u5f55\u6743\u9650\u624d\u80fd\u8bbf\u95ee\u7684\u8def\u7531\u670d\u52a1."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Max-Age")," priority higher than ",(0,r.kt)("inlineCode",{parentName:"li"},"Expires"),".\nWhen both to ",(0,r.kt)("inlineCode",{parentName:"li"},"null"),", cookie become ",(0,r.kt)("strong",{parentName:"li"},"session cookie"),".")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},"Set-Cookie: username=tazimi; domain=tazimi.dev; Expires=Wed, 21 Oct 2022 08:00:00\nSet-Cookie: username=tazimi; domain=tazimi.dev; path=/blog\nSet-Cookie: username=tazimi; domain=tazimi.dev; path=/blog; Secure; HttpOnly\nSet-Cookie: username=tazimi; domain=github.com\nSet-Cookie: height=100; domain=me.github.com\nSet-Cookie: weight=100; domain=me.github.com\n")),(0,r.kt)("h4",{id:"session-cookie-cons"},"Session Cookie Cons"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u8ba4\u8bc1\u65b9\u5f0f\u5c40\u9650\u4e8e\u5728\u6d4f\u89c8\u5668 (Cookie)."),(0,r.kt)("li",{parentName:"ul"},"\u975e HTTPS \u534f\u8bae\u4e0b\u4f7f\u7528 Cookie, \u5bb9\u6613\u53d7\u5230 CSRF \u8de8\u7ad9\u70b9\u8bf7\u6c42\u4f2a\u9020\u653b\u51fb."),(0,r.kt)("li",{parentName:"ul"},"Session ID \u4e0d\u5305\u542b\u5177\u4f53\u7528\u6237\u4fe1\u606f, \u9700\u8981 Key-Value Store (e.g ",(0,r.kt)("strong",{parentName:"li"},"Redis"),") \u6301\u4e45\u5316,\n\u5728\u5206\u5e03\u5f0f\u73af\u5883\u4e0b\u9700\u8981\u5728\u6bcf\u4e2a\u670d\u52a1\u5668\u4e0a\u90fd\u5907\u4efd, \u5360\u7528\u4e86\u5927\u91cf\u7684\u5b58\u50a8\u7a7a\u95f4.")),(0,r.kt)("h3",{id:"token-authentication"},"Token Authentication"),(0,r.kt)("h4",{id:"token-authentication-basis"},"Token Authentication Basis"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5ba2\u6237\u7aef\u53d1\u9001\u767b\u5f55\u4fe1\u606f (ID, Password)."),(0,r.kt)("li",{parentName:"ul"},"\u670d\u52a1\u7aef\u6536\u5230\u8bf7\u6c42\u9a8c\u8bc1\u6210\u529f\u540e, \u670d\u52a1\u7aef\u4f1a\u7b7e\u53d1\u4e00\u4e2a Token (\u5305\u542b\u7528\u6237\u4fe1\u606f) \u5e76\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef."),(0,r.kt)("li",{parentName:"ul"},"\u5ba2\u6237\u7aef\u6536\u5230 Token \u540e\u5b58\u50a8\u5230 Cookie \u6216 Local Storage,\n\u5ba2\u6237\u7aef\u6bcf\u6b21\u5411\u670d\u52a1\u7aef\u8bf7\u6c42\u90fd\u9700\u5728 Request Header \u4e2d\u8bbe\u7f6e: ",(0,r.kt)("inlineCode",{parentName:"li"},"Authorization: <Token>"),"."),(0,r.kt)("li",{parentName:"ul"},"\u670d\u52a1\u7aef\u6536\u5230\u8bf7\u6c42\u5e76\u9a8c\u8bc1 Token, \u6210\u529f\u53d1\u9001\u8d44\u6e90 (\u9274\u6743\u6210\u529f), \u4e0d\u6210\u529f\u53d1\u9001 401 \u9519\u8bef\u4ee3\u7801 (\u9274\u6743\u5931\u8d25).")),(0,r.kt)("h4",{id:"token-authentication-pros"},"Token Authentication Pros"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Token \u8ba4\u8bc1\u4e0d\u5c40\u9650\u4e8e\u6d4f\u89c8\u5668 (Cookie)."),(0,r.kt)("li",{parentName:"ul"},"\u4e0d\u4f7f\u7528 Cookie \u53ef\u4ee5\u89c4\u907f CSRF \u653b\u51fb."),(0,r.kt)("li",{parentName:"ul"},"Token \u4e2d\u5305\u542b\u4e86\u7528\u6237\u4fe1\u606f, \u4e0d\u9700\u8981 Key-Value Store \u6301\u4e45\u5316, \u5206\u5e03\u5f0f\u53cb\u597d.\n\u670d\u52a1\u5668\u7aef\u53d8\u6210\u65e0\u72b6\u6001, \u670d\u52a1\u5668\u7aef\u53ea\u9700\u8981\u6839\u636e\u5b9a\u4e49\u7684\u89c4\u5219\u6821\u9a8c Token \u5408\u6cd5\u6027.\n\u4e0a\u8ff0\u4e24\u70b9\u4f7f\u5f97 Token Authentication \u5177\u6709\u66f4\u597d\u7684\u6269\u5c55\u6027.")),(0,r.kt)("h4",{id:"token-authentication-cons"},"Token Authentication Cons"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Token \u8ba4\u8bc1 (\u52a0\u5bc6\u89e3\u5bc6\u8fc7\u7a0b) \u6bd4 Session Cookie \u66f4\u6d88\u8017\u6027\u80fd."),(0,r.kt)("li",{parentName:"ul"},"Token (\u5305\u542b\u7528\u6237\u4fe1\u606f) \u6bd4 Session ID \u5927, \u66f4\u5360\u5e26\u5bbd."),(0,r.kt)("li",{parentName:"ul"},"\u4e0d\u4fdd\u5b58 Session \u72b6\u6001, \u65e0\u6cd5\u4e2d\u6b62\u6216\u66f4\u6539 Token \u6743\u9650, Token \u5230\u671f\u524d\u4f1a\u59cb\u7ec8\u6709\u6548, \u5b58\u5728\u76d7\u7528\u98ce\u9669:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Token \u6709\u6548\u671f\u5e94\u77ed."),(0,r.kt)("li",{parentName:"ul"},"Token \u5e94\u4f7f\u7528 HTTPS \u534f\u8bae."),(0,r.kt)("li",{parentName:"ul"},"\u5bf9\u4e8e\u91cd\u8981\u6743\u9650, \u9700\u4f7f\u7528\u4e8c\u6b21\u9a8c\u8bc1 (Two Factor Authentication).")))),(0,r.kt)("h3",{id:"json-web-token"},"JSON Web Token"),(0,r.kt)("h4",{id:"json-web-token-basis"},"JSON Web Token Basis"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u57fa\u4e8e Token \u7684\u89e3\u51b3\u65b9\u6848\u4e2d\u6700\u5e38\u7528\u7684\u662f JWT."),(0,r.kt)("li",{parentName:"ul"},"\u670d\u52a1\u5668\u8ba4\u8bc1\u7528\u6237\u5bc6\u7801\u4ee5\u540e, \u751f\u6210\u4e00\u4e2a JSON \u5bf9\u8c61\u5e76\u7b7e\u540d\u52a0\u5bc6\u540e\u4f5c\u4e3a Token \u8fd4\u56de\u7ed9\u7528\u6237."),(0,r.kt)("li",{parentName:"ul"},"JSON \u5bf9\u8c61\u5305\u542b\u7528\u6237\u4fe1\u606f, \u7528\u6237\u8eab\u4efd, \u4ee4\u724c\u8fc7\u671f\u65f6\u95f4\u7b49:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Header: \u660e\u6587 Base64 \u7f16\u7801 JSON \u5bf9\u8c61, \u63cf\u8ff0 JWT \u7684\u5143\u6570\u636e.\n\u4e00\u822c\u4e3a Token \u7684\u52a0\u5bc6\u7b97\u6cd5\u548c Token \u7684\u7c7b\u578b, \u5982 ",(0,r.kt)("inlineCode",{parentName:"li"},'{"alg": "HS256","typ": "JWT"}'),"."),(0,r.kt)("li",{parentName:"ul"},"Payload: \u660e\u6587 Base64 \u7f16\u7801 JSOn \u5bf9\u8c61, \u5b58\u653e\u5b9e\u9645\u6570\u636e.\n\u6709 7 \u4e2a\u5b98\u65b9\u5b57\u6bb5\u548c\u90e8\u5206\u5b9a\u4e49\u79c1\u6709\u5b57\u6bb5, \u4e00\u822c\u5b58\u653e\u7528\u6237\u540d, \u7528\u6237\u8eab\u4efd, JWT \u63cf\u8ff0\u5b57\u6bb5."),(0,r.kt)("li",{parentName:"ul"},"Signature: \u5bf9 Header \u548c Payload \u7684\u7b7e\u540d, \u5229\u7528\u7b7e\u540d\u9a8c\u8bc1\u4fe1\u606f\u7684\u6b63\u786e\u6027, \u9632\u6b62\u6570\u636e\u7be1\u6539. \u7b7e\u540d\u9700\u8981\u670d\u52a1\u7aef\u4fdd\u5b58\u7684\u5bc6\u94a5."))),(0,r.kt)("li",{parentName:"ul"},"\u628a\u4e09\u4e2a\u90e8\u5206\u62fc\u6210\u4e00\u4e2a\u5b57\u7b26\u4e32, \u6bcf\u4e2a\u90e8\u5206\u4e4b\u95f4\u7528 ",(0,r.kt)("inlineCode",{parentName:"li"},".")," \u5206\u9694: ",(0,r.kt)("inlineCode",{parentName:"li"},"HeaderBase64.PayloadBase64.Signature"),"."),(0,r.kt)("li",{parentName:"ul"},"\u4e1a\u52a1\u63a5\u53e3\u7528\u6765\u9274\u6743\u7684 token \u4e3a ",(0,r.kt)("inlineCode",{parentName:"li"},"access token"),".\n\u8d8a\u662f\u6743\u9650\u654f\u611f\u7684\u4e1a\u52a1, ",(0,r.kt)("inlineCode",{parentName:"li"},"access token")," \u6709\u6548\u671f\u8db3\u591f\u77ed, \u4ee5\u907f\u514d\u88ab\u76d7\u7528."),(0,r.kt)("li",{parentName:"ul"},"\u4e00\u4e2a\u4e13\u95e8\u751f\u6210 ",(0,r.kt)("inlineCode",{parentName:"li"},"access token")," \u7684 token, \u79f0\u4e3a ",(0,r.kt)("inlineCode",{parentName:"li"},"refresh token"),".\n",(0,r.kt)("inlineCode",{parentName:"li"},"refresh token")," \u7528\u6765\u83b7\u53d6 ",(0,r.kt)("inlineCode",{parentName:"li"},"access token"),", \u6709\u6548\u671f\u66f4\u957f,\n\u901a\u8fc7\u72ec\u7acb\u670d\u52a1\u548c\u4e25\u683c\u7684\u8bf7\u6c42\u65b9\u5f0f\u589e\u52a0\u5b89\u5168\u6027.")),(0,r.kt)("h4",{id:"json-web-token-pros"},"JSON Web TOken Pros"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"JWT \u9ed8\u8ba4\u662f\u4e0d\u52a0\u5bc6."),(0,r.kt)("li",{parentName:"ul"},"JWT \u4e0d\u52a0\u5bc6\u7684\u60c5\u51b5\u4e0b, \u4e0d\u80fd\u5c06\u79d8\u5bc6\u6570\u636e\u5199\u5165 JWT."),(0,r.kt)("li",{parentName:"ul"},"JWT \u53ef\u4ee5\u52a0\u5bc6, \u751f\u6210\u539f\u59cb Token \u4ee5\u540e, \u53ef\u4ee5\u7528\u5bc6\u94a5\u518d\u52a0\u5bc6\u4e00\u6b21."),(0,r.kt)("li",{parentName:"ul"},"JWT \u4e0d\u4ec5\u53ef\u7528\u4e8e\u8ba4\u8bc1, \u4e5f\u53ef\u7528\u4e8e\u4ea4\u6362\u4fe1\u606f.\n\u6709\u6548\u4f7f\u7528 JWT, \u53ef\u4ee5\u964d\u4f4e\u670d\u52a1\u5668\u67e5\u8be2\u6570\u636e\u5e93\u7684\u6b21\u6570.")),(0,r.kt)("h4",{id:"json-web-token-cons"},"JSON Web Token Cons"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u4e0d\u4fdd\u5b58 Session \u72b6\u6001, \u65e0\u6cd5\u4e2d\u6b62\u6216\u66f4\u6539 Token \u6743\u9650, Token \u5230\u671f\u524d\u4f1a\u59cb\u7ec8\u6709\u6548, \u5b58\u5728\u76d7\u7528\u98ce\u9669:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"JWT \u6709\u6548\u671f\u5e94\u77ed."),(0,r.kt)("li",{parentName:"ul"},"JWT \u5e94\u4f7f\u7528 HTTPS \u534f\u8bae."),(0,r.kt)("li",{parentName:"ul"},"\u5bf9\u4e8e\u91cd\u8981\u6743\u9650, \u9700\u4f7f\u7528\u4e8c\u6b21\u9a8c\u8bc1 (Two Factor Authentication).")))),(0,r.kt)("h4",{id:"jwt-client"},"JWT Client"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"HTTP request with credential data (email/password) for first request,\nget token data or error code from first response."),(0,r.kt)("li",{parentName:"ul"},"Intercept token to ",(0,r.kt)("inlineCode",{parentName:"li"},"fetch"),"/",(0,r.kt)("inlineCode",{parentName:"li"},"axios")," request headers for rest requests",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Sent requests with token data."),(0,r.kt)("li",{parentName:"ul"},"Logout whenever token data inspire or deleted."))),(0,r.kt)("li",{parentName:"ul"},"Store token in ",(0,r.kt)("inlineCode",{parentName:"li"},"Redux"),"/",(0,r.kt)("inlineCode",{parentName:"li"},"Vuex")," global state."),(0,r.kt)("li",{parentName:"ul"},"Store token in ",(0,r.kt)("inlineCode",{parentName:"li"},"localStorage"),"/",(0,r.kt)("inlineCode",{parentName:"li"},"sessionStorage"),".")),(0,r.kt)("h3",{id:"oauth-authentication"},"OAuth Authentication"),(0,r.kt)("p",null,"OAuth (Open Authorization) \u662f\u4e00\u4e2a\u5f00\u653e\u6807\u51c6, \u4f5c\u7528\u4e8e\u7b2c\u4e09\u65b9\u6388\u6743\u548c\u7b2c\u4e09\u65b9\u8bbf\u95ee.\n\u7528\u6237\u6570\u636e\u7684\u6240\u6709\u8005\u544a\u8bc9\u7cfb\u7edf, \u540c\u610f\u6388\u6743\u7b2c\u4e09\u65b9\u5e94\u7528\u8fdb\u5165\u7cfb\u7edf, \u83b7\u53d6\u8fd9\u4e9b\u6570\u636e.\n\u7cfb\u7edf\u4ece\u800c\u4ea7\u751f\u4e00\u4e2a\u77ed\u671f\u8fdb\u5165\u4ee4\u724c (Token), \u7528\u6765\u4ee3\u66ff\u5bc6\u7801\u4f9b\u7b2c\u4e09\u65b9\u5e94\u7528\u4f7f\u7528."),(0,r.kt)("p",null,"\u7b2c\u4e09\u65b9\u5e94\u7528\u7533\u8bf7\u4ee4\u724c\u4e4b\u524d, \u90fd\u5fc5\u987b\u5148\u5230\u7cfb\u7edf\u5907\u6848, \u8bf4\u660e\u81ea\u5df1\u7684\u8eab\u4efd, \u7136\u540e\u4f1a\u62ff\u5230\u4e24\u4e2a\u8eab\u4efd\u8bc6\u522b\u7801:\nClient ID \u548c Client Secret. \u8fd9\u662f\u4e3a\u4e86\u9632\u6b62\u4ee4\u724c\u88ab\u6ee5\u7528, \u6ca1\u6709\u5907\u6848\u8fc7\u7684\u7b2c\u4e09\u65b9\u5e94\u7528\u62ff\u4e0d\u5230\u4ee4\u724c (Token)."),(0,r.kt)("p",null,"OAuth Token \u7279\u5f81:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u6388\u6743\u77ed (Short Expire Time)."),(0,r.kt)("li",{parentName:"ol"},"\u53ef\u64a4\u9500 (Revoke)."),(0,r.kt)("li",{parentName:"ol"},"\u6743\u9650\u5c0f (Scope).")),(0,r.kt)("h4",{id:"oauth-authentication-basis"},"OAuth Authentication Basis"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5728 GitHub Developer Settings \u4e2d\u5907\u6848\u7b2c\u4e09\u65b9\u5e94\u7528,\n\u62ff\u5230\u5c5e\u4e8e\u5b83\u7684\u5ba2\u6237\u7aef ID \u548c\u5ba2\u6237\u7aef\u5bc6\u94a5\n(3rd-Party Server vs Resource Owner)"),(0,r.kt)("li",{parentName:"ul"},"\u5728\u81ea\u5df1\u7684\u7b2c\u4e09\u65b9\u7f51\u7ad9\u63d0\u4f9b\u4e00\u4e2a GitHub \u767b\u5f55\u94fe\u63a5,\n\u7528\u6237\u70b9\u51fb\u8be5\u94fe\u63a5\u540e\u4f1a\u8df3\u8f6c\u5230 GitHub OAuth API\n",(0,r.kt)("inlineCode",{parentName:"li"},"https://github.com/login/oauth/authorize/?client_id=${clientID}"),"."),(0,r.kt)("li",{parentName:"ul"},"\u7528\u6237\u8df3\u8f6c\u5230 GitHub, \u901a\u8fc7\u9a8c\u8bc1\u5e76\u540c\u610f\u4f7f\u7528 GitHub \u8eab\u4efd\u767b\u5f55\u7b2c\u4e09\u65b9\u7f51\u7ad9,\n\u6b64\u65f6\u5c31\u4f1a\u5e26\u7740\u6388\u6743\u7801 Code \u8df3\u56de\u7b2c\u4e09\u65b9\u7f51\u7ad9."),(0,r.kt)("li",{parentName:"ul"},"\u7b2c\u4e09\u65b9\u7f51\u7ad9\u6536\u5230\u6388\u6743\u7801, \u5229\u7528\u6388\u6743\u7801, \u5ba2\u6237\u7aef ID, \u5ba2\u6237\u7aef\u5bc6\u94a5\u5411 GitHub \u8bf7\u6c42 ",(0,r.kt)("inlineCode",{parentName:"li"},"access_token"),"\u4ee4\u724c\n",(0,r.kt)("inlineCode",{parentName:"li"},"https://github.com/login/oauth/access_token?client_id=${clientID}&client_secret=${clientSecret}&code=${code}"),"\n(3rd-Party Server vs Authorization Server)"),(0,r.kt)("li",{parentName:"ul"},"\u7b2c\u4e09\u65b9\u7f51\u7ad9\u6536\u5230\u4ee4\u724c, \u53ef\u4ee5\u6682\u65f6\u62e5\u6709 GitHub \u4e00\u4e9b\u8bf7\u6c42\u7684\u6743\u9650\u6bd4\u5982\u7528\u6237\u4fe1\u606f,\n",(0,r.kt)("inlineCode",{parentName:"li"},"https://api.github.com/user?access_token=${accessToken}"),"\n\u6216\u8005 Request Header ",(0,r.kt)("inlineCode",{parentName:"li"},"Authorization: token ${accessToken}"),".\n\u53ef\u4ee5\u6784\u5efa\u7b2c\u4e09\u65b9\u7f51\u7ad9\u81ea\u5df1\u7684 Token, \u505a\u8fdb\u4e00\u6b65\u76f8\u5173\u9274\u6743\u64cd\u4f5c (\u5982 Session Cookie).\n(3rd-Party Server vs Resource Server)")),(0,r.kt)("h4",{id:"oauth-20"},"OAuth 2.0"),(0,r.kt)("p",null,"OAuth 2.0 \u5141\u8bb8\u81ea\u52a8\u66f4\u65b0\u4ee4\u724c.\n\u8d44\u6e90\u6240\u6709\u8005\u9881\u53d1\u4ee4\u724c\u65f6\u4e00\u6b21\u6027\u9881\u53d1\u4e24\u4e2a\u4ee4\u724c,\n\u4e00\u4e2a\u7528\u4e8e\u83b7\u53d6\u6570\u636e (Access Token),\n\u53e6\u4e00\u4e2a\u7528\u4e8e\u83b7\u53d6\u65b0\u7684\u4ee4\u724c (Refresh Token).\n\u4ee4\u724c\u5230\u671f\u524d, \u7b2c\u4e09\u65b9\u7f51\u7ad9\u4f7f\u7528 Refresh Token \u53d1\u8bf7\u6c42\u66f4\u65b0\u4ee4\u724c:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},"https://github.com/login/oauth/access_token\n?client_id=CLIENT_ID\n&client_secret=CLIENT_SECRET\n&grant_type=refresh_token\n&refresh_token=REFRESH_TOKEN\n")),(0,r.kt)("h4",{id:"oauth-usage"},"OAuth Usage"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Modern guide to ",(0,r.kt)("a",{parentName:"li",href:"https://fusionauth.io/learn/expert-advice/oauth/modern-guide-to-oauth"},"OAuth"),".")),(0,r.kt)("h3",{id:"single-sign-on"},"Single Sign On"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"SSO"),":\n\u5355\u70b9\u767b\u5f55\u8981\u6c42\u4e0d\u540c\u57df\u4e0b\u7684\u7cfb\u7edf",(0,r.kt)("strong",{parentName:"p"},"\u4e00\u6b21\u767b\u5f55, \u5168\u7ebf\u901a\u7528"),",\n\u901a\u5e38\u7531\u72ec\u7acb\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"SSO")," \u7cfb\u7edf\u8bb0\u5f55\u767b\u5f55\u72b6\u6001, \u4e0b\u53d1 ",(0,r.kt)("inlineCode",{parentName:"p"},"ticket"),",\n\u5404\u4e1a\u52a1\u7cfb\u7edf\u914d\u5408\u5b58\u50a8\u548c\u8ba4\u8bc1 ",(0,r.kt)("inlineCode",{parentName:"p"},"ticket"),"."),(0,r.kt)("h2",{id:"security"},"Security"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://eggjs.org/zh-cn/core/security.html"},"Web Security Checklist")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/nodesecurity/eslint-plugin-security"},"ESLint Node Security Tool")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://mp.weixin.qq.com/s/G4pME9xFHdWnFckgytnofQ"},"Defensive Design and Programming"))),(0,r.kt)("h3",{id:"content-security-policy-level-3"},"Content Security Policy Level 3"),(0,r.kt)("p",null,"CSP help prevent from XSS"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"{\n  \"header\": {\n    \"Content-Security-Policy\":\n      script-src 'nonce-random123' 'strict-dynamic' 'unsafe-eval';\n      object-src 'none';\n      base-uri 'none'\n  }\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'<script>\n  alert(\'xss\');\n<\/script>\n// XSS injected by attacker - blocked by CSP\n<script nonce="random123">\n  alert(\'this is fine!)\n<\/script>\n<script nonce="random123" src="https://cdnjs.com/lib.js"><\/script>\n')),(0,r.kt)("p",null,"nonce only CSP block 3rd scripts and dynamic scripts generate by trusted users,\n'strict-dynamic' can tackle it."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},"\x3c!-- Content-Security-Policy: script-src 'nonce-random123' 'strict-dynamic' --\x3e\n<script nonce=\"random123\">\n  const s = document.createElement('script)\n  s.src = '/path/to/script.js';\n  document.head.appendChild(s); // can execute correctly\n<\/script>\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'\x3c!-- Given this CSP header --\x3e\nContent-Security-Policy: script-src https://example.com/\n\n\x3c!-- The following third-party script will not be loaded or executed --\x3e\n<script src="https://not-example.com/js/library.js"><\/script>\n')),(0,r.kt)("h3",{id:"trusted-types"},"Trusted Types"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"TrustedURL"),(0,r.kt)("li",{parentName:"ul"},"TrustedHTML"),(0,r.kt)("li",{parentName:"ul"},"TrustedScript"),(0,r.kt)("li",{parentName:"ul"},"TrustedScriptURL")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// fallback policy\nTrustedTypes.createPolicy(\n  'default',\n  {\n    createHTML(s) {\n      console.error('Please fix! Insecure string assignment detected:', s);\n      return s;\n    },\n  },\n  true\n);\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// Content-Security-Policy-Report-Only: trusted-types myPolicy; report-uri /cspReport\nconst SanitizingPolicy = TrustedTypes.createPolicy(\n  'myPolicy',\n  {\n    createHTML: (s: string) => myCustomSanitizer(s),\n  },\n  false\n);\n\nconst trustedHTML = SanitizingPolicy.createHTML(foo);\nelement.innerHTML = trustedHTML;\n")),(0,r.kt)("h3",{id:"csrf"},"CSRF"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u786e\u4fdd ",(0,r.kt)("inlineCode",{parentName:"li"},"GET request")," \u6ca1\u6709\u526f\u4f5c\u7528."),(0,r.kt)("li",{parentName:"ul"},"\u786e\u4fdd ",(0,r.kt)("inlineCode",{parentName:"li"},"request")," \u6b63\u5e38\u6e20\u9053\u53d1\u8d77 (Hidden token check in form)."),(0,r.kt)("li",{parentName:"ul"},"\u5f00\u542f\u540c\u6e90\u7b56\u7565 (",(0,r.kt)("strong",{parentName:"li"},"Same Origin Policy"),")."),(0,r.kt)("li",{parentName:"ul"},"Addition Authentication: input password again.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"# Reject cross-origin requests to protect from\n# CSRF, XSSI & other bugs\ndef allow_request(req):\n  # Allow requests from browsers which don't send Fetch Metadata\n  if not req['sec-fetch-site']:\n    return True\n\n  # Allow same-site and browser-initiated requests\n  if req['sec-fetch-site'] in ('same-origin', 'same-site', 'none'):\n    return True\n\n  # Allow simple top-level navigation from anywhere\n  if req['sec-fetch-mode'] == 'navigate' and req.method == 'GET':\n    return True\n\n  return False\n")),(0,r.kt)("h3",{id:"sandbox"},"Sandbox"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"eval()"),":\n\u5b83\u80fd\u8bbf\u95ee\u6267\u884c\u4e0a\u4e0b\u6587\u4e2d\u7684\u5c40\u90e8\u53d8\u91cf, \u4e5f\u80fd\u8bbf\u95ee\u6240\u6709\u5168\u5c40\u53d8\u91cf, \u662f\u4e00\u4e2a\u975e\u5e38\u5371\u9669\u7684\u51fd\u6570."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"new Function()"),":\n\u5728\u5168\u5c40\u4f5c\u7528\u57df\u4e2d\u88ab\u521b\u5efa, \u4e0d\u4f1a\u521b\u5efa\u95ed\u5305.\n\u5f53\u8fd0\u884c\u51fd\u6570\u65f6, \u53ea\u80fd\u8bbf\u95ee\u672c\u5730\u53d8\u91cf\u548c\u5168\u5c40\u53d8\u91cf,\n\u4e0d\u80fd\u8bbf\u95ee Function \u6784\u9020\u5668\u88ab\u8c03\u7528\u751f\u6210\u7684\u4e0a\u4e0b\u6587\u7684\u4f5c\u7528\u57df."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"with () {}"),":\n\u5b83\u9996\u5148\u4f1a\u5728\u4f20\u5165\u7684\u5bf9\u8c61\u4e2d\u67e5\u627e\u5bf9\u5e94\u7684\u53d8\u91cf,\n\u5982\u679c\u627e\u4e0d\u5230\u5c31\u4f1a\u5f80\u66f4\u4e0a\u5c42\u7684\u5168\u5c40\u4f5c\u7528\u57df\u53bb\u67e5\u627e,\n\u5bfc\u81f4\u5168\u5c40\u73af\u5883\u6c61\u67d3.")),(0,r.kt)("p",null,"ProxySandbox:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"function sandbox(code) {\n  code = `with (sandbox) {${code}}`;\n  // eslint-disable-next-line no-new-func\n  const fn = new Function('sandbox', code);\n\n  return function (sandbox) {\n    const sandboxProxy = new Proxy(sandbox, {\n      has(target, key) {\n        return true;\n      },\n      get(target, key) {\n        if (key === Symbol.unscopables) return undefined;\n        return target[key];\n      },\n    });\n    return fn(sandboxProxy);\n  };\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// \u7b80\u5316\u4f2a\u4ee3\u7801\u793a\u4f8b\nconst frame = document.body.appendChild(\n  document.createElement('iframe', {\n    src: 'about:blank',\n    sandbox:\n      'allow-scripts allow-same-origin allow-popups allow-presentation allow-top-navigation',\n    style: 'display: none;',\n  })\n);\n\nconst window = new Proxy(frame.contentWindow, {});\nconst document = new Proxy(document, {});\nconst location = new Proxy(window.location);\nconst history = new Proxy(window.history);\n\n// eslint-disable-next-line no-new-func\nconst sandbox = new Function(`\n  return function ({ window, location, history, document }, code){\n    with(window) {\n      ${code}\n    }\n}`);\n\nsandbox().call(window, { window, location, history, document }, code);\n")),(0,r.kt)("h3",{id:"user-privacy"},"User Privacy"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://browserleaks.com"},"Browser Leaks"))),(0,r.kt)("h4",{id:"user-fingerprint"},"User Fingerprint"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Use Canvas or WebGL to generate user\n",(0,r.kt)("a",{parentName:"li",href:"https://yinzhicao.org/TrackingFree/crossbrowsertracking_NDSS17.pdf"},"fingerprint"),"."),(0,r.kt)("li",{parentName:"ul"},"Location information:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Country."),(0,r.kt)("li",{parentName:"ul"},"Region."),(0,r.kt)("li",{parentName:"ul"},"City."),(0,r.kt)("li",{parentName:"ul"},"Zip code."),(0,r.kt)("li",{parentName:"ul"},"Latitude."),(0,r.kt)("li",{parentName:"ul"},"Longitude."),(0,r.kt)("li",{parentName:"ul"},"Timezone."))),(0,r.kt)("li",{parentName:"ul"},"Connection information:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"IP address."),(0,r.kt)("li",{parentName:"ul"},"Internet service provider."),(0,r.kt)("li",{parentName:"ul"},"Organization."),(0,r.kt)("li",{parentName:"ul"},"ASN."),(0,r.kt)("li",{parentName:"ul"},"Tor browser detection."))),(0,r.kt)("li",{parentName:"ul"},"Software information:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Browser."),(0,r.kt)("li",{parentName:"ul"},"Browser plugins detection."),(0,r.kt)("li",{parentName:"ul"},"Operation system."),(0,r.kt)("li",{parentName:"ul"},"User agent."),(0,r.kt)("li",{parentName:"ul"},"Preferred language."),(0,r.kt)("li",{parentName:"ul"},"Cookies enabled detection."),(0,r.kt)("li",{parentName:"ul"},"Java enabled detection."),(0,r.kt)("li",{parentName:"ul"},"DNT header enabled detection."),(0,r.kt)("li",{parentName:"ul"},"Automated browser detection."),(0,r.kt)("li",{parentName:"ul"},"Content filters detection: Adblock detection."))),(0,r.kt)("li",{parentName:"ul"},"Hardware information:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Screen resolution."),(0,r.kt)("li",{parentName:"ul"},"Color resolution."),(0,r.kt)("li",{parentName:"ul"},"Device type."),(0,r.kt)("li",{parentName:"ul"},"Device memory."),(0,r.kt)("li",{parentName:"ul"},"CPU cores."),(0,r.kt)("li",{parentName:"ul"},"Max touch points."),(0,r.kt)("li",{parentName:"ul"},"WebGL vendor."),(0,r.kt)("li",{parentName:"ul"},"WebGL renderer."),(0,r.kt)("li",{parentName:"ul"},"Battery level."),(0,r.kt)("li",{parentName:"ul"},"Batter status.")))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"function getCanvasFingerprint() {\n  const canvas = document.createElement('canvas');\n  const context = canvas.getContext('2d');\n  context.font = '18pt Arial';\n  context.textBaseline = 'top';\n  context.fillText('Hello, user.', 2, 2);\n  return canvas.toDataURL('image/jpeg');\n}\n\ngetCanvasFingerprint();\n")),(0,r.kt)("h3",{id:"crypto"},"Crypto"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto"},"Web Crypto API")),(0,r.kt)("li",{parentName:"ul"},"\u516c\u94a5\u52a0\u5bc6\u79c1\u94a5\u89e3\u5bc6: \u53ea\u6709\u79c1\u94a5\u62e5\u6709\u8005\u53ef\u4ee5\u83b7\u53d6\u4fe1\u606f."),(0,r.kt)("li",{parentName:"ul"},"\u516c\u94a5\u9a8c\u8bc1\u79c1\u94a5\u7b7e\u540d: \u53ea\u6709\u79c1\u94a5\u62e5\u6709\u8005\u53ef\u4ee5\u53d1\u5e03\u7b7e\u540d.")),(0,r.kt)("h2",{id:"devops"},"DevOps"),(0,r.kt)("h3",{id:"static-assets"},"Static Assets"),(0,r.kt)("p",null,"Fingerprinting is a technique that makes the name of a file,\ndependent on the ",(0,r.kt)("strong",{parentName:"p"},"contents")," of the file,\nnot on the ",(0,r.kt)("strong",{parentName:"p"},"timestamp")," differ from servers.\nWhen the file contents change,\nthe filename is also changed.\nFor content that is static or infrequently changed,\nthis provides an easy way to tell whether two versions of a file are identical,\neven across different servers or deployment dates."),(0,r.kt)("p",null,"When a filename is unique and based on its content, HTTP headers\ncan be set to encourage ",(0,r.kt)("strong",{parentName:"p"},"caches"),"(code: ",(0,r.kt)("inlineCode",{parentName:"p"},"200"),") everywhere\n(whether at CDNs, at ISPs, in networking equipment, or in web browsers)\nto keep their own copy of the content.\nWhen the content is updated(),\nthe fingerprint will change.\nThis will cause the remote clients to request a new copy of the content.\nThis is generally known as cache busting."),(0,r.kt)("h3",{id:"ci-system"},"CI System"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Full builds upon continuous deployment."),(0,r.kt)("li",{parentName:"ul"},"Incremental builds are a product of time.")),(0,r.kt)("h3",{id:"release-system"},"Release System"),(0,r.kt)("h3",{id:"blue-green-deployment"},"Blue Green Deployment"),(0,r.kt)("p",null,"\u4e24\u5957\u7cfb\u7edf, \u4e00\u5957\u7a33\u5b9a\u7684\u7eff\u8272\u7cfb\u7edf, \u4e00\u5957\u5373\u5c06\u53d1\u5e03\u7684\u84dd\u8272\u7cfb\u7edf.\n\u4e0d\u65ad\u5207\u6362\u5e76\u8fed\u4ee3\u53d1\u5e03\u5230\u751f\u4ea7\u73af\u5883\u4e2d."),(0,r.kt)("h3",{id:"rolling-update"},"Rolling Update"),(0,r.kt)("p",null,"\u591a\u4e2a\u96c6\u7fa4\u5b9e\u4f8b\u7684\u670d\u52a1\u4e2d, \u5728\u4e0d\u5f71\u54cd\u670d\u52a1\u7684\u60c5\u51b5\u4e0b,\n\u505c\u6b62\u4e00\u4e2a\u6216\u591a\u4e2a\u5b9e\u4f8b, \u9010\u6b65\u8fdb\u884c\u7248\u672c\u66f4\u65b0."),(0,r.kt)("h3",{id:"gray-release"},"Gray Release"),(0,r.kt)("h4",{id:"gray-release-introduction"},"Gray Release Introduction"),(0,r.kt)("p",null,"Canary Release: \u5168\u91cf\u6216\u589e\u91cf\u90e8\u7f72\u65b0\u6587\u4ef6, \u5e76\u9010\u6b65\u628a\u6d41\u91cf\u5207\u6362\u81f3\u65b0 CDN URL.\n\u6839\u636e\u7070\u5ea6\u767d\u540d\u5355, \u5c06\u7070\u5ea6\u6d4b\u8bd5\u7528\u6237\u7684 CDN Assets\n\u66f4\u6362\u81f3\u4e0d\u540c Version Number \u6216\u8005 Fingerprint \u7684\u65b0\u7248\u672c\u524d\u7aef\u9875\u9762\u6587\u4ef6."),(0,r.kt)("h4",{id:"gray-release-solution"},"Gray Release Solution"),(0,r.kt)("p",null,"\u901a\u8fc7\u7070\u5ea6\u53d1\u5e03\u6536\u96c6\u7528\u6237\u53cd\u9988 (\u8f6c\u5316\u7387\u7b49\u6307\u6807),\n\u51b3\u5b9a\u540e\u7eed\u662f\u5426\u5168\u9762\u5c06\u6240\u6709\u6d41\u91cf\u5207\u81f3\u65b0\u7248\u672c,\n\u6216\u8005\u5b8c\u5168\u653e\u5f03\u65b0\u7248\u672c,\n\u4ea6\u6216\u662f\u901a\u8fc7 FLAGS \u7ed3\u5408\u7528\u6237\u7279\u5f81\u56fe\u50cf,\n(\u5982\u7528\u6237\u7ea7\u522b, UA, Cookie\nLocation, IP,\nFeature List \u7b49)\n\u53ea\u5411\u90e8\u5206\u6d41\u91cf\u6295\u653e\u65b0\u7248\u672c.\n\u53ef\u4ee5\u5b9e\u73b0\u5343\u4eba\u5343\u9875,\n\u6bcf\u4e2a\u7528\u6237\u83b7\u5f97\u7531\u4e0d\u540c\u7684\u529f\u80fd (FLAGS \u5f00\u542f\u5173\u95ed) \u7ec4\u6210\u7684\u4e0d\u540c\u9875\u9762."),(0,r.kt)("p",null,"\u4e1a\u754c\u6210\u719f\u7684\u7070\u5ea6\u65b9\u6848:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u7b80\u5355\u7070\u5ea6\u903b\u8f91\u901a\u8fc7 Nginx \u914d\u7f6e\u505a\u89c4\u5219\u5224\u65ad(\u8def\u7531, \u53c2\u6570, IP, Cookie \u7b49), upstream \u5230\u4e0d\u540c\u7684\u670d\u52a1\u5668:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u65b0\u4ee3\u7801\u90e8\u7f72\u5230 A \u8fb9."),(0,r.kt)("li",{parentName:"ul"},"\u7b26\u5408\u7070\u5ea6\u7b56\u7565\u7684\u5c0f\u90e8\u5206\u6d41\u91cf\u5207\u5230 A \u8fb9, \u5269\u4f59\u5927\u90e8\u5206\u6d41\u91cf\u4ecd\u53bb\u5f80 B \u8fb9"),(0,r.kt)("li",{parentName:"ul"},"\u9a8c\u8bc1 A \u8fb9\u529f\u80fd\u662f\u5426\u6b63\u5e38\u53ef\u7528/\u597d\u7528"),(0,r.kt)("li",{parentName:"ul"},"\u9a8c\u8bc1\u65e0\u8bef\u540e, \u5927\u90e8\u5206\u6d41\u91cf\u8f6c\u5230 A \u8fb9, \u7070\u5ea6\u6d41\u91cf\u53bb\u5f80 B \u8fb9"),(0,r.kt)("li",{parentName:"ul"},"\u9a8c\u8bc1 B \u8fb9\u529f\u80fd\u662f\u5426\u6b63\u5e38\u53ef\u7528/\u597d\u7528"),(0,r.kt)("li",{parentName:"ul"},"\u9a8c\u8bc1\u65e0\u8bef\u540e, \u6d41\u91cf\u50cf\u5f80\u5e38\u4e00\u6837\u5747\u5206\u5230 AB \u8fb9")))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# Canary Deployment\nmap $COOKIE_canary $group {\n  # canary account\n  ~*devui$ server_canary;\n  default server_default;\n}\n\n# \u6d41\u91cf\u5747\u5206, \u6ce8\u91ca\u6389\u5176\u4e2d\u67d0\u4e00\u8fb9, \u53e6\u4e00\u8fb9\u4e3a\u7070\u5ea6\u6d41\u91cf\u8bbf\u95ee\u8fb9\nupstream server_canary {\n  server 11.11.11.11:8000 weight=1 max_fails=1 fail_timeout=30s;\n  server 22.22.22.22 weight=1 max_fails=1 fail_timeout=30s;\n}\n\n# \u6d41\u91cf\u5747\u5206, \u6ce8\u91ca\u6389\u5176\u4e2d\u67d0\u4e00\u8fb9, \u53e6\u4e00\u8fb9\u4e3a\u6b63\u5e38\u6d41\u91cf\u8bbf\u95ee\u8fb9\nupstream server_default {\n  server 11.11.11.11:8000 weight=2 max_fails=1 fail_timeout=30s;\n  server 22.22.22.22 weight=2 max_fails=1 fail_timeout=30s;\n}\n\n# \u914d\u7f6e 8000 \u7aef\u53e3\u7684\u8f6c\u53d1\u89c4\u5219, \u5e76\u4e14 expose port\nserver {\n  listen 8000;\n  server_name _;\n  root /var/canaryDemo;\n\n  # Load configuration files for the default server block.\n  include /etc/nginx/default.d/*.conf;\n\n  location / {\n    root /var/canaryDemo;\n    index index.html;\n    try_files $uri $uri/ /index.html;\n  }\n}\n\nserver {\n  listen 80 default_server;\n  listen [::]:80 default_server;\n  server_name _;\n  # root /usr/share/nginx/html;\n  root /var/canaryDemo;\n\n  # Load configuration files for the default server block.\n  include /etc/nginx/default.d/*.conf;\n\n  location / {\n    proxy_pass http://$group;\n    # root /var/canaryDemo;\n    # index index.html;\n  }\n\n  error_page 404 /404.html;\n    location = /40x.html {\n  }\n\n  error_page 500 502 503 504 /50x.html;\n  location = /50x.h\n}\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u590d\u6742\u7070\u5ea6\u903b\u8f91\u901a\u8fc7 Nginx + Lua \u65b0\u589e\u4e00\u4e2a\u7070\u5ea6\u4e2d\u5fc3\u670d\u52a1,\n\u7ed3\u5408\u4e1a\u52a1\u6765\u505a\u6d41\u91cf\u7684\u7070\u5ea6\u4e0e\u5207\u6362, \u63a7\u5236 HTML \u5165\u53e3\u6587\u4ef6,\n\u4f7f\u7070\u5ea6\u89c4\u5219\u4e0e\u4e1a\u52a1\u4ee3\u7801\u89e3\u8026.")),(0,r.kt)("h4",{id:"gray-release-performance"},"Gray Release Performance"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u524d\u7aef\u4f18\u5316:\n\u6bcf\u4e00\u4e2a\u9875\u9762\u90fd\u9700\u8981\u53bb\u83b7\u53d6\u7070\u5ea6\u89c4\u5219, \u8fd9\u4e2a\u7070\u5ea6\u8bf7\u6c42\u5c06\u963b\u585e\u9875\u9762.\n\u53ef\u4ee5\u4f7f\u7528 localStorage \u5b58\u50a8\u8fd9\u4e2a\u7528\u6237\u662f\u5426\u4e3a\u7070\u5ea6\u7528\u6237,\n\u7136\u540e\u5b9a\u671f\u7684\u66f4\u65b0 localStorage,\n\u53d6\u4ee3\u5927\u91cf\u7684\u8bf7\u6c42\u9020\u6210\u7684\u4f53\u9a8c\u95ee\u9898.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u540e\u7aef\u4f18\u5316:\n\u5229\u7528 MemCache \u5728\u5185\u5b58\u4e2d\u7f13\u5b58\u7070\u5ea6\u89c4\u5219\u4e0e\u7070\u5ea6\u7528\u6237\u5217\u8868,\n\u63d0\u5347\u7070\u5ea6\u53d1\u5e03\u6027\u80fd."))),(0,r.kt)("h3",{id:"zero-trust-access-control"},"Zero Trust Access Control"),(0,r.kt)("p",null,"\u4ece\u9632\u5fa1\u7684\u89d2\u5ea6\u6765\u8bb2, \u5185\u90e8\u98ce\u9669\u662f\u5916\u90e8\u98ce\u9669\u7684\u8d85\u96c6:\n\u5f53\u653b\u51fb\u8005\u653b\u9677\u4efb\u4f55\u4e00\u4e2a\u5185\u90e8\u4eba\u5458 (\u5408\u6cd5\u7528\u6237\u6216\u5458\u5de5) \u7684\u8bbe\u5907\u540e,\n\u653b\u51fb\u8005\u4fbf\u6210\u4e86\u5185\u90e8\u4eba\u5458.\n",(0,r.kt)("a",{parentName:"p",href:"https://zchn.github.io/j/ztcn"},"\u96f6\u4fe1\u4efb"),"\n\u4ece\u8fd9\u4e2a\u89d2\u5ea6\u770b\u5c31\u662f\u5047\u8bbe\u4efb\u4f55\u4e00\u53f0\u4e3b\u673a\u90fd\u6709\u53ef\u80fd\u88ab\u653b\u9677."),(0,r.kt)("h4",{id:"chain-of-trust"},"Chain of Trust"),(0,r.kt)("p",null,"\u96f6\u4fe1\u4efb\u5e76\u4e0d\u662f\u5b8c\u5168\u6ca1\u6709\u4fe1\u4efb,\n\u800c\u662f\u51e0\u4e2a\u57fa\u672c\u7684\u6700\u5c0f\u5316\u7684\u4fe1\u4efb\u6839 (Root of Trust),\n\u91cd\u6784\u4fe1\u4efb\u94fe (Chain of Trust).\n\u901a\u8fc7\u4e00\u7cfb\u5217\u7684\u6807\u51c6\u5316\u6d41\u7a0b (Standard Process) \u5efa\u7acb\u7684\u4e00\u4e2a\u5b8c\u6574\u7684\u4fe1\u4efb\u94fe\n(\u4fe1\u4efb\u6811 Tree of Trust \u6216\u8005\u4fe1\u4efb\u7f51 Web of Trust)."),(0,r.kt)("p",null,"\u51e0\u4e2a\u5178\u578b\u7684\u4f8b\u5b50\u5305\u62ec:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u591a\u56e0\u5b50\u8ba4\u8bc1 (MFA, Multi-Factor Authentication):\n\u4eba\u7684\u8eab\u4efd\u7684\u4fe1\u4efb\u6839."),(0,r.kt)("li",{parentName:"ul"},"\u53ef\u4fe1\u5e73\u53f0\u6a21\u5757 (TPM, Trusted Platform Module)\u548c\u53ef\u4fe1\u542f\u52a8 (Trusted Boot):\n\u673a\u5668\u7684\u8eab\u4efd\u7684\u4fe1\u4efb\u6839."),(0,r.kt)("li",{parentName:"ul"},"\u6e90\u4ee3\u7801\u548c\u53ef\u4fe1\u7f16\u8bd1 (Trusted Build):\n\u8f6f\u4ef6\u7684\u4fe1\u4efb\u6839.")),(0,r.kt)("h4",{id:"identity-20"},"Identity 2.0"),(0,r.kt)("p",null,"\u8eab\u4efd 2.0 \u662f\u5bf9\u4e8e\u4ee5\u4e0a\u7684\u4fe1\u4efb\u94fe\u7684\u6807\u51c6\u5316,\n\u4ee5\u4fbf\u4e8e\u5728\u5b89\u5168\u8bbf\u95ee\u7b56\u7565\u4e2d\u4f7f\u7528\u8fd9\u4e9b\u5728\u5efa\u7acb\u4fe1\u4efb\u8fc7\u7a0b\u4e2d\u6536\u96c6\u5230\u7684\u4fe1\u606f."),(0,r.kt)("p",null,"\u5728\u8eab\u4efd 2.0 \u4e2d, \u4e00\u5207\u672c\u4f53 (Entity) \u90fd\u6709\u8eab\u4efd.\n\u7528\u6237\u6709\u7528\u6237\u8eab\u4efd, \u5458\u5de5\u6709\u5458\u5de5\u8eab\u4efd, \u673a\u5668\u6709\u673a\u5668\u8eab\u4efd, \u8f6f\u4ef6\u6709\u8f6f\u4ef6\u8eab\u4efd."),(0,r.kt)("p",null,"\u5728\u8eab\u4efd 2.0 \u4e2d, \u4e00\u5207\u8bbf\u95ee (Access) \u90fd\u5e26\u6709\u8bbf\u95ee\u80cc\u666f (Access Context):"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u76ee\u7684: \u4e3a\u4e86\u5e2e\u52a9\u7528\u6237\u89e3\u51b3\u4e00\u4e2a\u6280\u672f\u95ee\u9898"),(0,r.kt)("li",{parentName:"ul"},"\u8bbf\u95ee\u8005: \u5458\u5de5 A"),(0,r.kt)("li",{parentName:"ul"},"\u6388\u6743\u8005: \u7528\u6237 B"),(0,r.kt)("li",{parentName:"ul"},"\u8bbf\u95ee\u65b9\u5f0f: \u8f6f\u4ef6 C"),(0,r.kt)("li",{parentName:"ul"},"\u8bbf\u95ee\u5730\u70b9: \u673a\u5668 D")),(0,r.kt)("h4",{id:"continuous-access-control"},"Continuous Access Control"),(0,r.kt)("p",null,"\u6301\u7eed\u8bbf\u95ee\u63a7\u5236\u4f1a\u5728\u8f6f\u4ef6\u5f00\u53d1\u548c\u8fd0\u884c\u7684\u5404\u4e2a\u73af\u8282\u6301\u7eed\u5730\u8fdb\u884c\u8bbf\u95ee\u63a7\u5236:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5728\u5458\u5de5\u767b\u5f55\u65f6\u8981\u6c42\u63d0\u4f9b\u591a\u56e0\u5b50\u8ba4\u8bc1."),(0,r.kt)("li",{parentName:"ul"},"\u5728\u90e8\u7f72\u8f6f\u4ef6\u65f6\u8981\u6c42\u8f6f\u4ef6\u662f\u4ece\u4fe1\u4efb\u7684\u6e90\u7801\u5e93\u5728\u5b89\u5168\u7684\u73af\u5883\u4e2d\u7f16\u8bd1\u800c\u6765,\n\u5e76\u7ecf\u8fc7\u4ee3\u7801\u8bc4\u4f30 (Code Review)."),(0,r.kt)("li",{parentName:"ul"},"\u5728\u4e3b\u673a\u4e4b\u95f4\u5efa\u7acb\u8fde\u63a5\u65f6\u8981\u6c42\u53cc\u65b9\u63d0\u4f9b\u4e3b\u673a\u5b8c\u6574\u6027\u8bc1\u660e."),(0,r.kt)("li",{parentName:"ul"},"\u5728\u5fae\u670d\u52a1\u83b7\u53d6\u7279\u5b9a\u7528\u6237\u6570\u636e\u65f6\u8981\u6c42\u63d0\u4f9b\u8be5\u7528\u6237\u7684\u6388\u6743\u4ee4\u724c (Authorization Token).")),(0,r.kt)("h4",{id:"zero-trust-basement"},"Zero Trust Basement"),(0,r.kt)("p",null,"\u96f6\u4fe1\u4efb\u7684\u5b9e\u65bd\u4f9d\u8d56\u4e8e\u624e\u5b9e\u7684\u57fa\u7840\u5b89\u5168\u67b6\u6784, \u6ca1\u6709\u57fa\u7840\u5c31\u6ca1\u6709\u4e0a\u5c42\u5efa\u7b51.\n\u8c37\u6b4c\u96f6\u4fe1\u4efb\u4f9d\u8d56\u4e8e\u4ee5\u4e0b\u57fa\u7840\u8bbe\u65bd\u63d0\u4f9b\u7684\u57fa\u672c\u5b89\u5168\u4fdd\u969c:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u6570\u636e\u52a0\u5bc6\u548c\u5bc6\u94a5\u7ba1\u7406 (Encryption and Key Management)"),(0,r.kt)("li",{parentName:"ul"},"\u8eab\u4efd\u548c\u8bbf\u95ee\u7ba1\u7406 (Identity and Access Management)"),(0,r.kt)("li",{parentName:"ul"},"\u6570\u5b57\u5316\u4eba\u529b\u8d44\u6e90\u7ba1\u7406 (Digital Human Resource)"),(0,r.kt)("li",{parentName:"ul"},"\u6570\u5b57\u5316\u8bbe\u5907\u7ba1\u7406 (Digital Device Management)"),(0,r.kt)("li",{parentName:"ul"},"\u6570\u636e\u4e2d\u5fc3\u5b89\u5168 (Data Center Security)"),(0,r.kt)("li",{parentName:"ul"},"\u7f51\u7edc\u5b89\u5168 (Network Security)"),(0,r.kt)("li",{parentName:"ul"},"\u4e3b\u673a\u5b89\u5168 (Host Security)"),(0,r.kt)("li",{parentName:"ul"},"\u5bb9\u5668\u9694\u79bb (Container Isolation, gVisor)"),(0,r.kt)("li",{parentName:"ul"},"\u53ef\u4fe1\u542f\u52a8 (Trusted Boot)"),(0,r.kt)("li",{parentName:"ul"},"\u53ef\u9a8c\u8bc1\u7f16\u8bd1 (Verifiable Build)"),(0,r.kt)("li",{parentName:"ul"},"\u8f6f\u4ef6\u5b8c\u6574\u6027\u9a8c\u8bc1 (Software Integrity Verification)"),(0,r.kt)("li",{parentName:"ul"},"\u53cc\u5411 TLS (mTLS)"),(0,r.kt)("li",{parentName:"ul"},"\u57fa\u4e8e\u670d\u52a1\u7684\u8bbf\u95ee\u7b56\u7565 (Service Access Policy)"),(0,r.kt)("li",{parentName:"ul"},"\u7ec8\u7aef\u7528\u6237\u4ee4\u724c (End User Context Tokens)"),(0,r.kt)("li",{parentName:"ul"},"\u914d\u7f6e\u5373\u4ee3\u7801 (Configuration as Code)"),(0,r.kt)("li",{parentName:"ul"},"\u6807\u51c6\u5316\u5f00\u53d1\u548c\u90e8\u7f72 (Standard Development and Deployment)")),(0,r.kt)("h2",{id:"babel"},"Babel"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"babel example.js -o compiled.js\nbabel src -d lib -s\n")),(0,r.kt)("h3",{id:"babel-node"},"Babel Node"),(0,r.kt)("p",null,"A read-eval-print loop(REPL) can replace node REPL."),(0,r.kt)("h3",{id:"babel-core"},"Babel Core"),(0,r.kt)("p",null,"\u63d0\u4f9b babel \u8f6c\u7801 API"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npm install babel-core --save\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const babel = require('babel-core');\n\n// \u5b57\u7b26\u4e32\u8f6c\u7801\nbabel.transform('code();', options);\n// => { code, map, ast }\n\n// \u6587\u4ef6\u8f6c\u7801 (\u5f02\u6b65)\nbabel.transformFile('filename.js', options, function (err, result) {\n  process(err);\n  return result; // => { code, map, ast }\n});\n\n// \u6587\u4ef6\u8f6c\u7801 (\u540c\u6b65)\nbabel.transformFileSync('filename.js', options);\n// => { code, map, ast }\n\n// Babel AST\u8f6c\u7801\nbabel.transformFromAst(ast, code, options);\n// => { code, map, ast }\n")),(0,r.kt)("h3",{id:"codemod-tool"},"CodeMod Tool"),(0,r.kt)("p",null,"Use Babel to refactor code:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/facebook/jscodeshift"},"JSCodeshift")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/reactjs/react-codemod"},"ReactCodemod"))),(0,r.kt)("h3",{id:"babel-transform-plugin"},"Babel Transform Plugin"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Visitor pattern with Babel."),(0,r.kt)("li",{parentName:"ul"},"Named ",(0,r.kt)("inlineCode",{parentName:"li"},"babel-plugin-transform-xxx"),".")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "main": "index.js"\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// index.js\nmodule.exports = babel => {\n  const t = babel.types;\n  let isJSXExisted = false;\n  let isMeactContextEnabled = false;\n\n  return {\n    visitor: {\n      Program: {\n        exit(path) {\n          if (isJSXExisted === true && isMeactContextEnabled === false) {\n            throw path.buildCodeFrameError(`Meact isn't in current context!`);\n          }\n        },\n      },\n      ImportDeclaration(path, state) {\n        if (path.node.specifiers[0].local.name === 'Meact') {\n          isMeactContextEnabled = true;\n        }\n      },\n      MemberExpression(path, state) {\n        if (\n          path.node.object.name === 'React' &&\n          path.node.property.name === 'createElement'\n        ) {\n          isJSXExisted = true;\n          path.replaceWith(\n            t.MemberExpression(\n              t.identifier('Meact'),\n              t.identifier('createElement')\n            )\n          );\n        }\n      },\n    },\n  };\n};\n")),(0,r.kt)("h3",{id:"babel-preset-plugin"},"Babel Preset Plugin"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Just like ",(0,r.kt)("inlineCode",{parentName:"li"},".babelrc.js"),"."),(0,r.kt)("li",{parentName:"ul"},"Named ",(0,r.kt)("inlineCode",{parentName:"li"},"babel-preset-xxx"),".")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'// package.json\n{\n  "main": "index.js",\n  "dependencies": {\n    "babel-plugin-transform-meact-jsx": "^0.1.2",\n    "@babel/plugin-proposal-object-rest-spread": "^7.0.0",\n    "@babel/plugin-transform-react-jsx": "^7.0.0",\n    "@babel/plugin-transform-runtime": "^7.0.0",\n    "@babel/preset-env": "^7.0.0"\n  }\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// index.js\nconst defaultTargets = {\n  android: 30,\n  chrome: 35,\n  edge: 14,\n  explorer: 9,\n  firefox: 52,\n  safari: 8,\n  ucandroid: 1,\n};\n\nconst buildTargets = options => {\n  return Object.assign({}, defaultTargets, options.additionalTargets);\n};\n\nmodule.exports = function buildMeactPreset(context, options) {\n  const transpileTargets =\n    (options && options.targets) || buildTargets(options || {});\n\n  return {\n    presets: [\n      require('@babel/preset-env').default(null, {\n        targets: transpileTargets,\n        modules: false,\n      }),\n    ],\n    plugins: [\n      require('@babel/plugin-proposal-object-rest-spread'),\n      require('@babel/plugin-transform-react-jsx'),\n      require('babel-plugin-transform-meact-jsx'),\n      require('@babel/plugin-transform-runtime'),\n    ].filter(Boolean),\n  };\n};\n")),(0,r.kt)("h2",{id:"webpack"},"Webpack"),(0,r.kt)("h3",{id:"webpack-internals"},"Webpack Internals"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://segmentfault.com/a/1190000039956437"},"Webpack source code guide"))),(0,r.kt)("h3",{id:"webpack-configuration-intellisense"},"Webpack Configuration Intellisense"),(0,r.kt)("p",null,"Enable webpack configuration types intellisense:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npm i -D webpack webpack-cli webpack-dev-server\n")),(0,r.kt)("p",null,"Enable ",(0,r.kt)("inlineCode",{parentName:"p"},"devServer")," type intellisense:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# Add `devServer` type to `webpack.Configuration`\nnpm i -D @types/webpack-dev-server\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"/** @type {import('webpack').Configuration} */\nmodule.exports = {\n  entry: {\n    main: './src/index.ts',\n  },\n  output: {\n    filename: devMode ? '[name].js' : '[name].[contenthash].js',\n    path: path.resolve(__dirname, 'build'),\n  },\n  mode: devMode ? 'development' : 'production',\n  devServer: {\n    hot: true,\n    open: true,\n    port: 2333,\n  },\n};\n")),(0,r.kt)("h3",{id:"webpack-hot-module-replacement"},"Webpack Hot Module Replacement"),(0,r.kt)("p",null,"HMR:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u4f7f\u7528 WDS \u6258\u7ba1\u9759\u6001\u8d44\u6e90, \u540c\u65f6\u4ee5 Runtime \u65b9\u5f0f\u6ce8\u5165 HMR \u5ba2\u6237\u7aef\u4ee3\u7801."),(0,r.kt)("li",{parentName:"ul"},"\u6d4f\u89c8\u5668\u52a0\u8f7d\u9875\u9762\u540e, \u4e0e WDS \u5efa\u7acb WebSocket \u8fde\u63a5."),(0,r.kt)("li",{parentName:"ul"},"Webpack \u76d1\u542c\u5230\u6587\u4ef6\u53d8\u5316\u540e, \u589e\u91cf\u6784\u5efa\u53d1\u751f\u53d8\u66f4\u7684\u6a21\u5757, \u5e76\u901a\u8fc7 WebSocket \u53d1\u9001 hash \u4e8b\u4ef6."),(0,r.kt)("li",{parentName:"ul"},"\u6d4f\u89c8\u5668\u63a5\u6536\u5230 hash \u4e8b\u4ef6\u540e, \u8bf7\u6c42 manifest (",(0,r.kt)("inlineCode",{parentName:"li"},"[hash].hot-update.json"),") \u8d44\u6e90\u6587\u4ef6, \u786e\u8ba4\u589e\u91cf\u53d8\u66f4\u8303\u56f4."),(0,r.kt)("li",{parentName:"ul"},"\u6d4f\u89c8\u5668\u52a0\u8f7d\u53d1\u751f\u53d8\u66f4\u7684\u589e\u91cf\u6a21\u5757."),(0,r.kt)("li",{parentName:"ul"},"Webpack \u8fd0\u884c\u65f6\u89e6\u53d1\u53d8\u66f4\u6a21\u5757\u7684 ",(0,r.kt)("inlineCode",{parentName:"li"},"module.hot.accept")," \u56de\u8c03, \u6267\u884c\u4ee3\u7801\u53d8\u66f4\u903b\u8f91.")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"module.hot.accept")," \u6709\u4e24\u79cd\u8c03\u7528\u6a21\u5f0f:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u65e0\u53c2\u8c03\u7528\u6a21\u5f0f ",(0,r.kt)("inlineCode",{parentName:"li"},"module.hot.accept()"),": \u5f53\u524d\u6587\u4ef6\u4fee\u6539\u540e, \u91cd\u5934\u6267\u884c\u5f53\u524d\u6587\u4ef6\u4ee3\u7801."),(0,r.kt)("li",{parentName:"ul"},"\u56de\u8c03\u8c03\u7528\u6a21\u5f0f ",(0,r.kt)("inlineCode",{parentName:"li"},"module.hot.accept(path, callback)"),": \u5e38\u7528\u6a21\u5f0f, \u76d1\u542c\u6a21\u5757\u53d8\u66f4, \u6267\u884c\u4ee3\u7801\u53d8\u66f4\u903b\u8f91.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// \u8be5\u6a21\u5757\u4fee\u6539\u540e, `console.log('bar')` \u4f1a\u91cd\u65b0\u6267\u884c\nconsole.log('bar');\nmodule.hot.accept();\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import component from './component';\n\nlet demoComponent = component();\ndocument.body.appendChild(demoComponent);\n\nif (module.hot) {\n  module.hot.accept('./component', () => {\n    const nextComponent = component();\n    document.body.replaceChild(nextComponent, demoComponent);\n    demoComponent = nextComponent;\n  });\n}\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"react-refresh-webpack-plugin"),"/",(0,r.kt)("inlineCode",{parentName:"p"},"vue-loader"),"/",(0,r.kt)("inlineCode",{parentName:"p"},"style-loader"),"\n\u5229\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"module.hot.accept")," \u5b9e\u73b0\u4e86 HMR (forceUpdate), \u65e0\u9700\u5f00\u53d1\u8005\u7f16\u5199\u70ed\u6a21\u5757\u66f4\u65b0\u903b\u8f91."),(0,r.kt)("h3",{id:"webpack-watch-options"},"Webpack Watch Options"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"echo fs.notify.max_user_watches=524288 | sudo tee -a /etc/sysctl.conf\nsudo sysctl -p\n")),(0,r.kt)("h3",{id:"webpack-resolve-path-options"},"Webpack Resolve Path Options"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const TsconfigPathsPlugin = require('tsconfig-paths-webpack-plugin');\n\nmodule.exports = {\n  resolve: {\n    alias: {\n      '#': path.resolve(__dirname, '/'),\n      '~': path.resolve(__dirname, 'src'),\n      '@': path.resolve(__dirname, 'src'),\n      '~@': path.resolve(__dirname, 'src'),\n      vendor: path.resolve(__dirname, 'src/vendor'),\n      '~component': path.resolve(__dirname, 'src/components'),\n      '~config': path.resolve(__dirname, 'config'),\n    },\n    extensions: ['.tsx', '.ts', '.jsx', '.js'],\n    plugins: [new TsconfigPathsPlugin({ configFile: './tsconfig.json' })],\n  },\n};\n")),(0,r.kt)("p",null,"get ",(0,r.kt)("inlineCode",{parentName:"p"},"baseUrl"),"and ",(0,r.kt)("inlineCode",{parentName:"p"},"paths")," from ",(0,r.kt)("inlineCode",{parentName:"p"},"tsconfig.json"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const TsconfigPathsPlugin = require('tsconfig-paths-webpack-plugin');\n\nmodule.exports = {\n  resolve: {\n    plugins: [new TsconfigPathsPlugin({ configFile: './tsconfig.json' })],\n  },\n};\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"jsconfig.json")," for vscode resolve path:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "compilerOptions": {\n    // This must be specified if "paths" is set\n    "baseUrl": ".",\n    // Relative to "baseUrl"\n    "paths": {\n      "*": ["*", "src/*"]\n    }\n  }\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "compilerOptions": {\n    "target": "es2017",\n    "allowSyntheticDefaultImports": false,\n    "baseUrl": "./",\n    "paths": {\n      "Config/*": ["src/config/*"],\n      "Components/*": ["src/components/*"],\n      "Ducks/*": ["src/ducks/*"],\n      "Shared/*": ["src/shared/*"],\n      "App/*": ["src/*"]\n    }\n  },\n  "exclude": ["node_modules", "dist"]\n}\n')),(0,r.kt)("h3",{id:"webpack-flag-options"},"Webpack Flag Options"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"--progress"),(0,r.kt)("li",{parentName:"ul"},"--colors"),(0,r.kt)("li",{parentName:"ul"},"-p")),(0,r.kt)("h3",{id:"webpack-devtool-source-map-configuration"},"Webpack Devtool Source Map Configuration"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Devtool"),(0,r.kt)("th",{parentName:"tr",align:null},"Build"),(0,r.kt)("th",{parentName:"tr",align:null},"Rebuild"),(0,r.kt)("th",{parentName:"tr",align:null},"Production"),(0,r.kt)("th",{parentName:"tr",align:null},"Quality"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"(none) / false"),(0,r.kt)("td",{parentName:"tr",align:null},"fastest"),(0,r.kt)("td",{parentName:"tr",align:null},"fastest"),(0,r.kt)("td",{parentName:"tr",align:null},"yes"),(0,r.kt)("td",{parentName:"tr",align:null},"bundle")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"eval"),(0,r.kt)("td",{parentName:"tr",align:null},"fast"),(0,r.kt)("td",{parentName:"tr",align:null},"fastest"),(0,r.kt)("td",{parentName:"tr",align:null},"no"),(0,r.kt)("td",{parentName:"tr",align:null},"generated")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"eval-cheap-source-map"),(0,r.kt)("td",{parentName:"tr",align:null},"ok"),(0,r.kt)("td",{parentName:"tr",align:null},"fast"),(0,r.kt)("td",{parentName:"tr",align:null},"no"),(0,r.kt)("td",{parentName:"tr",align:null},"transformed")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"eval-cheap-module-source-map"),(0,r.kt)("td",{parentName:"tr",align:null},"slow"),(0,r.kt)("td",{parentName:"tr",align:null},"fast"),(0,r.kt)("td",{parentName:"tr",align:null},"no"),(0,r.kt)("td",{parentName:"tr",align:null},"lines only")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"eval-source-map"),(0,r.kt)("td",{parentName:"tr",align:null},"slowest"),(0,r.kt)("td",{parentName:"tr",align:null},"ok"),(0,r.kt)("td",{parentName:"tr",align:null},"no"),(0,r.kt)("td",{parentName:"tr",align:null},"lines + rows")))),(0,r.kt)("h3",{id:"webpack-cache-configuration"},"Webpack Cache Configuration"),(0,r.kt)("h4",{id:"webpack-build-cache"},"Webpack Build Cache"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"cache")," is set to ",(0,r.kt)("inlineCode",{parentName:"p"},"type: 'memory'")," in development mode\nand disabled in production mode.\n",(0,r.kt)("inlineCode",{parentName:"p"},"cache: true")," is an alias to ",(0,r.kt)("inlineCode",{parentName:"p"},"cache: { type: 'memory' }"),"."),(0,r.kt)("p",null,"Accelerate second build time:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"module.exports = {\n  cache: {\n    type: 'filesystem',\n  },\n};\n")),(0,r.kt)("h4",{id:"webpack-browser-cache"},"Webpack Browser Cache"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://webpack.js.org/guides/caching"},"Webpack caching guide"),"."),(0,r.kt)("li",{parentName:"ul"},"Use ",(0,r.kt)("inlineCode",{parentName:"li"},"[contenthash]")," and long-term browser cache to improve second access time.")),(0,r.kt)("h3",{id:"webpack-library-configuration"},"Webpack Library Configuration"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const path = require('path');\n\nmodule.exports = {\n  entry: {\n    'bod-cli.min': path.join(__dirname, './src/index.js'),\n    'bod-cli': path.join(__dirname, './src/index.js'),\n  },\n  output: {\n    path: path.join(__dirname, './dist'),\n    filename: '[name].[contenthash].js',\n    library: 'bod',\n    libraryExport: 'default',\n    libraryTarget: 'esm',\n    globalObject: 'this',\n  },\n};\n")),(0,r.kt)("h3",{id:"webpack-loader-configuration"},"Webpack Loader Configuration"),(0,r.kt)("h4",{id:"webpack-babel-loader"},"Webpack Babel Loader"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const config = {\n  test: /\\.(js|mjs|jsx|ts|tsx)$/,\n  include: path.resolve('src'),\n  use: [\n    'thread-loader',\n    {\n      loader: require.resolve('babel-loader'),\n    },\n  ],\n  options: {\n    customize: require.resolve('babel-preset-react-app/webpack-overrides'),\n    plugins: [\n      [\n        require.resolve('babel-plugin-named-asset-import'),\n        {\n          loaderMap: {\n            svg: {\n              ReactComponent: '@svgr/webpack?-svgo,+titleProp,+ref![path]',\n            },\n          },\n        },\n      ],\n      ['lodash'],\n    ],\n    cacheDirectory: true,\n    cacheCompression: false,\n    compact: isEnvProduction,\n  },\n};\n")),(0,r.kt)("h4",{id:"webpack-css-loader"},"Webpack CSS Loader"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const MiniCssExtractPlugin = require('mini-css-extract-plugin');\nconst CssMinimizerPlugin = require('css-minimizer-webpack-plugin');\n\nconst devMode = process.env.NODE_ENV !== 'production';\n\nmodule.exports = {\n  module: {\n    rules: [\n      {\n        test: /.s?css$/,\n        exclude: /node_modules$/,\n        use: [\n          devMode ? 'style-loader' : MiniCssExtractPlugin.loader,\n          {\n            loader: 'css-loader',\n            options: {\n              modules: {\n                compileType: 'module',\n                localIdentName: '[local]__[hash:base64:5]',\n              },\n            },\n          },\n          'sass-loader',\n          {\n            loader: 'postcss-loader',\n            options: {\n              postcssOptions: {\n                plugins: [['autoprefixer']],\n              },\n            },\n          },\n        ],\n      },\n    ],\n  },\n  optimization: {\n    minimizer: [\n      // `...`,\n      new CssMinimizerPlugin(),\n    ],\n  },\n};\n")),(0,r.kt)("h4",{id:"webpack-static-assets-loader"},"Webpack Static Assets Loader"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/tcoopman/image-webpack-loader"},"ImageMin Loader")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"asset/resource")," emits separate file and exports the URL\n(",(0,r.kt)("inlineCode",{parentName:"li"},"file-loader"),")."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"asset/inline")," exports data URI of the asset\n(url-loader)."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"asset/source")," exports source code of the asset\n(raw-loader)."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"asset")," automatically chooses between exporting data URI and separate file\n(",(0,r.kt)("inlineCode",{parentName:"li"},"url-loader")," with asset size limit, default ",(0,r.kt)("inlineCode",{parentName:"li"},"8kb"),").")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const config = {\n  rules: [\n    {\n      test: /\\.(png|jpg|gif|jpeg|webp|svg|eot|ttf|woff|woff2)$/,\n      type: 'asset',\n      parser: {\n        dataUrlCondition: {\n          maxSize: 4 * 1024, // 4kb\n        },\n      },\n    },\n  ],\n};\n")),(0,r.kt)("h5",{id:"webpack-resource-assets"},"Webpack Resource Assets"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const path = require('path');\n\nmodule.exports = {\n  entry: './src/index.js',\n  output: {\n    filename: 'main.js',\n    path: path.resolve(__dirname, 'dist'),\n    assetModuleFilename: 'images/[hash][ext][query]',\n  },\n  module: {\n    rules: [\n      {\n        test: /\\.png/,\n        type: 'asset/resource',\n      },\n      {\n        test: /\\.html/,\n        type: 'asset/resource',\n        generator: {\n          filename: 'static/[hash][ext][query]',\n        },\n      },\n    ],\n  },\n};\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import mainImage from './images/main.png';\n\nimg.src = mainImage; // '/dist/151cfcfa1bd74779aadb.png'\n")),(0,r.kt)("h5",{id:"webpack-inline-assets"},"Webpack Inline Assets"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const path = require('path');\nconst svgToMiniDataURI = require('mini-svg-data-uri');\n\nmodule.exports = {\n  entry: './src/index.js',\n  output: {\n    filename: 'main.js',\n    path: path.resolve(__dirname, 'dist'),\n  },\n  module: {\n    rules: [\n      {\n        test: /\\.svg/,\n        type: 'asset/inline',\n        generator: {\n          dataUrl: content => {\n            content = content.toString();\n            return svgToMiniDataURI(content);\n          },\n        },\n      },\n    ],\n  },\n};\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import metroMap from './images/metro.svg';\n\nblock.style.background = `url(${metroMap})`;\n// => url(data:image/svg+xml;base64,PHN2ZyB4bW0iaHR0cDo...vc3ZnPgo=)\n")),(0,r.kt)("h5",{id:"webpack-source-assets"},"Webpack Source Assets"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const path = require('path');\n\nmodule.exports = {\n  entry: './src/index.js',\n  output: {\n    filename: 'main.js',\n    path: path.resolve(__dirname, 'dist'),\n  },\n  module: {\n    rules: [\n      {\n        test: /\\.txt/,\n        type: 'asset/source',\n      },\n    ],\n  },\n};\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import exampleText from './example.txt';\n\nblock.textContent = exampleText; // 'Hello world'\n")),(0,r.kt)("h4",{id:"webpack-thread-loader"},"Webpack Thread Loader"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const config = {\n  rules: [\n    {\n      loader: 'thread-loader',\n      // loaders with equal options will share worker pools\n      options: {\n        // the number of spawned workers, defaults to (number of cpus - 1) or\n        // fallback to 1 when require('os').cpus() is undefined\n        workers: 2,\n\n        // number of jobs a worker processes in parallel\n        // defaults to 20\n        workerParallelJobs: 50,\n\n        // additional node.js arguments\n        workerNodeArgs: ['--max-old-space-size=1024'],\n\n        // Allow to respawn a dead worker pool\n        // respawning slows down the entire compilation\n        // and should be set to false for development\n        poolRespawn: false,\n\n        // timeout for killing the worker processes when idle\n        // defaults to 500 (ms)\n        // can be set to Infinity for watching builds to keep workers alive\n        poolTimeout: 2000,\n\n        // number of jobs the poll distributes to the workers\n        // defaults to 200\n        // decrease of less efficient but more fair distribution\n        poolParallelJobs: 50,\n\n        // name of the pool\n        // can be used to create different pools with elseWise identical options\n        name: 'my-pool',\n      },\n    },\n    // your expensive loader (e.g babel-loader)\n  ],\n};\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const threadLoader = require('thread-loader');\n\nthreadLoader.warmup(\n  {\n    // pool options, like passed to loader options\n    // must match loader options to boot the correct pool\n  },\n  [\n    // modules to load\n    // can be any module, i. e.\n    'babel-loader',\n    'babel-preset-es2015',\n    'sass-loader',\n  ]\n);\n")),(0,r.kt)("h4",{id:"webpack-web-worker-loader"},"Webpack Web Worker Loader"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/Webpack-contrib/worker-loader"},"Worker Loader"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npm i -D worker-loader\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"module.exports = {\n  module: {\n    rules: [\n      {\n        test: /\\.worker\\.js$/,\n        use: { loader: 'worker-loader' },\n      },\n    ],\n  },\n};\n")),(0,r.kt)("h3",{id:"webpack-optimization"},"Webpack Optimization"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"CDN"),(0,r.kt)("li",{parentName:"ul"},"\u670d\u52a1\u5668\u7aef\u6e32\u67d3"),(0,r.kt)("li",{parentName:"ul"},"\u63d0\u53d6\u516c\u5171\u5e93"),(0,r.kt)("li",{parentName:"ul"},"\u4ee3\u7801\u538b\u7f29"),(0,r.kt)("li",{parentName:"ul"},"\u4ee3\u7801\u5206\u5272: Chunks"),(0,r.kt)("li",{parentName:"ul"},"\u4ee3\u7801\u5206\u5272: \u6309\u9700\u52a0\u8f7d"),(0,r.kt)("li",{parentName:"ul"},"\u591a\u6838\u6784\u5efa"),(0,r.kt)("li",{parentName:"ul"},"\u6784\u5efa\u7f13\u5b58"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://webpack.js.org/guides/build-performance"},"\u4f18\u5316\u6784\u5efa\u901f\u5ea6"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://jelly.jd.com/article/61179aa26bea510187770aa3"},"JD Webpack optimization guide"),".")),(0,r.kt)("h4",{id:"common-libraries"},"Common Libraries"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "externals": {\n    "moment": "window.moment",\n    "antd": "window.antd",\n    "lodash": "window._",\n    "react": "window.React",\n    "react-dom": "window.ReactDOM"\n  }\n}\n')),(0,r.kt)("h4",{id:"common-chunks"},"Common Chunks"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const config = new webpack.optimize.CommonsChunkPlugin({\n  name: string, // or\n  names: [string],\n  // The chunk name of the commons chunk.\n  // An existing chunk can be selected by passing a name of an existing chunk.\n  // If an array of strings is passed this is equal to\n  // invoking the plugin multiple times for each chunk name.\n  // If omitted and `options.async` or `options.children`\n  // is set all chunks are used, otherwise `options.filename`\n  // is used as chunk name.\n  // When using `options.async` to create common chunks\n  // from other async chunks you must specify an entry-point\n  // chunk name here instead of omitting the `option.name`.\n\n  filename: string,\n  // The filename template for the commons chunk.\n  // Can contain the same placeholders as `output.filename`.\n  // If omitted the original filename is not modified\n  // (usually `output.filename` or `output.chunkFilename`).\n  // This option is not permitted if you're using `options.async` as well,\n  // see below for more details.\n\n  minChunks: number | Infinity | fn,\n  // (module, count) => boolean,\n  // The minimum number of chunks which need to contain a module\n  // before it's moved into the commons chunk.\n  // The number must be greater than or equal 2\n  // and lower than or equal to the number of chunks.\n  // Passing `Infinity` creates the commons chunk, but moves no modules into it.\n  // By providing a `function` you can add custom logic.\n  // (Defaults to the number of chunks)\n\n  chunks: [string],\n  // Select the source chunks by chunk names.\n  // The chunk must be a child of the commons chunk.\n  // If omitted all entry chunks are selected.\n\n  children: boolean,\n  // If `true` all children of the commons chunk are selected\n\n  deepChildren: boolean,\n  // If `true` all descendants of the commons chunk are selected\n\n  async: boolean | string,\n  // If `true` a new async commons chunk is created\n  // as child of `options.name` and sibling of `options.chunks`.\n  // It is loaded in parallel with `options.chunks`.\n  // Instead of using `option.filename`,\n  // it is possible to change the name of the output file by providing\n  // the desired string here instead of `true`.\n\n  minSize: number,\n  // Minimum size of all common module before a commons chunk is created.\n});\n")),(0,r.kt)("h4",{id:"code-minimization"},"Code Minimization"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const TerserPlugin = require('terser-webpack-plugin');\nconst MiniCssExtractPlugin = require('mini-css-extract-plugin');\nconst CssMinimizerPlugin = require('css-minimizer-webpack-plugin');\n\nconst isEnvProduction = process.env.NODE_ENV === 'production';\nconst isEnvProductionProfile =\n  isEnvProduction && process.argv.includes('--profile');\nconst shouldUseSourceMap = process.env.GENERATE_SOURCEMAP !== 'false';\n\nmodule.exports = {\n  module: {\n    rules: [\n      {\n        test: /\\.(js|mjs|jsx|ts|tsx)$/,\n        include: path.resolve('src'),\n        use: [\n          'thread-loader',\n          {\n            loader: require.resolve('babel-loader'),\n          },\n        ],\n      },\n      {\n        test: /.s?css$/,\n        use: [MiniCssExtractPlugin.loader, 'css-loader', 'sass-loader'],\n      },\n    ],\n  },\n  optimization: {\n    minimize: true,\n    minimizer: [\n      new TerserPlugin({\n        parallel: true,\n        terserOptions: {\n          parse: {\n            ecma: 8,\n          },\n          compress: {\n            ecma: 5,\n            warnings: false,\n            drop_console: true,\n            comparisons: false,\n            inline: 2,\n          },\n          mangle: {\n            safari10: true,\n          },\n          keep_classnames: isEnvProductionProfile,\n          keep_fnames: isEnvProductionProfile,\n          output: {\n            ecma: 5,\n            comments: false,\n            ascii_only: true,\n          },\n        },\n      }),\n      new CssMinimizerPlugin(),\n    ],\n  },\n};\n")),(0,r.kt)("h4",{id:"code-splitting"},"Code Splitting"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"require.ensure([], () => {});"),"."),(0,r.kt)("li",{parentName:"ul"},"async/await ",(0,r.kt)("inlineCode",{parentName:"li"},"import"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"React.Suspense")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"React.lazy"),"."),(0,r.kt)("li",{parentName:"ul"},"Route-based ",(0,r.kt)("a",{parentName:"li",href:"https://reactjs.org/docs/code-splitting.html#route-based-code-splitting"},"code splitting"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"vendor.[hash].chunk.js"),":\nsplitting vendor and application code\nis to enable long term caching techniques\nSince vendor code tends to change less often than the actual application code,\nbrowser will be able to cache them separately,\nand won't re-download them each time the app code changes.")),(0,r.kt)("p",null,"Split chunks configuration:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"chunks:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"async: \u53ea\u63d0\u53d6\u5f02\u6b65\u52a0\u8f7d\u7684\u6a21\u5757\u51fa\u6765\u6253\u5305\u5230\u4e00\u4e2a\u6587\u4ef6\u4e2d."),(0,r.kt)("li",{parentName:"ul"},"initial: \u63d0\u53d6\u540c\u6b65\u52a0\u8f7d\u548c\u5f02\u6b65\u52a0\u8f7d\u6a21\u5757, \u5206\u522b\u6253\u5305\u5230\u4e0d\u540c\u7684\u6587\u4ef6\u4e2d."),(0,r.kt)("li",{parentName:"ul"},"all: \u4e0d\u7ba1\u5f02\u6b65\u52a0\u8f7d\u8fd8\u662f\u540c\u6b65\u52a0\u8f7d\u7684\u6a21\u5757\u90fd\u63d0\u53d6\u51fa\u6765, \u6253\u5305\u5230\u4e00\u4e2a\u6587\u4ef6\u4e2d."))),(0,r.kt)("li",{parentName:"ul"},"minSize: \u8d85\u8fc7 minSize \u624d\u4f1a\u88ab\u63d0\u53d6."),(0,r.kt)("li",{parentName:"ul"},"maxSize: \u8d85\u8fc7 maxSize \u4f1a\u88ab\u8fdb\u4e00\u6b65\u5206\u5272."),(0,r.kt)("li",{parentName:"ul"},"minChunks: \u5f15\u7528\u6b21\u6570 >= minChunks \u503c\u624d\u88ab\u63d0\u53d6."),(0,r.kt)("li",{parentName:"ul"},"maxAsyncRequests: \u6700\u5927\u7684\u6309\u9700 (\u5f02\u6b65) \u52a0\u8f7d\u6b21\u6570 (default: 6)."),(0,r.kt)("li",{parentName:"ul"},"maxInitialRequests: \u5165\u53e3\u6587\u4ef6\u52a0\u8f7d\u6700\u5927\u6570 (default: 4)."),(0,r.kt)("li",{parentName:"ul"},"automaticNameDelimiter: \u6587\u4ef6\u540d\u5206\u5272\u7b26."),(0,r.kt)("li",{parentName:"ul"},"name: chunk \u6587\u4ef6\u540d."),(0,r.kt)("li",{parentName:"ul"},"cacheGroups: \u914d\u7f6e\u63d0\u53d6\u6a21\u5757\u7684\u65b9\u6848, \u91cc\u9762\u6bcf\u4e00\u9879\u4ee3\u8868\u4e00\u4e2a\u63d0\u53d6\u6a21\u5757\u7684\u65b9\u6848.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"priority: \u503c\u8d8a\u5927\u4f18\u5148\u7ea7\u8d8a\u5927."),(0,r.kt)("li",{parentName:"ul"},"test: \u5339\u914d\u6a21\u5757\u8def\u5f84\u6216\u540d\u79f0."),(0,r.kt)("li",{parentName:"ul"},"reuseExistingChunk: ",(0,r.kt)("inlineCode",{parentName:"li"},"true")," / ",(0,r.kt)("inlineCode",{parentName:"li"},"false"),"."),(0,r.kt)("li",{parentName:"ul"},"enforce: ",(0,r.kt)("inlineCode",{parentName:"li"},"true")," / ",(0,r.kt)("inlineCode",{parentName:"li"},"false"),".")))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"module.exports = {\n  optimization: {\n    runtimeChunk: true,\n    splitChunks: {\n      chunks: 'async',\n      minSize: 30000,\n      maxSize: 200000,\n      minChunks: 1,\n      maxAsyncRequests: 6,\n      maxInitialRequests: 4,\n      automaticNameDelimiter: '-',\n      cacheGroups: {\n        vendors: {\n          name: 'chunk-vendors',\n          priority: -10,\n          chunks: 'initial',\n          test: /[\\\\/]node_modules[\\\\/]/,\n        },\n        common: {\n          name: 'chunk-common',\n          priority: -20,\n          chunks: 'initial',\n          minChunks: 2,\n          reuseExistingChunk: true,\n        },\n        element: {\n          name: 'element-ui',\n          priority: 0,\n          chunks: 'all',\n          test: /[\\\\/]element-ui[\\\\/]/,\n        },\n        api: {\n          name: 'api',\n          priority: 0,\n          test: /[\\\\/]api[\\\\/]/,\n        },\n        subApi: {\n          name: 'subApi',\n          priority: 10,\n          minChunks: 2,\n          test: /[\\\\/]api[\\\\/]subApi[\\\\/]/,\n        },\n        mixin: {\n          name: 'mixin',\n          priority: 0,\n          test: /[\\\\/]mixin[\\\\/]/,\n        },\n      },\n    },\n  },\n};\n")),(0,r.kt)("h4",{id:"tree-shaking"},"Tree Shaking"),(0,r.kt)("p",null,"Live code inclusion (AST analysis) + dead code elimination:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u907f\u514d\u65e0\u610f\u4e49\u7684\u8d4b\u503c."),(0,r.kt)("li",{parentName:"ul"},"\u5c3d\u91cf\u4e0d\u5199\u5e26\u6709\u526f\u4f5c\u7528\u7684\u4ee3\u7801: \u8bf8\u5982\u7f16\u5199\u4e86\u7acb\u5373\u6267\u884c\u51fd\u6570, \u5728\u51fd\u6570\u91cc\u53c8\u4f7f\u7528\u4e86\u5916\u90e8\u53d8\u91cf\u7b49."),(0,r.kt)("li",{parentName:"ul"},"\u5982\u679c\u5bf9 ES6 \u8bed\u4e49\u7279\u6027\u8981\u6c42\u4e0d\u662f\u7279\u522b\u4e25\u683c, \u53ef\u4ee5\u5f00\u542f babel \u7684 loose \u6a21\u5f0f etc. \u662f\u5426\u771f\u7684\u8981\u4e0d\u53ef\u679a\u4e3e class \u7684\u5c5e\u6027\n(babel \u5c06 Class \u8f6c\u5316\u4e3a ES5 \u8fc7\u7a0b\u4e2d\u4f1a\u4ea7\u751f Side Effect, \u5bfc\u81f4 Tree Shaking \u5931\u6548)."),(0,r.kt)("li",{parentName:"ul"},"\u7981\u6b62 Babel \u5c06\u6a21\u5757\u5bfc\u5165\u5bfc\u51fa\u8bed\u53e5\u8f6c\u8bd1\u6210 ",(0,r.kt)("inlineCode",{parentName:"li"},"CommonJS")," \u5f62\u5f0f.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"@babel/preset-env"),": always ",(0,r.kt)("inlineCode",{parentName:"li"},'{ "modules": false }'),"."),(0,r.kt)("li",{parentName:"ul"},"Babel \u4f5c\u4e3a\u7f16\u8bd1\u5668\u4e0d\u5e94\u8be5\u5904\u7406 ",(0,r.kt)("inlineCode",{parentName:"li"},"modules")," \u7c7b\u578b\u7684\u8f6c\u6362."),(0,r.kt)("li",{parentName:"ul"},"Webpack \u8981\u4f9d\u8d56 ",(0,r.kt)("inlineCode",{parentName:"li"},"esm")," \u6a21\u5757\u8fdb\u884c tree shaking."))),(0,r.kt)("li",{parentName:"ul"},"\u5982\u679c\u662f\u5f00\u53d1 JavaScript \u5e93, \u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"li"},"rollup")," (ES6 module export + code flow static analysis),\n\u5e76\u4e14\u63d0\u4f9b ES6 module \u7684\u7248\u672c, \u5165\u53e3\u6587\u4ef6\u5730\u5740\u8bbe\u7f6e\u5230 ",(0,r.kt)("inlineCode",{parentName:"li"},"package.json")," \u7684 module \u5b57\u6bb5."),(0,r.kt)("li",{parentName:"ul"},"\u5982\u679c JavaScript \u5e93\u5f00\u53d1\u4e2d, \u96be\u4ee5\u907f\u514d\u7684\u4ea7\u751f\u5404\u79cd\u526f\u4f5c\u7528\u4ee3\u7801,\n\u53ef\u4ee5\u5c06\u529f\u80fd\u51fd\u6570\u6216\u8005\u7ec4\u4ef6, \u6253\u5305\u6210\u5355\u72ec\u7684\u6587\u4ef6\u6216\u76ee\u5f55, \u4ee5\u4fbf\u4e8e\u7528\u6237\u53ef\u4ee5\u901a\u8fc7\u76ee\u5f55\u53bb\u52a0\u8f7d.\n\u5982\u6709\u6761\u4ef6, \u4e5f\u53ef\u4e3a\u81ea\u5df1\u7684\u5e93\u5f00\u53d1\u5355\u72ec\u7684 webpack-loader, \u4fbf\u4e8e\u7528\u6237\u6309\u9700\u52a0\u8f7d."),(0,r.kt)("li",{parentName:"ul"},"\u4f18\u5316\u5bfc\u51fa\u7c92\u5ea6, \u4fdd\u6301\u5bfc\u51fa\u503c\u9897\u7c92\u5ea6\u548c\u539f\u5b50\u6027:\n",(0,r.kt)("inlineCode",{parentName:"li"},"export { foo, bar }")," better than ",(0,r.kt)("inlineCode",{parentName:"li"},"export default alls"),"."),(0,r.kt)("li",{parentName:"ul"},"\u4f7f\u7528\u652f\u6301 ",(0,r.kt)("inlineCode",{parentName:"li"},"Tree Shaking")," \u7684\u5305: ",(0,r.kt)("inlineCode",{parentName:"li"},"lodash-es")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"babel-plugin-lodash"),".")),(0,r.kt)("h4",{id:"building-caches"},"Building Caches"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const config = new HardSourceWebpackPlugin({\n  // Either an absolute path or relative to webpack options.context.\n  cacheDirectory: 'node_modules/.cache/hard-source/[confighash]',\n  // Either a string of object hash function given a webpack config.\n  configHash: webpackConfig => {\n    // node-object-hash on npm can be used to build this.\n    return require('node-object-hash')({ sort: false }).hash(webpackConfig);\n  },\n  // Either false, a string, an object, or a project hashing function.\n  environmentHash: {\n    root: process.cwd(),\n    directories: [],\n    files: ['package-lock.json', 'yarn.lock'],\n  },\n  // An object.\n  info: {\n    // 'none' or 'test'.\n    mode: 'none',\n    // 'debug', 'log', 'info', 'warn', or 'error'.\n    level: 'debug',\n  },\n  // Clean up large, old caches automatically.\n  cachePrune: {\n    // Caches younger than `maxAge` are not considered for deletion. They must\n    // be at least this (default: 2 days) old in milliseconds.\n    maxAge: 2 * 24 * 60 * 60 * 1000,\n    // All caches together must be larger than `sizeThreshold` before any\n    // caches will be deleted. Together they must be at least this\n    // (default: 50 MB) big in bytes.\n    sizeThreshold: 50 * 1024 * 1024,\n  },\n});\n")),(0,r.kt)("p",null,"Webpack 5"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const config = {\n  cache: {\n    type: 'memory',\n  },\n};\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const config = {\n  cache: {\n    type: 'filesystem',\n    buildDependencies: {\n      config: [__filename],\n    },\n  },\n};\n")),(0,r.kt)("h4",{id:"webpack-perf-profiling"},"Webpack Perf Profiling"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const SpeedMeasurePlugin = require('speed-measure-webpack-plugin');\n\nconst smp = new SpeedMeasurePlugin();\n\nconst webpackConfig = smp.wrap({\n  plugins: [new MyPlugin(), new MyOtherPlugin()],\n});\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npx webpack --mode production --profile --json > stats.json\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/jakoblind/webpack-optimize-helper"},"Optimize Helper")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/alexkuz/webpack-chart"},"Statics Chart"))),(0,r.kt)("h4",{id:"commit-linter"},"Commit Linter"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "husky": {\n    "hooks": {\n      "commit-msg": "commitlint -e -V",\n      "pre-commit": "lint-staged"\n    }\n  },\n  "lint-staged": {\n    "src/**/*.{js,jsx, ts, tsx}": ["eslint --fix", "git add"],\n    "src/**/*.{css, scss}": ["stylelint --fix", "git add"]\n  }\n}\n')),(0,r.kt)("h3",{id:"webpack-plugins"},"Webpack Plugins"),(0,r.kt)("h4",{id:"webpack-html-plugins"},"Webpack HTML Plugins"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/jantimon/html-webpack-plugin"},"HTML Plugin"))),(0,r.kt)("h4",{id:"webpack-javascript-plugins"},"Webpack JavaScript Plugins"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/webpack-contrib/terser-webpack-plugin"},"UglifyJS Terser Plugin")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/javascript-obfuscator/webpack-obfuscator"},"JavaScript Obfuscator")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/aackerman/circular-dependency-plugin"},"Circular Dependency Plugin"))),(0,r.kt)("h4",{id:"webpack-css-plugins"},"Webpack CSS Plugins"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/webpack-contrib/mini-css-extract-plugin"},"Mini CSS Extract Plugin")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/webpack-contrib/css-minimizer-webpack-plugin"},"CSS Minimizer Plugin")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/FullHuman/purgecss"},"CSS Tree Shaking"))),(0,r.kt)("h4",{id:"webpack-images-plugins"},"Webpack Images Plugins"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/Klathmon/imagemin-webpack-plugin"},"ImageMin Plugin"))),(0,r.kt)("h4",{id:"webpack-building-work-plugins"},"Webpack Building Work Plugins"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/webpack-contrib/thread-loader"},"Thread Loader")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/mzgoddard/hard-source-webpack-plugin"},"Hard Source Plugin")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/stephencookdev/speed-measure-webpack-plugin"},"Speed Measure Plugin")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/webpack-contrib/compression-webpack-plugin"},"Compression Plugin"))),(0,r.kt)("h4",{id:"webpack-bundles-ui-plugins"},"Webpack Bundles UI Plugins"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/webpack-contrib/webpack-bundle-analyzer"},"Bundle Analyzer")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/webpackmonitor/webpackmonitor"},"Monitor")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/unjs/webpackbar"},"WebpackBar: elegant progressbar and profiler")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/zouhir/jarvis"},"Browser UI")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/unjs/webpackbar"},"CLI UI"))),(0,r.kt)("h4",{id:"webpack-dll-plugins"},"Webpack DLL Plugins"),(0,r.kt)("p",null,"Webpack 5 support out of box cache."),(0,r.kt)("h4",{id:"webpack-other-plugins"},"Webpack Other Plugins"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Commons Chunk Plugin"),(0,r.kt)("li",{parentName:"ul"},"PreLoad plugin"),(0,r.kt)("li",{parentName:"ul"},"PreFetch plugin"),(0,r.kt)("li",{parentName:"ul"},"Define Plugin"),(0,r.kt)("li",{parentName:"ul"},"Provide Plugin"),(0,r.kt)("li",{parentName:"ul"},"CleanUp Plugin"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/survivejs/webpack-merge"},"Webpack Merge"))),(0,r.kt)("h4",{id:"webpack-custom-plugin"},"Webpack Custom Plugin"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"module.exports = {\n  plugins: [\n    function () {\n      this.hooks.done.tap('done', stats => {\n        if (\n          stats.compilation.errors &&\n          stats.compilation.errors.length &&\n          !process.argv.includes('--watch')\n        ) {\n          // Process build errors.\n          process.exit(1);\n        }\n      });\n    },\n  ],\n};\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const childProcess = require('child_process');\nconst HtmlWebpackPlugin = require('html-webpack-plugin');\nconst branch = childProcess\n  .execSync('git rev-parse --abbrev-ref HEAD')\n  .toString()\n  .replace(/\\s+/, '');\nconst version = branch.split('/')[1];\nconst scripts = [\n  'https://cdn.bootcss.com/react-dom/16.9.0-rc.0/umd/react-dom.production.min.js',\n  'https://cdn.bootcss.com/react/16.9.0/umd/react.production.min.js',\n];\n\nclass HotLoad {\n  apply(compiler) {\n    compiler.hooks.beforeRun.tap('UpdateVersion', compilation => {\n      compilation.options.output.publicPath = `./${version}/`;\n    });\n\n    compiler.hooks.compilation.tap('HotLoadPlugin', compilation => {\n      HtmlWebpackPlugin.getHooks(compilation).alterAssetTags.tapAsync(\n        'HotLoadPlugin',\n        (data, cb) => {\n          scripts.forEach(src => [\n            data.assetTags.scripts.unshift({\n              tagName: 'script',\n              voidTag: false,\n              attributes: { src },\n            }),\n          ]);\n          cb(null, data);\n        }\n      );\n    });\n  }\n}\n\nmodule.exports = HotLoad;\n")),(0,r.kt)("p",null,"Typed webpack plugin from ",(0,r.kt)("inlineCode",{parentName:"p"},"laravel-mix/"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const readline = require('readline');\nconst _ = require('lodash');\nconst chalk = require('chalk');\nconst Table = require('cli-table3');\nconst stripAnsi = require('strip-ansi');\nconst { formatSize } = require('webpack/lib/SizeFormatHelpers');\nconst { version } = require('../../package.json');\n\n/**\n * @typedef {object} BuildOutputOptions\n * @property {boolean} clearConsole\n * @property {boolean} showRelated\n **/\n\n/**\n * @typedef {object} StatsAsset\n * @property {string} name\n * @property {number} size\n * @property {StatsAsset[]|{}} related\n **/\n\n/**\n * @typedef {object} StatsData\n * @property {StatsAsset[]} assets\n **/\n\nclass BuildOutputPlugin {\n  /**\n   *\n   * @param {BuildOutputOptions} options\n   */\n  constructor(options) {\n    this.options = options;\n    this.patched = false;\n  }\n\n  /**\n   * Apply the plugin.\n   *\n   * @param {import('webpack').Compiler} compiler\n   */\n  apply(compiler) {\n    if (process.env.NODE_ENV === 'test') {\n      return;\n    }\n\n    compiler.hooks.done.tap('BuildOutputPlugin', stats => {\n      if (stats.hasErrors()) {\n        return false;\n      }\n\n      if (this.options.clearConsole) {\n        this.clearConsole();\n      }\n\n      const data = stats.toJson({\n        assets: true,\n        builtAt: true,\n        hash: true,\n        performance: true,\n        relatedAssets: this.options.showRelated,\n      });\n\n      this.heading(`Laravel Mix v${version}`);\n\n      console.log(\n        chalk.green.bold(`\u2714 Compiled Successfully in ${data.time}ms`)\n      );\n\n      if (data.assets.length) {\n        console.log(this.statsTable(data));\n      }\n    });\n  }\n\n  /**\n   * Print a block section heading.\n   *\n   * @param {string} text\n   */\n  heading(text) {\n    console.log();\n\n    console.log(chalk.bgBlue.white.bold(this.section(text)));\n\n    console.log();\n  }\n\n  /**\n   * Create a block section.\n   *\n   * @param {string} text\n   */\n  section(text) {\n    const padLength = 3;\n    const padding = ' '.repeat(padLength);\n\n    text = `${padding}${text}${padding}`;\n\n    const line = ' '.repeat(text.length);\n\n    return `${line}\\n${text}\\n${line}`;\n  }\n\n  /**\n   * Generate the stats table.\n   *\n   * @param {StatsData} data\n   * @returns {string}\n   */\n  statsTable(data) {\n    const assets = this.sortAssets(data);\n\n    const table = new Table({\n      head: [chalk.bold('File'), chalk.bold('Size')],\n      colWidths: [35],\n      colAligns: ['right'],\n      style: {\n        head: [],\n        compact: true,\n      },\n    });\n\n    for (const asset of assets) {\n      table.push([chalk.green(asset.name), formatSize(asset.size)]);\n    }\n\n    this.extendTableWidth(table);\n    this.monkeyPatchTruncate();\n\n    return table.toString();\n  }\n\n  /**\n   *\n   * @param {StatsData} data\n   */\n  sortAssets(data) {\n    let assets = data.assets;\n\n    assets = _.flatMap(assets, asset => [\n      asset,\n      ...(Array.isArray(asset.related) ? asset.related : []),\n    ]);\n\n    assets = _.orderBy(assets, ['name', 'size'], ['asc', 'asc']);\n\n    return assets;\n  }\n\n  /**\n   * Clear the entire screen.\n   */\n  clearConsole() {\n    const blank = '\\n'.repeat(process.stdout.rows);\n    console.log(blank);\n\n    readline.cursorTo(process.stdout, 0, 0);\n    readline.clearScreenDown(process.stdout);\n  }\n\n  /**\n   * Extend the width of the table\n   *\n   * Currently only increases the file column size\n   *\n   * @param {import('cli-table3').Table} table\n   * @param {number|null} targetWidth\n   * @param {number} maxWidth\n   */\n  extendTableWidth(table, targetWidth = null, maxWidth = Infinity) {\n    targetWidth = targetWidth === null ? process.stdout.columns : targetWidth;\n\n    if (!targetWidth) {\n      return;\n    }\n\n    const tableWidth = this.calculateTableWidth(table);\n    const fileColIncrease = Math.min(\n      targetWidth - tableWidth,\n      maxWidth - tableWidth\n    );\n\n    if (fileColIncrease <= 0) {\n      return;\n    }\n\n    // @ts-expect-error Should error\n    table.options.colWidths[0] += fileColIncrease;\n  }\n\n  monkeyPatchTruncate() {\n    if (this.patched) {\n      return;\n    }\n\n    this.patched = true;\n\n    // @ts-expect-error Should error\n    const utils = require('cli-table3/src/utils');\n    const oldTruncate = utils.truncate;\n\n    /**\n     *\n     * @param {string} str\n     * @param {number} desiredLength\n     * @param {string} truncateChar\n     */\n    utils.truncate = (str, desiredLength, truncateChar) => {\n      if (stripAnsi(str).length > desiredLength) {\n        str = `\u2026${str.substr(-desiredLength + 2)}`;\n      }\n\n      return oldTruncate(str, desiredLength, truncateChar);\n    };\n  }\n\n  /**\n   * Calculate the width of the CLI Table\n   *\n   * `table.width` does not report the correct width\n   * because it includes ANSI control characters\n   *\n   * @internal\n   * @param {import('cli-table3').Table} table\n   */\n  calculateTableWidth(table) {\n    const firstRow = table.toString().split('\\n')[0];\n\n    return stripAnsi(firstRow).length;\n  }\n}\n\nmodule.exports = BuildOutputPlugin;\n")),(0,r.kt)("h3",{id:"webpack-migrate-to-5"},"Webpack Migrate to 5"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://webpack.js.org/migrate/5"},"Migrate 5 Guide"),":"),(0,r.kt)("p",null,"Make sure there's no webpack deprecation warnings."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"node --trace-deprecation node_modules/webpack/bin/webpack.js\n")),(0,r.kt)("h3",{id:"webpack-reference"},"Webpack Reference"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://nystudio107.com/blog/an-annotated-webpack-4-config-for-frontend-web-development"},"Webpack 4 Tutorial")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://juejin.cn/post/6870055445034172424"},"Custom Plugin"))),(0,r.kt)("h2",{id:"vite"},"Vite"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import path from 'node:path';\nimport react from '@vitejs/plugin-react';\nimport { defineConfig } from 'vite';\nimport dts from 'vite-plugin-dts';\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    dts({\n      insertTypesEntry: true,\n    }),\n  ],\n  build: {\n    lib: {\n      entry: path.resolve(__dirname, 'src/lib/index.ts'),\n      name: 'SafeView',\n      formats: ['es', 'umd'],\n      fileName: format => `safeview.${format}.js`,\n    },\n    rollupOptions: {\n      external: ['react', 'react-dom'],\n      output: {\n        globals: {\n          react: 'React',\n          'react-dom': 'ReactDOM',\n        },\n      },\n    },\n    minify: true,\n    sourcemap: true,\n  },\n});\n")))}u.isMDXComponent=!0},6161:function(e,n,t){n.Z=t.p+"assets/images/ClientSize-188639869aa83d77661cdd7924b149a1.png"},9103:function(e,n,t){n.Z=t.p+"assets/images/ContextStackAndScopeChain-1fe54b80b91bd079b55a126e7d2fec4a.png"},9686:function(e,n,t){n.Z=t.p+"assets/images/CriticalRenderPath-d8b8799786c63f7b716d6d1fec65e916.svg"},3006:function(e,n,t){n.Z=t.p+"assets/images/EventLoop-55376b882d25e724423d4dc9883cf416.jpg"},8804:function(e,n,t){n.Z=t.p+"assets/images/OffsetSize-aae54cfc6d6752f66a0d8587797f0820.png"},1748:function(e,n,t){n.Z=t.p+"assets/images/RenderingPatterns-ab7b4fd4c4291369b4701b45e19516bd.png"},1816:function(e,n){n.Z="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA4MjAgMjAwIj48c3R5bGU+LnN2Zy1sYWJlbCwuc3ZnLXRhZ3tkb21pbmFudC1iYXNlbGluZTpjZW50cmFsfS5zdmctdGFne2ZvbnQtd2VpZ2h0OjcwMDtmb250LWZhbWlseTptb25vc3BhY2U7Zm9udC1zaXplOjEzcHh9LnN2Zy1sYWJlbHtmb250LWZhbWlseTpzYW5zLXNlcmlmO2ZvbnQtc2l6ZToxMHB4fS5wYXJzZXJ7c3Ryb2tlOiM2ZWFlMDA7ZmlsbDojNmVhZTAwfS5mZXRjaHtzdHJva2U6IzAwMzVmZjtmaWxsOiMwMDM1ZmZ9LmV4ZWN1dGlvbntzdHJva2U6cmVkO2ZpbGw6cmVkfS5wcm9ncmVzc3tzdHJva2Utd2lkdGg6Mn0ucHJvZ3Jlc3MucGFyc2VyOm5vdCguZmlyc3Qpe21hcmtlci1zdGFydDp1cmwoI3BhcnNlci1tYXJrZXIpfS5wcm9ncmVzcy5wYXJzZXI6bm90KC5sYXN0KXttYXJrZXItZW5kOnVybCgjcGFyc2VyLW1hcmtlcil9LnByb2dyZXNzLmZldGNoOm5vdCguZmlyc3Qpe21hcmtlci1zdGFydDp1cmwoI2ZldGNoLW1hcmtlcil9LnByb2dyZXNzLmZldGNoOm5vdCgubGFzdCl7bWFya2VyLWVuZDp1cmwoI2ZldGNoLW1hcmtlcil9LnByb2dyZXNzLmV4ZWN1dGlvbjpub3QoLmZpcnN0KXttYXJrZXItc3RhcnQ6dXJsKCNleGVjdXRpb24tbWFya2VyKX0ucHJvZ3Jlc3MuZXhlY3V0aW9uOm5vdCgubGFzdCl7bWFya2VyLWVuZDp1cmwoI2V4ZWN1dGlvbi1tYXJrZXIpfW1hcmtlciZndDtjaXJjbGV7c3Ryb2tlLXdpZHRoOjB9LmNvbm5lY3RvcntzdHJva2U6I2NlY2VjZTtzdHJva2Utd2lkdGg6MX08L3N0eWxlPjxwYXRoIHN0cm9rZT0iIzZhOTQwMCIgc3Ryb2tlLWRhc2hhcnJheT0iMSAxIiBkPSJNMCAzMy41aDgyME0wIDY2LjVoODIwTTAgOTkuNWg4MjBtLTgyMCAzM2g4MjBNMjQ1LjUgMXYyOG0wIDl2MjRtMCA2djI3bTAgOXYyNG0wIDl2MjgiLz48ZGVmcz48bWFya2VyIGlkPSJwYXJzZXItbWFya2VyIiBtYXJrZXJIZWlnaHQ9IjMiIG1hcmtlcldpZHRoPSIzIiByZWZYPSIxLjUiIHJlZlk9IjEuNSI+PGNpcmNsZSBjeD0iMS41IiBjeT0iMS41IiByPSIxLjUiIGNsYXNzPSJwYXJzZXIiLz48L21hcmtlcj48bWFya2VyIGlkPSJmZXRjaC1tYXJrZXIiIG1hcmtlckhlaWdodD0iMyIgbWFya2VyV2lkdGg9IjMiIHJlZlg9IjEuNSIgcmVmWT0iMS41Ij48Y2lyY2xlIGN4PSIxLjUiIGN5PSIxLjUiIHI9IjEuNSIgY2xhc3M9ImZldGNoIi8+PC9tYXJrZXI+PG1hcmtlciBpZD0iZXhlY3V0aW9uLW1hcmtlciIgbWFya2VySGVpZ2h0PSIzIiBtYXJrZXJXaWR0aD0iMyIgcmVmWD0iMS41IiByZWZZPSIxLjUiPjxjaXJjbGUgY3g9IjEuNSIgY3k9IjEuNSIgcj0iMS41IiBjbGFzcz0iZXhlY3V0aW9uIi8+PC9tYXJrZXI+PC9kZWZzPjx0ZXh0IHg9IjEyIiB5PSIxNi43NSIgY2xhc3M9InN2Zy10YWciPiZsdDtzY3JpcHQmZ3Q7PC90ZXh0Pjx0ZXh0IHk9IjkiIGNsYXNzPSJzdmctbGFiZWwiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDI1MikiPlNjcmlwdGluZzo8L3RleHQ+PHRleHQgeT0iMjQiIGNsYXNzPSJzdmctbGFiZWwiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDI1MikiPkhUTUwgUGFyc2VyOjwvdGV4dD48cGF0aCBkPSJNNTA5IDl2MTVNNjU2IDl2MTUiIGNsYXNzPSJjb25uZWN0b3IiLz48cGF0aCBkPSJNMzU4IDI0aDE1MSIgY2xhc3M9InBhcnNlciBwcm9ncmVzcyBmaXJzdCIvPjxwYXRoIGQ9Ik01MDkgOWg5NyIgY2xhc3M9ImZldGNoIHByb2dyZXNzIi8+PHBhdGggZD0iTTYwNiA5aDUwIiBjbGFzcz0iZXhlY3V0aW9uIHByb2dyZXNzIi8+PHBhdGggZD0iTTY1NiAyNGgxMjgiIGNsYXNzPSJwYXJzZXIgcHJvZ3Jlc3MgbGFzdCIvPjx0ZXh0IHg9IjEyIiB5PSIxNi43NSIgY2xhc3M9InN2Zy10YWciIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAgMzMpIj4mbHQ7c2NyaXB0IGRlZmVyJmd0OzwvdGV4dD48dGV4dCB5PSI5IiBjbGFzcz0ic3ZnLWxhYmVsIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyNTIgMzMpIj5TY3JpcHRpbmc6PC90ZXh0Pjx0ZXh0IHk9IjI0IiBjbGFzcz0ic3ZnLWxhYmVsIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyNTIgMzMpIj5IVE1MIFBhcnNlcjo8L3RleHQ+PHBhdGggZD0iTTczNiA0MnYxNSIgY2xhc3M9ImNvbm5lY3RvciIvPjxwYXRoIGQ9Ik0zNTggNTdoMzc4IiBjbGFzcz0icGFyc2VyIHByb2dyZXNzIGZpcnN0Ii8+PHBhdGggZD0iTTUwOSA0Mmg5NyIgY2xhc3M9ImZldGNoIHByb2dyZXNzIi8+PHBhdGggZD0iTTczNiA0Mmg0OCIgY2xhc3M9ImV4ZWN1dGlvbiBwcm9ncmVzcyBsYXN0Ii8+PGc+PHRleHQgeD0iMTIiIHk9IjE2Ljc1IiBjbGFzcz0ic3ZnLXRhZyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCA2NikiPiZsdDtzY3JpcHQgYXN5bmMmZ3Q7PC90ZXh0Pjx0ZXh0IHk9IjkiIGNsYXNzPSJzdmctbGFiZWwiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDI1MiA2NikiPlNjcmlwdGluZzo8L3RleHQ+PHRleHQgeT0iMjQiIGNsYXNzPSJzdmctbGFiZWwiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDI1MiA2NikiPkhUTUwgUGFyc2VyOjwvdGV4dD48cGF0aCBkPSJNNjA2IDc1djE1bTUwLTE1djE1IiBjbGFzcz0iY29ubmVjdG9yIi8+PHBhdGggZD0iTTM1OCA5MGgyNDgiIGNsYXNzPSJwYXJzZXIgcHJvZ3Jlc3MgZmlyc3QiLz48cGF0aCBkPSJNNTA5IDc1aDk3IiBjbGFzcz0iZmV0Y2ggcHJvZ3Jlc3MiLz48cGF0aCBkPSJNNjA2IDc1aDUwIiBjbGFzcz0iZXhlY3V0aW9uIHByb2dyZXNzIi8+PHBhdGggZD0iTTY1NiA5MGgxMjgiIGNsYXNzPSJwYXJzZXIgcHJvZ3Jlc3MgbGFzdCIvPjwvZz48Zz48dGV4dCB4PSIxMiIgeT0iMTYuNzUiIGNsYXNzPSJzdmctdGFnIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwIDk5KSI+Jmx0O3NjcmlwdCB0eXBlPSZxdW90O21vZHVsZSZxdW90OyZndDs8L3RleHQ+PHRleHQgeT0iOSIgY2xhc3M9InN2Zy1sYWJlbCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjUyIDk5KSI+U2NyaXB0aW5nOjwvdGV4dD48dGV4dCB5PSIyNCIgY2xhc3M9InN2Zy1sYWJlbCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjUyIDk5KSI+SFRNTCBQYXJzZXI6PC90ZXh0PjxwYXRoIGQ9Ik03MzYgMTA4djE1IiBjbGFzcz0iY29ubmVjdG9yIi8+PHBhdGggZD0iTTM1OCAxMjNoMzc4IiBjbGFzcz0icGFyc2VyIHByb2dyZXNzIGZpcnN0Ii8+PHBhdGggZD0iTTUwOSAxMDhoOTdtMCAwaDIwbS0yMCAwbDIwIDcuNW0wIDBoMjBtMCAwaDIwbS0yMCAwbDIwLTcuNSIgY2xhc3M9ImZldGNoIHByb2dyZXNzIi8+PHBhdGggZD0iTTczNiAxMDhoNDgiIGNsYXNzPSJleGVjdXRpb24gcHJvZ3Jlc3MgbGFzdCIvPjwvZz48Zz48dGV4dCB4PSIxMiIgeT0iMTYuNzUiIGNsYXNzPSJzdmctdGFnIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwIDEzMikiPiZsdDtzY3JpcHQgdHlwZT0mcXVvdDttb2R1bGUmcXVvdDsgYXN5bmMmZ3Q7PC90ZXh0Pjx0ZXh0IHk9IjkiIGNsYXNzPSJzdmctbGFiZWwiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDI1MiAxMzIpIj5TY3JpcHRpbmc6PC90ZXh0Pjx0ZXh0IHk9IjI0IiBjbGFzcz0ic3ZnLWxhYmVsIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyNTIgMTMyKSI+SFRNTCBQYXJzZXI6PC90ZXh0PjxwYXRoIGQ9Ik02NjYgMTQxdjE1bTUwLTE1djE1IiBjbGFzcz0iY29ubmVjdG9yIi8+PHBhdGggZD0iTTM1OCAxNTZoMzA4IiBjbGFzcz0icGFyc2VyIHByb2dyZXNzIGZpcnN0Ii8+PHBhdGggZD0iTTUwOSAxNDFoOTdtMCAwaDIwbS0yMCAwbDIwIDcuNW0wIDBoMjBtMCAwaDIwbS0yMCAwbDIwLTcuNSIgY2xhc3M9ImZldGNoIHByb2dyZXNzIi8+PHBhdGggZD0iTTY2NiAxNDFoNTAiIGNsYXNzPSJleGVjdXRpb24gcHJvZ3Jlc3MiLz48cGF0aCBkPSJNNzE2IDE1Nmg2OCIgY2xhc3M9InBhcnNlciBwcm9ncmVzcyBsYXN0Ii8+PC9nPjxnIGNsYXNzPSJsZWdlbmQiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDM1Ny41IDE3MikiPjxjaXJjbGUgY3g9IjMiIGN5PSIzIiByPSIzIiBjbGFzcz0icGFyc2VyIi8+PHRleHQgeD0iOSIgeT0iMyIgY2xhc3M9InN2Zy1sYWJlbCI+cGFyc2VyPC90ZXh0PjxjaXJjbGUgY3g9IjUwIiBjeT0iMyIgcj0iMyIgY2xhc3M9ImZldGNoIi8+PHRleHQgeD0iNTYiIHk9IjMiIGNsYXNzPSJzdmctbGFiZWwiPmZldGNoPC90ZXh0PjxjaXJjbGUgY3g9IjkwIiBjeT0iMyIgcj0iMyIgY2xhc3M9ImV4ZWN1dGlvbiIvPjx0ZXh0IHg9Ijk2IiB5PSIzIiBjbGFzcz0ic3ZnLWxhYmVsIj5leGVjdXRpb248L3RleHQ+PC9nPjx0ZXh0IHg9Ijc4MiIgeT0iMTc1IiBjbGFzcz0ic3ZnLWxhYmVsIiB0ZXh0LWFuY2hvcj0iZW5kIj5ydW50aW1lIOKGkjwvdGV4dD48L3N2Zz4="},7407:function(e,n,t){n.Z=t.p+"assets/images/ScrollSize-0fbec70f8a0fcc83776fd80e9ff17f01.png"},9601:function(e,n,t){n.Z=t.p+"assets/images/ServerSideRendering-fc978d9129203d94372e9f0895fd33a7.png"}}]);