"use strict";(self.webpackChunkawesome_notes=self.webpackChunkawesome_notes||[]).push([[6363],{3905:function(e,n,t){t.d(n,{Zo:function(){return c},kt:function(){return d}});var r=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var p=r.createContext({}),l=function(e){var n=r.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},c=function(e){var n=l(e.components);return r.createElement(p.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},m=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,o=e.originalType,p=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),m=l(t),d=a,h=m["".concat(p,".").concat(d)]||m[d]||u[d]||o;return t?r.createElement(h,i(i({ref:n},c),{},{components:t})):r.createElement(h,i({ref:n},c))}));function d(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=t.length,i=new Array(o);i[0]=m;var s={};for(var p in n)hasOwnProperty.call(n,p)&&(s[p]=n[p]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var l=2;l<o;l++)i[l]=t[l];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}m.displayName="MDXCreateElement"},744:function(e,n,t){t.r(n),t.d(n,{assets:function(){return c},contentTitle:function(){return p},default:function(){return d},frontMatter:function(){return s},metadata:function(){return l},toc:function(){return u}});var r=t(7462),a=t(3366),o=(t(7294),t(3905)),i=["components"],s={author:"Sabertazimi",authorTitle:"Web Developer",authorURL:"https://github.com/sabertazimi",authorImageURL:"https://github.com/sabertazimi.png",tags:["Web","React","Router"]},p="React Router Basic Notes",l={unversionedId:"web/react/reactRouterBasicNotes",id:"web/react/reactRouterBasicNotes",title:"React Router Basic Notes",description:"Router and Route",source:"@site/notes/web/react/reactRouterBasicNotes.md",sourceDirName:"web/react",slug:"/web/react/reactRouterBasicNotes",permalink:"/awesome-notes/web/react/reactRouterBasicNotes",editUrl:"https://github.com/sabertazimi/awesome-notes/edit/main/notes/web/react/reactRouterBasicNotes.md",tags:[{label:"Web",permalink:"/awesome-notes/tags/web"},{label:"React",permalink:"/awesome-notes/tags/react"},{label:"Router",permalink:"/awesome-notes/tags/router"}],version:"current",lastUpdatedBy:"sabertazimi",lastUpdatedAt:1650928413,formattedLastUpdatedAt:"4/25/2022",frontMatter:{author:"Sabertazimi",authorTitle:"Web Developer",authorURL:"https://github.com/sabertazimi",authorImageURL:"https://github.com/sabertazimi.png",tags:["Web","React","Router"]},sidebar:"sidebar",previous:{title:"React Basic Notes",permalink:"/awesome-notes/web/react/reactBasicNotes"},next:{title:"Redux Basic Notes",permalink:"/awesome-notes/web/react/reduxBasicNotes"}},c={},u=[{value:"Router and Route",id:"router-and-route",level:2},{value:"Basic Usage",id:"basic-usage",level:3},{value:"Nested Route",id:"nested-route",level:3},{value:"Private Route",id:"private-route",level:3},{value:"URL Params",id:"url-params",level:3},{value:"Component Props",id:"component-props",level:3},{value:"Link and URL Props",id:"link-and-url-props",level:3},{value:"Clean URLs",id:"clean-urls",level:3},{value:"Change Route",id:"change-route",level:3},{value:"Deployment",id:"deployment",level:2},{value:"Relative Path",id:"relative-path",level:3},{value:"Webpack Dev Server",id:"webpack-dev-server",level:3},{value:"Express Config",id:"express-config",level:3},{value:"Nginx Config",id:"nginx-config",level:3},{value:"A Simple React Router",id:"a-simple-react-router",level:2},{value:"Route Component",id:"route-component",level:3},{value:"Link Component",id:"link-component",level:3},{value:"Redirect Component",id:"redirect-component",level:3},{value:"Reference",id:"reference",level:2}],m={toc:u};function d(e){var n=e.components,t=(0,a.Z)(e,i);return(0,o.kt)("wrapper",(0,r.Z)({},m,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"react-router-basic-notes"},"React Router Basic Notes"),(0,o.kt)("h2",{id:"router-and-route"},"Router and Route"),(0,o.kt)("p",null,"parent routes are active when child routes are active"),(0,o.kt)("h3",{id:"basic-usage"},"Basic Usage"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},'import {\n  Redirect,\n  Route,\n  BrowserRouter as Router,\n  Switch,\n} from \'react-router-dom\';\n\nclass App extends Component {\n  render() {\n    return (\n      <Router>\n        <Switch>\n          <Route exact path="/" component={Home} />\n          <Route\n            exact\n            path="/tags"\n            render={() => {\n              return <Redirect to="/tags/all" />;\n            }}\n          />\n          <Route path="/tags/:tagName" component={Tags} />\n          <Route path="/posts/:mdFile" component={Post} />\n          <Route path="/book" component={Book} />\n          <Route component={NotFound} />\n        </Switch>\n      </Router>\n    );\n  }\n}\n')),(0,o.kt)("h3",{id:"nested-route"},"Nested Route"),(0,o.kt)("p",null,"Key Notes: In component of parent route, should render ",(0,o.kt)("inlineCode",{parentName:"p"},"{this.props.children}"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},'import {\n  Redirect,\n  Route,\n  BrowserRouter as Router,\n  Switch,\n} from \'react-router-dom\';\n\nrender(\n  <Router>\n    <Route path="/" component={App}>\n      <Route path="/repos" component={Repos}>\n        <Route path="/repos/:userName/:repoName" component={Repo} />\n      </Route>\n    </Route>\n  </Router>,\n  document.getElementById(\'app\')\n);\n')),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"In ",(0,o.kt)("inlineCode",{parentName:"li"},"App.js"),": ",(0,o.kt)("inlineCode",{parentName:"li"},"render() { return (<div>... {this.props.children}</ div>); }"),"."),(0,o.kt)("li",{parentName:"ul"},"In ",(0,o.kt)("inlineCode",{parentName:"li"},"Repos.js"),": ",(0,o.kt)("inlineCode",{parentName:"li"},"render() { return (<div>... {this.props.children}</ div>); }"),".")),(0,o.kt)("h3",{id:"private-route"},"Private Route"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"import { Redirect, Route } from 'react-router-dom';\n\nconst PrivateRoute = ({ component: Component, toAuth, ...rest }) => {\n  return (\n    <Route\n      {...rest}\n      render={props =>\n        auth.isAuthenticated() === true ? (\n          <Component {...props} />\n        ) : (\n          <Redirect\n            to={{\n              pathname: toAuth,\n              state: {\n                from: props.location,\n              },\n            }}\n          />\n        )\n      }\n    />\n  );\n};\n")),(0,o.kt)("h3",{id:"url-params"},"URL Params"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"import { Route } from 'react-router-dom';\n\nfunction App() {\n  return <Route path=\"/repos/:userName/:repoName\" component={Repo} />;\n}\n\n// In Repo.js\nfunction Repo() {\n  return (\n    <div>\n      <div>{this.props.params.userName}</div>\n      <div>{this.props.params.repoName}</div>\n    </div>\n  );\n}\n")),(0,o.kt)("h3",{id:"component-props"},"Component Props"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"subRoutes."),(0,o.kt)("li",{parentName:"ul"},"id/size."),(0,o.kt)("li",{parentName:"ul"},"etc....")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"import { Route } from 'react-router-dom';\n\nfunction RenderRoute({ component: Component }) {\n  return <Route render={props => <Component {...props} />} />;\n}\n")),(0,o.kt)("h3",{id:"link-and-url-props"},"Link and URL Props"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"import Component from './Component';\n\nfunction App() {\n  const { ...state } = this.props.location.state;\n\n  return (\n    <Component\n      to={{\n        pathname: url,\n        state: { ...state },\n      }}\n    />\n  );\n}\n")),(0,o.kt)("h3",{id:"clean-urls"},"Clean URLs"),(0,o.kt)("p",null,"Switch from ",(0,o.kt)("inlineCode",{parentName:"p"},"hashHistory")," to ",(0,o.kt)("inlineCode",{parentName:"p"},"browserHistory"),"."),(0,o.kt)("h3",{id:"change-route"},"Change Route"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"onEnter = { () => store.dispatch(createRouteAction(params))}"),"."),(0,o.kt)("li",{parentName:"ul"},"Return ",(0,o.kt)("inlineCode",{parentName:"li"},"<Redirect />")," conditionally and ",(0,o.kt)("inlineCode",{parentName:"li"},"withRouter")," wrapper (",(0,o.kt)("inlineCode",{parentName:"li"},"this.props.history.push('nextURL')"),").")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"import { Redirect } from 'react-router-dom';\n\nclass Login {\n  login = () => {\n    // 1. login\n    // 2. setState and pushHistory (500ms delay)\n    auth.login(() => {\n      const { from } = this.props.location.state || { from: { pathname: '/' } };\n      this.setState({ redirect: true });\n      this.props.history.push(from);\n    }, 500);\n  };\n\n  render() {\n    const { redirect } = this.state;\n    const { from } = this.props.location.state || { from: { pathname: '/' } };\n\n    if (redirect) {\n      return <Redirect to={from} />;\n    }\n\n    return (\n      <div>\n        <button onClick={this.login}>Login</button>\n      </div>\n    );\n  }\n}\n\n// apply `history` object to props of `Login` component\nexport default withRouter(Login);\n")),(0,o.kt)("h2",{id:"deployment"},"Deployment"),(0,o.kt)("h3",{id:"relative-path"},"Relative Path"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},'const App = () => {\n  const history = useHistory();\n  return (\n    <ConnectedRouter history={history} basename="/react-boilerplate">\n      <Fragment>\n        <Switch>\n          <Route exact path={`${process.env.PUBLIC_URL}/`} component={Home} />\n          <Route path={`${process.env.PUBLIC_URL}/about`} component={About} />\n          <Route\n            path={`${process.env.PUBLIC_URL}/404`}\n            render={() => <Redirect to={`${process.env.PUBLIC_URL}/`} />}\n          />\n        </Switch>\n      </Fragment>\n    </ConnectedRouter>\n  );\n};\n\nconst Header = () => (\n  <div>\n    <NavLink to={`${process.env.PUBLIC_URL}/`}>Home</NavLink>\n    <NavLink to={`${process.env.PUBLIC_URL}/about`}>About</NavLink>\n  </div>\n);\n')),(0,o.kt)("h3",{id:"webpack-dev-server"},"Webpack Dev Server"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"publicPath: '/'")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"historyApiFallback: true"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"const path = require('path');\nconst HtmlWebpackPlugin = require('html-webpack-plugin');\n\nmodule.exports = {\n  entry: './app/index.js',\n  output: {\n    path: path.resolve(__dirname, 'dist'),\n    filename: 'index_bundle.js',\n    publicPath: '/',\n  },\n  module: {\n    rules: [\n      { test: /\\.(js)$/, use: 'babel-loader' },\n      { test: /\\.css$/, use: ['style-loader', 'css-loader'] },\n    ],\n  },\n  devServer: {\n    historyApiFallback: true,\n  },\n  plugins: [\n    new HtmlWebpackPlugin({\n      template: 'app/index.html',\n    }),\n  ],\n};\n")),(0,o.kt)("h3",{id:"express-config"},"Express Config"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"app.use(express.static(path.resolve(__dirname, 'build')));\n\n// always serve index.html for any request\napp.get('*', (req, res) => {\n  res.sendFile(path.resolve(__dirname, 'build', 'index.html'));\n});\n")),(0,o.kt)("h3",{id:"nginx-config"},"Nginx Config"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-nginx"},"# always serve index.html for any request (react-router for single page application)\nroot /var/www/blog/html/build;\nindex index.html;\nserver_name blog.sabertazimi.cn;\n\nlocation / {\n   try_files $uri /index.html;\n}\n")),(0,o.kt)("h2",{id:"a-simple-react-router"},"A Simple React Router"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"<Route>")," instances listen to ",(0,o.kt)("inlineCode",{parentName:"li"},"popstate")," event to ",(0,o.kt)("inlineCode",{parentName:"li"},"forceUpdate"),"."),(0,o.kt)("li",{parentName:"ul"},"When click ",(0,o.kt)("inlineCode",{parentName:"li"},"<Link>"),"/",(0,o.kt)("inlineCode",{parentName:"li"},"<Redirect>"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"historyPush")," or ",(0,o.kt)("inlineCode",{parentName:"li"},"historyReplace")," get called,\n",(0,o.kt)("inlineCode",{parentName:"li"},"<Route>")," instances re-match and re-render.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"const instances = [];\n\nconst register = comp => instances.push(comp);\nconst unregister = comp => instances.splice(instances.indexOf(comp), 1);\n\nconst historyPush = path => {\n  window.history.pushState({}, null, path);\n  instances.forEach(instance => instance.forceUpdate());\n};\n\nconst historyReplace = path => {\n  window.history.replaceState({}, null, path);\n  instances.forEach(instance => instance.forceUpdate());\n};\n")),(0,o.kt)("h3",{id:"route-component"},"Route Component"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"const matchPath = (pathname, options) => {\n  const { exact = false, path } = options;\n\n  if (!path) {\n    return {\n      path: null,\n      url: pathname,\n      isExact: true,\n    };\n  }\n\n  const match = new RegExp(`^${path}`).exec(pathname);\n\n  if (!match) {\n    // There wasn't a match.\n    return null;\n  }\n\n  const url = match[0];\n  const isExact = pathname === url;\n\n  if (exact && !isExact) {\n    // There was a match, but it wasn't\n    // an exact match as specified by\n    // the exact prop.\n\n    return null;\n  }\n\n  return {\n    path,\n    url,\n    isExact,\n  };\n};\n\nclass Route extends Component {\n  static propTypes: {\n    path: PropTypes.string;\n    exact: PropTypes.bool;\n    component: PropTypes.func;\n    render: PropTypes.func;\n  };\n\n  componentWillMount() {\n    window.addEventListener('popstate', this.handlePop);\n    register(this);\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('popstate', this.handlePop);\n    unregister(this);\n  }\n\n  handlePop = () => {\n    this.forceUpdate();\n  };\n\n  render() {\n    const { path, exact, component, render } = this.props;\n\n    const match = matchPath(window.location.pathname, { path, exact });\n\n    if (!match) {\n      return null;\n    }\n\n    if (component) {\n      return React.createElement(component, { match });\n    }\n\n    if (render) {\n      return render({ match });\n    }\n\n    return null;\n  }\n}\n")),(0,o.kt)("h3",{id:"link-component"},"Link Component"),(0,o.kt)("p",null,"Whenever a ",(0,o.kt)("inlineCode",{parentName:"p"},"<Link>")," is clicked and the location changes,\neach ",(0,o.kt)("inlineCode",{parentName:"p"},"<Route>")," will be aware of that and re-match and re-render with ",(0,o.kt)("inlineCode",{parentName:"p"},"instances"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"class Link extends Component {\n  static propTypes = {\n    to: PropTypes.string.isRequired,\n    replace: PropTypes.bool,\n  };\n\n  handleClick = event => {\n    const { replace, to } = this.props;\n    event.preventDefault();\n\n    replace ? historyReplace(to) : historyPush(to);\n  };\n\n  render() {\n    const { to, children } = this.props;\n\n    return (\n      <a href={to} onClick={this.handleClick}>\n        {children}\n      </a>\n    );\n  }\n}\n")),(0,o.kt)("h3",{id:"redirect-component"},"Redirect Component"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"class Redirect extends Component {\n  static defaultProps = {\n    push: false,\n  };\n\n  static propTypes = {\n    to: PropTypes.string.isRequired,\n    push: PropTypes.bool.isRequired,\n  };\n\n  componentDidMount() {\n    const { to, push } = this.props;\n\n    push ? historyPush(to) : historyReplace(to);\n  }\n\n  render() {\n    return null;\n  }\n}\n")),(0,o.kt)("h2",{id:"reference"},"Reference"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://www.youtube.com/playlist?list=PLqrUy7kON1mfJ1cQfJJ1FiULLNngvlFTD"},"React Router Tutorial"))))}d.isMDXComponent=!0}}]);