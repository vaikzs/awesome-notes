"use strict";(self.webpackChunkawesome_notes=self.webpackChunkawesome_notes||[]).push([[7562],{3905:function(e,n,t){t.d(n,{Zo:function(){return u},kt:function(){return m}});var a=t(7294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var s=a.createContext({}),p=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},u=function(e){var n=p(e.components);return a.createElement(s.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},d=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,o=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=p(t),m=i,v=d["".concat(s,".").concat(m)]||d[m]||c[m]||o;return t?a.createElement(v,r(r({ref:n},u),{},{components:t})):a.createElement(v,r({ref:n},u))}));function m(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var o=t.length,r=new Array(o);r[0]=d;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l.mdxType="string"==typeof e?e:i,r[1]=l;for(var p=2;p<o;p++)r[p]=t[p];return a.createElement.apply(null,r)}return a.createElement.apply(null,t)}d.displayName="MDXCreateElement"},796:function(e,n,t){t.r(n),t.d(n,{assets:function(){return u},contentTitle:function(){return s},default:function(){return m},frontMatter:function(){return l},metadata:function(){return p},toc:function(){return c}});var a=t(7462),i=t(3366),o=(t(7294),t(3905)),r=["components"],l={author:"Sabertazimi",authorTitle:"Web Developer",authorURL:"https://github.com/sabertazimi",authorImageURL:"https://github.com/sabertazimi.png",tags:["Web","Vue"]},s="Vue Basic Notes",p={unversionedId:"web/vue/vueBasicNotes",id:"web/vue/vueBasicNotes",title:"Vue Basic Notes",description:"Directives",source:"@site/notes/web/vue/vueBasicNotes.md",sourceDirName:"web/vue",slug:"/web/vue/vueBasicNotes",permalink:"/awesome-notes/web/vue/vueBasicNotes",editUrl:"https://github.com/sabertazimi/awesome-notes/edit/main/notes/web/vue/vueBasicNotes.md",tags:[{label:"Web",permalink:"/awesome-notes/tags/web"},{label:"Vue",permalink:"/awesome-notes/tags/vue"}],version:"current",lastUpdatedBy:"sabertazimi",lastUpdatedAt:1650030963,formattedLastUpdatedAt:"4/15/2022",frontMatter:{author:"Sabertazimi",authorTitle:"Web Developer",authorURL:"https://github.com/sabertazimi",authorImageURL:"https://github.com/sabertazimi.png",tags:["Web","Vue"]},sidebar:"sidebar",previous:{title:"Security Basic Notes",permalink:"/awesome-notes/web/security/securityBasicNotes"}},u={},c=[{value:"Directives",id:"directives",level:2},{value:"Control Flow Directives",id:"control-flow-directives",level:3},{value:"Attributes Binding Directive",id:"attributes-binding-directive",level:3},{value:"Class and Style Binding Directive",id:"class-and-style-binding-directive",level:3},{value:"Event Handlers Directive",id:"event-handlers-directive",level:3},{value:"Event Handlers and Modifiers",id:"event-handlers-and-modifiers",level:4},{value:"Custom Events",id:"custom-events",level:4},{value:"Model Directives",id:"model-directives",level:3},{value:"Components",id:"components",level:2},{value:"Computed Properties",id:"computed-properties",level:3},{value:"Slots",id:"slots",level:3},{value:"Fallback Slots",id:"fallback-slots",level:4},{value:"Named Slots",id:"named-slots",level:4},{value:"Scoped Slots",id:"scoped-slots",level:4},{value:"Composition API",id:"composition-api",level:2},{value:"Setup Method",id:"setup-method",level:3},{value:"Composition LifeCycle Hooks",id:"composition-lifecycle-hooks",level:3},{value:"Reactivity",id:"reactivity",level:3},{value:"Reactive Value",id:"reactive-value",level:4},{value:"Computed Value",id:"computed-value",level:4},{value:"Watch Value",id:"watch-value",level:4},{value:"Animation and Transition",id:"animation-and-transition",level:2},{value:"Fade Transition",id:"fade-transition",level:3},{value:"Slide Transition",id:"slide-transition",level:3},{value:"Transition Group",id:"transition-group",level:3},{value:"Transition Hooks",id:"transition-hooks",level:3},{value:"Transition Internals",id:"transition-internals",level:3},{value:"Transition Component",id:"transition-component",level:4},{value:"Transition Module",id:"transition-module",level:4},{value:"Transition Group Component",id:"transition-group-component",level:4},{value:"Modern Vue",id:"modern-vue",level:2},{value:"Suspense",id:"suspense",level:3},{value:"Keep Alive",id:"keep-alive",level:3},{value:"Vue Router",id:"vue-router",level:2},{value:"Basic Routes",id:"basic-routes",level:3},{value:"Dynamic Routes",id:"dynamic-routes",level:3},{value:"Routes Composition API",id:"routes-composition-api",level:4},{value:"Passing Routes Props",id:"passing-routes-props",level:4},{value:"Named Routes",id:"named-routes",level:3},{value:"Nested Routes",id:"nested-routes",level:3},{value:"Programmatic Routes Navigation",id:"programmatic-routes-navigation",level:3},{value:"Navigate to Different Location",id:"navigate-to-different-location",level:4},{value:"Replace Current Location",id:"replace-current-location",level:4},{value:"Traverse Routes History",id:"traverse-routes-history",level:4},{value:"Navigation Guard Routes",id:"navigation-guard-routes",level:3},{value:"Guard Routes Configuration",id:"guard-routes-configuration",level:4},{value:"Global Navigation Guards",id:"global-navigation-guards",level:4},{value:"Full Navigation Resolution Flow",id:"full-navigation-resolution-flow",level:4},{value:"Vuex",id:"vuex",level:2},{value:"Vuex Types",id:"vuex-types",level:3},{value:"Vite",id:"vite",level:2},{value:"Basic Configuration",id:"basic-configuration",level:3},{value:"Environment Variables and Modes",id:"environment-variables-and-modes",level:3},{value:"Vue CLI",id:"vue-cli",level:2},{value:"SCSS Configuration",id:"scss-configuration",level:3},{value:"Vue Best Practice",id:"vue-best-practice",level:2},{value:"Legacy Vue Internals",id:"legacy-vue-internals",level:2},{value:"Vue Constructor",id:"vue-constructor",level:3},{value:"Vue Prototype",id:"vue-prototype",level:3},{value:"Vue Global API",id:"vue-global-api",level:3},{value:"Vue Global Extend API",id:"vue-global-extend-api",level:4},{value:"Vue Global NextTick API",id:"vue-global-nexttick-api",level:4},{value:"Vue Global Mixin API",id:"vue-global-mixin-api",level:4},{value:"Vue Global Use API",id:"vue-global-use-api",level:4},{value:"Vue Instance",id:"vue-instance",level:3},{value:"Vue Mounting Workflow",id:"vue-mounting-workflow",level:3},{value:"Vue Options API",id:"vue-options-api",level:3},{value:"Vue Merge Options",id:"vue-merge-options",level:4},{value:"Vue Normalize Options",id:"vue-normalize-options",level:4},{value:"Vue Lifecycle",id:"vue-lifecycle",level:3},{value:"Vue Async Component",id:"vue-async-component",level:3},{value:"Vue Legacy Reactivity",id:"vue-legacy-reactivity",level:3},{value:"Vue Watcher and Observer",id:"vue-watcher-and-observer",level:4},{value:"Vue Array Watcher",id:"vue-array-watcher",level:4},{value:"Vue Global Set and Delete API",id:"vue-global-set-and-delete-api",level:4},{value:"Vue Computed Watcher",id:"vue-computed-watcher",level:4},{value:"Vue Router Watcher",id:"vue-router-watcher",level:4},{value:"Modern Vue Internals",id:"modern-vue-internals",level:2},{value:"Vue Virtual DOM",id:"vue-virtual-dom",level:3},{value:"Vue Template and Compiler",id:"vue-template-and-compiler",level:3},{value:"Vue Compilation Workflow",id:"vue-compilation-workflow",level:4},{value:"Vue Compilation Performant Improvements",id:"vue-compilation-performant-improvements",level:4},{value:"Vue Two-Way Data Binding",id:"vue-two-way-data-binding",level:3},{value:"Vue Reactivity",id:"vue-reactivity",level:3},{value:"ES6 Reactive Proxy",id:"es6-reactive-proxy",level:4},{value:"Vue Setup",id:"vue-setup",level:3}],d={toc:c};function m(e){var n=e.components,l=(0,i.Z)(e,r);return(0,o.kt)("wrapper",(0,a.Z)({},d,l,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"vue-basic-notes"},"Vue Basic Notes"),(0,o.kt)("h2",{id:"directives"},"Directives"),(0,o.kt)("h3",{id:"control-flow-directives"},"Control Flow Directives"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},'<template>\n  <p v-if="isShow">Show</p>\n  <p v-if="isEnabled">Enabled</p>\n  <p v-else>Disabled</p>\n  <p v-if="inventory > 10">In Stock</p>\n  <p v-else-if="inventory <= 10 && inventory > 0">Almost Sold Out</p>\n  <p v-else>Out of Stock</p>\n  <ul>\n    <li v-for="item in items" :key="item.id">{{ item.value }}</li>\n    <li v-for="(item, index) in items">\n      {{ parentMessage }} - {{ index }} - {{ item.message }}\n    </li>\n  </ul>\n</template>\n')),(0,o.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Prefer ",(0,o.kt)("inlineCode",{parentName:"p"},"v-show")," if you need to toggle something very often,\nand prefer ",(0,o.kt)("inlineCode",{parentName:"p"},"v-if")," if the condition is unlikely to change at runtime."))),(0,o.kt)("h3",{id:"attributes-binding-directive"},"Attributes Binding Directive"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},'<template>\n  <a :href="url">Dynamic Link</a>\n  <img :src="link" :alt="description" />\n  <button :disabled="item.length === 0">Save Item</button>\n</template>\n')),(0,o.kt)("h3",{id:"class-and-style-binding-directive"},"Class and Style Binding Directive"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Static class."),(0,o.kt)("li",{parentName:"ul"},"Array binding."),(0,o.kt)("li",{parentName:"ul"},"Object binding.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},'<template>\n  <div class="static"></div>\n  <div :class="{ active: isActive, \'text-danger\': hasError }"></div>\n  <div :class="[isActive ? activeClass : \'\', errorClass]"></div>\n  <div :class="[{ active: isActive }, errorClass]"></div>\n  <div :style="{ color: activeColor, fontSize: fontSize + \'px\' }"></div>\n  <div :style="[baseStyles, overridingStyles]"></div>\n  <div :style="{ display: [\'-webkit-box\', \'-ms-flexbox\', \'flex\'] }"></div>\n</template>\n')),(0,o.kt)("h3",{id:"event-handlers-directive"},"Event Handlers Directive"),(0,o.kt)("h4",{id:"event-handlers-and-modifiers"},"Event Handlers and Modifiers"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},'<div id="handler">\n  <button @click="warn(\'Warn message.\', $event)">Submit</button>\n  <button @click="one($event), two($event)">Submit</button>\n\n  \x3c!-- \u963b\u6b62\u5355\u51fb\u4e8b\u4ef6\u7ee7\u7eed\u4f20\u64ad --\x3e\n  <a @click.stop="doThis"></a>\n\n  \x3c!-- \u63d0\u4ea4\u4e8b\u4ef6\u4e0d\u518d\u91cd\u8f7d\u9875\u9762 --\x3e\n  <form @submit.prevent="onSubmit"></form>\n\n  \x3c!-- \u4fee\u9970\u7b26\u53ef\u4ee5\u4e32\u8054 --\x3e\n  <a @click.stop.prevent="doThat"></a>\n\n  \x3c!-- \u53ea\u6709\u4fee\u9970\u7b26 --\x3e\n  <form @submit.prevent></form>\n\n  \x3c!-- \u6dfb\u52a0\u4e8b\u4ef6\u76d1\u542c\u5668\u65f6\u4f7f\u7528\u4e8b\u4ef6\u6355\u83b7\u6a21\u5f0f --\x3e\n  \x3c!-- \u5373\u5185\u90e8\u5143\u7d20\u89e6\u53d1\u7684\u4e8b\u4ef6\u5148\u5728\u6b64\u5904\u7406, \u7136\u540e\u624d\u4ea4\u7531\u5185\u90e8\u5143\u7d20\u8fdb\u884c\u5904\u7406 --\x3e\n  <div @click.capture="doThis">...</div>\n\n  \x3c!-- \u53ea\u5f53\u5728 event.target \u662f\u5f53\u524d\u5143\u7d20\u81ea\u8eab\u65f6\u89e6\u53d1\u5904\u7406\u51fd\u6570 --\x3e\n  \x3c!-- \u5373\u4e8b\u4ef6\u4e0d\u662f\u4ece\u5185\u90e8\u5143\u7d20\u89e6\u53d1\u7684 --\x3e\n  <div @click.self="doThat">...</div>\n\n  \x3c!-- \u70b9\u51fb\u4e8b\u4ef6\u5c06\u53ea\u4f1a\u89e6\u53d1\u4e00\u6b21 --\x3e\n  <a @click.once="doThis"></a>\n\n  \x3c!-- \u6eda\u52a8\u4e8b\u4ef6\u7684\u9ed8\u8ba4\u884c\u4e3a (\u5373\u6eda\u52a8\u884c\u4e3a) \u5c06\u4f1a\u7acb\u5373\u89e6\u53d1   --\x3e\n  \x3c!-- \u800c\u4e0d\u4f1a\u7b49\u5f85 `onScroll` \u5b8c\u6210                   --\x3e\n  \x3c!-- \u8fd9\u5176\u4e2d\u5305\u542b `event.preventDefault()` \u7684\u60c5\u51b5   --\x3e\n  <div @scroll.passive="onScroll">...</div>\n\n  <input @keyup.enter="submit" />\n  <input @keyup.tab="submit" />\n  <input @keyup.delete="submit" />\n  <input @keyup.esc="submit" />\n  <input @keyup.space="submit" />\n  <input @keyup.up="submit" />\n  <input @keyup.down="submit" />\n  <input @keyup.left="submit" />\n  <input @keyup.right="submit" />\n  <input @keyup.page-down="onPageDown" />\n  <input @keyup.ctrl.enter="clear" />\n  <input @keyup.alt.space="clear" />\n  <input @keyup.shift.up="clear" />\n  <input @keyup.meta.right="clear" />\n\n  \x3c!-- Ctrl + Click --\x3e\n  <div @click.ctrl="doSomething">Do something</div>\n  \x3c!-- \u5373\u4f7f Alt \u6216 Shift \u88ab\u4e00\u540c\u6309\u4e0b\u65f6\u4e5f\u4f1a\u89e6\u53d1 --\x3e\n  <button @click.ctrl="onClick">A</button>\n  \x3c!-- \u6709\u4e14\u53ea\u6709 Ctrl \u88ab\u6309\u4e0b\u7684\u65f6\u5019\u624d\u89e6\u53d1 --\x3e\n  <button @click.ctrl.exact="onCtrlClick">A</button>\n  \x3c!-- \u6ca1\u6709\u4efb\u4f55\u7cfb\u7edf\u4fee\u9970\u7b26\u88ab\u6309\u4e0b\u7684\u65f6\u5019\u624d\u89e6\u53d1 --\x3e\n  <button @click.exact="onClick">A</button>\n  <button @click.left="onClick">Left click</button>\n  <button @click.right="onClick">Right click</button>\n  <button @click.middle="onClick">Middle click</button>\n</div>\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"Vue.createApp({\n  methods: {\n    warn(message, event) {\n      if (event) event.preventDefault();\n      alert(message);\n    },\n    one(event) {\n      if (event) event.preventDefault();\n      console.log('one');\n    },\n    two(event) {\n      if (event) event.preventDefault();\n      console.log('two');\n    },\n  },\n}).mount('#inline-handler');\n")),(0,o.kt)("h4",{id:"custom-events"},"Custom Events"),(0,o.kt)("p",null,"Form events:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"app.component('CustomForm', {\n  emits: {\n    // \u6ca1\u6709\u9a8c\u8bc1\n    click: null,\n\n    // \u9a8c\u8bc1 submit \u4e8b\u4ef6\n    submit: ({ email, password }) => {\n      if (email && password) {\n        return true;\n      } else {\n        console.warn('Invalid submit event payload!');\n        return false;\n      }\n    },\n  },\n  methods: {\n    customEvent() {\n      this.$emit('custom-event');\n    },\n    submitForm(email, password) {\n      this.$emit('submit', { email, password });\n    },\n  },\n});\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},'<custom-form\n  @click="handleClick"\n  @submit="handleSubmit"\n  @custom-event="handleEvent"\n></custom-form>\n')),(0,o.kt)("p",null,"Drag and Drop events:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},"\x3c!-- Drag.vue --\x3e\n<template>\n  <div\n    draggable=\"true\"\n    @dragenter.prevent\n    @dragover.prevent\n    @dragstart.self=\"onDrag\"\n  >\n    <slot />\n  </div>\n</template>\n\n<script>\n  export default {\n    props: {\n      transferData: {\n        type: Object,\n        required: true,\n      },\n    },\n    methods: {\n      onDrag(e) {\n        e.dataTransfer.effectAllowed = 'move';\n        e.dataTransfer.dropEffect = 'move';\n        e.dataTransfer.setData('payload', JSON.stringify(this.transferData));\n      },\n    },\n  };\n<\/script>\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},"\x3c!-- Drop.vue --\x3e\n<template>\n  <div @dragenter.prevent @dragover.prevent @drop.stop=\"onDrop\">\n    <slot />\n  </div>\n</template>\n\n<script>\n  export default {\n    methods: {\n      onDrop(e) {\n        const transferData = JSON.parse(e.dataTransfer.getData('payload'));\n        this.$emit('drop', transferData);\n      },\n    },\n  };\n<\/script>\n")),(0,o.kt)("h3",{id:"model-directives"},"Model Directives"),(0,o.kt)("p",null,"\u672c\u8d28\u4e3a\u8bed\u6cd5\u7cd6 (",(0,o.kt)("inlineCode",{parentName:"p"},"v-model = v-bind + v-on"),"):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},'<input v-model="searchText" />\n<input :value="searchText" @input="searchText = $event.target.value" />\n')),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"checkbox"),"/",(0,o.kt)("inlineCode",{parentName:"li"},"radio"),":\n",(0,o.kt)("inlineCode",{parentName:"li"},"checked")," property and ",(0,o.kt)("inlineCode",{parentName:"li"},"@change")," event."),(0,o.kt)("li",{parentName:"ul"},"Multiple ",(0,o.kt)("inlineCode",{parentName:"li"},"checkbox"),":\nvalue array."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"select"),":\n",(0,o.kt)("inlineCode",{parentName:"li"},"value")," property and ",(0,o.kt)("inlineCode",{parentName:"li"},"@change")," event."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"text"),"/",(0,o.kt)("inlineCode",{parentName:"li"},"textarea"),":\n",(0,o.kt)("inlineCode",{parentName:"li"},"value")," property and ",(0,o.kt)("inlineCode",{parentName:"li"},"@input")," event."),(0,o.kt)("li",{parentName:"ul"},"Child component:",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Default: ",(0,o.kt)("inlineCode",{parentName:"li"},"value")," property and ",(0,o.kt)("inlineCode",{parentName:"li"},"@input")," event."),(0,o.kt)("li",{parentName:"ul"},"Use ",(0,o.kt)("inlineCode",{parentName:"li"},"options.model")," on Child component to change default ",(0,o.kt)("inlineCode",{parentName:"li"},"v-bind")," and ",(0,o.kt)("inlineCode",{parentName:"li"},"v-on"),".")))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},'<input v-model="message" placeholder="edit me" />\n<textarea v-model="message" placeholder="add multiple lines"></textarea>\n\n<input type="radio" id="one" value="One" v-model="picked" />\n<input type="radio" id="two" value="Two" v-model="picked" />\n\n<input type="checkbox" id="checkbox" v-model="checked" />\n<label for="checkbox">{{ checked }}</label>\n\n<input type="checkbox" id="jack" value="Jack" v-model="checkedNames" />\n<input type="checkbox" id="john" value="John" v-model="checkedNames" />\n<input type="checkbox" id="mike" value="Mike" v-model="checkedNames" />\n\n<select v-model="selected">\n  <option disabled value="">Please select one</option>\n  <option>A</option>\n  <option>B</option>\n  <option>C</option>\n</select>\n\n<select v-model="selected" multiple>\n  <option>A</option>\n  <option>B</option>\n  <option>C</option>\n</select>\n\n\x3c!-- Debounce --\x3e\n<input v-model.lazy="msg" />\n\x3c!-- \u81ea\u52a8\u5c06\u7528\u6237\u7684\u8f93\u5165\u503c\u8f6c\u4e3a\u6570\u503c\u7c7b\u578b --\x3e\n<input v-model.number="age" type="number" />\n\x3c!-- \u81ea\u52a8\u8fc7\u6ee4\u7528\u6237\u8f93\u5165\u7684\u9996\u5c3e\u7a7a\u767d\u5b57\u7b26 --\x3e\n<input v-model.trim="msg" /\n')),(0,o.kt)("p",null,"Component ",(0,o.kt)("inlineCode",{parentName:"p"},"v-model")," directive:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},'<custom-input v-model="searchText"></custom-input>\n<custom-input\n  :model-value="searchText"\n  @update:model-value="searchText = $event"\n></custom-input>\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"app.component('CustomInput', {\n  props: ['modelValue'],\n  emits: ['update:modelValue'],\n  template: `\n    <input\n      :value=\"modelValue\"\n      @input=\"$emit('update:modelValue', $event.target.value)\"\n    >\n  `,\n});\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"app.component('CustomInput', {\n  props: ['modelValue'],\n  emits: ['update:modelValue'],\n  computed: {\n    value: {\n      get() {\n        return this.modelValue;\n      },\n      set(value) {\n        this.$emit('update:modelValue', value);\n      },\n    },\n  },\n  template: `\n    <input v-model=\"value\">\n  `,\n});\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"options.model")," on Child component:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"const Child = {\n  template: `\n    <div>\n      <input :value=\"msg\" @input=\"updateValue\" placeholder=\"edit me\">\n    </div>\n  `,\n  props: ['msg'],\n  model: {\n    prop: 'msg',\n    event: 'change',\n  },\n  methods: {\n    updateValue(e) {\n      this.$emit('change', e.target.value);\n    },\n  },\n};\n\nconst vm = new Vue({\n  el: '#app',\n  components: {\n    Child,\n  },\n  data() {\n    return {\n      message: '',\n    };\n  },\n  template: `\n    <div>\n      <child v-model=\"message\"></child>\n      <p>Message is: {{ message }}</p>\n    </div>\n  `,\n});\n")),(0,o.kt)("h2",{id:"components"},"Components"),(0,o.kt)("h3",{id:"computed-properties"},"Computed Properties"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},'<div id="computed-basics">\n  <p>Has published books:</p>\n  <span>{{ publishedBooksMessage }}</span>\n</div>\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"Vue.createApp({\n  data() {\n    return {\n      author: {\n        name: 'John Doe',\n        books: [\n          'Vue 2 - Advanced Guide',\n          'Vue 3 - Basic Guide',\n          'Vue 4 - The Mystery',\n        ],\n      },\n    };\n  },\n  computed: {\n    // \u8ba1\u7b97\u5c5e\u6027\u7684 getter\n    publishedBooksMessage() {\n      // `this` \u6307\u5411 vm \u5b9e\u4f8b\n      return this.author.books.length > 0 ? 'Yes' : 'No';\n    },\n    fullName: {\n      // getter\n      get() {\n        return `${this.firstName} ${this.lastName}`;\n      },\n      // setter\n      set(newValue) {\n        const names = newValue.split(' ');\n        this.firstName = names[0];\n        this.lastName = names[names.length - 1];\n      },\n    },\n  },\n}).mount('#computed-basics');\n")),(0,o.kt)("h3",{id:"slots"},"Slots"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://developers.google.com/web/fundamentals/web-components/shadowdom#slots"},"Web Slot")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"name")," attribute."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"fallback")," content."),(0,o.kt)("li",{parentName:"ul"},"\u63d2\u69fd\u57fa\u672c\u76ee\u7684: \u81ea\u5b9a\u4e49\u7ec4\u4ef6\u6e32\u67d3\u7ec6\u8282."),(0,o.kt)("li",{parentName:"ul"},"Normal Slots:\n\u5728\u7236\u7ec4\u4ef6\u7f16\u8bd1\u548c\u6e32\u67d3\u9636\u6bb5\u751f\u6210 Slots VNodes,\n\u6570\u636e\u4f5c\u7528\u57df\u4e3a\u7236\u7ec4\u4ef6\u5b9e\u4f8b (\u4f7f\u7528\u63d2\u69fd\u7684\u7ec4\u4ef6)."),(0,o.kt)("li",{parentName:"ul"},"Scoped Slots:\n\u5728\u7236\u7ec4\u4ef6\u7f16\u8bd1\u548c\u6e32\u67d3\u9636\u6bb5\u4e3a ",(0,o.kt)("inlineCode",{parentName:"li"},"vnode.data")," \u6dfb\u52a0 ",(0,o.kt)("inlineCode",{parentName:"li"},"scopedSlots")," \u5bf9\u8c61,\n\u5728\u5b50\u7ec4\u4ef6\u7f16\u8bd1\u548c\u6e32\u67d3\u9636\u6bb5\u751f\u6210 Slots VNodes,\n\u6570\u636e\u4f5c\u7528\u57df\u4e3a\u5b50\u7ec4\u4ef6\u5b9e\u4f8b (\u5b9a\u4e49\u63d2\u69fd\u7684\u7ec4\u4ef6).")),(0,o.kt)("h4",{id:"fallback-slots"},"Fallback Slots"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},'\x3c!-- SubmitButton --\x3e\n<button type="submit">\n  <slot>Submit</slot>\n</button>\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},"<SubmitButton></SubmitButton>\n")),(0,o.kt)("p",null,"render to"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},'<button type="submit">Submit</button>\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},"<SubmitButton>Save</SubmitButton>\n")),(0,o.kt)("p",null,"render to"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},'<button type="submit">Save</button>\n')),(0,o.kt)("h4",{id:"named-slots"},"Named Slots"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"#"),": ",(0,o.kt)("inlineCode",{parentName:"li"},"v-slot")," directive shorthand.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},'\x3c!-- Layout --\x3e\n<div class="container">\n  <header>\n    <slot name="header"></slot>\n  </header>\n  <main>\n    <slot></slot>\n  </main>\n  <footer>\n    <slot name="footer"></slot>\n  </footer>\n</div>\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},"<Layout>\n  <template v-slot:header>\n    <h1>Here might be a page title</h1>\n  </template>\n  <template v-slot:default>\n    <p>A paragraph for the main content.</p>\n    <p>And another one.</p>\n  </template>\n  <template v-slot:footer>\n    <p>Here's some contact info</p>\n  </template>\n</Layout>\n")),(0,o.kt)("p",null,"Named slot directive shorthand:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},"<Layout>\n  <template #header>\n    <h1>Here might be a page title</h1>\n  </template>\n  <template>\n    <p>A paragraph for the main content.</p>\n    <p>And another one.</p>\n  </template>\n  <template #footer>\n    <p>Here's some contact info</p>\n  </template>\n</Layout>\n")),(0,o.kt)("h4",{id:"scoped-slots"},"Scoped Slots"),(0,o.kt)("p",null,"Pass data from child to parent\n(like ",(0,o.kt)("inlineCode",{parentName:"p"},"Render Props")," in React):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"app.component('TodoList', {\n  data() {\n    return {\n      items: ['Feed a cat', 'Buy milk'],\n    };\n  },\n  template: `\n    <ul>\n      <li v-for=\"( item, index ) in items\">\n        <slot :item=\"item\"></slot>\n      </li>\n    </ul>\n  `,\n});\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},'<TodoList>\n  \x3c!-- `default` can be other named slots --\x3e\n  <template v-slot:default="slotProps">\n    <i class="fas fa-check"></i>\n    <span class="green">{{ slotProps.item }}</span>\n  </template>\n</TodoList>\n')),(0,o.kt)("p",null,"Slot props shorthand\n(",(0,o.kt)("inlineCode",{parentName:"p"},"default")," can be other named slots):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},'<TodoList v-slot="slotProps">\n  <i class="fas fa-check"></i>\n  <span class="green">{{ slotProps.item }}</span>\n</TodoList>\n\n<TodoList v-slot="{ item }">\n  <i class="fas fa-check"></i>\n  <span class="green">{{ item }}</span>\n</TodoList>\n\n<TodoList v-slot="{ item: todo }">\n  <i class="fas fa-check"></i>\n  <span class="green">{{ todo }}</span>\n</TodoList>\n\n<TodoList v-slot="{ item = \'Placeholder\' }">\n  <i class="fas fa-check"></i>\n  <span class="green">{{ item }}</span>\n</TodoList>\n\n<TodoList #default="{ item }">\n  <i class="fas fa-check"></i>\n  <span class="green">{{ item }}</span>\n</TodoList>\n')),(0,o.kt)("h2",{id:"composition-api"},"Composition API"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://v3.vuejs.org/api/sfc-script-setup.html"},"SFC with Script Setup"),".")),(0,o.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Can't access to ",(0,o.kt)("inlineCode",{parentName:"p"},"this")," inside of ",(0,o.kt)("inlineCode",{parentName:"p"},"setup"),",\nwe cannot directly access ",(0,o.kt)("inlineCode",{parentName:"p"},"this.$emit")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"this.$route")," anymore."))),(0,o.kt)("h3",{id:"setup-method"},"Setup Method"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Executes before\n",(0,o.kt)("inlineCode",{parentName:"li"},"Components"),",\n",(0,o.kt)("inlineCode",{parentName:"li"},"Props"),",\n",(0,o.kt)("inlineCode",{parentName:"li"},"Data"),",\n",(0,o.kt)("inlineCode",{parentName:"li"},"Methods"),",\n",(0,o.kt)("inlineCode",{parentName:"li"},"Computed")," properties,\n",(0,o.kt)("inlineCode",{parentName:"li"},"Lifecycle")," methods."),(0,o.kt)("li",{parentName:"ul"},"Can't access ",(0,o.kt)("inlineCode",{parentName:"li"},"this"),"."),(0,o.kt)("li",{parentName:"ul"},"Can access ",(0,o.kt)("inlineCode",{parentName:"li"},"props")," and ",(0,o.kt)("inlineCode",{parentName:"li"},"context"),":",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"props"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"context.attrs"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"context.slots"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"context.emit"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"context.expose"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"context.parent"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"context.root"),".")))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"import { ref, toRefs } from 'vue';\n\n// eslint-disable-next-line import/no-anonymous-default-export\nexport default {\n  setup(props, { attrs, slots, emit, expose }) {\n    const { title } = toRefs(props);\n\n    const count = ref(0);\n    const increment = () => ++count.value;\n\n    console.log(title.value);\n\n    return { title, increment };\n  },\n};\n")),(0,o.kt)("h3",{id:"composition-lifecycle-hooks"},"Composition LifeCycle Hooks"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"onBeforeMount"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"onMounted"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"onBeforeUpdate"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"onUpdated"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"onBeforeUnmount"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"onUnmounted"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"onErrorCaptured"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"onRenderTracked"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"onRenderTriggered"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"onActivated"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"onDeactivated"),".")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"beforeCreate")," -> ",(0,o.kt)("inlineCode",{parentName:"p"},"setup")," -> ",(0,o.kt)("inlineCode",{parentName:"p"},"created"),":\nNo need for ",(0,o.kt)("inlineCode",{parentName:"p"},"onBeforeCreate")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"onCreated")," hooks,\njust put code in ",(0,o.kt)("inlineCode",{parentName:"p"},"setup")," methods."),(0,o.kt)("h3",{id:"reactivity"},"Reactivity"),(0,o.kt)("h4",{id:"reactive-value"},"Reactive Value"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"import { reactive, toRefs } from 'vue';\n\nconst book = reactive({\n  author: 'Vue Team',\n  year: '2020',\n  title: 'Vue 3 Guide',\n  description: 'You are reading this book right now ;)',\n  price: 'free',\n});\n\nconst { author, title } = toRefs(book);\n\ntitle.value = 'Vue 3 Detailed Guide';\nconsole.log(book.title); // 'Vue 3 Detailed Guide'\n")),(0,o.kt)("h4",{id:"computed-value"},"Computed Value"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"const count = ref(1);\nconst plusOne = computed(() => count.value + 1);\n\nconsole.log(plusOne.value); // 2\n\nplusOne.value++; // error\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"const count = ref(1);\nconst plusOne = computed({\n  get: () => count.value + 1,\n  set: val => {\n    count.value = val - 1;\n  },\n});\n\nplusOne.value = 1;\nconsole.log(count.value); // 0\n")),(0,o.kt)("h4",{id:"watch-value"},"Watch Value"),(0,o.kt)("p",null,"Watch single value:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"// watching a getter\nconst state = reactive({ count: 0 });\nwatch(\n  () => state.count,\n  (count, prevCount) => {\n    /* ... */\n  }\n);\n\n// directly watching a ref\nconst count = ref(0);\nwatch(count, (count, prevCount) => {\n  /* ... */\n});\n")),(0,o.kt)("p",null,"Watch multiple value:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},'const firstName = ref(\'\');\nconst lastName = ref(\'\');\n\nwatch([firstName, lastName], (newValues, prevValues) => {\n  console.log(newValues, prevValues);\n});\n\nfirstName.value = \'John\'; // logs: ["John", ""] ["", ""]\nlastName.value = \'Smith\'; // logs: ["John", "Smith"] ["John", ""]\n')),(0,o.kt)("p",null,"Watch reactive value:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"const numbers = reactive([1, 2, 3, 4]);\n\nwatch(\n  () => [...numbers],\n  (numbers, prevNumbers) => {\n    console.log(numbers, prevNumbers);\n  }\n);\n\nnumbers.push(5); // logs: [1,2,3,4,5] [1,2,3,4]\n")),(0,o.kt)("p",null,"Watch deep object:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"const state = reactive({\n  id: 1,\n  attributes: {\n    name: '',\n  },\n});\n\nwatch(\n  () => state,\n  (state, prevState) => {\n    console.log('not deep', state.attributes.name, prevState.attributes.name);\n  }\n);\n\nwatch(\n  () => state,\n  (state, prevState) => {\n    console.log('deep', state.attributes.name, prevState.attributes.name);\n  },\n  { deep: true }\n);\n\nstate.attributes.name = 'Alex'; // Logs: \"deep\" \"Alex\" \"Alex\"\n")),(0,o.kt)("h2",{id:"animation-and-transition"},"Animation and Transition"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"v-enter-from"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"v-enter-to"),": CSS defaults."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"v-enter-active"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"v-leave-from"),": CSS defaults."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"v-leave-to"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"v-leave-active"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"name"),": transition name (different from ",(0,o.kt)("inlineCode",{parentName:"li"},"v"),")."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"mode"),":",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"out-in"),": rectify router components transition."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"in-out"),".")))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-css"},".v-enter-from {\n  opacity: 0;\n}\n\n@media (prefers-reduced-motion: no-preference) {\n  .v-enter-active,\n  .v-leave-active {\n    transition: opacity 0.3s ease-out;\n  }\n}\n\n.v-leave-to {\n  opacity: 0;\n}\n")),(0,o.kt)("h3",{id:"fade-transition"},"Fade Transition"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},'<template>\n  <div>\n    <h1>This is the modal page</h1>\n    <button @click="toggleModal">Open</button>\n    <transition name="fade" mode="out-in">\n      <div v-if="isOpen" class="modal">\n        <p><button @click="toggleModal">Close</button></p>\n      </div>\n    </transition>\n  </div>\n</template>\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-css"},".fade-enter-from {\n  opacity: 0;\n}\n\n@media (prefers-reduced-motion: no-preference) {\n  .fade-enter-active,\n  .fade-leave-active {\n    transition: opacity 0.5s ease-out;\n  }\n}\n\n.fade-leave-to {\n  opacity: 0;\n}\n")),(0,o.kt)("h3",{id:"slide-transition"},"Slide Transition"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-css"},".slide-fade-enter-from {\n  opacity: 0;\n  transform: translateX(10px);\n}\n\n@media (prefers-reduced-motion: no-preference) {\n  .slide-fade-enter-active,\n  .slide-fade-leave-active {\n    transition: all 0.2s ease;\n  }\n}\n\n.slide-fade-leave-to {\n  opacity: 0;\n  transform: translateX(-10px);\n}\n")),(0,o.kt)("h3",{id:"transition-group"},"Transition Group"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},'<template>\n  <div>\n    <input type="text" v-model="newContact" placeholder="Name" />\n    <button @click="addContact">Add Contact</button>\n    <button @click="sortContacts">Sort</button>\n    <transition-group name="slide-up" tag="ul" appear>\n      <li v-for="contact in contacts" :key="contact">{{ contact }}</li>\n    </transition-group>\n  </div>\n</template>\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-css"},".slide-up-enter-from {\n  opacity: 0;\n  transform: translateY(10px);\n}\n\n@media (prefers-reduced-motion: no-preference) {\n  .slide-up-enter-active {\n    transition: all 0.2s ease;\n  }\n\n  .slide-up-move {\n    transition: transform 0.8s ease-in;\n  }\n}\n")),(0,o.kt)("h3",{id:"transition-hooks"},"Transition Hooks"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},':css="false"')," tells Vue don't handle transition classes,\nwe're relying on JavaScript hooks instead."),(0,o.kt)("p",null,"When it comes to JavaScript animation library,\ntransition JavaScript hooks helps a lot."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},'<transition\n  @before-enter="beforeEnter"\n  @enter="enter"\n  @after-enter="afterEnter"\n  @enter-cancelled="enterCancelled"\n  @before-leave="beforeLeave"\n  @leave="leave"\n  @after-leave="afterLeave"\n  @leave-cancelled="leaveCancelled"\n  :css="false"\n>\n  <div>Modal</div>\n</transition>\n\n<transition-group\n  @before-enter="beforeEnter"\n  @enter="enter"\n  @after-enter="afterEnter"\n  @enter-cancelled="enterCancelled"\n  @before-leave="beforeLeave"\n  @leave="leave"\n  @after-leave="afterLeave"\n  @leave-cancelled="leaveCancelled"\n  :css="false"\n>\n  >\n  <div class="card" v-for="card in cards" :key="card.id">\n    <p>{{ card.title }}</p>\n  </div>\n</transition-group>\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"// eslint-disable-next-line import/no-anonymous-default-export\nexport default {\n  methods: {\n    beforeEnter(el) {},\n    enter(el, done) {\n      done();\n    },\n    afterEnter(el) {},\n    enterCancelled(el) {},\n    beforeLeave(el) {},\n    leave(el, done) {\n      done();\n    },\n    afterLeave(el) {},\n    leaveCancelled(el) {},\n  },\n};\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},'<template>\n  <transition appear @before-enter="beforeEnter" @enter="enter" :css="false">\n    <div class="card"></div>\n  </transition>\n</template>\n\n<script>\n  import gsap from \'gsap\';\n\n  export default {\n    methods: {\n      beforeEnter(el) {\n        el.style.opacity = 0;\n        el.style.transform = \'scale(0, 0)\';\n      },\n      enter(el, done) {\n        gsap.to(el, {\n          duration: 1,\n          opacity: 1,\n          scale: 1,\n          ease: \'bounce.inOut\',\n          onComplete: done,\n        });\n      },\n    },\n  };\n<\/script>\n')),(0,o.kt)("h3",{id:"transition-internals"},"Transition Internals"),(0,o.kt)("h4",{id:"transition-component"},"Transition Component"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"platforms/web/runtime/component/transition.js"),",\n",(0,o.kt)("inlineCode",{parentName:"p"},"render")," \u51fd\u6570\u83b7\u53d6\u4e00\u4e9b\u6570\u636e, \u5e76\u4e14\u8fd4\u56de\u6e32\u67d3\u7684 VNode:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"const Transition = defineComponent({\n  name: 'Transition',\n  props: transitionProps,\n  abstract: true,\n\n  render(h: Function) {\n    // eslint-disable-next-line vue/require-slots-as-functions\n    let children: any = this.$slots.default;\n\n    if (!children) {\n      return;\n    }\n\n    // filter out text nodes (possible white spaces)\n    children = children.filter((c: VNode) => c.tag || isAsyncPlaceholder(c));\n\n    if (!children.length) {\n      return;\n    }\n\n    const mode: string = this.mode;\n    const rawChild: VNode = children[0];\n\n    // if this is a component root node and the component's\n    // parent container node also has transition, skip.\n    if (hasParentTransition(this.$vnode)) {\n      return rawChild;\n    }\n\n    // apply transition data to child\n    // use getRealChild() to ignore abstract components e.g. keep-alive\n    const child: VNode = getRealChild(rawChild);\n\n    if (!child) {\n      return rawChild;\n    }\n\n    if (this._leaving) {\n      return placeholder(h, rawChild);\n    }\n\n    // ensure a key that is unique to the vnode type and to this transition\n    // component instance. This key will be used to remove pending leaving nodes\n    // during entering.\n    const id = `__transition-${this._uid}-`;\n    child.key =\n      child.key === null\n        ? child.isComment\n          ? `${id} comment`\n          : id + child.tag\n        : isPrimitive(child.key)\n        ? String(child.key).indexOf(id) === 0\n          ? child.key\n          : id + child.key\n        : child.key;\n\n    const data: Object = ((child.data || (child.data = {})).transition =\n      extractTransitionData(this));\n    const oldRawChild: VNode = this._vnode;\n    const oldChild: VNode = getRealChild(oldRawChild);\n\n    // mark v-show\n    // so that the transition module can hand over the control to the directive\n    if (\n      child.data.directives &&\n      child.data.directives.some(d => d.name === 'show')\n    ) {\n      child.data.show = true;\n    }\n\n    if (\n      oldChild &&\n      oldChild.data &&\n      !isSameChild(child, oldChild) &&\n      !isAsyncPlaceholder(oldChild) &&\n      // #6687 component root is a comment node\n      !(\n        oldChild.componentInstance &&\n        oldChild.componentInstance._vnode.isComment\n      )\n    ) {\n      // replace old child transition data with fresh one\n      // important for dynamic transitions!\n      const oldData: Object = (oldChild.data.transition = extend({}, data));\n\n      // handle transition mode\n      if (mode === 'out-in') {\n        // return placeholder node and queue update when leave finishes\n        this._leaving = true;\n        mergeVNodeHook(oldData, 'afterLeave', () => {\n          this._leaving = false;\n          this.$forceUpdate();\n        });\n\n        return placeholder(h, rawChild);\n      } else if (mode === 'in-out') {\n        if (isAsyncPlaceholder(child)) {\n          return oldRawChild;\n        }\n\n        let delayedLeave;\n        const performLeave = () => {\n          delayedLeave();\n        };\n\n        mergeVNodeHook(data, 'afterEnter', performLeave);\n        mergeVNodeHook(data, 'enterCancelled', performLeave);\n        mergeVNodeHook(oldData, 'delayLeave', leave => {\n          delayedLeave = leave;\n        });\n      }\n    }\n\n    return rawChild;\n  },\n});\n")),(0,o.kt)("h4",{id:"transition-module"},"Transition Module"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"platforms/web/runtime/modules/transition.js"),":"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u81ea\u52a8\u55c5\u63a2\u76ee\u6807\u5143\u7d20\u662f\u5426\u5e94\u7528\u4e86 CSS \u8fc7\u6e21\u6216\u52a8\u753b, \u5728\u6070\u5f53\u7684\u65f6\u673a\u6dfb\u52a0/\u5220\u9664 CSS \u7c7b\u540d."),(0,o.kt)("li",{parentName:"ul"},"\u8fc7\u6e21\u7ec4\u4ef6\u63d0\u4f9b JavaScript \u94a9\u5b50\u51fd\u6570\u63a5\u53e3, \u94a9\u5b50\u51fd\u6570\u5c06\u5728\u6070\u5f53\u7684\u65f6\u673a\u88ab\u8c03\u7528."),(0,o.kt)("li",{parentName:"ul"},"\u6838\u5fc3\u903b\u8f91\u4f4d\u4e8e ",(0,o.kt)("inlineCode",{parentName:"li"},"enter()")," \u4e0e ",(0,o.kt)("inlineCode",{parentName:"li"},"leave()")," \u51fd\u6570.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"// eslint-disable-next-line import/no-anonymous-default-export\nexport default {\n  create: _enter,\n  activate: _enter,\n  remove(vnode: VNode, rm: Function) {\n    if (vnode.data.show !== true) {\n      leave(vnode, rm);\n    } else {\n      rm();\n    }\n  },\n};\n\nfunction _enter(_: any, vnode: VNodeWithData) {\n  if (vnode.data.show !== true) {\n    enter(vnode);\n  }\n}\n")),(0,o.kt)("h4",{id:"transition-group-component"},"Transition Group Component"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"const TransitionGroup = defineComponent({\n  props: extend(\n    {\n      tag: String,\n      moveClass: String,\n    },\n    transitionProps\n  ),\n\n  beforeMount() {\n    const update = this._update;\n    this._update = (vnode, hydrating) => {\n      // force removing pass\n      this.__patch__(\n        this._vnode,\n        this.kept,\n        false, // hydrating\n        true // removeOnly (!important, avoids unnecessary moves)\n      );\n      this._vnode = this.kept;\n      update.call(this, vnode, hydrating);\n    };\n  },\n\n  updated() {\n    const children: Array<VNode> = this.prevChildren;\n    const moveClass: string = this.moveClass || `${this.name || 'v'}-move'`;\n\n    if (!children.length || !this.hasMove(children[0].elm, moveClass)) {\n      return;\n    }\n\n    // we divide the work into three loops to avoid mixing DOM reads and writes\n    // in each iteration - which helps prevent layout thrashing.\n    children.forEach(callPendingCbs);\n    children.forEach(recordPosition);\n    children.forEach(applyTranslation);\n\n    // force reflow to put everything in position\n    // assign to this to avoid being removed in tree-shaking\n    // $flow-disable-line\n    this._reflow = document.body.offsetHeight;\n\n    children.forEach((c: VNode) => {\n      if (c.data.moved) {\n        const el: any = c.elm;\n        const s: any = el.style;\n        addTransitionClass(el, moveClass);\n        s.transform = s.WebkitTransform = s.transitionDuration = '';\n        el.addEventListener(\n          transitionEndEvent,\n          (el._moveCb = function cb(e) {\n            if (!e || /transform$/.test(e.propertyName)) {\n              el.removeEventListener(transitionEndEvent, cb);\n              el._moveCb = null;\n              removeTransitionClass(el, moveClass);\n            }\n          })\n        );\n      }\n    });\n  },\n\n  methods: {\n    hasMove(el: any, moveClass: string): boolean {\n      if (!hasTransition) {\n        return false;\n      }\n\n      if (this._hasMove) {\n        return this._hasMove;\n      }\n\n      // Detect whether an element with the move class applied has\n      // CSS transitions. Since the element may be inside an entering\n      // transition at this very moment, we make a clone of it and remove\n      // all other transition classes applied to ensure only the move class\n      // is applied.\n      const clone: HTMLElement = el.cloneNode();\n\n      if (el._transitionClasses) {\n        el._transitionClasses.forEach((cls: string) => {\n          removeClass(clone, cls);\n        });\n      }\n\n      addClass(clone, moveClass);\n      clone.style.display = 'none';\n      this.$el.appendChild(clone);\n      const info: Object = getTransitionInfo(clone);\n      this.$el.removeChild(clone);\n      return (this._hasMove = info.hasTransform);\n    },\n  },\n\n  render(h: Function) {\n    const tag: string = this.tag || this.$vnode.data.tag || 'span';\n    const map: Object = Object.create(null);\n    const prevChildren: Array<VNode> = (this.prevChildren = this.children);\n    const rawChildren: Array<VNode> = this.$slots.default || [];\n    const children: Array<VNode> = (this.children = []);\n    const transitionData: Object = extractTransitionData(this);\n\n    for (let i = 0; i < rawChildren.length; i++) {\n      const c: VNode = rawChildren[i];\n\n      if (c.tag && c.key != null && String(c.key).indexOf('__vList') !== 0) {\n        children.push(c);\n        map[c.key] = c;\n        (c.data || (c.data = {})).transition = transitionData;\n      }\n    }\n\n    if (prevChildren) {\n      const kept: Array<VNode> = [];\n      const removed: Array<VNode> = [];\n\n      for (let i = 0; i < prevChildren.length; i++) {\n        const c: VNode = prevChildren[i];\n        c.data.transition = transitionData;\n        c.data.pos = c.elm.getBoundingClientRect();\n\n        if (map[c.key]) {\n          kept.push(c);\n        } else {\n          removed.push(c);\n        }\n      }\n\n      this.kept = h(tag, null, kept);\n      this.removed = removed;\n    }\n\n    return h(tag, null, children);\n  },\n});\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"Children")," \u4ece\u65e7\u4f4d\u7f6e\u6309\u7167\u7684\u7f13\u52a8\u65f6\u95f4\u8fc7\u6e21\u504f\u79fb\u5230\u5f53\u524d\u76ee\u6807\u4f4d\u7f6e,\n\u5b9e\u73b0 ",(0,o.kt)("inlineCode",{parentName:"p"},"Move")," \u7684\u8fc7\u6e21\u52a8\u753b:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"function callPendingCbs(c: VNode) {\n  if (c.elm._moveCb) {\n    c.elm._moveCb();\n  }\n  if (c.elm._enterCb) {\n    c.elm._enterCb();\n  }\n}\n\nfunction recordPosition(c: VNode) {\n  c.data.newPos = c.elm.getBoundingClientRect();\n}\n\nfunction applyTranslation(c: VNode) {\n  const oldPos = c.data.pos;\n  const newPos = c.data.newPos;\n  const dx = oldPos.left - newPos.left;\n  const dy = oldPos.top - newPos.top;\n\n  if (dx || dy) {\n    c.data.moved = true;\n    const s = c.elm.style;\n    s.transform = s.WebkitTransform = `translate(${dx}px,${dy}px)`;\n    s.transitionDuration = '0s';\n  }\n}\n")),(0,o.kt)("h2",{id:"modern-vue"},"Modern Vue"),(0,o.kt)("h3",{id:"suspense"},"Suspense"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},"\x3c!-- Events.vue --\x3e\n<script setup lang=\"ts\">\n  import { getEvents } from '@/services';\n  import type { Event } from '@/services';\n  const events: Event[] = await getEvents();\n<\/script>\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},"<template>\n  <suspense>\n    <template #default>\n      <Events />\n    </template>\n    <template #fallback>\n      <div>Loading events list ...</div>\n    </template>\n  </suspense>\n</template>\n")),(0,o.kt)("h3",{id:"keep-alive"},"Keep Alive"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"include"),": ",(0,o.kt)("inlineCode",{parentName:"li"},"string | RegExp | Array<string>"),", \u5339\u914d\u7684\u7ec4\u4ef6\u4f1a\u88ab\u7f13\u5b58."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"exclude"),": ",(0,o.kt)("inlineCode",{parentName:"li"},"string | RegExp | Array<string>"),", \u5339\u914d\u7684\u7ec4\u4ef6\u4e0d\u4f1a\u88ab\u7f13\u5b58."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"max"),": \u7f13\u5b58\u5927\u5c0f."),(0,o.kt)("li",{parentName:"ul"},"\u7ec4\u4ef6\u4e00\u65e6\u88ab ",(0,o.kt)("inlineCode",{parentName:"li"},"<keep-alive>")," \u7f13\u5b58,\n\u518d\u6b21\u6e32\u67d3\u7684\u65f6\u5019\u4e0d\u4f1a\u6267\u884c ",(0,o.kt)("inlineCode",{parentName:"li"},"created"),"/",(0,o.kt)("inlineCode",{parentName:"li"},"mounted")," \u7b49\u94a9\u5b50\u51fd\u6570 (",(0,o.kt)("inlineCode",{parentName:"li"},"core/vdom/create-component.js"),").\n\u4f46\u4f1a\u6267\u884c ",(0,o.kt)("inlineCode",{parentName:"li"},"activated"),"/",(0,o.kt)("inlineCode",{parentName:"li"},"deactivated")," \u94a9\u5b50\u51fd\u6570 (",(0,o.kt)("inlineCode",{parentName:"li"},"core/vdom/create-component.js"),"/",(0,o.kt)("inlineCode",{parentName:"li"},"core/instance/lifecycle.js"),").")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"// core/components/keep-alive.js\nconst KeepAlive = defineComponent({\n  name: 'KeepAlive',\n  abstract: true,\n\n  props: {\n    include: patternTypes,\n    exclude: patternTypes,\n    max: [String, Number],\n  },\n\n  created() {\n    this.cache = Object.create(null);\n    this.keys = [];\n  },\n\n  mounted() {\n    this.$watch('include', val => {\n      pruneCache(this, name => matches(val, name));\n    });\n    this.$watch('exclude', val => {\n      pruneCache(this, name => !matches(val, name));\n    });\n  },\n\n  unmounted() {\n    for (const key in this.cache) {\n      pruneCacheEntry(this.cache, key, this.keys);\n    }\n  },\n\n  render() {\n    // eslint-disable-next-line vue/require-slots-as-functions\n    const slot = this.$slots.default;\n    const vnode: VNode = getFirstComponentChild(slot);\n    const componentOptions: ?VNodeComponentOptions =\n      vnode && vnode.componentOptions;\n\n    if (componentOptions) {\n      // check pattern\n      const name: ?string = getComponentName(componentOptions);\n      const { include, exclude } = this;\n\n      if (\n        // not included\n        (include && (!name || !matches(include, name))) ||\n        // excluded\n        (exclude && name && matches(exclude, name))\n      ) {\n        return vnode;\n      }\n\n      const { cache, keys } = this;\n      const key: ?string =\n        vnode.key == null\n          ? // same constructor may get registered as different local components\n            // so cid alone is not enough (#3269)\n            componentOptions.Ctor.cid +\n            (componentOptions.tag ? `::${componentOptions.tag}` : '')\n          : vnode.key;\n\n      if (cache[key]) {\n        vnode.componentInstance = cache[key].componentInstance;\n        // make current key freshest\n        remove(keys, key);\n        keys.push(key);\n      } else {\n        cache[key] = vnode;\n        keys.push(key);\n\n        // prune oldest entry\n        if (this.max && keys.length > parseInt(this.max)) {\n          pruneCacheEntry(cache, keys[0], keys, this._vnode);\n        }\n      }\n\n      vnode.data.keepAlive = true;\n    }\n\n    return vnode || (slot && slot[0]);\n  },\n});\n")),(0,o.kt)("h2",{id:"vue-router"},"Vue Router"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://next.router.vuejs.org/guide/advanced/composition-api.html"},"Composition API Reference"))),(0,o.kt)("h3",{id:"basic-routes"},"Basic Routes"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"import type { RouteRecordRaw } from 'vue-router';\nimport { createRouter, createWebHistory } from 'vue-router';\nimport Home from '../views/Home.vue';\n\nconst routes: Array<RouteRecordRaw> = [\n  {\n    path: '/',\n    name: 'Home',\n    component: Home,\n  },\n  {\n    path: '/about',\n    name: 'About',\n    component: () =>\n      import(/* webpackChunkName: \"about\" */ '../views/About.vue'),\n  },\n];\n\nconst router = createRouter({\n  history: createWebHistory(process.env.BASE_URL),\n  routes,\n});\n\nexport default router;\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"import { createApp } from 'vue';\nimport App from './App.vue';\nimport router from './router';\nimport store from './store';\n\ncreateApp(App).use(store).use(router).mount('#app');\n")),(0,o.kt)("h3",{id:"dynamic-routes"},"Dynamic Routes"),(0,o.kt)("p",null,"Two methods to access route ",(0,o.kt)("inlineCode",{parentName:"p"},"params")," in components:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Composition route API: ",(0,o.kt)("inlineCode",{parentName:"li"},"const { params } = useRoute()"),"."),(0,o.kt)("li",{parentName:"ul"},"Passing route props to component: ",(0,o.kt)("inlineCode",{parentName:"li"},"const props = defineProps<{ id: string }>()"),":",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"props")," better testing friendly."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"props")," better TypeScript types inference.")))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},'<template>\n  <router-link\n    class="event-link"\n    :to="{ name: \'EventDetails\', params: { id: event.id } }"\n  >\n    <div class="event-card">\n      <span>@{{ event.time }} on {{ event.date }}</span>\n      <h4>{{ event.title }}</h4>\n    </div>\n  </router-link>\n</template>\n')),(0,o.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Can't access to ",(0,o.kt)("inlineCode",{parentName:"p"},"this")," inside of ",(0,o.kt)("inlineCode",{parentName:"p"},"setup"),",\nwe cannot directly access ",(0,o.kt)("inlineCode",{parentName:"p"},"this.$router")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"this.$route")," anymore."))),(0,o.kt)("h4",{id:"routes-composition-api"},"Routes Composition API"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"import type { RouteRecordRaw } from 'vue-router';\nimport { createRouter, createWebHistory } from 'vue-router';\nimport EventDetails from '../views/EventDetails.vue';\n\nconst routes: Array<RouteRecordRaw> = [\n  {\n    path: '/event/:id',\n    name: 'EventDetails',\n    component: EventDetails,\n  },\n];\n\nconst router = createRouter({\n  history: createWebHistory(process.env.BASE_URL),\n  routes,\n});\n\nexport default router;\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},"<script setup lang=\"ts\">\n  import { useRoute } from 'vue-router';\n  import { getEvent } from '@/services';\n  import type { Event } from '@/services';\n\n  const { params } = useRoute();\n  const event: Event = await getEvent(Number.parseInt(params.id));\n<\/script>\n")),(0,o.kt)("h4",{id:"passing-routes-props"},"Passing Routes Props"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"import type { RouteRecordRaw } from 'vue-router';\nimport { createRouter, createWebHistory } from 'vue-router';\nimport EventDetails from '../views/EventDetails.vue';\n\nconst routes: Array<RouteRecordRaw> = [\n  {\n    path: '/event/:id',\n    name: 'EventDetails',\n    component: EventDetails,\n    props: true /* Passing route props to component */,\n  },\n];\n\nconst router = createRouter({\n  history: createWebHistory(process.env.BASE_URL),\n  routes,\n});\n\nexport default router;\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},"<script setup lang=\"ts\">\n  import { getEvent } from '@/services';\n  import type { Event } from '@/services';\n\n  const props = defineProps<{ id: string }>();\n  const event: Event = await getEvent(Number.parseInt(props.id));\n<\/script>\n")),(0,o.kt)("h3",{id:"named-routes"},"Named Routes"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"const routes = [\n  {\n    path: '/user/:username',\n    name: 'User',\n    component: User,\n  },\n];\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},"<router-link :to=\"{ name: 'User', params: { username: 'sabertaz' }}\">\n  User\n</router-link>\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"router.push({ name: 'User', params: { username: 'sabertaz' } });\n")),(0,o.kt)("h3",{id:"nested-routes"},"Nested Routes"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"const routes: Array<RouteRecordRaw> = [\n  {\n    path: '/',\n    name: 'board',\n    component: Board,\n    children: [\n      {\n        path: 'task/:id',\n        name: 'task',\n        component: Task,\n        props: true,\n      },\n    ],\n  },\n];\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},"\x3c!-- App.vue --\x3e\n\x3c!-- Root router view --\x3e\n<template><router-view /></template>\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},"\x3c!-- Board.vue --\x3e\n\x3c!-- Nested router view --\x3e\n<template>\n  <div>Board View</div>\n  <router-view />\n</template>\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},'\x3c!-- Task.vue --\x3e\n<script setup lang="ts">\n  defineProps<{ id: string }>();\n<\/script>\n\n<template>\n  <div>Task View {{ id }}</div>\n</template>\n')),(0,o.kt)("h3",{id:"programmatic-routes-navigation"},"Programmatic Routes Navigation"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"import { useRouter } from 'vue-router';\n\nfunction App() {\n  const router = useRouter();\n}\n")),(0,o.kt)("h4",{id:"navigate-to-different-location"},"Navigate to Different Location"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"const username = 'eduardo';\n// we can manually build the url but we will have to handle the encoding ourselves\nrouter.push(`/user/${username}`); // -> /user/eduardo\n// same as\nrouter.push({ path: `/user/${username}` }); // -> /user/eduardo\n// if possible use `name` and `params` to benefit from automatic URL encoding\nrouter.push({ name: 'user', params: { username } }); // -> /user/eduardo\n// `params` cannot be used alongside `path`\nrouter.push({ path: '/user', params: { username } }); // -> /user\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"// literal string path\nrouter.push('/users/eduardo');\n\n// object with path\nrouter.push({ path: '/users/eduardo' });\n\n// named route with params to let the router build the url\nrouter.push({ name: 'user', params: { username: 'eduardo' } });\n\n// with query, resulting in /register?plan=private\nrouter.push({ path: '/register', query: { plan: 'private' } });\n\n// with hash, resulting in /about#team\nrouter.push({ path: '/about', hash: '#team' });\n")),(0,o.kt)("h4",{id:"replace-current-location"},"Replace Current Location"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"// replace current location\nrouter.push({ path: '/home', replace: true });\n// equivalent to\nrouter.replace({ path: '/home' });\n")),(0,o.kt)("h4",{id:"traverse-routes-history"},"Traverse Routes History"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"// go forward by one record, the same as router.forward()\nrouter.go(1);\n\n// go back by one record, the same as router.back()\nrouter.go(-1);\n\n// go forward by 3 records\nrouter.go(3);\n\n// fails silently if there aren't that many records\nrouter.go(-100);\nrouter.go(100);\n")),(0,o.kt)("h3",{id:"navigation-guard-routes"},"Navigation Guard Routes"),(0,o.kt)("h4",{id:"guard-routes-configuration"},"Guard Routes Configuration"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"const routes = [\n  {\n    path: '/users/:id',\n    component: UserDetails,\n    beforeEnter: (to, from) => {\n      // reject the navigation\n      return false;\n    },\n  },\n];\n")),(0,o.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},(0,o.kt)("inlineCode",{parentName:"p"},"beforeEnter")," guards only trigger when entering the route,\ndon't trigger when the params, query or hash change."),(0,o.kt)("p",{parentName:"div"},"Going from ",(0,o.kt)("inlineCode",{parentName:"p"},"/users/2")," to ",(0,o.kt)("inlineCode",{parentName:"p"},"/users/3")," or going from ",(0,o.kt)("inlineCode",{parentName:"p"},"/users/2#info")," to ",(0,o.kt)("inlineCode",{parentName:"p"},"/users/2#projects"),"\ndon't trigger ",(0,o.kt)("inlineCode",{parentName:"p"},"beforeEnter")," guards."))),(0,o.kt)("h4",{id:"global-navigation-guards"},"Global Navigation Guards"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"router.beforeEach((to, from, next) => {\n  if (to.name !== 'Login' && !isAuthenticated) next({ name: 'Login' });\n  else next();\n});\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"router.beforeResolve(async to => {\n  if (to.meta.requiresCamera) {\n    try {\n      await askForCameraPermission();\n    } catch (error) {\n      if (error instanceof NotAllowedError) {\n        // Handle the error and then cancel the navigation.\n        return false;\n      } else {\n        // Unexpected error: cancel the navigation and pass error to global handler.\n        throw error;\n      }\n    }\n  }\n});\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"router.afterEach((to, from, failure) => {\n  if (!failure) sendToAnalytics(to.fullPath);\n});\n")),(0,o.kt)("h4",{id:"full-navigation-resolution-flow"},"Full Navigation Resolution Flow"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Navigation triggered."),(0,o.kt)("li",{parentName:"ul"},"Call ",(0,o.kt)("inlineCode",{parentName:"li"},"beforeRouteLeave")," guards in deactivated components."),(0,o.kt)("li",{parentName:"ul"},"Call global ",(0,o.kt)("inlineCode",{parentName:"li"},"beforeEach")," guards."),(0,o.kt)("li",{parentName:"ul"},"Call ",(0,o.kt)("inlineCode",{parentName:"li"},"beforeRouteUpdate")," guards in reused components."),(0,o.kt)("li",{parentName:"ul"},"Call ",(0,o.kt)("inlineCode",{parentName:"li"},"beforeEnter")," in route configs."),(0,o.kt)("li",{parentName:"ul"},"Resolve async route components."),(0,o.kt)("li",{parentName:"ul"},"Call ",(0,o.kt)("inlineCode",{parentName:"li"},"beforeRouteEnter")," in activated components."),(0,o.kt)("li",{parentName:"ul"},"Call global ",(0,o.kt)("inlineCode",{parentName:"li"},"beforeResolve")," guards."),(0,o.kt)("li",{parentName:"ul"},"Navigation is confirmed."),(0,o.kt)("li",{parentName:"ul"},"Call global ",(0,o.kt)("inlineCode",{parentName:"li"},"afterEach")," hooks."),(0,o.kt)("li",{parentName:"ul"},"DOM updates triggered."),(0,o.kt)("li",{parentName:"ul"},"Call ",(0,o.kt)("inlineCode",{parentName:"li"},"next")," callbacks in ",(0,o.kt)("inlineCode",{parentName:"li"},"beforeRouteEnter")," guards with instantiated instances.")),(0,o.kt)("h2",{id:"vuex"},"Vuex"),(0,o.kt)("h3",{id:"vuex-types"},"Vuex Types"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Vuex types ",(0,o.kt)("a",{parentName:"li",href:"https://dev.to/3vilarthas/vuex-typescript-m4j"},"guide"),".")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"// store.ts\nimport type { InjectionKey } from 'vue';\nimport type { Store } from 'vuex';\nimport { createStore, useStore } from 'vuex';\n\n// define your typings for the store state\ninterface State {\n  count: number;\n}\n\n// define injection key\nconst key: InjectionKey<Store<State>> = Symbol('key');\n\nconst store = createStore<State>({\n  state: {\n    count: 0,\n  },\n});\n\nconst useAppStore = () => useStore<State>(key);\n\nexport { key, useAppStore };\nexport type { State };\nexport default store;\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"// main.ts\nimport { createApp } from 'vue';\nimport store, { key } from './store';\n\nconst app = createApp({});\n\n// pass the injection key\napp.use(store, key);\n\napp.mount('#app');\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"// in a vue component\nimport { useAppStore } from './store';\n\n// eslint-disable-next-line import/no-anonymous-default-export\nexport default {\n  setup() {\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    const store = useAppStore();\n    const count = store.state.count; // typed as number\n  },\n};\n")),(0,o.kt)("h2",{id:"vite"},"Vite"),(0,o.kt)("h3",{id:"basic-configuration"},"Basic Configuration"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"import path from 'path';\nimport { defineConfig } from 'vite';\nimport vue from '@vitejs/plugin-vue';\n\nexport default defineConfig({\n  base: '/awesome-web/vue-trello/',\n  plugins: [vue()],\n  resolve: {\n    alias: {\n      src: path.resolve(__dirname, './src'),\n    },\n  },\n});\n")),(0,o.kt)("h3",{id:"environment-variables-and-modes"},"Environment Variables and Modes"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"import.meta.env.MODE"),": {string} running mode."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"import.meta.env.BASE_URL"),": {string} vite ",(0,o.kt)("inlineCode",{parentName:"li"},"base")," url."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"import.meta.env.PROD"),": {boolean} whether in production."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"import.meta.env.DEV"),": {boolean} whether in development.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"const router = createRouter({\n  history: createWebHistory(import.meta.env.BASE_URL),\n  routes,\n});\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"interface ImportMetaEnv extends Readonly<Record<string, string>> {\n  readonly VITE_APP_TITLE: string;\n  // More environment variables...\n}\n\ninterface ImportMeta {\n  readonly env: ImportMetaEnv;\n}\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},".env                # Loaded in all cases.\n.env.local          # Loaded in all cases, ignored by git.\n.env.[mode]         # Only loaded in specified mode.\n.env.[mode].local   # Only loaded in specified mode, ignored by git.\n")),(0,o.kt)("h2",{id:"vue-cli"},"Vue CLI"),(0,o.kt)("h3",{id:"scss-configuration"},"SCSS Configuration"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://css-tricks.com/how-to-increase-your-page-size-by-1500-with-webpack-and-vue"},"Build with Bulma"),":"),(0,o.kt)("p",null,"Every element and every style for this scoped styled component\nwill have a ",(0,o.kt)("inlineCode",{parentName:"p"},"data-v-2929"),' on them at runtime.\nIf import a Sass file into component that has actual styles in it,\nVue (via webpack) will pull in those styles and\n"namespace" them with that dynamic ',(0,o.kt)("inlineCode",{parentName:"p"},"data-")," attribute.\nThe result is that is include ",(0,o.kt)("inlineCode",{parentName:"p"},"Bulma")," in your ",(0,o.kt)("strong",{parentName:"p"},"many")," times\nwith a bunch of ",(0,o.kt)("inlineCode",{parentName:"p"},"data-v")," weirdness in front of it."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-css"},"/* bulma-custom.scss */\n@import './variables.scss';\n\n/* UTILITIES */\n@import 'bulma/sass/utilities/animations.sass';\n@import 'bulma/sass/utilities/controls.sass';\n@import 'bulma/sass/utilities/mixins.sass';\n\n/* etc... */\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-css"},"/* site.scss */\n@import url('https://use.fontawesome.com/releases/v5.6.3/css/all.css');\n@import './bulma-custom.scss';\n\nhtml,\nbody {\n  height: 100%;\n  background-color: #f9fafc;\n}\n\n/* etc... */\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"// main.js\nimport Vue from 'vue';\nimport App from './App.vue';\nimport router from './router';\n\n// import styles\nimport '@/styles/site.scss';\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},'// webpack.config.js\nmodule.exports = {\n  css: {\n    loaderOptions: {\n      sass: {\n        data: `@import "@/styles/variables.scss";`,\n      },\n    },\n  },\n};\n')),(0,o.kt)("h2",{id:"vue-best-practice"},"Vue Best Practice"),(0,o.kt)("p",null,"When it comes to Vue 3,\nEvan You ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/vuejs/rfcs/discussions/378"},"recommended"),":"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Use SFC + ",(0,o.kt)("inlineCode",{parentName:"li"},"<script setup>")," + Composition API (drop Options API)."),(0,o.kt)("li",{parentName:"ul"},"Use VSCode + ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/johnsoncodehk/volar"},"Volar"),"."),(0,o.kt)("li",{parentName:"ul"},"Not strictly required for TS, but if applicable, use Vite for build tooling.")),(0,o.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Composition API vs Options API")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Original intention for supporting both APIs:\nexisting Options-API-based codebases can benefit from Composition API-based libraries,\nIt's not for new codebases to mix Composition API and Options API."),(0,o.kt)("p",{parentName:"div"},"Intentionally mixing Composition API and Options API\nshould be avoided except in existing Options API codebases,\nto either replace mixins or leverage a Composition API-based library."))),(0,o.kt)("h2",{id:"legacy-vue-internals"},"Legacy Vue Internals"),(0,o.kt)("h3",{id:"vue-constructor"},"Vue Constructor"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"core/instance/index.js"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"// \u4ece\u4e94\u4e2a\u6587\u4ef6\u5bfc\u5165\u4e94\u4e2a\u65b9\u6cd5\uff08\u4e0d\u5305\u62ec warn\uff09\nimport { warn } from '../util/index';\nimport { initMixin } from './init';\nimport { stateMixin } from './state';\nimport { renderMixin } from './render';\nimport { eventsMixin } from './events';\nimport { lifecycleMixin } from './lifecycle';\n\n// \u5b9a\u4e49 Vue \u6784\u9020\u51fd\u6570\nfunction Vue(options) {\n  this._init(options);\n}\n\n// \u5c06 Vue \u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u7ed9\u5bfc\u5165\u7684\u4e94\u4e2a\u65b9\u6cd5\ninitMixin(Vue);\nstateMixin(Vue);\neventsMixin(Vue);\nlifecycleMixin(Vue);\nrenderMixin(Vue);\n\n// \u5bfc\u51fa Vue\nexport default Vue;\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"core/instance/init.js"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"// initMixin(Vue)\nVue.prototype._init = function (options?: Object) {};\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"core/instance/state.js"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"// stateMixin(Vue)\nVue.prototype.$data = data;\nVue.prototype.$props = props;\nVue.prototype.$set = set;\nVue.prototype.$delete = del;\nVue.prototype.$watch = function (\n  expOrFn: string | Function,\n  cb: any,\n  options?: Object\n): Function {};\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"core/instance/events.js"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"// eventsMixin(Vue)\nVue.prototype.$on = function (\n  event: string | Array<string>,\n  fn: Function\n): Component {};\nVue.prototype.$once = function (event: string, fn: Function): Component {};\nVue.prototype.$off = function (\n  event?: string | Array<string>,\n  fn?: Function\n): Component {};\nVue.prototype.$emit = function (event: string): Component {};\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"core/instance/lifecycle.js"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"// lifecycleMixin(Vue)\nVue.prototype._update = function (vnode: VNode, hydrating?: boolean) {};\nVue.prototype.$forceUpdate = function () {};\nVue.prototype.$destroy = function () {};\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"core/instance/render.js"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"export function initRender(vm: Component) {\n  vm._vnode = null; // the root of the child tree\n  vm._staticTrees = null; // v-once cached trees\n  const options = vm.$options;\n  const parentVnode = (vm.$vnode = options._parentVnode);\n  const renderContext = parentVnode && parentVnode.context;\n  vm.$slots = resolveSlots(options._renderChildren, renderContext);\n  vm.$scopedSlots = emptyObject;\n  vm._c = (a, b, c, d) => createElement(vm, a, b, c, d, false);\n  vm.$createElement = (a, b, c, d) => createElement(vm, a, b, c, d, true);\n  const parentData = parentVnode && parentVnode.data;\n}\n\nexport function renderMixin(Vue: Class<Component>) {\n  installRenderHelpers(Vue.prototype);\n  Vue.prototype.$nextTick = function (fn: Function) {\n    return nextTick(fn, this);\n  };\n  Vue.prototype._render = function (): VNode {};\n}\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"core/instance/render-helpers/index.js"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"export function installRenderHelpers(target: any) {\n  target._o = markOnce;\n  target._n = toNumber;\n  target._s = toString;\n  target._l = renderList;\n  target._t = renderSlot;\n  target._q = looseEqual;\n  target._i = looseIndexOf;\n  target._m = renderStatic;\n  target._f = resolveFilter;\n  target._k = checkKeyCodes;\n  target._b = bindObjectProps;\n  target._v = createTextVNode;\n  target._e = createEmptyVNode;\n  target._u = resolveScopedSlots;\n  target._g = bindObjectListeners;\n}\n")),(0,o.kt)("h3",{id:"vue-prototype"},"Vue Prototype"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"core/index.js"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"import { FunctionalRenderContext } from 'core/vdom/create-functional-component';\nimport { isServerRendering } from 'core/util/env';\nimport Vue from './instance/index';\nimport { initGlobalAPI } from './global-api/index';\n\ninitGlobalAPI(Vue);\n\nObject.defineProperty(Vue.prototype, '$isServer', {\n  get: isServerRendering,\n});\n\nObject.defineProperty(Vue.prototype, '$ssrContext', {\n  get() {\n    return this.$vnode && this.$vnode.ssrContext;\n  },\n});\n\n// expose FunctionalRenderContext for ssr runtime helper installation\nObject.defineProperty(Vue, 'FunctionalRenderContext', {\n  value: FunctionalRenderContext,\n});\n\nVue.version = '__VERSION__';\n\nexport default Vue;\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"runtime/index.js"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"import Vue from 'core/index';\nimport config from 'core/config';\nimport { extend, noop } from 'shared/util';\nimport { mountComponent } from 'core/instance/lifecycle';\nimport { devtools, inBrowser, isChrome } from 'core/util/index';\n\nimport {\n  getTagNamespace,\n  isReservedAttr,\n  isReservedTag,\n  isUnknownElement,\n  mustUseProp,\n  query,\n} from 'web/util/index';\n\nimport { patch } from './patch';\nimport platformDirectives from './directives/index';\nimport platformComponents from './components/index';\n\n// Install platform specific utils.\nVue.config.mustUseProp = mustUseProp;\nVue.config.isReservedTag = isReservedTag;\nVue.config.isReservedAttr = isReservedAttr;\nVue.config.getTagNamespace = getTagNamespace;\nVue.config.isUnknownElement = isUnknownElement;\n\n// Install platform runtime directives & components.\nextend(Vue.options.directives, platformDirectives);\nextend(Vue.options.components, platformComponents);\n\n// Install platform patch function.\nVue.prototype.__patch__ = inBrowser ? patch : noop;\n\n// Public mount method.\nVue.prototype.$mount = function (\n  el?: string | Element,\n  hydrating?: boolean\n): Component {\n  el = el && inBrowser ? query(el) : undefined;\n  return mountComponent(this, el, hydrating);\n};\n\nexport default Vue;\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"platforms/web/entry-runtime-with-compiler.js")," \u91cd\u5199 ",(0,o.kt)("inlineCode",{parentName:"p"},"Vue.prototype.$mount")," \u65b9\u6cd5:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"import config from 'core/config';\nimport { cached } from 'core/util/index';\n\nimport Vue from './runtime/index';\nimport { compileToFunctions } from './compiler/index';\nimport {\n  shouldDecodeNewlines,\n  shouldDecodeNewlinesForHref,\n} from './util/compat';\nimport { query } from './util/index';\n\nconst mount = Vue.prototype.$mount;\n\nconst idToTemplate = cached(id => {\n  const el = query(id);\n  return el && el.innerHTML;\n});\n\n/**\n * Get outerHTML of elements, taking care\n * of SVG elements in IE as well.\n */\nconst getOuterHTML = (el: Element): string => {\n  if (el.outerHTML) {\n    return el.outerHTML;\n  } else {\n    const container = document.createElement('div');\n    container.appendChild(el.cloneNode(true));\n    return container.innerHTML;\n  }\n};\n\nVue.prototype.$mount = function (\n  el?: string | Element,\n  hydrating?: boolean\n): Component {\n  el = el && query(el);\n\n  if (el === document.body || el === document.documentElement) {\n    // Do not mount Vue to <html> or <body>\n    return this;\n  }\n\n  const options = this.$options;\n  // resolve template/el and convert to render function\n  if (!options.render) {\n    let template = options.template;\n    if (template) {\n      if (typeof template === 'string') {\n        if (template.charAt(0) === '#') {\n          template = idToTemplate(template);\n        }\n      } else if (template.nodeType) {\n        template = template.innerHTML;\n      } else {\n        // Invalid template option\n        return this;\n      }\n    } else if (el) {\n      template = getOuterHTML(el);\n    }\n    if (template) {\n      const { render, staticRenderFns } = compileToFunctions(\n        template,\n        {\n          shouldDecodeNewlines,\n          shouldDecodeNewlinesForHref,\n          delimiters: options.delimiters,\n          comments: options.comments,\n        },\n        this\n      );\n      options.render = render;\n      options.staticRenderFns = staticRenderFns;\n    }\n  }\n\n  return mount.call(this, el, hydrating);\n};\n\nVue.compile = compileToFunctions;\n\nexport default Vue;\n")),(0,o.kt)("h3",{id:"vue-global-api"},"Vue Global API"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"core/global-api/index.js")," \u6dfb\u52a0 ",(0,o.kt)("inlineCode",{parentName:"p"},"Vue.XXX")," \u9759\u6001\u65b9\u6cd5:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"// initGlobalAPI\nVue.config = config;\nVue.util = {\n  warn,\n  extend,\n  mergeOptions,\n  defineReactive,\n};\nVue.set = set;\nVue.delete = del;\nVue.nextTick = nextTick;\nVue.options = {\n  components: {\n    KeepAlive,\n    // Transition \u548c TransitionGroup \u7ec4\u4ef6\u5728 runtime/index.js \u6587\u4ef6\u4e2d\u88ab\u6dfb\u52a0\n    // Transition,\n    // TransitionGroup\n  },\n  directives: Object.create(null),\n  // \u5728 runtime/index.js \u6587\u4ef6\u4e2d, \u4e3a directives \u6dfb\u52a0\u4e86\u4e24\u4e2a\u5e73\u53f0\u5316\u7684\u6307\u4ee4 model \u548c show\n  // directives:{\n  // model,\n  // show\n  // },\n  filters: Object.create(null),\n  _base: Vue,\n};\n\n// initUse: global-api/use.js\nVue.use = function (plugin: Function | Object) {};\n\n// initMixin: global-api/mixin.js\nVue.mixin = function (mixin: Object) {};\n\n// initExtend: global-api/extend.js\nVue.cid = 0;\nVue.extend = function (extendOptions: Object): Function {};\n\n// initAssetRegisters: global-api/assets.js\nVue.component =\n  Vue.directive =\n  Vue.filter =\n    function (\n      id: string,\n      definition: Function | Object\n    ): Function | Object | void {};\n\n// expose FunctionalRenderContext for ssr runtime helper installation\nObject.defineProperty(Vue, 'FunctionalRenderContext', {\n  value: FunctionalRenderContext,\n});\n\nVue.version = '__VERSION__';\n\n// entry-runtime-with-compiler.js\nVue.compile = compileToFunctions;\n")),(0,o.kt)("h4",{id:"vue-global-extend-api"},"Vue Global Extend API"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"core/global-api/extend.js"),":"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"Vue.extend"),"/",(0,o.kt)("inlineCode",{parentName:"li"},"vm.$options._base.extend")," will return brand new ",(0,o.kt)("inlineCode",{parentName:"li"},"Vue")," constructor.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"/**\n * Class inheritance\n */\nVue.extend = function (extendOptions: Object): Function {\n  extendOptions = extendOptions || {};\n  // eslint-disable-next-line @typescript-eslint/no-this-alias\n  const Super = this;\n  const SuperId = Super.cid;\n  const cachedCtors = extendOptions._Ctor || (extendOptions._Ctor = {});\n\n  if (cachedCtors[SuperId]) {\n    return cachedCtors[SuperId];\n  }\n\n  const name = extendOptions.name || Super.options.name;\n  const Sub = function VueComponent(options) {\n    this._init(options);\n  };\n\n  Sub.prototype = Object.create(Super.prototype);\n  Sub.prototype.constructor = Sub;\n  Sub.cid = cid++;\n  Sub.options = mergeOptions(Super.options, extendOptions);\n  Sub.super = Super;\n\n  // For props and computed properties, we define the proxy getters on\n  // the Vue instances at extension time, on the extended prototype. This\n  // avoids Object.defineProperty calls for each instance created.\n  if (Sub.options.props) {\n    initProps(Sub);\n  }\n\n  if (Sub.options.computed) {\n    initComputed(Sub);\n  }\n\n  // allow further extension/mixin/plugin usage\n  Sub.extend = Super.extend;\n  Sub.mixin = Super.mixin;\n  Sub.use = Super.use;\n\n  // create asset registers, so extended classes\n  // can have their private assets too.\n  ASSET_TYPES.forEach(function (type) {\n    Sub[type] = Super[type];\n  });\n\n  // enable recursive self-lookup\n  if (name) {\n    Sub.options.components[name] = Sub;\n  }\n\n  // keep a reference to the super options at extension time.\n  // later at instantiation we can check if Super's options have\n  // been updated.\n  Sub.superOptions = Super.options;\n  Sub.extendOptions = extendOptions;\n  Sub.sealedOptions = extend({}, Sub.options);\n\n  // cache constructor\n  cachedCtors[SuperId] = Sub;\n  return Sub;\n};\n")),(0,o.kt)("h4",{id:"vue-global-nexttick-api"},"Vue Global NextTick API"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"core/util/next-tick.js"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"import { noop } from 'shared/util';\nimport { handleError } from './error';\nimport { isIOS, isNative } from './env';\n\nconst callbacks = [];\nlet pending = false;\n\nfunction flushCallbacks() {\n  pending = false;\n  const copies = callbacks.slice(0);\n  callbacks.length = 0;\n\n  for (let i = 0; i < copies.length; i++) {\n    copies[i]();\n  }\n}\n\nlet microTimerFunc;\nlet macroTimerFunc;\nlet useMacroTask = false;\n\n// setImmediate -> MessageChannel -> setTimeout.\nif (typeof setImmediate !== 'undefined' && isNative(setImmediate)) {\n  macroTimerFunc = () => {\n    setImmediate(flushCallbacks);\n  };\n} else if (\n  typeof MessageChannel !== 'undefined' &&\n  (isNative(MessageChannel) ||\n    // PhantomJS\n    MessageChannel.toString() === '[object MessageChannelConstructor]')\n) {\n  const channel = new MessageChannel();\n  const port = channel.port2;\n  channel.port1.onmessage = flushCallbacks;\n  macroTimerFunc = () => {\n    port.postMessage(1);\n  };\n} else {\n  macroTimerFunc = () => {\n    setTimeout(flushCallbacks, 0);\n  };\n}\n\n// Promise.then -> Macro Timer.\nif (typeof Promise !== 'undefined' && isNative(Promise)) {\n  const p = Promise.resolve();\n  microTimerFunc = () => {\n    p.then(flushCallbacks);\n    if (isIOS) setTimeout(noop);\n  };\n} else {\n  microTimerFunc = macroTimerFunc;\n}\n\n/**\n * Wrap a function so that if any code inside triggers state change,\n * the changes are queued using a (macro) task instead of a micro task.\n */\nexport function withMacroTask(fn: Function): Function {\n  return (\n    fn._withTask ||\n    (fn._withTask = function (...args) {\n      useMacroTask = true;\n      const res = fn(...args);\n      useMacroTask = false;\n      return res;\n    })\n  );\n}\n\nexport function nextTick(cb?: Function, ctx?: Object) {\n  let _resolve;\n\n  callbacks.push(() => {\n    if (cb) {\n      try {\n        cb.call(ctx);\n      } catch (e) {\n        handleError(e, ctx, 'nextTick');\n      }\n    } else if (_resolve) {\n      _resolve(ctx);\n    }\n  });\n\n  if (!pending) {\n    pending = true;\n\n    if (useMacroTask) {\n      macroTimerFunc();\n    } else {\n      microTimerFunc();\n    }\n  }\n\n  if (!cb && typeof Promise !== 'undefined') {\n    return new Promise(resolve => {\n      _resolve = resolve;\n    });\n  }\n}\n")),(0,o.kt)("h4",{id:"vue-global-mixin-api"},"Vue Global Mixin API"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"core/global-api/mixin.js"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"export function initMixin(Vue: GlobalAPI) {\n  Vue.mixin = function (mixin: Object) {\n    this.options = mergeOptions(this.options, mixin);\n    return this;\n  };\n}\n")),(0,o.kt)("h4",{id:"vue-global-use-api"},"Vue Global Use API"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"core/global-api/use.js"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"export function initUse(Vue: GlobalAPI) {\n  Vue.use = function (plugin: Function | Object, ...args: any) {\n    const installedPlugins =\n      this._installedPlugins || (this._installedPlugins = []);\n\n    if (installedPlugins.includes(plugin)) {\n      return this;\n    }\n\n    // Pass `Vue` to plugin install hook.\n    args.unshift(this);\n\n    if (typeof plugin.install === 'function') {\n      plugin.install(...args);\n    } else if (typeof plugin === 'function') {\n      plugin(...args);\n    }\n\n    installedPlugins.push(plugin);\n    return this;\n  };\n}\n")),(0,o.kt)("h3",{id:"vue-instance"},"Vue Instance"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"// Vue.prototype._init: core/instance/init.js\n// eslint-disable-next-line @typescript-eslint/no-this-alias\nconst vm: Component = this;\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"// Vue.prototype._init: core/instance/init.js\nvm._uid = uid++; // \u6bcf\u4e2aVue\u5b9e\u4f8b\u90fd\u62e5\u6709\u4e00\u4e2a\u552f\u4e00\u7684 id\nvm._isVue = true; // \u8fd9\u4e2a\u8868\u793a\u7528\u4e8e\u907f\u514dVue\u5b9e\u4f8b\u5bf9\u8c61\u88ab\u89c2\u6d4b(observed)\nvm.$options = options; // \u5f53\u524d Vue \u5b9e\u4f8b\u7684\u521d\u59cb\u5316\u9009\u9879, \u6ce8\u610f: \u8fd9\u662f\u7ecf\u8fc7 mergeOptions() \u540e\u7684\nvm._renderProxy = vm; // \u6e32\u67d3\u51fd\u6570\u4f5c\u7528\u57df\u4ee3\u7406\nvm._self = vm; // \u5b9e\u4f8b\u672c\u8eab\n\n// initLifecycle(vm): core/instance/lifecycle.js\nvm.$parent = vmParent;\nvm.$root = vmParent ? vmParent.$root : vm;\n\nvm.$children = [];\nvm.$refs = {};\n\nvm._watcher = null;\nvm._inactive = null;\nvm._directInactive = false;\nvm._isMounted = false;\nvm._isDestroyed = false;\nvm._isBeingDestroyed = false;\n\n// initEvents(vm): core/instance/events.js\nvm._events = Object.create(null);\nvm._hasHookEvent = false;\n\n// initRender(vm): core/instance/render.js\nvm._vnode = null; // the root of the child tree\nvm._staticTrees = null; // v-once cached trees\n\nvm.$vnode = vnode;\nvm.$slots = slots;\nvm.$scopedSlots = scopedSlots;\n\nvm._c = c;\nvm.$createElement = createElement;\n\nvm.$attrs = attrs;\nvm.$listeners = listeners;\n\n// initState(vm): core/instance/state.js\nvm._watchers = [];\nvm._data = data;\n\n// mountComponent(): core/instance/lifecycle.js\nvm.$el = el;\n\n// initComputed(): core/instance/state.js\nvm._computedWatchers = Object.create(null);\n\n// initProps(): core/instance/state.js\nvm._props = {};\n\n// initProvide(): core/instance/inject.js\nvm._provided = provided;\n")),(0,o.kt)("h3",{id:"vue-mounting-workflow"},"Vue Mounting Workflow"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"new Vue()")," -> \u521d\u59cb\u5316 -> \u7f16\u8bd1 -> \u6e32\u67d3 -> \u6302\u8f7d -> \u66f4\u65b0:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"new Vue()"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"Vue.prototype._init"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"Vue.prototype.$mount"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"vm.$options.render = compileToFunctions(vm.$options.template)"),":",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"vue-loader")," for static transform:\n",(0,o.kt)("inlineCode",{parentName:"li"},".vue")," -> ",(0,o.kt)("inlineCode",{parentName:"li"},".js")," in build time."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"compileToFunctions")," for runtime transform:\nbundle ",(0,o.kt)("inlineCode",{parentName:"li"},"compiler")," and ",(0,o.kt)("inlineCode",{parentName:"li"},"runtime")," into ",(0,o.kt)("inlineCode",{parentName:"li"},"vue.js"),"."))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"mountComponent(vm, el)"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"Vue.prototype._render"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"VDOM.createElement(vm)"),":",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Normalize children."),(0,o.kt)("li",{parentName:"ul"},"Create VNode and install hooks."),(0,o.kt)("li",{parentName:"ul"},"Create children recursively."))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"Vue.prototype._update"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"Vue.prototype.__patch__")," (",(0,o.kt)("inlineCode",{parentName:"li"},"platforms/web/runtime/patch.js"),"):",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"backend.nodeOps")," (",(0,o.kt)("inlineCode",{parentName:"li"},"platforms/web/runtime/node-ops"),").",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"createElement"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"createElementNS"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"createTextNode"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"createComment"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"insertBefore"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"appendChild"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"removeChild"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"parentNode"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"nextSibling"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"tagName"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"setTextContent"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"setStyleScope"),"."))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"backend.hooksModules")," (",(0,o.kt)("inlineCode",{parentName:"li"},"core/vdom/modules")," + ",(0,o.kt)("inlineCode",{parentName:"li"},"platforms/web/runtime/modules"),"):",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"create"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"activate"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"update"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"remove"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"destroy"),".")))))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"const app = new Vue({ el: '#app', ...restOptionsAPI });\nvm._init(...restOptionsAPI);\nif (vm.$options.el) vm.$mount(vm.$options.el);\nvm.$options.render = compileToFunctions(vm.$options.template);\nmountComponent(vm, el);\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"core/instance/init.js"),":"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u5408\u5e76\u914d\u7f6e."),(0,o.kt)("li",{parentName:"ul"},"\u521d\u59cb\u5316\u751f\u547d\u5468\u671f."),(0,o.kt)("li",{parentName:"ul"},"\u521d\u59cb\u5316\u4e8b\u4ef6\u4e2d\u5fc3."),(0,o.kt)("li",{parentName:"ul"},"\u521d\u59cb\u5316\u6e32\u67d3."),(0,o.kt)("li",{parentName:"ul"},"\u521d\u59cb\u5316 data/props/computed/watcher.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"// initMixin(Vue)\nVue.prototype._init = function (options?: Object) {\n  // eslint-disable-next-line @typescript-eslint/no-this-alias\n  const vm: Component = this;\n\n  // uid\n  vm._uid = uid++;\n\n  // a flag to avoid this being observed\n  vm._isVue = true;\n\n  // merge options\n  if (options && options._isComponent) {\n    initInternalComponent(vm, options);\n  } else {\n    vm.$options = mergeOptions(\n      resolveConstructorOptions(vm.constructor),\n      options || {},\n      vm\n    );\n  }\n\n  vm._renderProxy = vm;\n\n  // expose real self\n  vm._self = vm;\n  initLifecycle(vm);\n  initEvents(vm);\n  initRender(vm);\n  callHook(vm, 'beforeCreate');\n  initInjections(vm); // resolve injections before data/props\n  initState(vm);\n  initProvide(vm); // resolve provide after data/props\n  callHook(vm, 'created');\n\n  if (vm.$options.el) {\n    vm.$mount(vm.$options.el);\n  }\n};\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"core/instance/lifecycle.js"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"export function mountComponent(\n  vm: Component,\n  el: ?Element,\n  hydrating?: boolean\n): Component {\n  vm.$el = el;\n\n  if (!vm.$options.render) {\n    vm.$options.render = createEmptyVNode;\n  }\n\n  callHook(vm, 'beforeMount');\n\n  const updateComponent = () => {\n    vm._update(vm._render(), hydrating);\n  };\n\n  // eslint-disable-next-line no-new\n  new Watcher(\n    vm,\n    updateComponent,\n    noop,\n    {\n      before() {\n        if (vm._isMounted) {\n          callHook(vm, 'beforeUpdate');\n        }\n      },\n    },\n    true /* isRenderWatcher */\n  );\n\n  hydrating = false;\n\n  // manually mounted instance, call mounted on self\n  // mounted is called for render-created child components in its inserted hook\n  // vm.$vnode \u8868\u793a Vue \u5b9e\u4f8b\u7684\u7236\u865a\u62df Node.\n  if (vm.$vnode == null) {\n    // Only `new Vue()` trigger this:\n    vm._isMounted = true;\n    callHook(vm, 'mounted');\n  }\n\n  return vm;\n}\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"core/instance/render.js"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"Vue.prototype._render = function (): VNode {\n  // eslint-disable-next-line @typescript-eslint/no-this-alias\n  const vm: Component = this;\n  const { render, _parentVnode } = vm.$options;\n\n  if (_parentVnode) {\n    vm.$scopedSlots = _parentVnode.data.scopedSlots || emptyObject;\n  }\n\n  // set parent vnode. this allows render functions to have access\n  // to the data on the placeholder node.\n  vm.$vnode = _parentVnode;\n\n  // render self\n  const vnode = render.call(vm._renderProxy, vm.$createElement);\n\n  // return empty vnode in case the render function errored out\n  if (!(vnode instanceof VNode)) {\n    vnode = createEmptyVNode();\n  }\n\n  // set parent\n  vnode.parent = _parentVnode;\n  return vnode;\n};\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"core/vdom/create-element.js"),":"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Normalize children: transform children to ",(0,o.kt)("inlineCode",{parentName:"li"},"Array<VNode>"),"."),(0,o.kt)("li",{parentName:"ul"},"Create VNode:",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"new VNode(tag, data, children, vm)")," for native host elements (e.g ",(0,o.kt)("inlineCode",{parentName:"li"},"<div>"),")."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"createComponent(tag, data, children, vm)")," for custom components:",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"resolveConstructorOptions"),": merge and resolve options API."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"installComponentHooks"),":",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Install internal (",(0,o.kt)("inlineCode",{parentName:"li"},"core/vdom/create-component.js/componentVNodeHooks"),") hooks."),(0,o.kt)("li",{parentName:"ul"},"Merge user-defined VNode hooks."))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"new VNode("),"vue-component-${Ctor.options.name}",(0,o.kt)("inlineCode",{parentName:"li"},", data, undefined, vm)"),"."),(0,o.kt)("li",{parentName:"ul"},"Component VNode children is ",(0,o.kt)("inlineCode",{parentName:"li"},"undefined"),"."))))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"vm._vnode.parent === vm.$vnode"),"."),(0,o.kt)("li",{parentName:"ul"},"\u7ec4\u4ef6 patch \u8fc7\u7a0b\u4e2d DOM \u7684\u63d2\u5165\u987a\u5e8f\u4e3a",(0,o.kt)("strong",{parentName:"li"},"\u5148\u5b50\u540e\u7236"),":\n",(0,o.kt)("inlineCode",{parentName:"li"},"createComponent(vnode)")," \u4e2d\u4f1a\u8c03\u7528\u5185\u90e8\u94a9\u5b50\u51fd\u6570 ",(0,o.kt)("inlineCode",{parentName:"li"},"init(vnode)"),",\n",(0,o.kt)("inlineCode",{parentName:"li"},"init(vnode)")," \u51fd\u6570\u4f1a\u521b\u5efa\u5b50\u7ec4\u4ef6 ",(0,o.kt)("inlineCode",{parentName:"li"},"VNode"),", \u5e76\u8c03\u7528 ",(0,o.kt)("inlineCode",{parentName:"li"},"child.$mount(vnode.elm)"),",\n\u9012\u5f52\u5f0f\u5730\u521b\u5efa\u5b50\u7ec4\u4ef6.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"export function createElement(\n  context: Component,\n  tag: any,\n  data: any,\n  children: any,\n  normalizationType: any,\n  alwaysNormalize: boolean\n): VNode | Array<VNode> {\n  if (Array.isArray(data) || isPrimitive(data)) {\n    normalizationType = children;\n    children = data;\n    data = undefined;\n  }\n\n  if (isTrue(alwaysNormalize)) {\n    normalizationType = ALWAYS_NORMALIZE;\n  }\n\n  return _createElement(context, tag, data, children, normalizationType);\n}\n\nexport function _createElement(\n  context: Component,\n  tag?: string | Class<Component> | Function | Object,\n  data?: VNodeData,\n  children?: any,\n  normalizationType?: number\n): VNode | Array<VNode> {\n  if (isDef(data) && isDef(data.__ob__)) {\n    return createEmptyVNode();\n  }\n\n  // object syntax in v-bind\n  if (isDef(data) && isDef(data.is)) {\n    tag = data.is;\n  }\n\n  if (!tag) {\n    // in case of component :is set to falsy value\n    return createEmptyVNode();\n  }\n\n  // support single function children as default scoped slot\n  if (Array.isArray(children) && typeof children[0] === 'function') {\n    data = data || {};\n    data.scopedSlots = { default: children[0] };\n    children.length = 0;\n  }\n\n  if (normalizationType === ALWAYS_NORMALIZE) {\n    children = normalizeChildren(children);\n  } else if (normalizationType === SIMPLE_NORMALIZE) {\n    children = simpleNormalizeChildren(children);\n  }\n\n  let vnode;\n  let ns;\n\n  if (typeof tag === 'string') {\n    let Ctor;\n    ns = (context.$vnode && context.$vnode.ns) || config.getTagNamespace(tag);\n\n    if (config.isReservedTag(tag)) {\n      // platform built-in elements\n      vnode = new VNode(\n        config.parsePlatformTagName(tag),\n        data,\n        children,\n        undefined,\n        undefined,\n        context\n      );\n    } else if (\n      (!data || !data.pre) &&\n      // eslint-disable-next-line no-cond-assign\n      isDef((Ctor = resolveAsset(context.$options, 'components', tag)))\n    ) {\n      // component\n      vnode = createComponent(Ctor, data, context, children, tag);\n    } else {\n      // unknown or unlisted namespaced elements\n      // check at runtime because it may get assigned a namespace when its\n      // parent normalizes children\n      vnode = new VNode(tag, data, children, undefined, undefined, context);\n    }\n  } else {\n    // direct component options / constructor\n    vnode = createComponent(tag, data, context, children);\n  }\n\n  if (Array.isArray(vnode)) {\n    return vnode;\n  } else if (isDef(vnode)) {\n    if (isDef(ns)) applyNS(vnode, ns);\n    if (isDef(data)) registerDeepBindings(data);\n    return vnode;\n  } else {\n    return createEmptyVNode();\n  }\n}\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"core/instance/lifecycle.js"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"Vue.prototype._update = function (vnode: VNode, hydrating?: boolean) {\n  // eslint-disable-next-line @typescript-eslint/no-this-alias\n  const vm: Component = this;\n  const prevEl = vm.$el;\n  const prevVnode = vm._vnode;\n  const restoreActiveInstance = setActiveInstance(vm);\n  vm._vnode = vnode;\n\n  // Vue.prototype.__patch__ is injected in entry points\n  // based on the rendering backend used.\n  if (!prevVnode) {\n    // initial render\n    vm.$el = vm.__patch__(vm.$el, vnode, hydrating, false /* removeOnly */);\n  } else {\n    // updates\n    vm.$el = vm.__patch__(prevVnode, vnode);\n  }\n\n  restoreActiveInstance();\n\n  // update __vue__ reference\n  if (prevEl) {\n    prevEl.__vue__ = null;\n  }\n\n  if (vm.$el) {\n    vm.$el.__vue__ = vm;\n  }\n\n  // if parent is an HOC, update its $el as well\n  if (vm.$vnode && vm.$parent && vm.$vnode === vm.$parent._vnode) {\n    vm.$parent.$el = vm.$el;\n  }\n\n  // updated hook is called by the scheduler\n  // to ensure that children are updated in a parent's updated hook.\n};\n")),(0,o.kt)("h3",{id:"vue-options-api"},"Vue Options API"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"core/instance/init.js"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"vm.$options = mergeOptions(\n  // resolveConstructorOptions(vm.constructor)\n  {\n    components: {\n      KeepAlive,\n      Transition,\n      TransitionGroup,\n    },\n    directives: {\n      model,\n      show,\n    },\n    filters: Object.create(null),\n    _base: Vue,\n  },\n  // options || {}\n  {\n    el: '#app',\n    data: {\n      test: 1,\n    },\n  },\n  vm\n);\n")),(0,o.kt)("p",null,"Parent component options:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"vm.$options = {\n  components: {\n    KeepAlive,\n    Transition,\n    TransitionGroup,\n    ...UserRegisterComponents,\n  },\n  created: [\n    function created() {\n      console.log('parent created');\n    },\n  ],\n  directives: {\n    model,\n    show,\n    ...userCustomDirectives,\n  },\n  filters: {},\n  _base: function Vue(options) {},\n  el: '#app',\n  render: function _render(h) {},\n};\n")),(0,o.kt)("p",null,"Children component options:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"vm.$options = {\n  parent: Vue /* \u7236Vue\u5b9e\u4f8b */,\n  propsData: undefined,\n  _componentTag: undefined,\n  _parentVnode: VNode /* \u7236VNode\u5b9e\u4f8b */,\n  _renderChildren: undefined,\n  __proto__: {\n    components: {\n      KeepAlive,\n      Transition,\n      TransitionGroup,\n      ...UserRegisterComponents,\n    },\n    directives: {\n      model,\n      show,\n      ...userCustomDirectives,\n    },\n    filters: {},\n    _base: function Vue(options) {},\n    _Ctor: {},\n    created: [\n      function created() {\n        console.log('parent created');\n      },\n      function created() {\n        console.log('child created');\n      },\n    ],\n    mounted: [\n      function mounted() {\n        console.log('child mounted');\n      },\n    ],\n    data() {\n      return {\n        msg: 'Hello Vue',\n      };\n    },\n    template: '<div>{{msg}}</div>',\n  },\n};\n")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"core/instance/state.js/initProps()"),": ",(0,o.kt)("inlineCode",{parentName:"li"},"this.XXX")," -> ",(0,o.kt)("inlineCode",{parentName:"li"},"this._props.XXX"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"core/instance/state.js/initData()"),": ",(0,o.kt)("inlineCode",{parentName:"li"},"this.XXX")," -> ",(0,o.kt)("inlineCode",{parentName:"li"},"this._data.XXX"),".")),(0,o.kt)("h4",{id:"vue-merge-options"},"Vue Merge Options"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"mergeOptions")," (",(0,o.kt)("inlineCode",{parentName:"p"},"core/util/options.js"),"):"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u5bf9\u4e8e ",(0,o.kt)("inlineCode",{parentName:"li"},"el"),"/",(0,o.kt)("inlineCode",{parentName:"li"},"propsData")," \u9009\u9879\u4f7f\u7528\u9ed8\u8ba4\u7684\u5408\u5e76\u7b56\u7565 ",(0,o.kt)("inlineCode",{parentName:"li"},"defaultStrategy"),"."),(0,o.kt)("li",{parentName:"ul"},"\u5bf9\u4e8e ",(0,o.kt)("inlineCode",{parentName:"li"},"data")," \u9009\u9879, \u4f7f\u7528 ",(0,o.kt)("inlineCode",{parentName:"li"},"mergeDataOrFn")," \u51fd\u6570\u8fdb\u884c\u5904\u7406, \u6700\u7ec8\u7ed3\u679c\u662f ",(0,o.kt)("inlineCode",{parentName:"li"},"data")," \u9009\u9879\u5c06\u53d8\u6210\u4e00\u4e2a\u51fd\u6570, \u4e14\u8be5\u51fd\u6570\u7684\u6267\u884c\u7ed3\u679c\u4e3a\u771f\u6b63\u7684\u6570\u636e\u5bf9\u8c61."),(0,o.kt)("li",{parentName:"ul"},"\u5bf9\u4e8e \u751f\u547d\u5468\u671f\u94a9\u5b50 \u9009\u9879, \u5c06\u5408\u5e76\u6210\u6570\u7ec4, \u4f7f\u5f97\u7236\u5b50\u9009\u9879\u4e2d\u7684\u94a9\u5b50\u51fd\u6570\u90fd\u80fd\u591f\u88ab\u6267\u884c."),(0,o.kt)("li",{parentName:"ul"},"\u5bf9\u4e8e ",(0,o.kt)("inlineCode",{parentName:"li"},"directives"),"/",(0,o.kt)("inlineCode",{parentName:"li"},"filters")," \u4ee5\u53ca ",(0,o.kt)("inlineCode",{parentName:"li"},"components")," \u7b49\u8d44\u6e90\u9009\u9879,\n\u7236\u5b50\u9009\u9879\u5c06\u4ee5\u539f\u578b\u94fe\u7684\u5f62\u5f0f\u88ab\u5904\u7406, \u6b63\u662f\u56e0\u4e3a\u8fd9\u6837\u6211\u4eec\u624d\u80fd\u591f\u5728\u4efb\u4f55\u5730\u65b9\u90fd\u4f7f\u7528\u5185\u7f6e\u7ec4\u4ef6\u6216\u6307\u4ee4\u7b49."),(0,o.kt)("li",{parentName:"ul"},"\u5bf9\u4e8e ",(0,o.kt)("inlineCode",{parentName:"li"},"watch")," \u9009\u9879\u7684\u5408\u5e76\u5904\u7406, \u7c7b\u4f3c\u4e8e\u751f\u547d\u5468\u671f\u94a9\u5b50, \u5982\u679c\u7236\u5b50\u9009\u9879\u90fd\u6709\u76f8\u540c\u7684\u89c2\u6d4b\u5b57\u6bb5, \u5c06\u88ab\u5408\u5e76\u4e3a\u6570\u7ec4, \u8fd9\u6837\u89c2\u5bdf\u8005\u90fd\u5c06\u88ab\u6267\u884c."),(0,o.kt)("li",{parentName:"ul"},"\u5bf9\u4e8e ",(0,o.kt)("inlineCode",{parentName:"li"},"props"),"/",(0,o.kt)("inlineCode",{parentName:"li"},"methods"),"/",(0,o.kt)("inlineCode",{parentName:"li"},"inject"),"/",(0,o.kt)("inlineCode",{parentName:"li"},"computed")," \u9009\u9879, \u7236\u9009\u9879\u59cb\u7ec8\u53ef\u7528, \u4f46\u662f\u5b50\u9009\u9879\u4f1a\u8986\u76d6\u540c\u540d\u7684\u7236\u9009\u9879\u5b57\u6bb5."),(0,o.kt)("li",{parentName:"ul"},"\u5bf9\u4e8e ",(0,o.kt)("inlineCode",{parentName:"li"},"provide")," \u9009\u9879, \u5176\u5408\u5e76\u7b56\u7565\u4f7f\u7528\u4e0e ",(0,o.kt)("inlineCode",{parentName:"li"},"data")," \u9009\u9879\u76f8\u540c\u7684 ",(0,o.kt)("inlineCode",{parentName:"li"},"mergeDataOrFn")," \u51fd\u6570."),(0,o.kt)("li",{parentName:"ul"},"\u6700\u540e, \u4ee5\u4e0a\u6ca1\u6709\u63d0\u53ca\u5230\u7684\u9009\u9879\u90fd\u5c06\u4f7f\u9ed8\u8ba4\u9009\u9879 ",(0,o.kt)("inlineCode",{parentName:"li"},"defaultStrategy"),"."),(0,o.kt)("li",{parentName:"ul"},"\u6700\u6700\u540e, \u9ed8\u8ba4\u5408\u5e76\u7b56\u7565\u51fd\u6570 ",(0,o.kt)("inlineCode",{parentName:"li"},"defaultStrategy")," \u7684\u7b56\u7565\u662f: \u53ea\u8981\u5b50\u9009\u9879\u4e0d\u662f ",(0,o.kt)("inlineCode",{parentName:"li"},"undefined")," \u5c31\u4f7f\u7528\u5b50\u9009\u9879, \u5426\u5219\u4f7f\u7528\u7236\u9009\u9879.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"/**\n * Merge two option objects into a new one.\n * Core utility used in both instantiation and inheritance.\n */\nexport function mergeOptions(\n  parent: Object,\n  child: Object,\n  vm?: Component\n): Object {\n  if (typeof child === 'function') {\n    child = child.options;\n  }\n\n  normalizeProps(child, vm);\n  normalizeInject(child, vm);\n  normalizeDirectives(child);\n\n  const extendsFrom = child.extends;\n\n  if (extendsFrom) {\n    parent = mergeOptions(parent, extendsFrom, vm);\n  }\n\n  if (child.mixins) {\n    for (let i = 0, l = child.mixins.length; i < l; i++) {\n      parent = mergeOptions(parent, child.mixins[i], vm);\n    }\n  }\n\n  const options = {};\n  let key;\n\n  for (key in parent) {\n    mergeField(key);\n  }\n\n  for (key in child) {\n    if (!hasOwn(parent, key)) {\n      mergeField(key);\n    }\n  }\n\n  function mergeField(key) {\n    const strategy = strategies[key] || defaultStrategy;\n    options[key] = strategy(parent[key], child[key], vm, key);\n  }\n\n  return options;\n}\n")),(0,o.kt)("h4",{id:"vue-normalize-options"},"Vue Normalize Options"),(0,o.kt)("p",null,"Props:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"// eslint-disable-next-line import/no-anonymous-default-export\nexport default {\n  props: {\n    someData1: {\n      type: Number,\n    },\n    someData2: {\n      type: String,\n      default: '',\n    },\n  },\n};\n")),(0,o.kt)("p",null,"Injects:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"// eslint-disable-next-line import/no-anonymous-default-export\nexport default {\n  inject: {\n    data1: { from: 'data1' },\n    d2: { from: 'data2' },\n    data3: { from: 'data3', someProperty: 'someValue' },\n  },\n};\n")),(0,o.kt)("p",null,"Directives:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"for (const key in dirs) {\n  const def = dirs[key];\n  if (typeof def === 'function') {\n    dirs[key] = { bind: def, update: def };\n  }\n}\n")),(0,o.kt)("h3",{id:"vue-lifecycle"},"Vue Lifecycle"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://v2.vuejs.org/v2/api/#Options-Lifecycle-Hooks"},(0,o.kt)("img",{alt:"Lifecycle",src:t(2912).Z,width:"1200",height:"3039"}))),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"callHook")," in ",(0,o.kt)("inlineCode",{parentName:"p"},"core/instance/lifecycle.js"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"export function callHook(vm: Component, hook: string) {\n  pushTarget();\n  const handlers = vm.$options[hook];\n\n  if (handlers) {\n    for (let i = 0, j = handlers.length; i < j; i++) {\n      try {\n        handlers[i].call(vm);\n      } catch (e) {\n        handleError(e, vm, `${hook} hook`);\n      }\n    }\n  }\n\n  if (vm._hasHookEvent) {\n    vm.$emit(`hook:${hook}`);\n  }\n\n  popTarget();\n}\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"beforeCreate"),"/",(0,o.kt)("inlineCode",{parentName:"p"},"created")," in ",(0,o.kt)("inlineCode",{parentName:"p"},"core/instance/init.js"),":"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"beforeCreate")," \u4e0d\u80fd\u8bbf\u95ee ",(0,o.kt)("inlineCode",{parentName:"li"},"props"),"/",(0,o.kt)("inlineCode",{parentName:"li"},"data"),"/",(0,o.kt)("inlineCode",{parentName:"li"},"methods"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"created")," \u53ef\u4ee5\u8bbf\u95ee ",(0,o.kt)("inlineCode",{parentName:"li"},"props"),"/",(0,o.kt)("inlineCode",{parentName:"li"},"data"),"/",(0,o.kt)("inlineCode",{parentName:"li"},"methods"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"beforeCreate"),"/",(0,o.kt)("inlineCode",{parentName:"li"},"created")," \u4e0d\u80fd\u8bbf\u95ee DOM.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"Vue.prototype._init = function (options?: Object) {\n  // ...\n  initLifecycle(vm);\n  initEvents(vm);\n  initRender(vm);\n  callHook(vm, 'beforeCreate');\n  initInjections(vm);\n  initState(vm); // props/data/methods/watch/computed.\n  initProvide(vm);\n  callHook(vm, 'created');\n  // ...\n};\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"beforeMount"),"/",(0,o.kt)("inlineCode",{parentName:"p"},"beforeUpdate")," in ",(0,o.kt)("inlineCode",{parentName:"p"},"core/instance/lifecycle.js"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"export function mountComponent(\n  vm: Component,\n  el: ?Element,\n  hydrating?: boolean\n): Component {\n  vm.$el = el;\n  // ...\n  callHook(vm, 'beforeMount');\n\n  const updateComponent = () => {\n    vm._update(vm._render(), hydrating);\n  };\n\n  // eslint-disable-next-line no-new\n  new Watcher(\n    vm,\n    updateComponent,\n    noop,\n    {\n      before() {\n        if (vm._isMounted) {\n          callHook(vm, 'beforeUpdate');\n        }\n      },\n    },\n    true /* isRenderWatcher */\n  );\n\n  hydrating = false;\n\n  if (vm.$vnode == null) {\n    // Only `new Vue()` trigger this:\n    vm._isMounted = true;\n    callHook(vm, 'mounted');\n  }\n\n  return vm;\n}\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"mounted")," in ",(0,o.kt)("inlineCode",{parentName:"p"},"core/vdom/patch.js"),"/",(0,o.kt)("inlineCode",{parentName:"p"},"core/vdom/create-component.js"),":"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u5bf9\u4e8e\u540c\u6b65\u6e32\u67d3\u7684\u5b50\u7ec4\u4ef6, ",(0,o.kt)("inlineCode",{parentName:"li"},"mounted")," \u6267\u884c\u987a\u5e8f\u4e3a",(0,o.kt)("strong",{parentName:"li"},"\u5148\u5b50\u540e\u7236"),".")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"// core/vdom/patch.js:\nfunction invokeInsertHook(vnode, queue, initial) {\n  // delay insert hooks for component root nodes, invoke them after the\n  // element is really inserted\n  if (isTrue(initial) && isDef(vnode.parent)) {\n    vnode.parent.data.pendingInsert = queue;\n  } else {\n    for (let i = 0; i < queue.length; ++i) {\n      queue[i].data.hook.insert(queue[i]);\n    }\n  }\n}\n\n// core/vdom/create-component.js:\nconst componentVNodeHooks = {\n  // ...\n  insert(vnode: MountedComponentVNode) {\n    const { context, componentInstance } = vnode;\n    if (!componentInstance._isMounted) {\n      componentInstance._isMounted = true;\n      callHook(componentInstance, 'mounted');\n    }\n    // ...\n  },\n};\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"update")," in ",(0,o.kt)("inlineCode",{parentName:"p"},"core/observer/scheduler.js"),":"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"RenderWatcher"),".")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"function flushSchedulerQueue() {\n  // ...\n  // \u83b7\u53d6\u5230 updatedQueue\n  callUpdatedHooks(updatedQueue);\n}\n\nfunction callUpdatedHooks(queue) {\n  let i = queue.length;\n\n  while (i--) {\n    const watcher = queue[i];\n    const vm = watcher.vm;\n\n    // Peek up `RenderWatcher`\n    if (vm._watcher === watcher && vm._isMounted) {\n      callHook(vm, 'updated');\n    }\n  }\n}\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"beforeDestroy"),"/",(0,o.kt)("inlineCode",{parentName:"p"},"destroyed")," in ",(0,o.kt)("inlineCode",{parentName:"p"},"core/instance/lifecycle.js"),":"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u8c03\u7528 ",(0,o.kt)("inlineCode",{parentName:"li"},"beforeDestroy")," \u94a9\u5b50\u51fd\u6570."),(0,o.kt)("li",{parentName:"ul"},"\u4ece ",(0,o.kt)("inlineCode",{parentName:"li"},"parent")," \u7684 ",(0,o.kt)("inlineCode",{parentName:"li"},"$children")," \u4e2d\u5220\u6389\u81ea\u8eab."),(0,o.kt)("li",{parentName:"ul"},"\u5220\u9664 ",(0,o.kt)("inlineCode",{parentName:"li"},"watcher"),"."),(0,o.kt)("li",{parentName:"ul"},"\u5f53\u524d\u6e32\u67d3\u7684 VNode \u6267\u884c\u9500\u6bc1\u94a9\u5b50\u51fd\u6570."),(0,o.kt)("li",{parentName:"ul"},"\u8c03\u7528 ",(0,o.kt)("inlineCode",{parentName:"li"},"destroyed")," \u94a9\u5b50\u51fd\u6570."),(0,o.kt)("li",{parentName:"ul"},"\u5728 ",(0,o.kt)("inlineCode",{parentName:"li"},"$destroy")," \u7684\u6267\u884c\u8fc7\u7a0b\u4e2d,\n\u4f1a\u6267\u884c ",(0,o.kt)("inlineCode",{parentName:"li"},"vm.__patch__(vm._vnode, null)")," \u89e6\u53d1\u5b50\u7ec4\u4ef6\u7684\u9500\u6bc1\u94a9\u5b50\u51fd\u6570 (\u9012\u5f52),\n",(0,o.kt)("inlineCode",{parentName:"li"},"destroyed")," \u94a9\u5b50\u51fd\u6570\u6267\u884c\u987a\u5e8f\u4e3a",(0,o.kt)("strong",{parentName:"li"},"\u5148\u5b50\u540e\u7236"),".")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"Vue.prototype.$destroy = function () {\n  // eslint-disable-next-line @typescript-eslint/no-this-alias\n  const vm: Component = this;\n\n  if (vm._isBeingDestroyed) {\n    return;\n  }\n\n  callHook(vm, 'beforeDestroy');\n  vm._isBeingDestroyed = true;\n\n  // remove self from parent\n  const parent = vm.$parent;\n\n  if (parent && !parent._isBeingDestroyed && !vm.$options.abstract) {\n    remove(parent.$children, vm);\n  }\n\n  // teardown watchers\n  if (vm._watcher) {\n    vm._watcher.teardown();\n  }\n\n  let i = vm._watchers.length;\n\n  while (i--) {\n    vm._watchers[i].teardown();\n  }\n\n  // remove reference from data ob\n  // frozen object may not have observer.\n  if (vm._data.__ob__) {\n    vm._data.__ob__.vmCount--;\n  }\n\n  // call the last hook...\n  vm._isDestroyed = true;\n  // invoke destroy hooks on current rendered tree\n  vm.__patch__(vm._vnode, null);\n  // fire destroyed hook\n  callHook(vm, 'destroyed');\n  // turn off all instance listeners.\n  vm.$off();\n\n  // GC: remove __vue__ reference\n  if (vm.$el) {\n    vm.$el.__vue__ = null;\n  }\n\n  // GC: release circular reference (#6759)\n  if (vm.$vnode) {\n    vm.$vnode.parent = null;\n  }\n};\n")),(0,o.kt)("h3",{id:"vue-async-component"},"Vue Async Component"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"// 1. Basic async component:\nVue.component('AsyncExample', function (resolve, reject) {\n  // \u8fd9\u4e2a\u7279\u6b8a\u7684 require \u8bed\u6cd5\u544a\u8bc9 webpack\n  // \u81ea\u52a8\u5c06\u7f16\u8bd1\u540e\u7684\u4ee3\u7801\u5206\u5272\u6210\u4e0d\u540c\u7684\u5757,\n  // \u8fd9\u4e9b\u5757\u5c06\u901a\u8fc7 Ajax \u8bf7\u6c42\u81ea\u52a8\u4e0b\u8f7d.\n  require(['./my-async-component'], resolve);\n});\n\n// 2. Promise async component:\nVue.component(\n  'AsyncWebpackExample',\n  // \u8be5 `import` \u51fd\u6570\u8fd4\u56de\u4e00\u4e2a `Promise` \u5bf9\u8c61.\n  () => import('./my-async-component')\n);\n\n// 3. Advanced async component:\nconst AsyncComp = () => ({\n  // \u9700\u8981\u52a0\u8f7d\u7684\u7ec4\u4ef6, \u5e94\u5f53\u662f\u4e00\u4e2a Promise.\n  component: import('./MyComp.vue'),\n  // \u52a0\u8f7d\u4e2d\u5e94\u5f53\u6e32\u67d3\u7684\u7ec4\u4ef6.\n  loading: LoadingComp,\n  // \u51fa\u9519\u65f6\u6e32\u67d3\u7684\u7ec4\u4ef6.\n  error: ErrorComp,\n  // \u6e32\u67d3\u52a0\u8f7d\u4e2d\u7ec4\u4ef6\u524d\u7684\u7b49\u5f85\u65f6\u95f4, \u9ed8\u8ba4: 200ms.\n  delay: 200,\n  // \u6700\u957f\u7b49\u5f85\u65f6\u95f4, \u8d85\u51fa\u6b64\u65f6\u95f4\u5219\u6e32\u67d3\u9519\u8bef\u7ec4\u4ef6, \u9ed8\u8ba4: Infinity.\n  timeout: 3000,\n});\nVue.component('AsyncExample', AsyncComp);\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"core/vdom/helpers/resolve-async-component.js"),":"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"3 \u79cd\u5f02\u6b65\u7ec4\u4ef6\u7684\u5b9e\u73b0\u65b9\u5f0f.",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"\u9ad8\u7ea7\u5f02\u6b65\u7ec4\u4ef6\u5b9e\u73b0\u4e86 loading/resolve/reject/timeout 4 \u79cd\u72b6\u6001."))),(0,o.kt)("li",{parentName:"ul"},"\u5f02\u6b65\u7ec4\u4ef6\u5b9e\u73b0\u7684\u672c\u8d28\u662f 2 \u6b21\u6e32\u67d3:",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"\u7b2c\u4e00\u6b21\u6e32\u67d3\u751f\u6210\u4e00\u4e2a\u6ce8\u91ca\u8282\u70b9/",(0,o.kt)("inlineCode",{parentName:"li"},"<LoadingComponent>"),"."),(0,o.kt)("li",{parentName:"ul"},"\u5f53\u5f02\u6b65\u83b7\u53d6\u7ec4\u4ef6\u6210\u529f\u540e, \u901a\u8fc7 ",(0,o.kt)("inlineCode",{parentName:"li"},"forceRender")," \u5f3a\u5236\u91cd\u65b0\u6e32\u67d3.")))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"import {\n  hasSymbol,\n  isDef,\n  isObject,\n  isPromise,\n  isTrue,\n  isUndef,\n  once,\n  remove,\n} from 'core/util/index';\nimport { createEmptyVNode } from 'core/vdom/vnode';\nimport { currentRenderingInstance } from 'core/instance/render';\n\nexport function resolveAsyncComponent(\n  factory: Function,\n  baseCtor: Class<Component>\n): Class<Component> | void {\n  // 3.\n  if (isTrue(factory.error) && isDef(factory.errorComp)) {\n    return factory.errorComp;\n  }\n\n  if (isDef(factory.resolved)) {\n    return factory.resolved;\n  }\n\n  const owner = currentRenderingInstance;\n\n  if (owner && isDef(factory.owners) && !factory.owners.includes(owner)) {\n    // already pending\n    factory.owners.push(owner);\n  }\n\n  // 3.\n  if (isTrue(factory.loading) && isDef(factory.loadingComp)) {\n    return factory.loadingComp;\n  }\n\n  if (owner && !isDef(factory.owners)) {\n    const owners = (factory.owners = [owner]);\n    let sync = true;\n    let timerLoading = null;\n    let timerTimeout = null;\n\n    owner.$on('hook:destroyed', () => remove(owners, owner));\n\n    const forceRender = (renderCompleted: boolean) => {\n      for (let i = 0, l = owners.length; i < l; i++) {\n        owners[i].$forceUpdate();\n      }\n\n      if (renderCompleted) {\n        owners.length = 0;\n\n        if (timerLoading !== null) {\n          clearTimeout(timerLoading);\n          timerLoading = null;\n        }\n\n        if (timerTimeout !== null) {\n          clearTimeout(timerTimeout);\n          timerTimeout = null;\n        }\n      }\n    };\n\n    const resolve = once((res: Object | Class<Component>) => {\n      // cache resolved\n      factory.resolved = ensureCtor(res, baseCtor);\n      // invoke callbacks only if this is not a synchronous resolve\n      // (async resolves are shimmed as synchronous during SSR)\n      if (!sync) {\n        forceRender(true);\n      } else {\n        owners.length = 0;\n      }\n    });\n\n    const reject = once(reason => {\n      if (isDef(factory.errorComp)) {\n        factory.error = true;\n        forceRender(true);\n      }\n    });\n\n    const res = factory(resolve, reject);\n\n    if (isObject(res)) {\n      if (isPromise(res)) {\n        // 2. () => Promise.\n        if (isUndef(factory.resolved)) {\n          res.then(resolve, reject);\n        }\n      } else if (isPromise(res.component)) {\n        // 3.\n        res.component.then(resolve, reject);\n\n        if (isDef(res.error)) {\n          factory.errorComp = ensureCtor(res.error, baseCtor);\n        }\n\n        if (isDef(res.loading)) {\n          factory.loadingComp = ensureCtor(res.loading, baseCtor);\n\n          if (res.delay === 0) {\n            factory.loading = true;\n          } else {\n            timerLoading = setTimeout(() => {\n              timerLoading = null;\n\n              if (isUndef(factory.resolved) && isUndef(factory.error)) {\n                factory.loading = true;\n                forceRender(false);\n              }\n            }, res.delay || 200);\n          }\n        }\n\n        if (isDef(res.timeout)) {\n          timerTimeout = setTimeout(() => {\n            timerTimeout = null;\n\n            if (isUndef(factory.resolved)) {\n              reject(null);\n            }\n          }, res.timeout);\n        }\n      }\n    }\n\n    sync = false;\n    // return in case resolved synchronously\n    return factory.loading ? factory.loadingComp : factory.resolved;\n  }\n}\n\nfunction ensureCtor(comp: any, base) {\n  if (comp.__esModule || (hasSymbol && comp[Symbol.toStringTag] === 'Module')) {\n    comp = comp.default;\n  }\n\n  return isObject(comp) ? base.extend(comp) : comp;\n}\n\nfunction createAsyncPlaceholder(\n  factory: Function,\n  data: ?VNodeData,\n  context: Component,\n  children: ?Array<VNode>,\n  tag: ?string\n): VNode {\n  const node = createEmptyVNode();\n  node.asyncFactory = factory;\n  node.asyncMeta = { data, context, children, tag };\n  return node;\n}\n")),(0,o.kt)("h3",{id:"vue-legacy-reactivity"},"Vue Legacy Reactivity"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://ustbhuangyi.github.io/vue-analysis/v2/reactive/summary.html"},(0,o.kt)("img",{alt:"Reactive",src:t(6422).Z,width:"1898",height:"1278"}))),(0,o.kt)("p",null,"Collect deps (get):"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"watcher.get()"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"pushTarget(watcher)"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"watcherGetter()"),": Access reactive object ",(0,o.kt)("inlineCode",{parentName:"li"},"reactiveObject.key"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"reactiveObject.get(key)")," (",(0,o.kt)("inlineCode",{parentName:"li"},"defineReactive"),")."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"dep.depend()")," + ",(0,o.kt)("inlineCode",{parentName:"li"},"childObserver.dep.depend()")," + ",(0,o.kt)("inlineCode",{parentName:"li"},"dependArray()"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"Dep.target.addDep(dep)")," -> ",(0,o.kt)("inlineCode",{parentName:"li"},"watcher.addDep(dep)"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"dep.addSub(watcher)")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"dep.subs.push(watcher)"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"popTarget()"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"watcher.cleanupDeps()"),".")),(0,o.kt)("p",null,"Dispatch updates (set):"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Change reactive object ",(0,o.kt)("inlineCode",{parentName:"li"},"reactiveObject.key = value"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"reactiveObject.set(key, value)")," (",(0,o.kt)("inlineCode",{parentName:"li"},"defineReactive"),")."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"dep.notify()"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"dep.subs.forEach(watcher => watcher.update())"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"watcher.update()"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"queueWatcher(watcher)"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"nextTick(flushSchedulerQueue)"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"watcher.run()"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"watcher.get()"),": Get new value and recollect deps.")),(0,o.kt)("h4",{id:"vue-watcher-and-observer"},"Vue Watcher and Observer"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"core/observer/watcher.js"),":"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Watcher \u7684\u521b\u5efa\u987a\u5e8f\u4e3a\u5148\u7236\u540e\u5b50, \u6267\u884c\u987a\u5e8f (WatcherQueue) \u4fdd\u6301\u5148\u7236\u540e\u5b50."),(0,o.kt)("li",{parentName:"ul"},"\u7528\u6237\u81ea\u5b9a\u4e49 Watcher \u8981\u4f18\u5148\u4e8e RenderWatcher \u6267\u884c (\u5148\u521b\u5efa\u5148\u6267\u884c)."),(0,o.kt)("li",{parentName:"ul"},"\u82e5\u4e00\u4e2a\u7ec4\u4ef6\u5728\u7236\u7ec4\u4ef6\u7684 Watcher \u6267\u884c\u671f\u95f4\u88ab\u9500\u6bc1, \u5219\u5b83\u5bf9\u5e94\u7684 Watcher \u6267\u884c\u90fd\u53ef\u4ee5\u88ab\u8df3\u8fc7."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"RenderWatcher")," (built-in Watcher)\n",(0,o.kt)("inlineCode",{parentName:"li"},"updateComponent = () => vm._update(vm._render(), hydrating)"),":\nWhen reactive props and data changed,\n",(0,o.kt)("inlineCode",{parentName:"li"},"updateComponent")," get invoked automatically."),(0,o.kt)("li",{parentName:"ul"},"\u56db\u79cd ",(0,o.kt)("inlineCode",{parentName:"li"},"Watcher")," \u7c7b\u578b:",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"Computed Watcher"),": ",(0,o.kt)("inlineCode",{parentName:"li"},"Computed Props")," Watcher."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"Sync Watcher"),". ",(0,o.kt)("inlineCode",{parentName:"li"},"sync: true"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"Deep Watcher"),": ",(0,o.kt)("inlineCode",{parentName:"li"},"deep: true"),", \u68c0\u6d4b ",(0,o.kt)("inlineCode",{parentName:"li"},"Object")," \u5185\u90e8\u53d8\u5316."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"User Watcher"),".")))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"let uid = 0;\n\n/**\n * A watcher parses an expression, collects dependencies,\n * and fires callback when the expression value changes.\n * This is used for both the $watch() api and directives.\n */\nexport default class Watcher {\n  vm: Component;\n  expression: string;\n  cb: Function;\n  id: number;\n  deep: boolean;\n  user: boolean;\n  computed: boolean;\n  sync: boolean;\n  dirty: boolean;\n  active: boolean;\n  dep: Dep;\n  deps: Array<Dep>;\n  newDeps: Array<Dep>;\n  depIds: SimpleSet;\n  newDepIds: SimpleSet;\n  before: Function | null;\n  getter: Function;\n  value: any;\n\n  constructor(\n    vm: Component,\n    expOrFn: string | Function,\n    cb: Function,\n    options?: ?Object,\n    isRenderWatcher?: boolean\n  ) {\n    this.vm = vm;\n\n    if (isRenderWatcher) {\n      vm._watcher = this;\n    }\n\n    vm._watchers.push(this);\n\n    // options\n    if (options) {\n      this.deep = !!options.deep;\n      this.user = !!options.user;\n      this.computed = !!options.computed;\n      this.sync = !!options.sync;\n      this.before = options.before;\n    } else {\n      this.deep = this.user = this.computed = this.sync = false;\n    }\n\n    this.cb = cb;\n    this.id = ++uid; // uid for batching\n    this.active = true;\n    this.dirty = this.computed; // for computed watchers\n    this.deps = [];\n    this.newDeps = [];\n    this.depIds = new Set();\n    this.newDepIds = new Set();\n    this.expression = expOrFn.toString();\n\n    // parse expression for getter\n    if (typeof expOrFn === 'function') {\n      this.getter = expOrFn;\n    } else {\n      this.getter = parsePath(expOrFn);\n\n      if (!this.getter) {\n        this.getter = function () {};\n      }\n    }\n\n    if (this.computed) {\n      this.value = undefined;\n      this.dep = new Dep();\n    } else {\n      this.value = this.get();\n    }\n  }\n\n  /**\n   * Evaluate the getter, and re-collect dependencies.\n   */\n  get() {\n    pushTarget(this);\n    const vm = this.vm;\n    const value = this.getter.call(vm, vm);\n\n    if (this.deep) {\n      traverse(value);\n    }\n\n    popTarget();\n    this.cleanupDeps();\n    return value;\n  }\n\n  /**\n   * Add a dependency to this directive.\n   */\n  addDep(dep: Dep) {\n    const id = dep.id;\n\n    if (!this.newDepIds.has(id)) {\n      this.newDepIds.add(id);\n      this.newDeps.push(dep);\n\n      if (!this.depIds.has(id)) {\n        dep.addSub(this);\n      }\n    }\n  }\n\n  /**\n   * Subscriber interface.\n   * Will be called when a dependency changes.\n   */\n  update() {\n    if (this.lazy) {\n      this.dirty = true;\n    } else if (this.sync) {\n      this.run();\n    } else {\n      queueWatcher(this);\n    }\n  }\n\n  /**\n   * Scheduler job interface.\n   * Will be called by the scheduler.\n   */\n  run() {\n    if (this.active) {\n      const value = this.get();\n\n      if (value !== this.value || isObject(value) || this.deep) {\n        // set new value\n        const oldValue = this.value;\n        this.value = value;\n\n        if (this.user) {\n          const info = `callback for watcher \"${this.expression}\"`;\n          invokeWithErrorHandling(\n            this.cb,\n            this.vm,\n            [value, oldValue],\n            this.vm,\n            info\n          );\n        } else {\n          this.cb.call(this.vm, value, oldValue);\n        }\n      }\n    }\n  }\n\n  /**\n   * Depend on this watcher. Only for computed property watchers.\n   */\n  depend() {\n    if (this.dep && Dep.target) {\n      this.dep.depend();\n    }\n  }\n\n  /**\n   * Evaluate and return the value of the watcher.\n   * This only gets called for computed property watchers.\n   */\n  evaluate() {\n    if (this.dirty) {\n      this.value = this.get();\n      this.dirty = false;\n    }\n\n    return this.value;\n  }\n}\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"core/observer/dep.js"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"import { remove } from '../util/index';\nimport type Watcher from './watcher';\n\nlet uid = 0;\n\n/**\n * A dep is an observable that can have multiple\n * directives subscribing to it.\n */\nexport default class Dep {\n  static target: ?Watcher;\n  id: number;\n  subs: Array<Watcher>;\n\n  constructor() {\n    this.id = uid++;\n    this.subs = [];\n  }\n\n  addSub(sub: Watcher) {\n    this.subs.push(sub);\n  }\n\n  removeSub(sub: Watcher) {\n    remove(this.subs, sub);\n  }\n\n  depend() {\n    if (Dep.target) {\n      Dep.target.addDep(this);\n    }\n  }\n\n  notify() {\n    // stabilize the subscriber list first\n    const subs = this.subs.slice();\n    for (let i = 0, l = subs.length; i < l; i++) {\n      subs[i].update();\n    }\n  }\n}\n\n// the current target watcher being evaluated.\n// this is globally unique because there could be only one\n// watcher being evaluated at any time.\nDep.target = null;\nconst targetStack = [];\n\nexport function pushTarget(_target: ?Watcher) {\n  if (Dep.target) targetStack.push(Dep.target);\n  Dep.target = _target;\n}\n\nexport function popTarget() {\n  Dep.target = targetStack.pop();\n}\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"core/observer/index.js"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"/**\n * Observer class that is attached to each observed\n * object. Once attached, the observer converts the target\n * object's property keys into getter/setters that\n * collect dependencies and dispatch updates.\n */\nexport class Observer {\n  value: any;\n  dep: Dep;\n  vmCount: number; // number of vms that have this object as root $data\n\n  constructor(value: any) {\n    this.value = value;\n    this.dep = new Dep();\n    this.vmCount = 0;\n    def(value, '__ob__', this);\n\n    if (Array.isArray(value)) {\n      if (hasProto) {\n        protoAugment(value, arrayMethods);\n      } else {\n        copyAugment(value, arrayMethods, arrayKeys);\n      }\n\n      this.observeArray(value);\n    } else {\n      this.walk(value);\n    }\n  }\n\n  /**\n   * Walk through all properties and convert them into\n   * getter/setters. This method should only be called when\n   * value type is Object.\n   */\n  walk(obj: Object) {\n    const keys = Object.keys(obj);\n\n    for (let i = 0; i < keys.length; i++) {\n      defineReactive(obj, keys[i]);\n    }\n  }\n\n  /**\n   * Observe a list of Array items.\n   */\n  observeArray(items: Array<any>) {\n    for (let i = 0, l = items.length; i < l; i++) {\n      observe(items[i]);\n    }\n  }\n}\n\n/**\n * Attempt to create an observer instance for a value,\n * returns the new observer if successfully observed,\n * or the existing observer if the value already has one.\n */\nexport function observe(value: any, asRootData: ?boolean): Observer | void {\n  if (!isObject(value) || value instanceof VNode) {\n    return;\n  }\n\n  let ob: Observer | void;\n\n  if (hasOwn(value, '__ob__') && value.__ob__ instanceof Observer) {\n    ob = value.__ob__;\n  } else if (\n    shouldObserve &&\n    !isServerRendering() &&\n    (Array.isArray(value) || isPlainObject(value)) &&\n    Object.isExtensible(value) &&\n    !value._isVue\n  ) {\n    ob = new Observer(value);\n  }\n\n  if (asRootData && ob) {\n    ob.vmCount++;\n  }\n\n  return ob;\n}\n\n/**\n * Define a reactive property on an Object.\n */\nexport function defineReactive(\n  obj: Object,\n  key: string,\n  val: any,\n  customSetter?: ?Function,\n  shallow?: boolean\n) {\n  const dep = new Dep();\n\n  const property = Object.getOwnPropertyDescriptor(obj, key);\n\n  if (property && property.configurable === false) {\n    return;\n  }\n\n  // cater for pre-defined getter/setters\n  const getter = property && property.get;\n  const setter = property && property.set;\n\n  if ((!getter || setter) && arguments.length === 2) {\n    val = obj[key];\n  }\n\n  let childOb = !shallow && observe(val);\n\n  Object.defineProperty(obj, key, {\n    enumerable: true,\n    configurable: true,\n    get: function reactiveGetter() {\n      const value = getter ? getter.call(obj) : val;\n\n      if (Dep.target) {\n        dep.depend();\n\n        // \u5bf9\u4e8e\u6570\u7ec4\u7684\u7279\u6b8a\u5904\u7406:\n        if (childOb) {\n          // 1. \u6536\u96c6\u6570\u7ec4\u672c\u8eab\u4f9d\u8d56.\n          childOb.dep.depend();\n\n          // 2. \u6536\u96c6\u5d4c\u5957\u6570\u7ec4\u4f9d\u8d56.\n          if (Array.isArray(value)) {\n            dependArray(value);\n          }\n        }\n      }\n\n      return value;\n    },\n    set: function reactiveSetter(newVal) {\n      const value = getter ? getter.call(obj) : val;\n\n      /* eslint-disable no-self-compare */\n      if (newVal === value || (newVal !== newVal && value !== value)) {\n        return;\n      }\n\n      if (setter) {\n        setter.call(obj, newVal);\n      } else {\n        val = newVal;\n      }\n\n      childOb = !shallow && observe(newVal);\n      dep.notify();\n    },\n  });\n}\n")),(0,o.kt)("h4",{id:"vue-array-watcher"},"Vue Array Watcher"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"const methodsToPatch = [\n  'push',\n  'pop',\n  'shift',\n  'unshift',\n  'splice',\n  'sort',\n  'reverse',\n];\n\nmethodsToPatch.forEach(function (method) {\n  // Cache original method.\n  const original = Array.prototype[method];\n\n  def(arrayMethods, method, function mutator(...args) {\n    const result = original.apply(this, args);\n    const ob = this.__ob__;\n    let inserted;\n\n    switch (method) {\n      case 'push':\n      case 'unshift':\n        inserted = args;\n        break;\n      case 'splice':\n        inserted = args.slice(2);\n        break;\n    }\n\n    if (inserted) ob.observeArray(inserted);\n    ob.dep.notify();\n    return result;\n  });\n});\n")),(0,o.kt)("h4",{id:"vue-global-set-and-delete-api"},"Vue Global Set and Delete API"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"/**\n * Set a property on an object. Adds the new property and\n * triggers change notification if the property doesn't\n * already exist.\n */\nVue.set = function set(target: Array<any> | Object, key: any, val: any): any {\n  if (Array.isArray(target) && isValidArrayIndex(key)) {\n    target.length = Math.max(target.length, key);\n    target.splice(key, 1, val);\n    return val;\n  }\n\n  if (key in target && !(key in Object.prototype)) {\n    target[key] = val;\n    return val;\n  }\n\n  const ob = target.__ob__;\n\n  if (target._isVue || (ob && ob.vmCount)) {\n    return val;\n  }\n\n  if (!ob) {\n    target[key] = val;\n    return val;\n  }\n\n  defineReactive(ob.value, key, val);\n  ob.dep.notify();\n  return val;\n};\n\n/**\n * Delete a property and trigger change if necessary.\n */\nVue.del = function del(target: Array<any> | Object, key: any) {\n  if (Array.isArray(target) && isValidArrayIndex(key)) {\n    target.splice(key, 1);\n    return;\n  }\n\n  const ob = target.__ob__;\n\n  if (target._isVue || (ob && ob.vmCount)) {\n    return;\n  }\n\n  if (!hasOwn(target, key)) {\n    return;\n  }\n\n  delete target[key];\n\n  if (!ob) {\n    return;\n  }\n\n  ob.dep.notify();\n};\n")),(0,o.kt)("h4",{id:"vue-computed-watcher"},"Vue Computed Watcher"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"core/instance/state.js"),":"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"Computed Props")," \u53ea\u5173\u6ce8\u6700\u7ec8\u8ba1\u7b97\u7ed3\u679c\u662f\u5426\u53d1\u751f\u53d8\u5316, \u662f\u4e00\u79cd\u6027\u80fd\u4f18\u5316\u624b\u6bb5."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"Computed Props")," \u6700\u7ec8\u8ba1\u7b97\u7ed3\u679c\u4e0d\u53d8, \u4e0d\u89e6\u53d1\u540e\u7eed\u66f4\u65b0."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"Computed Props")," \u521b\u5efa\u7684 ",(0,o.kt)("inlineCode",{parentName:"li"},"Watcher")," \u79f0\u4e3a ",(0,o.kt)("inlineCode",{parentName:"li"},"Computed Watcher"),".")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"const computedWatcherOptions = { computed: true };\n\nfunction initComputed(vm: Component, computed: Object) {\n  const watchers = (vm._computedWatchers = Object.create(null));\n\n  for (const key in computed) {\n    const userDef = computed[key];\n    const getter = typeof userDef === 'function' ? userDef : userDef.get;\n\n    // create internal watcher for the computed property.\n    watchers[key] = new Watcher(\n      vm,\n      getter || noop,\n      noop,\n      computedWatcherOptions\n    );\n\n    if (!(key in vm)) {\n      defineComputed(vm, key, userDef);\n    }\n  }\n}\n\nexport function defineComputed(\n  target: any,\n  key: string,\n  userDef: Object | Function\n) {\n  if (typeof userDef === 'function') {\n    sharedPropertyDefinition.get = createComputedGetter(key);\n    sharedPropertyDefinition.set = noop;\n  } else {\n    sharedPropertyDefinition.get = userDef.get ?? noop;\n    sharedPropertyDefinition.set = userDef.set ?? noop;\n  }\n\n  Object.defineProperty(target, key, sharedPropertyDefinition);\n}\n\nfunction createComputedGetter(key) {\n  return function computedGetter() {\n    const watcher = this._computedWatchers && this._computedWatchers[key];\n\n    if (watcher) {\n      watcher.depend();\n      return watcher.evaluate();\n    }\n  };\n}\n")),(0,o.kt)("p",null,"Legacy ",(0,o.kt)("inlineCode",{parentName:"p"},"Vuex")," rely on ",(0,o.kt)("inlineCode",{parentName:"p"},"Computed Props"),",\nsee ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/vuejs/vuex/blob/3.x/src/store.js#L281"},(0,o.kt)("inlineCode",{parentName:"a"},"Store")," constructor"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"function resetStoreVM(store, state, hot) {\n  const oldVm = store._vm;\n  store.getters = {};\n  store._makeLocalGettersCache = Object.create(null);\n  const wrappedGetters = store._wrappedGetters;\n  const computed = {};\n\n  forEachValue(wrappedGetters, (fn, key) => {\n    computed[key] = partial(fn, store);\n    Object.defineProperty(store.getters, key, {\n      get: () => store._vm[key],\n      enumerable: true,\n    });\n  });\n\n  // Use a `Vue` instance to store the state tree.\n  const silent = Vue.config.silent;\n  Vue.config.silent = true;\n  store._vm = new Vue({\n    data() {\n      return {\n        $$state: state,\n      };\n    },\n    computed,\n  });\n  Vue.config.silent = silent;\n\n  if (store.strict) {\n    enableStrictMode(store);\n  }\n\n  if (oldVm) {\n    if (hot) {\n      store._withCommit(() => {\n        oldVm._data.$$state = null;\n      });\n    }\n\n    Vue.nextTick(() => oldVm.$destroy());\n  }\n}\n")),(0,o.kt)("h4",{id:"vue-router-watcher"},"Vue Router Watcher"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"<route-link>")," clicked."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"vm.$router.push(location)"),"/",(0,o.kt)("inlineCode",{parentName:"li"},"vm.$router.replace(location)"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"transitionTo(location, onComplete)"),".",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Call routes guard hooks."),(0,o.kt)("li",{parentName:"ul"},"Change ",(0,o.kt)("inlineCode",{parentName:"li"},"vm._routerRoot._route"),"."),(0,o.kt)("li",{parentName:"ul"},"Call ",(0,o.kt)("inlineCode",{parentName:"li"},"window.history.pushState"),"/",(0,o.kt)("inlineCode",{parentName:"li"},"window.history.replaceState")," in ",(0,o.kt)("inlineCode",{parentName:"li"},"onComplete"),"."))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"vm.$route")," trigger ",(0,o.kt)("inlineCode",{parentName:"li"},"<route-view>")," re-rendering.")),(0,o.kt)("h2",{id:"modern-vue-internals"},"Modern Vue Internals"),(0,o.kt)("h3",{id:"vue-virtual-dom"},"Vue Virtual DOM"),(0,o.kt)("p",null,"VNode Type:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"HTML native tag."),(0,o.kt)("li",{parentName:"ul"},"Plain text."),(0,o.kt)("li",{parentName:"ul"},"Component:",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Functional component."),(0,o.kt)("li",{parentName:"ul"},"Stateful component:",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Normal stateful component."),(0,o.kt)("li",{parentName:"ul"},"Need keep-alive stateful component."),(0,o.kt)("li",{parentName:"ul"},"Already keep-alive stateful component."))))),(0,o.kt)("li",{parentName:"ul"},"Fragment."),(0,o.kt)("li",{parentName:"ul"},"Portal."),(0,o.kt)("li",{parentName:"ul"},"Suspense.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"export default class VNode {\n  tag: string | void;\n  data: VNodeData | void;\n  children: Array<VNode> | null;\n  text: string | void;\n  elm: Node | void;\n  ns: string | void;\n  context: Component | void; // rendered in this component's scope\n  key: string | number | void;\n  componentOptions: VNodeComponentOptions | void;\n  componentInstance: Component | void; // component instance\n  parent: VNode | void; // component placeholder node\n\n  // strictly internal\n  raw: boolean; // contains raw HTML? (server only)\n  isStatic: boolean; // hoisted static node\n  isRootInsert: boolean; // necessary for enter transition check\n  isComment: boolean; // empty comment placeholder?\n  isCloned: boolean; // is a cloned node?\n  isOnce: boolean; // is a v-once node?\n  asyncFactory: Function | void; // async component factory function\n  asyncMeta: Object | void;\n  isAsyncPlaceholder: boolean;\n  ssrContext: Object | void;\n  fnContext: Component | void; // real context vm for functional nodes\n  fnOptions: ComponentOptions | null; // for SSR caching\n  fnScopeId: string | null; // functional scope id support\n\n  constructor(\n    tag?: string,\n    data?: VNodeData,\n    children?: Array<VNode> | null,\n    text?: string,\n    elm?: Node,\n    context?: Component,\n    componentOptions?: VNodeComponentOptions,\n    asyncFactory?: Function\n  ) {\n    this.tag = tag;\n    this.data = data;\n    this.children = children;\n    this.text = text;\n    this.elm = elm;\n    this.ns = undefined;\n    this.context = context;\n    this.fnContext = undefined;\n    this.fnOptions = undefined;\n    this.fnScopeId = undefined;\n    this.key = data && data.key;\n    this.componentOptions = componentOptions;\n    this.componentInstance = undefined;\n    this.parent = undefined;\n    this.raw = false;\n    this.isStatic = false;\n    this.isRootInsert = true;\n    this.isComment = false;\n    this.isCloned = false;\n    this.isOnce = false;\n    this.asyncFactory = asyncFactory;\n    this.asyncMeta = undefined;\n    this.isAsyncPlaceholder = false;\n  }\n}\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"const VNodeFlags = {\n  ELEMENT_HTML: 1,\n  ELEMENT_SVG: 1 << 1,\n  COMPONENT_STATEFUL_NORMAL: 1 << 2,\n  COMPONENT_STATEFUL_SHOULD_KEEP_ALIVE: 1 << 3,\n  COMPONENT_STATEFUL_KEPT_ALIVE: 1 << 4,\n  COMPONENT_FUNCTIONAL: 1 << 5,\n  TEXT: 1 << 6,\n  FRAGMENT: 1 << 7,\n  PORTAL: 1 << 8,\n};\n\nVNodeFlags.ELEMENT = VNodeFlags.ELEMENT_HTML | VNodeFlags.ELEMENT_SVG;\n\nVNodeFlags.COMPONENT_STATEFUL =\n  VNodeFlags.COMPONENT_STATEFUL_NORMAL |\n  VNodeFlags.COMPONENT_STATEFUL_SHOULD_KEEP_ALIVE |\n  VNodeFlags.COMPONENT_STATEFUL_KEPT_ALIVE;\n\nVNodeFlags.COMPONENT =\n  VNodeFlags.COMPONENT_STATEFUL | VNodeFlags.COMPONENT_FUNCTIONAL;\n\nconst ChildrenFlags = {\n  // \u672a\u77e5\u7684 children \u7c7b\u578b.\n  UNKNOWN_CHILDREN: 0,\n  // \u6ca1\u6709 children.\n  NO_CHILDREN: 1,\n  // children \u662f\u5355\u4e2a VNode.\n  SINGLE_VNODE: 1 << 1,\n  // children \u662f\u591a\u4e2a\u62e5\u6709 key \u7684 VNode.\n  KEYED_VNODES: 1 << 2,\n  // children \u662f\u591a\u4e2a\u6ca1\u6709 key \u7684 VNode.\n  NONE_KEYED_VNODES: 1 << 3,\n};\n\nChildrenFlags.MULTIPLE_VNODES =\n  ChildrenFlags.KEYED_VNODES | ChildrenFlags.NONE_KEYED_VNODES;\n\nexport interface VNode {\n  _isVNode: true;\n  // Refer to real DOM.\n  el: Element | null;\n  flags: VNodeFlags;\n  tag: string | FunctionalComponent | ComponentClass | null;\n  data: VNodeData | null;\n  children: VNodeChildren;\n  childFlags: ChildrenFlags;\n}\n")),(0,o.kt)("h3",{id:"vue-template-and-compiler"},"Vue Template and Compiler"),(0,o.kt)("h4",{id:"vue-compilation-workflow"},"Vue Compilation Workflow"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"function compile(template: string, options: CompilerOptions): CompiledResult {\n  const ast = parse(template.trim(), options);\n  optimize(ast, options);\n  const code = generate(ast, options);\n\n  return {\n    ast,\n    render: code.render,\n    staticRenderFns: code.staticRenderFns,\n  };\n}\n")),(0,o.kt)("p",null,"template \u5c5e\u6027\u5b58\u5728, render \u65b9\u6cd5\u4e0d\u5b58\u5728\u65f6:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"runtime with compiler \u7248\u672c\u4f1a\u5728 JavaScript \u8fd0\u884c\u65f6\u8fdb\u884c\u6a21\u677f\u7f16\u8bd1, \u751f\u6210 render \u51fd\u6570."),(0,o.kt)("li",{parentName:"ul"},"runtime only \u7248\u672c\u4f1a\u6253\u5370\u8b66\u544a\u4fe1\u606f, \u63d0\u793a\u7528\u6237\u4f7f\u7528 runtime with compiler \u7248\u672c\u6216\u8005\u4f7f\u7528\u4f7f\u7528 ",(0,o.kt)("inlineCode",{parentName:"li"},"vue-loader")," \u8fdb\u884c\u9759\u6001\u7f16\u8bd1.")),(0,o.kt)("h4",{id:"vue-compilation-performant-improvements"},"Vue Compilation Performant Improvements"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Shorten template helper function with prefix ",(0,o.kt)("inlineCode",{parentName:"li"},"_v"),"/",(0,o.kt)("inlineCode",{parentName:"li"},"_s")," etc."),(0,o.kt)("li",{parentName:"ul"},"Hoist static template blocks,\neliminate unnecessary virtual DOM diff effort,\nonly track dynamic VNode."),(0,o.kt)("li",{parentName:"ul"},"Cache event handlers (like ",(0,o.kt)("inlineCode",{parentName:"li"},"useCallback")," in React).")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"function isStatic(node: ASTNode): boolean {\n  if (node.type === 2) {\n    // expression\n    return false;\n  }\n\n  if (node.type === 3) {\n    // text\n    return true;\n  }\n\n  return !!(\n    node.pre ||\n    (!node.hasBindings && // no dynamic bindings\n      !node.if &&\n      !node.for && // not v-if or v-for or v-else\n      !isBuiltInTag(node.tag) && // not a built-in\n      isPlatformReservedTag(node.tag) && // not a component\n      !isDirectChildOfTemplateFor(node) &&\n      Object.keys(node).every(isStaticKey))\n  );\n}\n")),(0,o.kt)("h3",{id:"vue-two-way-data-binding"},"Vue Two-Way Data Binding"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"View-Model"),": \u4e3b\u8981\u505a\u4e86\u4e24\u4ef6\u5fae\u5c0f\u7684\u4e8b\u60c5:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u4ece M \u5230 V \u7684\u6620\u5c04 (Data Binding), \u8fd9\u6837\u53ef\u4ee5\u5927\u91cf\u8282\u7701\u4eba\u8089\u6765 update View \u7684\u4ee3\u7801:\n\u901a\u8fc7 Proxy \u4ee3\u7406 Model, \u6bcf\u5f53\u8c03\u7528 ",(0,o.kt)("inlineCode",{parentName:"li"},"Model[property].set")," \u65f6\u540c\u65f6\u8c03\u7528 ",(0,o.kt)("inlineCode",{parentName:"li"},"render")),(0,o.kt)("li",{parentName:"ul"},"\u4ece V \u5230 M \u7684\u4e8b\u4ef6\u76d1\u542c (DOM Listeners), \u8fd9\u6837 Model \u4f1a\u968f\u7740 View \u89e6\u53d1\u4e8b\u4ef6\u800c\u6539\u53d8")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"const _data = {\n  name: 'mark',\n};\n\n// new Proxy(target, handler);\nconst changeName = new Proxy(_data, {\n  set(obj, name, value) {\n    obj[name] = value;\n    render();\n  },\n});\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"Array.from(el.getElementsByTagName('input'))\n  .filter(ele => {\n    return ele.getAttribute('v-model');\n  })\n  .forEach(input => {\n    const name = input.getAttribute('v-model');\n    input.value = changeName[name];\n\n    // DOM Event Listener (listen to the changes of view)\n    input.oninput = function () {\n      changeName[name] = this.value;\n    };\n  });\n")),(0,o.kt)("h3",{id:"vue-reactivity"},"Vue Reactivity"),(0,o.kt)("p",null,"Data ",(0,o.kt)("inlineCode",{parentName:"p"},"getter"),"/",(0,o.kt)("inlineCode",{parentName:"p"},"setter")," -> Notify -> Watcher -> Trigger --\x3e Renderer:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"console.log(data.a); // getHook() get called.\ndata.a = 2; // setHook() get called.\n")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"targetMap")," -> ",(0,o.kt)("inlineCode",{parentName:"li"},"key: effectsMap"),": key is reactive object."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"effectsMap")," -> ",(0,o.kt)("inlineCode",{parentName:"li"},"key: effects"),": key is object property name.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"type Primitive = string | number | boolean;\ntype Key = string | symbol;\ntype Effect<T> = () => T;\n\nconst runningEffects = [];\n\nconst targetMap = new WeakMap();\n\n// runEffect -> effect -> proxy.get -> track.\nfunction createEffect<T>(effect: Effect<T>) {\n  runningEffects.push(effect);\n  effect();\n  runningEffects.pop();\n}\n\nfunction track<T extends object>(target: T, key: Key) {\n  for (const effect of runningEffects) {\n    let effectsMap = targetMap.get(target);\n    if (!effectsMap) targetMap.set(target, (effectsMap = new Map()));\n\n    let effects = effectsMap.get(key);\n    if (!effects) effectsMap.set(key, (effects = new Set()));\n\n    effects.add(effect);\n  }\n}\n\nfunction trigger<T extends object>(target: T, key: Key) {\n  const effectsMap = targetMap.get(target);\n  if (!effectsMap) return;\n\n  const effects = effectsMap.get(key);\n  if (effects) effects.forEach(effect => effect());\n}\n\nexport function reactive<T extends object>(target: T) {\n  const handler: ProxyHandler<T> = {\n    get(target, key, receiver) {\n      const value = Reflect.get(target, key, receiver);\n      track(target, key);\n      if (value !== null && typeof value === 'object') return reactive(value);\n      else return value;\n    },\n    set(target, key, value, receiver) {\n      const oldValue = Reflect.get(target, key, receiver);\n      const result = Reflect.set(target, key, value, receiver);\n      if (result && oldValue !== value) trigger(target, key);\n      return result;\n    },\n  };\n\n  return new Proxy(target, handler);\n}\n\nexport function ref<T extends Primitive>(raw?: T) {\n  const refObject = {\n    get value() {\n      track(refObject, 'value');\n      return raw;\n    },\n    set value(newValue: T) {\n      raw = newValue;\n      trigger(refObject, 'value');\n    },\n  };\n\n  return refObject;\n}\n\nexport function computed<T extends Primitive>(getter: () => T) {\n  const refObject = ref<T>();\n  createEffect(() => (refObject.value = getter()));\n  return refObject;\n}\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"interface Product {\n  price: number;\n  quantity: number;\n}\n\nconst product = reactive<Product>({ price: 5, quantity: 2 });\nconst salePrice = computed(() => product.price * 0.9);\nconst total = computed(() => salePrice.value * product.quantity);\n\nconsole.assert(salePrice.value === 4.5);\nconsole.assert(total.value === 9);\n\nproduct.quantity = 3;\nconsole.assert(total.value === 13.5);\n\nproduct.quantity = 4;\nconsole.assert(total.value === 18);\n\nproduct.price = 6;\nconsole.assert(salePrice.value === 5.4);\nconsole.assert(total.value === 21.6);\n\nproduct.price = 10;\nconsole.assert(salePrice.value === 9);\nconsole.assert(total.value === 36);\n")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"effect.ts"),": ",(0,o.kt)("inlineCode",{parentName:"li"},"effect"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"track"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"trigger"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"baseHandlers.ts"),": proxy handler (",(0,o.kt)("inlineCode",{parentName:"li"},"get")," and ",(0,o.kt)("inlineCode",{parentName:"li"},"set"),")."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"reactive.ts"),": ",(0,o.kt)("inlineCode",{parentName:"li"},"reactive")," using ES6 Proxy."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"ref.ts"),":",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"reactive reference using Object Accessors."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"ref")," performant over ",(0,o.kt)("inlineCode",{parentName:"li"},"reactive"),"."))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"computed.ts"),": ",(0,o.kt)("inlineCode",{parentName:"li"},"computed")," using ",(0,o.kt)("inlineCode",{parentName:"li"},"effect")," and return a ",(0,o.kt)("inlineCode",{parentName:"li"},"ref"),".")),(0,o.kt)("h4",{id:"es6-reactive-proxy"},"ES6 Reactive Proxy"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Simple: ",(0,o.kt)("inlineCode",{parentName:"li"},"Proxy")," \u4f7f\u7528\u4e0a\u6bd4 ",(0,o.kt)("inlineCode",{parentName:"li"},"Object.defineProperty")," \u65b9\u4fbf.",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"Object.defineProperty")," \u53ea\u80fd\u76d1\u542c\u5bf9\u8c61, \u5bfc\u81f4 ",(0,o.kt)("inlineCode",{parentName:"li"},"Vue 2")," ",(0,o.kt)("inlineCode",{parentName:"li"},"data")," \u5c5e\u6027\u5fc5\u987b\u901a\u8fc7\u4e00\u4e2a\u8fd4\u56de\u5bf9\u8c61\u7684\u51fd\u6570\u65b9\u5f0f\u521d\u59cb\u5316,"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"Vue 3")," \u66f4\u52a0\u591a\u5143\u5316, \u53ef\u4ee5\u76d1\u542c\u4efb\u610f\u6570\u636e."))),(0,o.kt)("li",{parentName:"ul"},"Performant: ",(0,o.kt)("inlineCode",{parentName:"li"},"Proxy")," \u4ee3\u7406\u6574\u4e2a\u5bf9\u8c61, ",(0,o.kt)("inlineCode",{parentName:"li"},"Object.defineProperty")," \u53ea\u4ee3\u7406\u5bf9\u8c61\u4e0a\u7684\u67d0\u4e2a\u5c5e\u6027.",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"Object.defineProperty")," \u7531\u4e8e\u6bcf\u6b21\u53ea\u80fd\u76d1\u542c\u5bf9\u8c61\u4e00\u4e2a\u952e\u7684 ",(0,o.kt)("inlineCode",{parentName:"li"},"get"),"/",(0,o.kt)("inlineCode",{parentName:"li"},"set"),", \u5bfc\u81f4\u9700\u8981\u5faa\u73af\u76d1\u542c\u6d6a\u8d39\u6027\u80fd."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"Proxy")," \u53ef\u4ee5\u4e00\u6b21\u6027\u76d1\u542c\u5230\u6240\u6709\u5c5e\u6027."))),(0,o.kt)("li",{parentName:"ul"},"Lazy: ",(0,o.kt)("inlineCode",{parentName:"li"},"Proxy")," \u6027\u80fd\u4f18\u4e8e ",(0,o.kt)("inlineCode",{parentName:"li"},"Object.defineProperty"),".",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"\u5982\u679c\u5bf9\u8c61\u5185\u90e8\u8981\u5168\u90e8\u9012\u5f52\u4ee3\u7406, \u5219 ",(0,o.kt)("inlineCode",{parentName:"li"},"Proxy")," \u53ef\u4ee5\u53ea\u5728\u8c03\u7528\u65f6\u9012\u5f52."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"Object.defineProperty")," \u9700\u8981\u5728\u4e00\u5f00\u59cb\u5c31\u5168\u90e8\u9012\u5f52."))),(0,o.kt)("li",{parentName:"ul"},"Feature:",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"\u5bf9\u8c61\u4e0a\u5b9a\u4e49\u65b0\u5c5e\u6027\u65f6, \u53ea\u6709 ",(0,o.kt)("inlineCode",{parentName:"li"},"Proxy")," \u53ef\u4ee5\u76d1\u542c\u5230."),(0,o.kt)("li",{parentName:"ul"},"\u6570\u7ec4\u65b0\u589e\u5220\u9664\u4fee\u6539\u65f6, \u53ea\u6709 ",(0,o.kt)("inlineCode",{parentName:"li"},"Proxy")," \u53ef\u4ee5\u76d1\u542c\u5230."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"Object.defineProperty")," \u65e0\u6cd5\u76d1\u542c\u6570\u7ec4, ",(0,o.kt)("inlineCode",{parentName:"li"},"Proxy")," \u5219\u53ef\u4ee5\u76f4\u63a5\u76d1\u542c\u6570\u7ec4\u53d8\u5316."),(0,o.kt)("li",{parentName:"ul"},"Vue2: \u91cd\u5199\u6570\u7ec4\u65b9\u6cd5\u76d1\u542c\u6570\u7ec4\u53d8\u5316, Vue3: ",(0,o.kt)("inlineCode",{parentName:"li"},"Proxy")," \u76d1\u542c\u6570\u7ec4\u53d8\u5316."))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"Proxy")," \u4e0d\u517c\u5bb9 IE, ",(0,o.kt)("inlineCode",{parentName:"li"},"Object.defineProperty")," \u4e0d\u517c\u5bb9 IE8 \u53ca\u4ee5\u4e0b.")),(0,o.kt)("p",null,"Vue 2:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"Vue.set(app.items, indexOfItem, newValue);\nVue.set(app.product, newField, newValue);\n")),(0,o.kt)("p",null,"Vue 3:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"app.items[indexOfItem] = newValue;\napp.product[newField] = newValue;\n")),(0,o.kt)("h3",{id:"vue-setup"},"Vue Setup"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/vuejs/core/blob/main/packages/runtime-core/src/component.ts"},"Setup workflow"),":"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/vuejs/core/blob/main/packages/runtime-core/src/renderer.ts"},(0,o.kt)("inlineCode",{parentName:"a"},"mountComponent(initialVNode, container)")),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"instance = createComponentInstance(initialVNode)"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"setupComponent(instance)"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"setupStatefulComponent(instance)"),".",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"setupContext = createSetupContext(instance)"),": ",(0,o.kt)("inlineCode",{parentName:"li"},"{ attrs, slots, emit }"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"setupResult = setup(instance.props, setupContext)"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"handleSetupResult(instance, setupResult)"),"."))),(0,o.kt)("li",{parentName:"ul"},"\u5bf9\u6e32\u67d3\u4e0a\u4e0b\u6587 ",(0,o.kt)("inlineCode",{parentName:"li"},"instance.ctx")," (",(0,o.kt)("inlineCode",{parentName:"li"},"Options API")," \u7528\u6237\u4ee3\u7801\u4e2d\u7684 ",(0,o.kt)("inlineCode",{parentName:"li"},"this"),") \u5c5e\u6027\u7684\u8bbf\u95ee\u548c\u4fee\u6539,\n\u4ee3\u7406\u5230\u5bf9 ",(0,o.kt)("inlineCode",{parentName:"li"},"setupState"),"/",(0,o.kt)("inlineCode",{parentName:"li"},"ctx"),"/",(0,o.kt)("inlineCode",{parentName:"li"},"data"),"/",(0,o.kt)("inlineCode",{parentName:"li"},"props")," \u4e2d\u7684\u6570\u636e\u7684\u8bbf\u95ee\u548c\u4fee\u6539\n(",(0,o.kt)("inlineCode",{parentName:"li"},"PublicInstanceProxyHandlers"),"):",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"setupState"),": ",(0,o.kt)("inlineCode",{parentName:"li"},"setup()")," return value, \u6700\u9ad8\u4f18\u5148\u7ea7."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"data"),": data from ",(0,o.kt)("inlineCode",{parentName:"li"},"Options API"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"props"),": props from ",(0,o.kt)("inlineCode",{parentName:"li"},"Options API"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"ctx"),": computed value/methods from ",(0,o.kt)("inlineCode",{parentName:"li"},"Options API"),".")))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"const mountComponent = (\n  initialVNode,\n  container,\n  anchor,\n  parentComponent,\n  parentSuspense,\n  isSVG,\n  optimized\n) => {\n  // \u521b\u5efa\u7ec4\u4ef6\u5b9e\u4f8b\n  const instance = (initialVNode.component = createComponentInstance(\n    initialVNode,\n    parentComponent,\n    parentSuspense\n  ));\n\n  // \u8bbe\u7f6e\u7ec4\u4ef6\u5b9e\u4f8b\n  setupComponent(instance);\n\n  // \u8bbe\u7f6e\u5e76\u8fd0\u884c\u5e26\u526f\u4f5c\u7528\u7684\u6e32\u67d3\u51fd\u6570\n  setupRenderEffect(\n    instance,\n    initialVNode,\n    container,\n    anchor,\n    parentSuspense,\n    isSVG,\n    optimized\n  );\n};\n\nfunction createComponentInstance(vnode, parent, suspense) {\n  // \u7ee7\u627f\u7236\u7ec4\u4ef6\u5b9e\u4f8b\u4e0a\u7684 appContext, \u5982\u679c\u662f\u6839\u7ec4\u4ef6, \u5219\u76f4\u63a5\u4ece\u6839 vnode \u4e2d\u53d6.\n  const appContext =\n    (parent ? parent.appContext : vnode.appContext) || emptyAppContext;\n\n  const instance = {\n    // \u7ec4\u4ef6\u552f\u4e00 id\n    uid: uid++,\n    // \u7ec4\u4ef6 vnode\n    vnode,\n    // \u7236\u7ec4\u4ef6\u5b9e\u4f8b\n    parent,\n    // app \u4e0a\u4e0b\u6587\n    appContext,\n    // vnode \u8282\u70b9\u7c7b\u578b\n    type: vnode.type,\n    // \u6839\u7ec4\u4ef6\u5b9e\u4f8b\n    root: null,\n    // \u65b0\u7684\u7ec4\u4ef6 vnode\n    next: null,\n    // \u5b50\u8282\u70b9 vnode\n    subTree: null,\n    // \u5e26\u526f\u4f5c\u7528\u66f4\u65b0\u51fd\u6570\n    update: null,\n    // \u6e32\u67d3\u51fd\u6570\n    render: null,\n    // \u6e32\u67d3\u4e0a\u4e0b\u6587\u4ee3\u7406\n    proxy: null,\n    // \u5e26\u6709 with \u533a\u5757\u7684\u6e32\u67d3\u4e0a\u4e0b\u6587\u4ee3\u7406\n    withProxy: null,\n    // \u54cd\u5e94\u5f0f\u76f8\u5173\u5bf9\u8c61\n    effects: null,\n    // \u4f9d\u8d56\u6ce8\u5165\u76f8\u5173\n    provides: parent ? parent.provides : Object.create(appContext.provides),\n    // \u6e32\u67d3\u4ee3\u7406\u7684\u5c5e\u6027\u8bbf\u95ee\u7f13\u5b58\n    accessCache: null,\n    // \u6e32\u67d3\u7f13\u5b58\n    renderCache: [],\n    // \u6e32\u67d3\u4e0a\u4e0b\u6587\n    ctx: EMPTY_OBJ,\n    // data \u6570\u636e\n    data: EMPTY_OBJ,\n    // props \u6570\u636e\n    props: EMPTY_OBJ,\n    // \u666e\u901a\u5c5e\u6027\n    attrs: EMPTY_OBJ,\n    // \u63d2\u69fd\u76f8\u5173\n    slots: EMPTY_OBJ,\n    // \u7ec4\u4ef6\u6216\u8005 DOM \u7684 ref \u5f15\u7528\n    refs: EMPTY_OBJ,\n    // setup \u51fd\u6570\u8fd4\u56de\u7684\u54cd\u5e94\u5f0f\u7ed3\u679c\n    setupState: EMPTY_OBJ,\n    // setup \u51fd\u6570\u4e0a\u4e0b\u6587\u6570\u636e\n    setupContext: null,\n    // \u6ce8\u518c\u7684\u7ec4\u4ef6\n    components: Object.create(appContext.components),\n    // \u6ce8\u518c\u7684\u6307\u4ee4\n    directives: Object.create(appContext.directives),\n    // suspense \u76f8\u5173\n    suspense,\n    // suspense \u5f02\u6b65\u4f9d\u8d56\n    asyncDep: null,\n    // suspense \u5f02\u6b65\u4f9d\u8d56\u662f\u5426\u90fd\u5df2\u5904\u7406\n    asyncResolved: false,\n    // \u662f\u5426\u6302\u8f7d\n    isMounted: false,\n    // \u662f\u5426\u5378\u8f7d\n    isUnmounted: false,\n    // \u662f\u5426\u6fc0\u6d3b\n    isDeactivated: false,\n    // \u751f\u547d\u5468\u671f, before create\n    bc: null,\n    // \u751f\u547d\u5468\u671f, created\n    c: null,\n    // \u751f\u547d\u5468\u671f, before mount\n    bm: null,\n    // \u751f\u547d\u5468\u671f, mounted\n    m: null,\n    // \u751f\u547d\u5468\u671f, before update\n    bu: null,\n    // \u751f\u547d\u5468\u671f, updated\n    u: null,\n    // \u751f\u547d\u5468\u671f, unmounted\n    um: null,\n    // \u751f\u547d\u5468\u671f, before unmount\n    bum: null,\n    // \u751f\u547d\u5468\u671f, deactivated\n    da: null,\n    // \u751f\u547d\u5468\u671f activated\n    a: null,\n    // \u751f\u547d\u5468\u671f render triggered\n    rtg: null,\n    // \u751f\u547d\u5468\u671f render tracked\n    rtc: null,\n    // \u751f\u547d\u5468\u671f error captured\n    ec: null,\n    // \u6d3e\u53d1\u4e8b\u4ef6\u65b9\u6cd5\n    emit: null,\n  };\n\n  // \u521d\u59cb\u5316\u6e32\u67d3\u4e0a\u4e0b\u6587\n  instance.ctx = { _: instance };\n  // \u521d\u59cb\u5316\u6839\u7ec4\u4ef6\u6307\u9488\n  instance.root = parent ? parent.root : instance;\n  // \u521d\u59cb\u5316\u6d3e\u53d1\u4e8b\u4ef6\u65b9\u6cd5\n  instance.emit = emit.bind(null, instance);\n\n  return instance;\n}\n\nfunction setupComponent(instance, isSSR = false) {\n  const { props, children, shapeFlag } = instance.vnode;\n\n  // STATEFUL_COMPONENT\n  const isStateful = shapeFlag & 4;\n\n  // \u521d\u59cb\u5316 props\n  initProps(instance, props, isStateful, isSSR);\n  // \u521d\u59cb\u5316 \u63d2\u69fd\n  initSlots(instance, children);\n\n  // \u8bbe\u7f6e\u6709\u72b6\u6001\u7684\u7ec4\u4ef6\u5b9e\u4f8b\n  const setupResult = isStateful\n    ? setupStatefulComponent(instance, isSSR)\n    : undefined;\n\n  return setupResult;\n}\n\nfunction setupStatefulComponent(instance, isSSR) {\n  const Component = instance.type;\n\n  // \u521b\u5efa\u6e32\u67d3\u4ee3\u7406\u7684\u5c5e\u6027\u8bbf\u95ee\u7f13\u5b58\n  instance.accessCache = {};\n\n  // \u521b\u5efa\u6e32\u67d3\u4e0a\u4e0b\u6587\u4ee3\u7406\n  instance.proxy = new Proxy(instance.ctx, PublicInstanceProxyHandlers);\n\n  // \u5224\u65ad\u5904\u7406 setup \u51fd\u6570\n  const { setup } = Component;\n\n  if (setup) {\n    // \u5982\u679c setup \u51fd\u6570\u5e26\u53c2\u6570\uff0c\u5219\u521b\u5efa\u4e00\u4e2a setupContext\n    const setupContext = (instance.setupContext =\n      setup.length > 1 ? createSetupContext(instance) : null);\n    // \u6267\u884c setup \u51fd\u6570\uff0c\u83b7\u53d6\u7ed3\u679c\n    const setupResult = callWithErrorHandling(\n      setup,\n      instance,\n      0 /* SETUP_FUNCTION */,\n      [instance.props, setupContext]\n    );\n    // \u5904\u7406 setup \u6267\u884c\u7ed3\u679c\n    handleSetupResult(instance, setupResult);\n  } else {\n    // \u5b8c\u6210\u7ec4\u4ef6\u5b9e\u4f8b\u8bbe\u7f6e\n    finishComponentSetup(instance);\n  }\n}\n\nfunction handleSetupResult(instance, setupResult) {\n  if (isFunction(setupResult)) {\n    // setup \u8fd4\u56de\u6e32\u67d3\u51fd\u6570\n    instance.render = setupResult;\n  } else if (isObject(setupResult)) {\n    // \u628a setup \u8fd4\u56de\u7ed3\u679c\u53d8\u6210\u54cd\u5e94\u5f0f\n    instance.setupState = reactive(setupResult);\n  }\n\n  finishComponentSetup(instance);\n}\n")))}m.isMDXComponent=!0},2912:function(e,n,t){n.Z=t.p+"assets/images/lifecycle-4a919f7471e246973e7380cf0871a739.png"},6422:function(e,n,t){n.Z=t.p+"assets/images/proxy-165836ddcbf17e6e058a1620bdd7ac73.png"}}]);